<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>MPlayer - Медиа Проигрыватель</title><link rel="stylesheet" href="default.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="ru" class="book" title="MPlayer - Медиа Проигрыватель"><div class="titlepage"><div><div><h1 class="title"><a name="index"></a><span class="application">MPlayer</span> - Медиа Проигрыватель</h1></div><div><h2 class="subtitle"><a class="ulink" href="http://www.mplayerhq.hu" target="_top">http://www.mplayerhq.hu</a></h2></div><div><p class="copyright">Copyright © 2000-2010 MPlayer team</p></div><div><div class="legalnotice" title="License"><a name="id2499750"></a><p class="legalnotice-title"><b>License</b></p><p>MPlayer is free software; you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by the
  Free Software Foundation; either version 2 of the License, or (at your
  option) any later version.</p><p>MPlayer is distributed in the hope that it will be useful, but
  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
  for more details.</p><p>You should have received a copy of the GNU General Public License
  along with MPlayer; if not, write to the Free Software Foundation,
  Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</p></div></div></div><hr></div><div class="toc"><dl><dt><span class="preface"><a href="#howtoread">Как читать эту документацию</a></span></dt><dt><span class="chapter"><a href="#intro">1. Введение</a></span></dt><dt><span class="chapter"><a href="#install">2. Установка</a></span></dt><dd><dl><dt><span class="sect1"><a href="#softreq">2.1. Требуемые программы:</a></span></dt><dt><span class="sect1"><a href="#features">2.2. Возможности:</a></span></dt><dt><span class="sect1"><a href="#gui">2.3. Как насчёт GUI?</a></span></dt><dt><span class="sect1"><a href="#fonts-osd">2.4. Шрифты и OSD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#truetype-fonts">2.4.1. TrueType шрифты</a></span></dt><dt><span class="sect2"><a href="#bitmap-fonts">2.4.2. Растровые шрифты</a></span></dt><dt><span class="sect2"><a href="#osdmenu">2.4.3. OSD меню</a></span></dt></dl></dd><dt><span class="sect1"><a href="#codec-installation">2.5. Codec installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#xvid">2.5.1. Xvid</a></span></dt><dt><span class="sect2"><a href="#x264">2.5.2. <code class="systemitem">x264</code></a></span></dt><dt><span class="sect2"><a href="#aac">2.5.3. AAC кодек</a></span></dt><dt><span class="sect2"><a href="#amr">2.5.4. AMR кодеки</a></span></dt></dl></dd><dt><span class="sect1"><a href="#rtc">2.6. RTC</a></span></dt></dl></dd><dt><span class="chapter"><a href="#usage">3. Использование</a></span></dt><dd><dl><dt><span class="sect1"><a href="#commandline">3.1. Командная строка</a></span></dt><dt><span class="sect1"><a href="#subosd">3.2. Субтитры и OSD</a></span></dt><dt><span class="sect1"><a href="#control">3.3. Управление</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ctrl-cfg">3.3.1. Конфигурация управления</a></span></dt><dt><span class="sect2"><a href="#lirc">3.3.2. Управление через LIRC</a></span></dt><dt><span class="sect2"><a href="#slave-mode">3.3.3. Подчинённый ("рабский") режим</a></span></dt></dl></dd><dt><span class="sect1"><a href="#streaming">3.4. Сетевые потоки и каналы</a></span></dt><dd><dl><dt><span class="sect2"><a href="#streaming-save">3.4.1. Сохранение потоковых данных</a></span></dt></dl></dd><dt><span class="sect1"><a href="#edl">3.5. Редактируемые списки решений [Edit Decision Lists] (EDL)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#edl_using">3.5.1. Использование EDL файлов</a></span></dt><dt><span class="sect2"><a href="#edl_making">3.5.2. Создание EDL файлов</a></span></dt></dl></dd><dt><span class="sect1"><a href="#advaudio">3.6. Расширенные возможности аудио</a></span></dt><dd><dl><dt><span class="sect2"><a href="#advaudio-surround">3.6.1. Окружающее/Многоканальное[Surround/Multichannel] воспроизведение</a></span></dt><dd><dl><dt><span class="sect3"><a href="#advaudio-surround-DVD">3.6.1.1. DVD'шники</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-stereoinfour">3.6.1.2. Воспроизведение стерео звука на четырех колонках</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-passthrough">3.6.1.3. Передача AC-3/DTS</a></span></dt><dt><span class="sect3"><a href="#hwmpa-surround-passthrough">3.6.1.4. Передача MPEG аудио</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-matrix">3.6.1.5. Matrix-кодированное[matrix-encoded] аудио</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-hrtf">3.6.1.6. Эмуляция окружающего звука в наушниках</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-troubleshooting">3.6.1.7. Решение проблем</a></span></dt></dl></dd><dt><span class="sect2"><a href="#advaudio-channels">3.6.2. Манипуляции с каналами</a></span></dt><dd><dl><dt><span class="sect3"><a href="#advaudio-channels-general">3.6.2.1. Общая информация</a></span></dt><dt><span class="sect3"><a href="#advaudio-channels-mono">3.6.2.2. Воспроизведение моно на двух колонках</a></span></dt><dt><span class="sect3"><a href="#advaudio-channels-copying">3.6.2.3. Копирование/перемещение каналов</a></span></dt><dt><span class="sect3"><a href="#advaudio-channels-mixing">3.6.2.4. Микширование каналов</a></span></dt></dl></dd><dt><span class="sect2"><a href="#advaudio-volume">3.6.3. Программная подстройка звука</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#cd-dvd">4. Использование CD/DVD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#drives">4.1. Приводы CD/DVD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#drives_linux">4.1.1. Linux</a></span></dt><dt><span class="sect2"><a href="#drives_freebsd">4.1.2. FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dvd">4.2. Воспроизведение DVD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#region_code">4.2.1. Региональный код</a></span></dt></dl></dd><dt><span class="sect1"><a href="#vcd">4.3. Воспроизведение VCD</a></span></dt></dl></dd><dt><span class="chapter"><a href="#tv">5. TV</a></span></dt><dd><dl><dt><span class="sect1"><a href="#tv-input">5.1. TV вход</a></span></dt><dd><dl><dt><span class="sect2"><a href="#tv-compilation">5.1.1. Компиляция</a></span></dt><dt><span class="sect2"><a href="#tv-tips">5.1.2. Советы по использованию</a></span></dt><dt><span class="sect2"><a href="#tv-examples">5.1.3. Примеры</a></span></dt></dl></dd><dt><span class="sect1"><a href="#tv-teletext">5.2. Телетекст</a></span></dt><dd><dl><dt><span class="sect2"><a href="#tv-teletext-implementation-notes">5.2.1. Замечания реализации</a></span></dt><dt><span class="sect2"><a href="#tv-teletext-usage">5.2.2. Использование телетекста</a></span></dt><dt><span class="sect2"><a href="#tv-teletext-hotkeys">5.2.3. Горячие клавиши телетекста</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#radio">6. Радио</a></span></dt><dd><dl><dt><span class="sect1"><a href="#radio-input">6.1. Радио вход</a></span></dt><dd><dl><dt><span class="sect2"><a href="#radio-compilation">6.1.1. Компиляция</a></span></dt><dt><span class="sect2"><a href="#radio-tips">6.1.2. Советы по использованию</a></span></dt><dt><span class="sect2"><a href="#radio-examples">6.1.3. Примеры</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#video">7. Устройства вывода видео</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mtrr">7.1. Настройка MTRR</a></span></dt><dt><span class="sect1"><a href="#xv">7.2. Xv</a></span></dt><dd><dl><dt><span class="sect2"><a href="#tdfx">7.2.1. 3dfx карты</a></span></dt><dt><span class="sect2"><a href="#s3">7.2.2. S3 карты</a></span></dt><dt><span class="sect2"><a href="#nvidia">7.2.3. nVidia карты</a></span></dt><dt><span class="sect2"><a href="#ati">7.2.4. ATI карты</a></span></dt><dt><span class="sect2"><a href="#neomagic">7.2.5. NeoMagic карты</a></span></dt><dt><span class="sect2"><a href="#trident">7.2.6. Trident карты</a></span></dt><dt><span class="sect2"><a href="#kyro">7.2.7. Kyro/PowerVR карты</a></span></dt><dt><span class="sect2"><a href="#intel">7.2.8. Карты Intel</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dga">7.3. DGA</a></span></dt><dt><span class="sect1"><a href="#sdl">7.4. SDL</a></span></dt><dt><span class="sect1"><a href="#svgalib">7.5. SVGAlib</a></span></dt><dt><span class="sect1"><a href="#fbdev">7.6. Вывод во фреймбуфер (FBdev)</a></span></dt><dt><span class="sect1"><a href="#mga_vid">7.7. Matrox фреймбуфер (mga_vid)</a></span></dt><dt><span class="sect1"><a href="#tdfxfb">7.8. Поддержка 3Dfx YUV</a></span></dt><dt><span class="sect1"><a href="#tdfx_vid">7.9. tdfx_vid</a></span></dt><dt><span class="sect1"><a href="#opengl">7.10. OpenGL вывод</a></span></dt><dt><span class="sect1"><a href="#aalib">7.11. AAlib - отображение в текстовом режиме</a></span></dt><dt><span class="sect1"><a href="#caca">7.12. 
<code class="systemitem">libcaca</code> - Цветная ASCII Art библиотека
</a></span></dt><dt><span class="sect1"><a href="#vesa">7.13. VESA - вывод в VESA BIOS</a></span></dt><dt><span class="sect1"><a href="#x11">7.14. X11</a></span></dt><dt><span class="sect1"><a href="#vidix">7.15. VIDIX</a></span></dt><dd><dl><dt><span class="sect2"><a href="#vidix-ati">7.15.1. ATI карты</a></span></dt><dt><span class="sect2"><a href="#vidix-mga">7.15.2. Matrox карты</a></span></dt><dt><span class="sect2"><a href="#vidix-trident">7.15.3. Trident карты</a></span></dt><dt><span class="sect2"><a href="#vidix-3dlabs">7.15.4. 3DLabs карты</a></span></dt><dt><span class="sect2"><a href="#vidix-nvidia">7.15.5. nVidia карты</a></span></dt><dt><span class="sect2"><a href="#vidix-sis">7.15.6. SiS карты</a></span></dt></dl></dd><dt><span class="sect1"><a href="#directfb">7.16. DirectFB</a></span></dt><dt><span class="sect1"><a href="#dfbmga">7.17. DirectFB/Matrox (dfbmga)</a></span></dt><dt><span class="sect1"><a href="#mpeg_decoders">7.18. MPEG декодеры</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dvb">7.18.1. DVB ввод и вывод</a></span></dt><dt><span class="sect2"><a href="#dxr2">7.18.2. DXR2</a></span></dt><dt><span class="sect2"><a href="#dxr3">7.18.3. DXR3/Hollywood+</a></span></dt></dl></dd><dt><span class="sect1"><a href="#other">7.19. Другое оборудование вывода видео</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zr">7.19.1. Zr</a></span></dt><dt><span class="sect2"><a href="#blinkenlights">7.19.2. Blinkenlights[Мерцающие огни?]</a></span></dt></dl></dd><dt><span class="sect1"><a href="#tvout">7.20. Поддержка TV-выхода</a></span></dt><dd><dl><dt><span class="sect2"><a href="#tvout-mga-g400">7.20.1. Matrox G400 карты</a></span></dt><dt><span class="sect2"><a href="#tv-out_matrox_g450">7.20.2. Matrox G450/G550 карты</a></span></dt><dt><span class="sect2"><a href="#tvout-ati">7.20.3. ATI карты</a></span></dt><dt><span class="sect2"><a href="#tvout-nvidia">7.20.4. nVidia</a></span></dt><dt><span class="sect2"><a href="#tvout-neomagic">7.20.5. NeoMagic</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ports">8. Портинг</a></span></dt><dd><dl><dt><span class="sect1"><a href="#linux">8.1. Linux</a></span></dt><dd><dl><dt><span class="sect2"><a href="#debian">8.1.1. Debian пакеты</a></span></dt><dt><span class="sect2"><a href="#rpm">8.1.2. RPM пакеты</a></span></dt><dt><span class="sect2"><a href="#arm">8.1.3. ARM</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsd">8.2. *BSD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#freebsd">8.2.1. FreeBSD</a></span></dt><dt><span class="sect2"><a href="#openbsd">8.2.2. OpenBSD</a></span></dt><dt><span class="sect2"><a href="#darwin">8.2.3. Darwin</a></span></dt></dl></dd><dt><span class="sect1"><a href="#unix">8.3. Коммерческие Unix</a></span></dt><dd><dl><dt><span class="sect2"><a href="#solaris">8.3.1. Solaris</a></span></dt><dt><span class="sect2"><a href="#hp-ux">8.3.2. HP-UX</a></span></dt><dt><span class="sect2"><a href="#aix">8.3.3. AIX</a></span></dt><dt><span class="sect2"><a href="#qnx">8.3.4. QNX</a></span></dt></dl></dd><dt><span class="sect1"><a href="#windows">8.4. Windows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#cygwin">8.4.1. <span class="application">Cygwin</span></a></span></dt><dt><span class="sect2"><a href="#mingw">8.4.2. <span class="application">MinGW</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#macos">8.5. Mac OS</a></span></dt><dd><dl><dt><span class="sect2"><a href="#osx_gui">8.5.1. MPlayer OS X GUI</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#mencoder">9. Основы использования <span class="application">MEncoder</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#menc-feat-selecting-codec">9.1. Выбор кодеков и формата файлов</a></span></dt><dt><span class="sect1"><a href="#menc-feat-selecting-input">9.2. Выбор входного файла или устройства</a></span></dt><dt><span class="sect1"><a href="#menc-feat-mpeg4">9.3. Двухпроходное кодирование MPEG-4 ("DivX")</a></span></dt><dt><span class="sect1"><a href="#menc-feat-handheld-psp">9.4. Кодирование в Sony PSP видео формат</a></span></dt><dt><span class="sect1"><a href="#menc-feat-mpeg">9.5. Кодирование в MPEG формат</a></span></dt><dt><span class="sect1"><a href="#menc-feat-rescale">9.6. Масштабирование фильмов</a></span></dt><dt><span class="sect1"><a href="#menc-feat-streamcopy">9.7. копирование потока</a></span></dt><dt><span class="sect1"><a href="#menc-feat-enc-images">9.8. Кодирование из нескольких входных файлов изображений (JPEG, PNG, TGA, SGI)</a></span></dt><dt><span class="sect1"><a href="#menc-feat-extractsub">9.9. Извлечение DVD субтитров в файл VOBsub</a></span></dt><dt><span class="sect1"><a href="#aspect">9.10. Сохранение пропорций</a></span></dt></dl></dd><dt><span class="chapter"><a href="#encoding-guide">10. Кодирование с <span class="application">MEncoder</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#menc-feat-dvd-mpeg4">10.1. Создание высококачественного MPEG-4 ("DivX") рипа из DVD фильма</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-preparing-encode">10.1.1. Подготовка к кодированию: Идентификация исходного материала и кадровой
  частоты</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-preparing-encode-fps">10.1.1.1. Определение кадровой частоты источника</a></span></dt><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-preparing-encode-material">10.1.1.2. Идентификация исходного материала</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-2pass">10.1.2. Постоянный квантователь в сравнении с многопроходностью</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-constraints">10.1.3. Ограничения для эффективного кодирования</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-crop">10.1.4. Усечение и масштабирование</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-resolution-bitrate">10.1.5. Выбор разрешения и битпотока</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-resolution-bitrate-compute">10.1.5.1. Расчёт разрешения</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-filtering">10.1.6. Фильтрация</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-interlacing">10.1.7. Чересстрочная развёртка и телесин</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-encoding-interlaced">10.1.8. Кодирование чересстрочного видео</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-av-sync">10.1.9. Замечания об аудио/видео синхронизации</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-codec">10.1.10. Выбор видеокодека</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-audio">10.1.11. Аудио</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-muxing">10.1.12. Мультиплексирование</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-muxing-filter-issues">10.1.12.1. Улучшение мультиплексирования и надёжности A/V синхронизации</a></span></dt><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-muxing-avi-limitations">10.1.12.2. Ограничения контейнера AVI</a></span></dt><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-muxing-matroska">10.1.12.3. Мультиплексирование в контейнер Matroska (Матрёшка)</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#menc-feat-telecine">10.2. Как работать с телесином и чересстрочной развёрткой на NTSC DVD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-telecine-intro">10.2.1. Введение</a></span></dt><dt><span class="sect2"><a href="#menc-feat-telecine-ident">10.2.2. Как распознать тип Вашего видео</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-telecine-ident-progressive">10.2.2.1. Построчная развёртка</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-ident-telecined">10.2.2.2. Телесин</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-ident-interlaced">10.2.2.3. Чересстрочная развертка</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-ident-mixedpt">10.2.2.4. Смешанные построчная развертка и телесин</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-ident-mixedpi">10.2.2.5. Смешанные построчная и чересстрочная развертки</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-telecine-encode">10.2.3. Как кодировать каждую категорию</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-telecine-encode-progressive">10.2.3.1. Построчная развертка</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-encode-telecined">10.2.3.2. Телесин</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-encode-interlaced">10.2.3.3. Чересстрочная развертка</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-encode-mixedpt">10.2.3.4. Смешанные построчная развертка и телесин</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-encode-mixedpi">10.2.3.5. Смешанные построчная и чересстрочная развертки</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-telecine-footnotes">10.2.4. Примечания</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-enc-libavcodec">10.3. Кодирование семейством кодеков <code class="systemitem">libavcodec</code>
</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-enc-libavcodec-video-codecs">10.3.1. Видео кодеки <code class="systemitem">libavcodec</code></a></span></dt><dt><span class="sect2"><a href="#menc-feat-enc-libavcodec-audio-codecs">10.3.2. Аудио кодеки <code class="systemitem">libavcodec</code></a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-enc-libavcodec-audio-codecs-pcmadpcm">10.3.2.1. Дополнительная таблица PCM/ADPCM форматов</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-lavc-encoding-options">10.3.3. Опции кодирования libavcodec</a></span></dt><dt><span class="sect2"><a href="#menc-feat-mpeg4-lavc-example-settings">10.3.4. Примеры настроек кодирования</a></span></dt><dt><span class="sect2"><a href="#custommatrices">10.3.5. Нестандартные inter/intra матрицы</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-example">10.3.6. Пример</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-xvid">10.4. Кодирование кодеком <code class="systemitem">Xvid</code></a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-xvid-intro">10.4.1. Какие опции следует использовать для получения лучших результатов?</a></span></dt><dt><span class="sect2"><a href="#menc-feat-xvid-encoding-options">10.4.2. Опции кодирования <code class="systemitem">Xvid</code></a></span></dt><dt><span class="sect2"><a href="#menc-feat-xvid-encoding-profiles">10.4.3. Профили кодирования</a></span></dt><dt><span class="sect2"><a href="#menc-feat-xvid-example-settings">10.4.4. Примеры настроек кодирования</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-x264">10.5. Кодирование кодеком <code class="systemitem">x264</code></a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-x264-encoding-options">10.5.1. Опции кодирования x264</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-x264-encoding-options-intro">10.5.1.1. Введение</a></span></dt><dt><span class="sect3"><a href="#menc-feat-x264-encoding-options-speedvquality">10.5.1.2. Опции, затрагивающие, в основном, скорость и качество</a></span></dt><dt><span class="sect3"><a href="#menc-feat-x264-encoding-options-misc-preferences">10.5.1.3. Опции, относящиеся к различным предпочтениям</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-x264-example-settings">10.5.2. Примеры настроек кодирования</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-video-for-windows">10.6. 
  Кодирование семейством кодеков <code class="systemitem">Video For Windows</code>
</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-enc-vfw-video-codecs">10.6.1. Поддерживаемые кодеки Video for Windows</a></span></dt><dt><span class="sect2"><a href="#menc-feat-video-for-windows-bitrate-settings">10.6.2. Использование vfw2menc для создания файла настроек кодека.</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-quicktime-7">10.7. Использование <span class="application">MEncoder</span>
для создания совместимых с <span class="application">QuickTime</span>
файлов</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-quicktime-7-why-use-it">10.7.1. Зачем необходимо создавать совместимые с <span class="application">QuickTime</span>
файлы?</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-constraints">10.7.2. Ограничения <span class="application">QuickTime</span> 7</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-crop">10.7.3. Обрезание</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-scale">10.7.4. Масштабирование</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-avsync">10.7.5. A/V синхронизация</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-bitrate">10.7.6. Битпоток</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-example">10.7.7. Пример кодирования</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-remux">10.7.8. Ремультиплексирование в MP4</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-metadata">10.7.9. Добавление тегов метаданных</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-vcd-dvd">10.8. Использование <span class="application">MEncoder</span>
  для создания VCD/SVCD/DVD-совместимых файлов.</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-constraints">10.8.1. Ограничения формата</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-constraints-resolution">10.8.1.1. Ограничения форматов</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-constraints-gop">10.8.1.2. Ограничения на размер GOP</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-constraints-bitrate">10.8.1.3. Ограничения на битпоток</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-output">10.8.2. Опции вывода</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-output-aspect">10.8.2.1. Пропорции</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-a-v-sync">10.8.2.2. Сохранение A/V синхронизации</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-output-srate">10.8.2.3. Преобразование частоты дискретизации</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-lavc">10.8.3. Использование libavcodec для VCD/SVCD/DVD кодирования</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-lavc-intro">10.8.3.1. Введение</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-lavc-options">10.8.3.2. lavcopts</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-lavc-examples">10.8.3.3. Примеры</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-lavc-advanced">10.8.3.4. Расширенные опции</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-audio">10.8.4. Кодирование звука</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-audio-toolame">10.8.4.1. toolame</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-audio-twolame">10.8.4.2. twolame</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-audio-lavc">10.8.4.3. libavcodec</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-all">10.8.5. Собирая все вместе</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-pal-dvd">10.8.5.1. PAL DVD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-ntsc-dvd">10.8.5.2. NTSC DVD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-pal-ac3-copy">10.8.5.3. PAL AVI, содержащий AC-3 звук, в DVD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-ntsc-ac3-copy">10.8.5.4. NTSC AVI, содержащий AC-3 звук, в DVD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-pal-svcd">10.8.5.5. PAL SVCD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-ntsc-svcd">10.8.5.6. NTSC SVCD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-pal-vcd">10.8.5.7. PAL VCD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-ntsc-vcd">10.8.5.8. NTSC VCD</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#faq">11. Часто Задаваемые вопросы</a></span></dt><dt><span class="appendix"><a href="#bugreports">A. Как сообщать об ошибках</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bugreports_security">A.1. Отчеты об ошибках безопасности</a></span></dt><dt><span class="sect1"><a href="#bugreports_fix">A.2. Как исправить ошибку</a></span></dt><dt><span class="sect1"><a href="#bugreports_regression_test">A.3. Как провести проверку на деградацию, используя Subversion</a></span></dt><dt><span class="sect1"><a href="#bugreports_report">A.4. Как сообщить об ошибке</a></span></dt><dt><span class="sect1"><a href="#bugreports_where">A.5. Куда сообщать об ошибках</a></span></dt><dt><span class="sect1"><a href="#bugreports_what">A.6. Что сообщать</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bugreports_system">A.6.1. Системная информация</a></span></dt><dt><span class="sect2"><a href="#bugreports_hardware">A.6.2. Аппаратура и драйверы</a></span></dt><dt><span class="sect2"><a href="#bugreports_configure">A.6.3. Проблемы конфигурации</a></span></dt><dt><span class="sect2"><a href="#bugreports_compilation">A.6.4. Проблемы компиляции</a></span></dt><dt><span class="sect2"><a href="#bugreports_playback">A.6.5. Проблемы при воспроизведении</a></span></dt><dt><span class="sect2"><a href="#bugreports_crash">A.6.6. Падения</a></span></dt><dd><dl><dt><span class="sect3"><a href="#bugreports_debug">A.6.6.1. Как сохранить информацию о воспроизводимом падении</a></span></dt><dt><span class="sect3"><a href="#bugreports_core">A.6.6.2. Как извлечь полезную информацию из дампа core</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#bugreports_advusers">A.7. Я знаю, что я делаю...</a></span></dt></dl></dd><dt><span class="appendix"><a href="#skin">B. Формат скинов <span class="application">MPlayer</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#skin-overview">B.1. Обзор</a></span></dt><dd><dl><dt><span class="sect2"><a href="#skin-overview-directories">B.1.1. Каталоги</a></span></dt><dt><span class="sect2"><a href="#skin-overview-formats">B.1.2. Форматы изображений</a></span></dt><dt><span class="sect2"><a href="#skin-overview-components">B.1.3. Компоненты скина</a></span></dt><dt><span class="sect2"><a href="#skin-files">B.1.4. Файлы</a></span></dt></dl></dd><dt><span class="sect1"><a href="#skin-file">B.2. Файл skin</a></span></dt><dd><dl><dt><span class="sect2"><a href="#skin-file-main">B.2.1. Главное окно и полоса воспроизведения</a></span></dt><dt><span class="sect2"><a href="#skin-file-subwindow">B.2.2. Вспомогательное окно</a></span></dt><dt><span class="sect2"><a href="#skin-file-menu">B.2.3. Меню со скинами</a></span></dt></dl></dd><dt><span class="sect1"><a href="#skin-fonts">B.3. Шрифты</a></span></dt><dd><dl><dt><span class="sect2"><a href="#skin-fonts-symbols">B.3.1. Значки</a></span></dt></dl></dd><dt><span class="sect1"><a href="#skin-gui">B.4. GUI сообщения</a></span></dt><dt><span class="sect1"><a href="#skin-quality">B.5. Создание качественного скина</a></span></dt></dl></dd></dl></div><div class="preface" title="Как читать эту документацию"><div class="titlepage"><div><div><h2 class="title"><a name="howtoread"></a>Как читать эту документацию</h2></div></div></div><p>
Если Вы инсталлируете программу в первый раз, прочитайте все от начала до конца
секции "Установка", и просматривайте ссылки, которые Вы обнаружите.
Если у Вас все ещё остались
вопросы, вернитесь к <a class="link" href="#toc">Оглавлению</a> и поищите там,
прочтите <a class="xref" href="#faq" title="Глава 11. Часто Задаваемые вопросы">FAQ</a>, или попытайтесь про'grep'пить файлы.
На большую часть вопросов Вы найдёте ответы здесь, а остальные, наверное, уже
спрашивались в наших
<a class="ulink" href="http://www.mplayerhq.hu/design7/mailing_lists.html" target="_top">рассылках</a>.
Проверьте
<a class="ulink" href="https://lists.mplayerhq.hu/mailman/listinfo" target="_top">по архивам</a>, в
которых можно найти много ценной информации.
</p></div><div class="chapter" title="Глава 1. Введение"><div class="titlepage"><div><div><h2 class="title"><a name="intro"></a>Глава 1. Введение</h2></div></div></div><p>
<span class="application">MPlayer</span> — это проигрыватель фильмов для LINUX'а
(работает на многих других UNIX'ах и не-x86
CPU, см. <a class="xref" href="#ports" title="Глава 8. Портинг">Портинг</a>). Он проигрывает большинство MPEG, VOB, AVI,
Ogg/OGM, VIVO, ASF/WMA/WMV, QT/MOV/MP4, FLI, RM, NuppelVideo, yuv4mpeg, FILM,
RoQ, PVA, Matroska файлов, опираясь на множество "родных", XAnim'овских,
RealPlayer'овских и Win32 DLL кодеков. Вы также можете смотреть VideoCD, SVCD,
DVD, 3ivx, RealMedia, Sorenson, Theora, и MPEG-4 (DivX) фильмы.
Другой важной особенностью
<span class="application">MPlayer</span>'а является широкий спектр поддерживаемых
устройств вывода. Он работает с X11, Xv, DGA, OpenGL, SVGAlib,
fbdev, AAlib, libcaca, DirectFB, и кроме того Вы можете
использовать GGI and SDL (и таким образом все их драйверы) и также несколько
низкоуровневых драйверов для конкретных карт (для Matrox, 3Dfx и Radeon,
Mach64, Permedia3)! Большинство из них поддерживают программное или аппаратное
масштабирование, поэтому Вы можете насладиться просмотром фильма на полном
экране.<span class="application">MPlayer</span> поддерживает некоторые аппаратные
MPEG декодеры, такие как <a class="link" href="#dvb" title="7.18.1. DVB ввод и вывод">DVB</a> и
<a class="link" href="#dxr3" title="7.18.3. DXR3/Hollywood+">DXR3/Hollywood+</a>. А как насчёт славных больших
сглаженных затенённых субтитров (14 поддерживаемых
типов) с Европейскими/ISO 8859-1,2 (венгерский, английский, чешский,
и т.п.), кириллическими, корейскими шрифтами и вывода информации на экран
[On Screen Display (OSD)]?
</p><p>
Плеер без проблем проигрывает повреждённые MPEG файлы (полезно для некоторых VCD),
плохие AVI файлы, которые не проигрываются известным
<span class="application">Windows Media Player</span>.
Даже AVI файлы без индекса являются проигрываемыми.
Вы можете временно сделать индекс с помощью ключа <tt class="option">-idx</tt> или
перманентно с помощью <span class="application">MEncoder</span>'а,
таким образом получив возможность перемещаться
по фильму! Как видите стабильность и качество — наиболее важные вещи,
но скорость также изумительна. Кроме того имеется мощная
система фильтров для манипуляции с видео и аудио.
</p><p>
<span class="application">MEncoder</span> (Кодировщик фильмов <span class="application">MPlayer
</span>'a) — это простой
кодировщик фильмов предназначенный для кодирования фильмов, проигрываемых MPlayer'ом
AVI/ASF/OGG/DVD/VCD/VOB/MPG/MOV/VIV/FLI/RM/NUV/NET/PVA в другие
проигрываемые <span class="application">MPlayer</span>'ом форматы (см. ниже).
Он может кодировать такими разными кодеками, как
MPEG-4 (DivX4) (1 или 2 прохода),
<code class="systemitem">libavcodec</code>,
PCM/MP3/VBR MP3 звук.
</p><div class="itemizedlist" title="Возможности MEncoder'а"><p class="title"><b>Возможности <span class="application">MEncoder</span>'а</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Кодирование из широкого спектра форматов файлов и декодеров
  <span class="application">MPlayer'а</span>
</p></li><li class="listitem"><p>
  Кодирование во все кодеки FFmpeg'овской библиотеки
  <code class="systemitem">libavcodec</code>
</p></li><li class="listitem"><p>
  Кодирование видео с V4L совместимых TV тюнеров
</p></li><li class="listitem"><p>
  Кодирование/мультиплексирование в "слоёные"[interleaved] AVI файлы
  с соответствующим индексом
</p></li><li class="listitem"><p>
  Создание файлов с аудио потоком из внешнего файла
</p></li><li class="listitem"><p>
  Кодирование в 1, 2 или 3 прохода
</p></li><li class="listitem"><p>
  <span class="bold"><strong>VBR</strong></span> MP3 аудио
</p></li><li class="listitem"><p>
  PCM аудио
</p></li><li class="listitem"><p>
  Копирование потоков
</p></li><li class="listitem"><p>
  Входная A/V синхронизация (основана на PTS, может быть отключена с помощью
  ключа <tt class="option">-mc 0</tt> )
</p></li><li class="listitem"><p>
  Коррекция FPS[кадров/сек] ключом <tt class="option">-ofps</tt> (полезно при кодировании
  30000/1001 fps VOB в 24000/1001 fps AVI)
</p></li><li class="listitem"><p>
  Использование нашей очень мощной системы плагинов (обрезание[crop],
  расширение[expand], отражение[flip], пост-обработка[postprocess],
  поворот[rotate], масштабирование[scale], RGB/YUV преобразования)
</p></li><li class="listitem"><p>
  Может кодировать DVD/VOBsub и текстовые субтитры
  в один выходной файл
</p></li><li class="listitem"><p>
  Может извлекать DVD субтитры в VOBsub формат
</p></li></ul></div><p>
<span class="application">MPlayer</span> и <span class="application">MEncoder</span> могут распространяться в соответствии с GNU General
Public License Version 2.
</p></div><div class="chapter" title="Глава 2. Установка"><div class="titlepage"><div><div><h2 class="title"><a name="install"></a>Глава 2. Установка</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#softreq">2.1. Требуемые программы:</a></span></dt><dt><span class="sect1"><a href="#features">2.2. Возможности:</a></span></dt><dt><span class="sect1"><a href="#gui">2.3. Как насчёт GUI?</a></span></dt><dt><span class="sect1"><a href="#fonts-osd">2.4. Шрифты и OSD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#truetype-fonts">2.4.1. TrueType шрифты</a></span></dt><dt><span class="sect2"><a href="#bitmap-fonts">2.4.2. Растровые шрифты</a></span></dt><dt><span class="sect2"><a href="#osdmenu">2.4.3. OSD меню</a></span></dt></dl></dd><dt><span class="sect1"><a href="#codec-installation">2.5. Codec installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#xvid">2.5.1. Xvid</a></span></dt><dt><span class="sect2"><a href="#x264">2.5.2. <code class="systemitem">x264</code></a></span></dt><dt><span class="sect2"><a href="#aac">2.5.3. AAC кодек</a></span></dt><dt><span class="sect2"><a href="#amr">2.5.4. AMR кодеки</a></span></dt></dl></dd><dt><span class="sect1"><a href="#rtc">2.6. RTC</a></span></dt></dl></div><p>
В файле <tt class="filename">README</tt> вы сможете найти короткое руководство
по установке. Пожалуйста, сначала прочтите его, а затем вернитесь к оставшимся
неясными деталям.
</p><p>
В этой главе я постараюсь провести Вас через процесс компиляции и конфигурации
<span class="application">MPlayer</span>'а. Это не просто, но это не обязательно будет сложно. Если Вы заметите
какие-то отклонения, от того, что я объясняю, пожалуйста, поищите в этой
документации и Вы найдёте ответ. Если Вы увидите ссылку, пожалуйста, проследуйте
по ней и внимательно прочитайте её содержимое. Это займёт некоторое время,
но это ДЕЙСТВИТЕЛЬНО того стоит
</p><p>
Вам нужна современная система. Под Linux'ом рекомендуются ядра 2.4.x.
</p><div class="sect1" title="2.1. Требуемые программы:"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="softreq"></a>2.1. Требуемые программы:</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>binutils</strong></span> - рекомендуемая версия - это
  <span class="bold"><strong>2.11.x</strong></span>.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>gcc</strong></span> - рекомендуемые версии:
  2.95 и 3.4+.  Известно, что 2.96 и 3.0.x генерируют испорченный код.
  С 3.1 и 3.2 были проблемы, с 3.3. тоже были небольшие проблемы. На PowerPC используйте 4.x+.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>XOrg/XFree86</strong></span> - рекомендуемая версия -
  4.3 или более поздняя.  Убедитесь, что также установлен
  <span class="bold"><strong>пакет разработки</strong></span>, иначе это не будет работать.
  Вам необязательно иметь X, некоторые драйверы вывода видео работают и без него.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>make</strong></span> - рекомендуемая версия - 3.79.x или
  более поздняя. Для сборки XML документации требуется 3.80.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>FreeType</strong></span> - версия 2.0.9 или более поздняя
  требуется для OSD и субтитров.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>ALSA</strong></span> - необязательно, для поддержки вывода звука через ALSA
  Требуется минимум  0.9.0rc4.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>libjpeg</strong></span> - необходима для опционального
  драйвера вывода видео JPEG.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>libpng</strong></span> - необходима для опционального
  драйвера вывода видео PNG.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>directfb</strong></span> - необязательно, версия 0.9.13 или
  более поздняя требуется для драйвера вывода видео directfb.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>lame</strong></span> - рекомендуется 3.90 или новее,
  необходимо для кодирования MP3 аудио c <span class="application">MEncoder</span>,
</p></li><li class="listitem"><p>
  <span class="bold"><strong>zlib</strong></span> - рекомендуется, необходима для сжатых
  MOV заголовков и поддержки PNG.
</p></li><li class="listitem"><p>
  <span class="bold"><strong><a class="ulink" href="http://www.live555.com/mplayer/" target="_top">LIVE555 Streaming Media</a></strong></span>
- необязательно, необходимо для некоторых RTSP/RTP потоков.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>cdparanoia</strong></span> - необязательно, для поддержки CDDA
</p></li><li class="listitem"><p>
  <span class="bold"><strong>libxmms</strong></span> - необязательно, для поддержки входных плагинов XMMS.
Требуется минимум 1.2.7.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>libsmb</strong></span> - необязательно, для поддержки
  сетевого протокола SMB.
</p></li></ul></div></div><div class="sect1" title="2.2. Возможности:"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="features"></a>2.2. Возможности:</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Решите, нужен ли Вам GUI. Если да, прочитайте до компиляции
  секцию <a class="link" href="#gui" title="2.3. Как насчёт GUI?">GUI</a>.
</p></li><li class="listitem"><p>
  Если Вы хотите установить <span class="application">MEncoder</span> (наш великолепный многоцелевой кодировщик),
читайте <a class="link" href="#mencoder" title="Глава 9. Основы использования MEncoder">секцию <span class="application">MEncoder</span></a>.
</p></li><li class="listitem"><p>
  Если у Вас есть V4L совместимый <span class="bold"><strong>TV тюнер</strong></span>, и Вы хотите
  смотреть/захватывать и кодировать MPlayer'ом фильмы, читайте секцию
  <a class="link" href="#tv-input" title="5.1. TV вход">TV вход</a>.
</p></li><li class="listitem"><p>
  Если у вас есть V4L совместимый <span class="bold"><strong>Radio тюнер</strong></span>,
  и вы хотите слушать/записывать MPlayer'ом радиопередачи, читайте секцию
  <a class="link" href="#radio" title="Глава 6. Радио">Радио</a>.
</p></li><li class="listitem"><p>
  Существует изящное <span class="bold"><strong>OSD Меню</strong></span> готовое для использования.
  Проверьте секцию <a class="link" href="#subosd" title="3.2. Субтитры и OSD">OSD Меню</a>.
</p></li></ul></div><p>
Теперь соберите <span class="application">MPlayer</span>:
</p><pre class="screen">
./configure
make
make install
</pre><p>
</p><p>
В этот момент, <span class="application">MPlayer</span> готов к использованию.
Проверьте, не содержится ли файл <tt class="filename">codecs.conf</tt> в Вашем домашнем каталоге
(<tt class="filename">~/.mplayer/codecs.conf</tt>) оставленный от предыдущих версий MPlayer'а,
и удалите его.
</p><p>
Обратите внимание на то, что если у Вас в <tt class="filename">~/.mplayer/</tt> есть
файл <tt class="filename">codecs.conf</tt>, то встроенный и системный файлы
<tt class="filename">codecs.conf</tt> будут полностью игнорированы. Не делайте
этого, если только Вы не собираетесь развлекаться со внутренностями <span class="application">MPlayer</span>'а,
поскольку это может вызвать множество проблем. Если Вы хотите поменять порядок
подбора кодеков, используйте опции <tt class="option">-vc</tt>, <tt class="option">-ac</tt>,
<tt class="option">-vfm</tt>, и <tt class="option">-afm</tt> либо в командной строке, либо
в Вашем конфигурационном файле (см. страницу руководства).
</p><p>
Пользователи Debian могут сами создать .deb пакеты, это очень
просто. Просто запустите </p><pre class="screen">fakeroot debian/rules binary</pre><p> в корневом
каталоге <span class="application">MPlayer'а</span>. Более подробные инструкции см.
в разделе <a class="link" href="#debian" title="8.1.1. Debian пакеты">Создание Debian пакетов</a>.
</p><p>
<span class="bold"><strong>Всегда просматривайте вывод</strong></span> <tt class="filename">./configure</tt>, и файл
<tt class="filename">configure.log</tt>, они содержат информацию о том, что будет собрано,
а что нет. Возможно Вы захотите просмотреть файлы <tt class="filename">config.h</tt> и
<tt class="filename">config.mak</tt>.
Если у Вас стоят какие-то библиотеки, которые не определяются
<tt class="filename">./configure</tt>, проверьте, что у Вас установлены соответствующие
заголовки[header files] (обычно это -dev пакеты) и их версии совпадают. Файл
<tt class="filename">configure.log</tt> Обычно сообщит Вам, чего не хватает для сборки.
</p><p>
Хотя это не обязательно, но чтобы получить функционирующие OSD и субтитры,
должны быть установлены шрифты. Рекомендуемый метод - установка TTF шрифта и
указание <span class="application">MPlyer</span>'у использовать его. Подробности, см. в  секции
<a class="link" href="#subosd" title="3.2. Субтитры и OSD">Субтитры и OSD</a>.
</p></div><div class="sect1" title="2.3. Как насчёт GUI?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gui"></a>2.3. Как насчёт GUI?</h2></div></div></div><p>
Для GUI требуется GTK 1.2.x или GTK 2.0 (он не целиком GTK'шный, но панельки - да). Шкуры
хранятся в PNG формате, поэтому GTK, <code class="systemitem">libpng</code>
(и их части для разработчиков, обычно они называются
<code class="systemitem">gtk-dev</code> и
<code class="systemitem">libpng-dev</code>) должны быть установлены.
Вы можете собрать GUI, указав <tt class="option">--enable-gui</tt> в <tt class="option">./configure</tt>.
Затем, чтобы использовать GUI, Вы должны запускать <span class="command"><strong>gmplayer</strong></span>.
</p><p>
Поскольку <span class="application">MPlayer</span> не содержит ни одной шкуры, Вы должны скачать
их, если Вы хотите использовать GUI. См.
<a class="ulink" href="http://www.mplayerhq.hu/dload.html" target="_top">download page[страницу
закачек]</a>. Они должны быть извлечены в системный каталог
(<tt class="filename">$PREFIX/share/mplayer/skins</tt>), или в
<tt class="filename">$HOME/.mplayer/skins</tt>. По умолчанию, MPlayer ищет
каталог <tt class="filename">default</tt>
в этих каталогах, но вы можете использовать опцию <tt class="option">-skin <em class="replaceable"><code>newskin</code></em></tt>,
или директиву конфигурационного файла <tt class="option">skin=newskin</tt>, чтобы использовать
шкуру из каталога <tt class="filename">*/skins/newskin</tt>.
</p></div><div class="sect1" title="2.4. Шрифты и OSD"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="fonts-osd"></a>2.4. Шрифты и OSD</h2></div></div></div><p>
Чтобы насладиться OSD и субтитрами, надо указать <span class="application">MPlayer</span> какой
шрифт использовать. Подойдет любой TrueType или специальный растровый шрифт. Тем не менее,
рекомендуется использовать TrueType шрифты, поскольку они лучше выглядят, корректно
масштабируются до размера фильма, у лучше справляются с различными кодировками.
</p><div class="sect2" title="2.4.1. TrueType шрифты"><div class="titlepage"><div><div><h3 class="title"><a name="truetype-fonts"></a>2.4.1. TrueType шрифты</h3></div></div></div><p>
Есть два способа заставить работать TrueType шрифты. Первый - указать опцию <tt class="option">-font</tt>,
чтобы указать путь к TrueType шрифту из команднов строки. Эта опция будет хорошим кандидатом на
помещение в файл конфигурации (для подробностей смотрите страницу man руководства).
Второй - создание символической ссылки с именем <tt class="filename">subfont.ttf</tt> на выбранный
файл шрифта. Либо
</p><pre class="screen">
ln -s <em class="replaceable"><code>/path/to/sample_font.ttf</code></em> ~/.mplayer/subfont.ttf
</pre><p>
индивидуально для каждого пользователя, либо одну общесистемную
</p><pre class="screen">
ln -s <em class="replaceable"><code>/path/to/sample_font.ttf</code></em> $PREFIX/share/mplayer/subfont.ttf
</pre><p>
</p><p>
Если <span class="application">MPlayer</span> был скомпилирован с поддержкой
<code class="systemitem">fontconfig</code>, эти методы не будут работать,
вместо этого, опция <tt class="option">-font</tt> ожидает
<code class="systemitem">fontconfig</code> название шрифта,
 и по умолчанию это шрифт sans-serif. Пример:
</p><pre class="screen">
mplayer -font <em class="replaceable"><code>'Bitstream Vera Sans'</code></em> <em class="replaceable"><code>anime.mkv</code></em>
</pre><p>
</p><p>
Чтобы получить список шрифтов, известных
<code class="systemitem">fontconfig</code>,
используйте <span class="command"><strong>fc-list</strong></span>
</p></div><div class="sect2" title="2.4.2. Растровые шрифты"><div class="titlepage"><div><div><h3 class="title"><a name="bitmap-fonts"></a>2.4.2. Растровые шрифты</h3></div></div></div><p>
Если по каким-то причинам вам необходимо использовать растровый шрифт, скачайте набор таковых с
нашего сайта. Вы можете выбирать между различными
<a class="ulink" href="http://www.mplayerhq.hu/MPlayer/releases/fonts/" target="_top">ISO шрифтами</a> и
набором шрифтов
<a class="ulink" href="http://www.mplayerhq.hu/MPlayer/contrib/fonts/" target="_top">созданных пользователями</a>
в различных кодировках.
</p><p>
Распакуйте скачанный файл в <tt class="filename">~/.mplayer</tt> или
<tt class="filename">$PREFIX/share/mplayer</tt>.
После этого переименуйте каталог или создайте символическую ссылку на него с именем
<tt class="filename">font</tt>, например:
</p><pre class="screen">
ln -s <em class="replaceable"><code>~/.mplayer/arial-24</code></em> ~/.mplayer/font
</pre><p>
</p><pre class="screen">
ln -s <em class="replaceable"><code>$PREFIX/mplayer/arial-24</code></em> $PREFIX/mplayer/font
</pre><p>
</p><p>
Шрифты должны иметь соответствующий им <tt class="filename">font.desc</tt> файл, отображающий
позиции юникод шрифта в кодовую страницу текста субтитров. Другое решение - иметь субтитры,
кодированные в UTF-8 и использовать опцию <tt class="option">-utf8</tt> или просто дать файлу
с субтитрами такое же, как у видео файла, имя с расширением <tt class="filename">.utf</tt>,
положив его в один каталог с фильмом.
</p></div><div class="sect2" title="2.4.3. OSD меню"><div class="titlepage"><div><div><h3 class="title"><a name="osdmenu"></a>2.4.3. OSD меню</h3></div></div></div><p>
У <span class="application">MPlayer</span>'а существует целиком определяемый пользователем интерфейс OSD меню.
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
меню Preferences[Настройки] в настоящий момент НЕ НАПИСАНО!
</p></div><div class="orderedlist" title="Установка"><p class="title"><b>Установка</b></p><ol class="orderedlist" type="1"><li class="listitem"><p>
  скомпилируйте <span class="application">MPlayer</span>, указав
  <tt class="filename">./configure</tt> параметр <tt class="option">--enable-menu</tt>
</p></li><li class="listitem"><p>
  убедитесь, что у Вас установлен OSD шрифт
</p></li><li class="listitem"><p>
  скопируйте <tt class="filename">etc/menu.conf</tt> в Ваш каталог <tt class="filename">.mplayer</tt>
</p></li><li class="listitem"><p>
  скопируйте <tt class="filename">etc/input.conf</tt> в Ваш каталог
  <tt class="filename">.mplayer</tt>, или в системный конфигурационный
  каталог <span class="application">MPlayer</span>'а (по умолчанию:
  <tt class="filename">/usr/local/etc/mplayer</tt>)
</p></li><li class="listitem"><p>
  проверьте и отредактируйте <tt class="filename">input.conf</tt>, чтобы включить
  кнопки перемещения по меню (это здесь описано).
</p></li><li class="listitem"><p>
  запустите <span class="application">MPlayer</span> как в следующем примере:
  </p><pre class="screen">mplayer -menu <em class="replaceable"><code>file.avi</code></em></pre><p>
</p></li><li class="listitem"><p>
  нажмите любую меню-кнопку, которую Вы определили
</p></li></ol></div></div></div><div class="sect1" title="2.5. Codec installation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="codec-installation"></a>2.5. Codec installation</h2></div></div></div><div class="sect2" title="2.5.1. Xvid"><div class="titlepage"><div><div><h3 class="title"><a name="xvid"></a>2.5.1. Xvid</h3></div></div></div><p>
<a class="ulink" href="http://www.xvid.org" target="_top">Xvid</a> свободный, MPEG-4 ASP совместимый
видео кодек, особенностями которого являются двухпроходное кодирование и
полная поддержка MPEG-4 ASP.
Имейте в виду, что Xvid не нужен для декодирования Xvid-кодированного видео.
<code class="systemitem">libavcodec</code> используется по-умолчанию,
т.к. обеспечивает более высокую скорость.
</p><div class="procedure" title="Установка Xvid"><a name="id2541327"></a><p class="title"><b>Установка <code class="systemitem">Xvid</code></b></p><p>
  Как и большинство ПО с открытым исходным кодом, он доступен как в виде
  <a class="ulink" href="http://www.xvid.org/downloads.html" target="_top">официальных релизов</a>,
  так и в виде CVS версии.
  Как правило, CVS версия достаточно стабильна для использования, т.к. в большинстве
  случаев ее особенностью является отсутствие ошибок, присутствующих в релизах.
  Далее описывается как заставить  работать
  <code class="systemitem">Xvid</code> CVS с <span class="application">MEncoder</span>:
</p><ol class="procedure" type="1"><li class="step" title="Шаг 1"><p>
  </p><pre class="screen">cvs -z3 -d:pserver:anonymous@cvs.xvid.org:/xvid login</pre><p>
</p></li><li class="step" title="Шаг 2"><p>
  </p><pre class="screen">cvs -z3 -d:pserver:anonymous@cvs.xvid.org:/xvid co xvidcore</pre><p>
</p></li><li class="step" title="Шаг 3"><p>
  </p><pre class="screen">cd xvidcore/build/generic</pre><p>
</p></li><li class="step" title="Шаг 4"><p>
  </p><pre class="screen">./bootstrap.sh</pre><p>
</p></li><li class="step" title="Шаг 5"><p>
  </p><pre class="screen">./configure</pre><p>
  Вам может потребоваться добавить некоторые опции (посмотрите вывод
  <span class="command"><strong>./configure --help</strong></span>).
</p></li><li class="step" title="Шаг 6"><p>
  </p><pre class="screen">make &amp;&amp; make install</pre><p>
</p></li><li class="step" title="Шаг 7"><p>
  Перекомпилируйте <span class="application">MPlayer</span>.
</p></li></ol></div></div><div class="sect2" title="2.5.2. x264"><div class="titlepage"><div><div><h3 class="title"><a name="x264"></a>2.5.2. <code class="systemitem">x264</code></h3></div></div></div><p>
<a class="ulink" href="http://developers.videolan.org/x264.html" target="_top"><code class="systemitem">x264</code></a>
is a library for creating H.264 video.
<span class="application">MPlayer</span> sources are updated whenever
an <code class="systemitem">x264</code> API change
occurs, so it is always suggested to use
<span class="application">MPlayer</span> from Subversion.
</p><p>
If you have a GIT client installed, the latest x264
sources can be gotten with this command:
</p><pre class="screen">git clone git://git.videolan.org/x264.git</pre><p>

Then build and install in the standard way:
</p><pre class="screen">./configure &amp;&amp; make &amp;&amp; make install</pre><p>

Now rerun <tt class="filename">./configure</tt> for
<span class="application">MPlayer</span> to pick up
<code class="systemitem">x264</code> support.
</p></div><div class="sect2" title="2.5.3. AAC кодек"><div class="titlepage"><div><div><h3 class="title"><a name="aac"></a>2.5.3. AAC кодек</h3></div></div></div><p>
AAC (Advanced Audio Coding) - это кодек, иногда обнаруживаемый в MOV и MP4
файлах. Декодер с открытым исходным кодом, называемый FAAD, доступен с
<a class="ulink" href="http://www.audiocoding.com" target="_top">http://www.audiocoding.com</a>.
<span class="application">MPlayer</span> включает в себя CVS версию libfaad 2.1 beta, поэтому
Вам ничего не нужно дополнительно скачивать.
</p><p>
Если Вы используете gcc 3.2, который не может скомпилировать встроенный FAAD,
или просто хотите использовать внешнюю библиотеку, скачаете её с
<a class="ulink" href="http://www.audiocoding.com/download.php" target="_top">страницы загрузок</a>
и укажите <tt class="filename">./configure</tt> <tt class="option">--enable-faad-external</tt>.
Вам не нужен весь faad2, чтобы декодировать AAC файлы, достаточно libfaad.
Вот как Вы можете её собрать:
</p><pre class="screen">
cd faad2/
sh bootstrap
./configure
cd libfaad
make
make install
</pre><p>
Бинарники отсутствуют на audiocoding.com, но вы можете скачать (apt-get) Debian
пакеты с <a class="ulink" href="http://marillat.free.fr" target="_top">домашней страницы Christian Marillat</a>,
Mandrake RPM'ники с <a class="ulink" href="http://plf.zarb.org" target="_top">P.L.F</a> и RedHat RPM'ники
с <a class="ulink" href="http://rpm.livna.org/" target="_top">Livna</a>.
</p></div><div class="sect2" title="2.5.4. AMR кодеки"><div class="titlepage"><div><div><h3 class="title"><a name="amr"></a>2.5.4. AMR кодеки</h3></div></div></div><p>
Речевой кодек Adaptive Multi-Rate используется в мобильных телефонах третьего поколения (3G).

Исходная реализация доступна с
<a class="ulink" href="http://www.3gpp.org" target="_top">The 3rd Generation Partnership Project</a>
(бесплатна для личного использования).
Чтобы включить поддержку, скачайте и установите библиотеки поддержки для
<a class="ulink" href="http://www.penguin.cz/~utx/amr" target="_top">AMR-NB и AMR-WB</a>, следуя
инструкциям на указанной странице.
</p></div></div><div class="sect1" title="2.6. RTC"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rtc"></a>2.6. RTC</h2></div></div></div><p>
У <span class="application">MPlayer</span>'а есть три метода синхронизации.

</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>Чтобы использовать старый метод синхронизации</strong></span>,
  Вам ничего не надо делать. Он использует <code class="systemitem">usleep()</code>,
  чтобы подстроить A/V синхронизацию, с точностью +/- 10ms. Однако, иногда
  требуется даже большая точность синхронизации.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Новый таймер</strong></span> использует RTC (Real Time
  Clock[часы истинного времени]) для этой задачи потому, что это таймер
  точностью 1ms. Он включается опцией <tt class="option">-rtc</tt>, но требует
  правильно настроенного ядра.
  Если Вы работаете с ядром 2.4.19pre8 или более поздним, Вы можете настроить
  максимальную частоту RTC для обычных пользователей через файловую систему
  <code class="systemitem">/proc</code>.
  Используйте одну из этих двух команд, чтобы сделать RTC доступным для обычных
  пользователей:
  </p><pre class="screen">echo 1024 &gt; /proc/sys/dev/rtc/max-user-freq</pre><p>
  </p><pre class="screen">sysctl dev/rtc/max-user-freq=1024</pre><p>
  Можно сделать эти изменения постоянными, добавив последнюю в
  <tt class="filename">/etc/sysctl.conf</tt>.
  </p><p>
  Вы увидите эффективность нового кода таймера по строке состояния.
  Функции управления потребляемой мощностью[power management] у некоторых
  ноутбуковских BIOS'ов со speedstep-CPU плохо взаимодействуют с RTC. Аудио и
  видео могут десинхронизироваться. Вероятно, если Вы вставите штекер внешнего
  питания до включения ноутбука, то это поможет. В некоторых аппаратных
  комбинациях (подтверждено при использовании не-DMA DVD драйва с материнской
  платой ALi1541) использование RTC таймера приводит к "прыгающему"[skippy]
  проигрыванию. В этом случае рекомендуется использовать третий метод.
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>Третий код таймера</strong></span> включается опцией
  <tt class="option">-softsleep</tt>. У него эффективность RTC, но он не использует
  RTC. С другой стороны, он сильнее использует CPU.
</p></li></ul></div><p>
</p></div></div><div class="chapter" title="Глава 3. Использование"><div class="titlepage"><div><div><h2 class="title"><a name="usage"></a>Глава 3. Использование</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#commandline">3.1. Командная строка</a></span></dt><dt><span class="sect1"><a href="#subosd">3.2. Субтитры и OSD</a></span></dt><dt><span class="sect1"><a href="#control">3.3. Управление</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ctrl-cfg">3.3.1. Конфигурация управления</a></span></dt><dt><span class="sect2"><a href="#lirc">3.3.2. Управление через LIRC</a></span></dt><dt><span class="sect2"><a href="#slave-mode">3.3.3. Подчинённый ("рабский") режим</a></span></dt></dl></dd><dt><span class="sect1"><a href="#streaming">3.4. Сетевые потоки и каналы</a></span></dt><dd><dl><dt><span class="sect2"><a href="#streaming-save">3.4.1. Сохранение потоковых данных</a></span></dt></dl></dd><dt><span class="sect1"><a href="#edl">3.5. Редактируемые списки решений [Edit Decision Lists] (EDL)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#edl_using">3.5.1. Использование EDL файлов</a></span></dt><dt><span class="sect2"><a href="#edl_making">3.5.2. Создание EDL файлов</a></span></dt></dl></dd><dt><span class="sect1"><a href="#advaudio">3.6. Расширенные возможности аудио</a></span></dt><dd><dl><dt><span class="sect2"><a href="#advaudio-surround">3.6.1. Окружающее/Многоканальное[Surround/Multichannel] воспроизведение</a></span></dt><dd><dl><dt><span class="sect3"><a href="#advaudio-surround-DVD">3.6.1.1. DVD'шники</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-stereoinfour">3.6.1.2. Воспроизведение стерео звука на четырех колонках</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-passthrough">3.6.1.3. Передача AC-3/DTS</a></span></dt><dt><span class="sect3"><a href="#hwmpa-surround-passthrough">3.6.1.4. Передача MPEG аудио</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-matrix">3.6.1.5. Matrix-кодированное[matrix-encoded] аудио</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-hrtf">3.6.1.6. Эмуляция окружающего звука в наушниках</a></span></dt><dt><span class="sect3"><a href="#advaudio-surround-troubleshooting">3.6.1.7. Решение проблем</a></span></dt></dl></dd><dt><span class="sect2"><a href="#advaudio-channels">3.6.2. Манипуляции с каналами</a></span></dt><dd><dl><dt><span class="sect3"><a href="#advaudio-channels-general">3.6.2.1. Общая информация</a></span></dt><dt><span class="sect3"><a href="#advaudio-channels-mono">3.6.2.2. Воспроизведение моно на двух колонках</a></span></dt><dt><span class="sect3"><a href="#advaudio-channels-copying">3.6.2.3. Копирование/перемещение каналов</a></span></dt><dt><span class="sect3"><a href="#advaudio-channels-mixing">3.6.2.4. Микширование каналов</a></span></dt></dl></dd><dt><span class="sect2"><a href="#advaudio-volume">3.6.3. Программная подстройка звука</a></span></dt></dl></dd></dl></div><div class="sect1" title="3.1. Командная строка"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="commandline"></a>3.1. Командная строка</h2></div></div></div><p>
<span class="application">MPlayer</span> использует составное дерево воспроизведения.
Опции, указанные в командной строке, могут применяться ко всем файлам/URL или
только к некоторым, в зависимости от местоположения. Например
</p><pre class="screen">mplayer -vfm ffmpeg movie1.avi movie2.avi</pre><p>,
будет использовать FFmpeg декодеры для каждого из двух файлов, а
</p><pre class="screen">
mplayer -vfm ffmpeg <em class="replaceable"><code>movie1.avi</code></em> <em class="replaceable"><code>movie2.avi</code></em> -vfm dmo
</pre><p>
будет воспроизводить второй файл, используя DMO декодер.
</p><p>
Вы можете группировать файлы/URL'ы вместе, используя <code class="literal">{</code> и
<code class="literal">}</code>. Это полезно, например, с опцией <tt class="option">-loop</tt>:
</p><pre class="screen">mplayer { 1.avi -loop 2 2.avi } -loop 3</pre><p>
Эта команда проиграет файлы в таком порядке: 1, 1, 2, 1, 1, 2, 1, 1, 2.
</p><p>
Воспроизведение файла:
</p><pre class="synopsis">
<span class="command"><strong>mplayer</strong></span> [<em class="replaceable"><code>опции</code></em>] [<em class="replaceable"><code>путь</code></em>/]<em class="replaceable"><code>имя_файла</code></em>
</pre><p>
</p><p>
Другой способ:
</p><pre class="synopsis">
<span class="command"><strong>mplayer</strong></span> [<em class="replaceable"><code>опции</code></em>] <em class="replaceable"><code>file:///uri-escaped-path</code></em>
</pre><p>
</p><p>
Воспроизведение множества файлов:
</p><pre class="synopsis">
<span class="command"><strong>mplayer</strong></span> [<em class="replaceable"><code>общие опции</code></em>] [<em class="replaceable"><code>путь</code></em>/]<em class="replaceable"><code>имя_файла1</code></em> [<em class="replaceable"><code>опции для имя_файла1</code></em>] <em class="replaceable"><code>имя_файла2</code></em> [<em class="replaceable"><code>опции для имя_файла2</code></em>] ...
</pre><p>
</p><p>
Воспроизведение VCD:
</p><pre class="synopsis">
<span class="command"><strong>mplayer</strong></span> [<em class="replaceable"><code>опции</code></em>] vcd://<em class="replaceable"><code>номер_дорожки</code></em> [-cdrom-device <em class="replaceable"><code>/dev/cdrom</code></em>]
</pre><p>
</p><p>
Воспроизведение DVD:
</p><pre class="synopsis">
<span class="command"><strong>mplayer</strong></span> [<em class="replaceable"><code>опции</code></em>] dvd://<em class="replaceable"><code>номер_ролика</code></em> [-dvd-device <em class="replaceable"><code>/dev/dvd</code></em>]
</pre><p>
</p><p>
Воспроизведение из WWW:
</p><pre class="synopsis">
<span class="command"><strong>mplayer</strong></span> [<em class="replaceable"><code>опции</code></em>] http://<em class="replaceable"><code>site.com/file.asf</code></em>
</pre><p>
(так же можно использовать и списки проигрывания (плейлист[playlist]) )
</p><p>
Воспроизведение по RTSP:
</p><pre class="synopsis">
<span class="command"><strong>mplayer</strong></span> [<em class="replaceable"><code>опции</code></em>] rtsp://<em class="replaceable"><code>server.example.com/streamName</code></em>
</pre><p>
</p><p>
Примеры:
</p><pre class="screen">
mplayer -vo x11 <em class="replaceable"><code>/mnt/Films/Contact/contact2.mpg</code></em>
mplayer vcd://<em class="replaceable"><code>2</code></em> -cdrom-device <em class="replaceable"><code>/dev/hdc</code></em>
mplayer -afm 3 <em class="replaceable"><code>/mnt/DVDtrailers/alien4.vob</code></em>
mplayer dvd://<em class="replaceable"><code>1</code></em> -dvd-device <em class="replaceable"><code>/dev/hdc</code></em>
mplayer -abs 65536 -delay -0.4 -nobps <em class="replaceable"><code>~/movies/test.avi</code></em></pre><p>
</p></div><div class="sect1" title="3.2. Субтитры и OSD"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="subosd"></a>3.2. Субтитры и OSD</h2></div></div></div><p>
Вместе с фильмом <span class="application">MPlayer</span> может показывать и субтитры. В настоящий момент
поддерживаются следующие форматы:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>VOBsub</p></li><li class="listitem"><p>OGM</p></li><li class="listitem"><p>CC (closed caption[скрытые титры])</p></li><li class="listitem"><p>MicroDVD</p></li><li class="listitem"><p>SubRip</p></li><li class="listitem"><p>SubViewer</p></li><li class="listitem"><p>Sami</p></li><li class="listitem"><p>VPlayer</p></li><li class="listitem"><p>RT</p></li><li class="listitem"><p>SSA</p></li><li class="listitem"><p>PJS (Phoenix Japanimation Society)</p></li><li class="listitem"><p>&gt;MPsub</p></li><li class="listitem"><p>AQTitle</p></li><li class="listitem"><p><a class="ulink" href="http://unicorn.us.com/jacosub/" target="_top">JACOsub</a></p></li></ul></div><p>
</p><p>
<span class="application">MPlayer</span> может конвертировать вышеперечисленные форматы
субтитров (<span class="bold"><strong>кроме первых трёх</strong></span>) в следующие форматы
с помощью соответствующих опций:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>MPsub: <tt class="option">-dumpmpsub</tt></p></li><li class="listitem"><p>SubRip: <tt class="option">-dumpsrtsub</tt></p></li><li class="listitem"><p>MicroDVD: <tt class="option">-dumpmicrodvdsub</tt></p></li><li class="listitem"><p>JACOsub: <tt class="option">-dumpjacosub</tt></p></li><li class="listitem"><p>Sami: <tt class="option">-dumpsami</tt></p></li></ul></div><p>
</p><p>
<span class="application">MEncoder</span> может выдавать DVD субтитры
в <a class="link" href="#menc-feat-extractsub" title="9.9. Извлечение DVD субтитров в файл VOBsub">VOBsub</a> формате.
</p><p>
Опции значительно различаются для различных форматов:
</p><p title="VOBsub субтитры"><b>VOBsub субтитры. </b>
VOBsub субтитры состоят из большого (несколько мегабайт) <tt class="filename">.SUB</tt> файла,
и необязательных
<tt class="filename">.IDX</tt> и/или <tt class="filename">.IFO</tt> файлов.
Использование: если у Вас, например, есть файлы
<tt class="filename"><em class="replaceable"><code>sample.sub</code></em></tt>,
<tt class="filename"><em class="replaceable"><code>sample.ifo</code></em></tt> (необязательно),
<tt class="filename"><em class="replaceable"><code>sample.idx</code></em></tt> - Вы должны указать
<span class="application">MPlayer</span>'у опции <tt class="option">-vobsub sample [-vobsubid <em class="replaceable"><code>id</code></em>]</tt> (можно указать полный путь).
Опция <tt class="option">-vobsubid</tt> похожа на <tt class="option">-sid</tt>
для DVD, с её помощью, Вы можете выбирать между дорожками субтитров (языками).
В случае, если <tt class="option">-vobsubid</tt> пропущена, MPlayer попытается использовать
языки, полученные через опцию <tt class="option">-slang</tt> и перейти к пункту
<code class="systemitem">langidx</code> в <tt class="filename">.IDX</tt> файле, чтобы выбрать язык субтитров. Если и это
не удаётся, то субтитров не будет.
</p><p title="Другие субтитры"><b>Другие субтитры. </b>
Прочие форматы субтитров состоят из единого текстового файла, содержащего информацию
о синхронизации, местоположении и тексте субтитра.
Использование: Если у Вас есть, например, файл
<tt class="filename"><em class="replaceable"><code>sample.txt</code></em></tt>,
Вы должны указать опцию <tt class="option">-sub <em class="replaceable"><code>sample.txt</code></em></tt>
(можно указать полный путь).
</p><div class="variablelist" title="Регулировка синхронизации и местоположения субтитров:"><p class="title"><b>Регулировка синхронизации и местоположения субтитров:</b></p><dl><dt><span class="term"><tt class="option">-subdelay <em class="replaceable"><code>sec</code></em></tt></span></dt><dd><p>
    Задерживает субтитры на <tt class="option"><em class="replaceable"><code>sec</code></em></tt>
	секунд. Это значение может быть отрицательным.
  </p></dd><dt><span class="term"><tt class="option">-subfps <em class="replaceable"><code>RATE</code></em></tt></span></dt><dd><p>
    Указывает количество кадров/сек для файла субтитров (вещественное число)
  </p></dd><dt><span class="term"><tt class="option">-subpos <em class="replaceable"><code>0-100</code></em></tt></span></dt><dd><p>
    Указывает позицию субтитров.
  </p></dd></dl></div><p>
Если Вы наблюдаете увеличивающуюся задержку между фильмом и субтитрами, используя
файл субтитров в формате MicroDVD, наиболее вероятно, что частота кадров у фильма и файла
субтитров не совпадают. Пожалуйста, обратите внимание, что формат MicroDVD
использует абсолютные номера кадров для синхронизации, но в нем нет информациио частоте кадров
и поэтому опция
<tt class="option">-subfps</tt> не может использоваться с этим форматом.
Вы должны, если хотите навсегда решить эту проблему, вручную конвертировать
частоту кадров файла субтитров.
<span class="application">MPlayer</span> может сделать для вас это преобразование:
</p><pre class="screen">
mplayer -dumpmicrodvdsub -fps <em class="replaceable"><code>subtitles_fps</code></em> -subfps <em class="replaceable"><code>avi_fps</code></em> \
    -sub <em class="replaceable"><code>subtitle_filename</code></em> <em class="replaceable"><code>dummy.avi</code></em>
</pre><p>
</p><p>
О DVD субтитрах, читайте в секции <a class="link" href="#dvd" title="4.2. Воспроизведение DVD">DVD</a>.
</p></div><div class="sect1" title="3.3. Управление"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="control"></a>3.3. Управление</h2></div></div></div><p>
<span class="application">MPlayer</span> использует полностью конфигурируемый,
основанный на понятии команды, уровень управления, позволяющий манипулировать
<span class="application">MPlayer</span>'ом с клавиатуры, мышью, джойстиком или
с пульта дистанционного управления (используя LIRC). Полный список кнопок
для управления с клавиатуры см. на man-странице.
</p><div class="sect2" title="3.3.1. Конфигурация управления"><div class="titlepage"><div><div><h3 class="title"><a name="ctrl-cfg"></a>3.3.1. Конфигурация управления</h3></div></div></div><p>
<span class="application">MPlayer</span> позволяет повесить любую MPlayer'овскую
команду на любую кнопку, используя простой конфигурационный файл. Синтаксис
файла состоит из имени кнопки, сопровождающегося командой. По умолчанию
конфигурационный файл находится в <tt class="filename">$HOME/.mplayer/input.conf</tt>,
но это можно изменить, указав опцию
<tt class="option">-input <em class="replaceable"><code>conf</code></em></tt>
(относительный путь указывается относительно <tt class="filename">$HOME/.mplayer</tt>).
</p><div class="example"><a name="input_control_file"></a><p class="title"><b>Пример 3.1. Простой файл конфигурации ввода</b></p><div class="example-contents"><pre class="programlisting">
##
## MPlayer input control file
##

RIGHT seek +10
LEFT seek -10
- audio_delay 0.100
+ audio_delay -0.100
q quit
&gt; pt_step 1
&lt; pt_step -1
ENTER pt_step 1 1</pre></div></div><br class="example-break"></div><div class="sect2" title="3.3.2. Управление через LIRC"><div class="titlepage"><div><div><h3 class="title"><a name="lirc"></a>3.3.2. Управление через LIRC</h3></div></div></div><p>
Linux Infrared Remote Control[Инфракрасное Удалённое Управление Linux'ом]
— используйте легко собираемый в домашних условиях IR-приёмник, (почти)
любой пульт управления и управляйте с их помощью Вашей Linux машиной.
Подробности на <a class="ulink" href="http://www.lirc.org" target="_top">www.lirc.org</a>.
</p><p>
Если у Вас установлен ракет lirc, configure само его обнаружит. Если Всё прошло
хорошо, <span class="application">MPlayer</span> при старте напечатает сообщение,
похожее на "<code class="computeroutput">Setting up lirc support...</code>".
Если произошла ошибка, он Вам сообщит. Если он не говорит ничего про LIRC,
то поддержка LIRC не была скомпилирована. Вот так :-)
</p><p>
Имя приложения для <span class="application">MPlayer</span> — угадайте —
<tt class="filename">mplayer</tt>.  Вы можете использовать все команды mplayer'а и
даже можете использовать более одной команды, разделив их символами
<code class="literal">\n</code>. Не забудьте включить флаг repeat[повтор] в
<tt class="filename">.lircrc</tt>, когда это имеет смысл (перемещение, громкость
и т.п.). Вот выдержка из моего <tt class="filename">.lircrc</tt>:
</p><pre class="programlisting">
begin
     button = VOLUME_PLUS
     prog = mplayer
     config = volume 1
     repeat = 1
end

begin
    button = VOLUME_MINUS
    prog = mplayer
    config = volume -1
    repeat = 1
end

begin
    button = CD_PLAY
    prog = mplayer
    config = pause
end

begin
    button = CD_STOP
    prog = mplayer
    config = seek 0 1\npause
end</pre><p>
Если Вам не нравится стандартное место Вашего конфигурационного файла lirc
(<tt class="filename">~/.lircrc</tt>), используйте опцию <tt class="option">-lircconf
<em class="replaceable"><code>filename</code></em></tt>, чтобы указать другой файл.
</p></div><div class="sect2" title='3.3.3. Подчинённый ("рабский") режим'><div class="titlepage"><div><div><h3 class="title"><a name="slave-mode"></a>3.3.3. Подчинённый ("рабский") режим</h3></div></div></div><p>
Наличие подчинённого режима позволяет Вам создавать простые приложения к
<span class="application">MPlayer</span>'у. Когда режим включён (опцией
<tt class="option">-slave</tt>), <span class="application">MPlayer</span> читает со
стандартного входа команды, разделяемые символом конца строки (\n).
Команды документированы в файле
<a class="ulink" href="../../tech/slave.txt" target="_top">slave.txt</a>.
</p></div></div><div class="sect1" title="3.4. Сетевые потоки и каналы"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="streaming"></a>3.4. Сетевые потоки и каналы</h2></div></div></div><p>
<span class="application">MPlayer</span> может проигрывать файлы по сети, используя
HTTP, FTP, MMS или RTSP/RTP протокол.
</p><p>
Проигрывание включается добавлением URL'а в командную строку.
Также, <span class="application">MPlayer</span> учитывает переменную среды
<code class="envar">http_proxy</code> и использует прокси[proxy], если это возможно.
Также можно заставить использовать прокси:
</p><pre class="screen">
mplayer <em class="replaceable"><code>http_proxy://proxy.micorsops.com:3128/http://micorsops.com:80/stream.asf</code></em>
</pre><p>
</p><p>
<span class="application">MPlayer</span> может считывать данные со стандартного входа
(а <span class="emphasis"><em>не</em></span> из поименованных каналов). Это может, например,
использоваться при проигрывании файлов по FTP:
</p><pre class="screen">
wget <em class="replaceable"><code>ftp://micorsops.com/something.avi</code></em> -O - | mplayer -
</pre><p>
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
Мы рекомендуем включать <tt class="option">-cache</tt> при проигрывании из сети:
</p><pre class="screen">
wget <em class="replaceable"><code>ftp://micorsops.com/something.avi</code></em> -O - | mplayer -cache 8192 -
</pre><p>
</p></div><div class="sect2" title="3.4.1. Сохранение потоковых данных"><div class="titlepage"><div><div><h3 class="title"><a name="streaming-save"></a>3.4.1. Сохранение потоковых данных</h3></div></div></div><p>
Как только вам удалось воспроизвести любимый интернет-поток, вы
можете воспользоваться опцией <tt class="option">-dumpstream</tt>, чтобы
сохранить его в файл.
Например:
</p><pre class="screen">
mplayer <em class="replaceable"><code>http://217.71.208.37:8006</code></em> -dumpstream -dumpfile <em class="replaceable"><code>stream.asf</code></em>
</pre><p>
сохранит данные из потока
<em class="replaceable"><code>http://217.71.208.37:8006</code></em> в
<em class="replaceable"><code>stream.asf</code></em>.
Это работает для всех протоколов, поддерживаемых
<span class="application">MPlayer</span>, таких как MMS, RSTP, и других.
</p></div></div><div class="sect1" title="3.5. Редактируемые списки решений [Edit Decision Lists] (EDL)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="edl"></a>3.5. Редактируемые списки решений [Edit Decision Lists] (EDL)</h2></div></div></div><p>
Система редактируемых списков решений [edit decision list] (EDL) позволяет Вам
автоматически пропускать или заглушать части при воспроизведении, основываясь
на специфичном для каждого фильма конфигурационном файле.
</p><p>
Это полезно для тех, кто может захотеть посмотреть фильм в "семейном" режиме.
Вы можете исключить любые проявления насилия, ненормативной лексики,
Jar-Jar Binks, и т. п. из фильмов, сообразуясь с Вашими личными предпочтениями.
Помимо этого, существуют другие применения, например автоматический пропуск рекламы
при просмотре фильмов.
</p><p>
Формат EDL файлов пока элементарен. в каждой строке находится одна команда, которая
указывает, что делать (пропустить/выключить звук) и когда (используя pts в секундах).
</p><div class="sect2" title="3.5.1. Использование EDL файлов"><div class="titlepage"><div><div><h3 class="title"><a name="edl_using"></a>3.5.1. Использование EDL файлов</h3></div></div></div><p>
Включите опцию <tt class="option">-edl &lt;имя_файла&gt;</tt>, когда Вы запускаете
<span class="application">MPlayer</span>, с именем EDL файла, который Вы хотите
использовать с видео.
</p></div><div class="sect2" title="3.5.2. Создание EDL файлов"><div class="titlepage"><div><div><h3 class="title"><a name="edl_making"></a>3.5.2. Создание EDL файлов</h3></div></div></div><p>
Текущий формат файлов EDL:
</p><pre class="programlisting">[начальная секунда] [конечная секунда] [действие]</pre><p>
Где секунды - это числа с плавающей точкой (вещественные числа), а действие -
это или <code class="literal">0</code> для пропуска или <code class="literal">1</code> для
заглушения звука. Пример:
</p><pre class="programlisting">
5.3   7.1    0
15    16.7   1
420   422    0
</pre><p>
Это вызовет пропуск видео с 5.3 секунды до 7.1 секунды, затем заглушит звук
на 15 секунде, включит обратно в 16.7 секунд и пропустит видео с 420 по 422
секунды. Эти действия будут происходить, когда таймер проигрывания достигнет
указанных в файле значений.
</p><p>
Чтобы начать создать EDL файл, используйте опцию <tt class="option">-edlout
&lt;filename&gt;</tt>. При проигрывании, когда Вы хотите отметить
предыдущие две секунды для пропуска, нажмите <span class="keycap"><b>i</b></span>.
Соответствующая запись для этого времени будет добавлена в файл. Затем Вы
можете вернуться и подстроить сгенерированный EDL файл также как и
поправить действие по-умолчанию (пропуск блока, указанного в строке).
</p></div></div><div class="sect1" title="3.6. Расширенные возможности аудио"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advaudio"></a>3.6. Расширенные возможности аудио</h2></div></div></div><div class="sect2" title="3.6.1. Окружающее/Многоканальное[Surround/Multichannel] воспроизведение"><div class="titlepage"><div><div><h3 class="title"><a name="advaudio-surround"></a>3.6.1. Окружающее/Многоканальное[Surround/Multichannel] воспроизведение</h3></div></div></div><div class="sect3" title="3.6.1.1. DVD'шники"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-surround-DVD"></a>3.6.1.1. DVD'шники</h4></div></div></div><p>
Большинство DVD и многие другие файлы содержат окружающий звук.
<span class="application">MPlayer</span> поддерживает воспроизведение такого звука, но
не задействует его по-умолчанию, поскольку стерео оборудование более распространено.
Для воспроизведения файла с более чем двумя каналами звука, используйте опцию
 <tt class="option">-channels</tt>. Например, для воспроизведения DVD со звуком 5.1:
</p><pre class="screen">mplayer dvd://1 -channels 6</pre><p>
Имейте ввиду, что несмотря на название "5.1" на самом деле присутствует
шесть независимых каналов. Если у вас есть соответствующее оборудование, вы
спокойно можете добавить опцию <tt class="option">channels</tt> в конфигурационный
файл <tt class="filename">~/.mplayer/config</tt> <span class="application">MPlayer</span>'а.
Например, для установки по умолчанию квадрофонического[quadraphonic] воспроизведения, добавьте
такую строку:
</p><pre class="programlisting">channels=4</pre><p>
<span class="application">MPlayer</span> будет выводить четырехканальный звук, если все четыре
есть в проигрываемом файле.
</p></div><div class="sect3" title="3.6.1.2. Воспроизведение стерео звука на четырех колонках"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-surround-stereoinfour"></a>3.6.1.2. Воспроизведение стерео звука на четырех колонках</h4></div></div></div><p>
По-умолчанию, <span class="application">MPlayer</span> не дублирует никакие каналы, как и
большинство звуковых драйверов. Если вы хотите, сделайте это самостоятельно:
</p><pre class="screen">mplayer <em class="replaceable"><code>filename</code></em> -af channels=2:2:0:1:0:0</pre><p>
Объяснения ищите в разделе
<a class="link" href="#advaudio-channels-copying" title="3.6.2.3. Копирование/перемещение каналов">копирование каналов</a>.
</p></div><div class="sect3" title="3.6.1.3. Передача AC-3/DTS"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-surround-passthrough"></a>3.6.1.3. Передача AC-3/DTS</h4></div></div></div><p>
DVD, как правило, имеют окружающий звук, кодированный в AC-3 (Dolby Digital) или DTS
(Digital Theater System[система цифрового кинотеатра]) формате.  Некоторое
современное аудио оборудование способно самостоятельно декодировать эти форматы.
<span class="application">MPlayer</span> может быть сконфигурирован, чтобы передавать
данные без их декодирования. Это работает только для наличие в вашей звуковой карте
разъема S/PDIF (Sony/Philips Digital Interface[цифровой интерфейс Sony/Philips]).
</p><p>
Если ваше оборудование может декодировать и AC-3, и DTS, выможете спокойно
задействовать передачу для обоих форматов. В противном случае включайте
передачу только того формата, который поддерживается оборудованием.
</p><div class="itemizedlist" title="Чтобы включить передачу из командной строки:"><p class="title"><b>Чтобы включить передачу из командной строки:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  только для AC-3, используйте <tt class="option">-ac hwac3</tt>
</p></li><li class="listitem"><p>
  только для DTS, используйте <tt class="option">-ac hwdts</tt>
</p></li><li class="listitem"><p>
  для AC-3 и DTS, используйте <tt class="option">-afm hwac3</tt>
</p></li></ul></div><div class="itemizedlist" title="Чтобы включить передачу в файле настроек MPlayer:"><p class="title"><b>Чтобы включить передачу в файле настроек <span class="application">MPlayer</span>:
</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  только для AC-3: <tt class="option">ac=hwac3,</tt>
</p></li><li class="listitem"><p>
  только для DTS: <tt class="option">ac=hwdts,</tt>
</p></li><li class="listitem"><p>
  для AC-3 и DTS: <tt class="option">afm=hwac3</tt>
</p></li></ul></div><p>
Заметьте, что в конце <tt class="option">ac=hwac3,</tt> и <tt class="option">ac=hwdts,</tt>
присутствует запятая (","). В этом случае
<span class="application">MPlayer</span> вернется к кодеку, который он обычно использует,
при воспроизведении файла, не содержащего звука AC-3 или DTS.
<tt class="option">afm=hwac3</tt> запятой не требует;
Когда указано семейство аудио, <span class="application">MPlayer</span> вернется к нужному кодеку так
или иначе.
</p></div><div class="sect3" title="3.6.1.4. Передача MPEG аудио"><div class="titlepage"><div><div><h4 class="title"><a name="hwmpa-surround-passthrough"></a>3.6.1.4. Передача MPEG аудио</h4></div></div></div><p>
Передатчики цифрового ТВ (такие как DVB и ATSC) и некоторые DVD, обычно имеют
аудио потоки MPEG (в частности MP2). Некоторые аппаратные MPEG декодеры, такие как
полнофункциональные DVB карты и DXR2 адаптеры имеют встроенную возможность
декодирования этого формата.
<span class="application">MPlayer</span> может быть настроен для передачи аудио данных
без из декодирования.
</p><p>
Для использования этого кодека:
</p><pre class="screen"> mplayer -ac hwmpa </pre><p>
</p></div><div class="sect3" title="3.6.1.5. Matrix-кодированное[matrix-encoded] аудио"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-surround-matrix"></a>3.6.1.5. Matrix-кодированное[matrix-encoded] аудио</h4></div></div></div><p>
<span class="emphasis"><em>***TODO***</em></span>
</p><p>
Этот раздел пока не написан, и не может быть завершен, пока кто-нибудь не
предоставить нам образцы файлов для тестирования. Если у вас есть
matrix-кодированные файлы, знаете где их можно достать или имеете информацию,
которая может быть полезна, отошлите сообщение в рассылку
<a class="ulink" href="http://lists.mplayerhq.hu/mailman/listinfo/mplayer-docs" target="_top">MPlayer-DOCS</a>.
Укажите в теме письма [matrix-encoded audio].
</p><p>
Если не появятся файлы или какая-нибудь информация, этот раздел будет удален.
</p><p>
Полезные ссылки:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <a class="ulink" href="http://electronics.howstuffworks.com/surround-sound5.htm" target="_top">http://electronics.howstuffworks.com/surround-sound5.htm</a>
</p></li><li class="listitem"><p>
  <a class="ulink" href="http://www.extremetech.com/article2/0,1697,1016875,00.asp" target="_top">http://www.extremetech.com/article2/0,1697,1016875,00.asp</a>
</p></li></ul></div><p>
</p></div><div class="sect3" title="3.6.1.6. Эмуляция окружающего звука в наушниках"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-surround-hrtf"></a>3.6.1.6. Эмуляция окружающего звука в наушниках</h4></div></div></div><p>
<span class="application">MPlayer</span> содержит плагин HRTF (Head Related Transfer
Function), основанный на
<a class="ulink" href="http://sound.media.mit.edu/KEMAR.html" target="_top">проекте MIT</a>
откуда взяты измерения от микрофонов, вмонтированных в макет человеческой головы.
</p><p>
Хотя точная имитация системы окружающего звука[surround system] невозможна,
<span class="application">MPlayer</span>'овский плагин HRTF

производит более пространственный окружающий звук
на 2-х канальных наушниках. Обычное сведение, просто объединяет канали в два;
кроме объединения каналов, <tt class="option">hrtf</tt> создает хитрое эхо, слегка
увеличивает разделение стерео, и меняет громкость некоторых частот.
Лучше ли звучит HRTF, зависеть от исходного звука, и является делом
личного вкуса, но его определенного стоит попробовать.
</p><p>
Для воспроизведения DVD с HRTF:
</p><pre class="screen">mplayer dvd://1 -channels 6 -af hrtf</pre><p>
</p><p>
<tt class="option">hrtf</tt> работает хорошо тоько с 5-ю или 6-ю каналами. Также,
<tt class="option">hrtf</tt> тербуется 48 kHz звук. DVD аудио уже kHz, но если у вас есть
файл, который вы хотите воспроизвести при помощи <tt class="option">hrtf</tt> , с другой
частотой сэмплирования, необходимо его ресэмплировать[resample]:
</p><pre class="screen">
mplayer <em class="replaceable"><code>filename</code></em> -channels 6 -af resample=48000,hrtf
</pre><p>
</p></div><div class="sect3" title="3.6.1.7. Решение проблем"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-surround-troubleshooting"></a>3.6.1.7. Решение проблем</h4></div></div></div><p>
Если вы ничего не слышите при использовании окружающего звука, проверьте
настройки вашего микшера при помощи такой как  <span class="application">alsamixer</span>
программы; очень часто по-умолчанию выходной звук  выключен или его уровень
установлен в ноль.
</p></div></div><div class="sect2" title="3.6.2. Манипуляции с каналами"><div class="titlepage"><div><div><h3 class="title"><a name="advaudio-channels"></a>3.6.2. Манипуляции с каналами</h3></div></div></div><div class="sect3" title="3.6.2.1. Общая информация"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-channels-general"></a>3.6.2.1. Общая информация</h4></div></div></div><p>
К сожалению, нет стандарта, описывающего порядок следования каналов. Порядки, указанные ниже,
таковые из AC-3 и довольно типичны; попробуйте их и увидите совпадают ли они с вашим источником.
Каналы нумеруются с нуля.

</p><div class="orderedlist" title="mono[моно]"><p class="title"><b>mono[моно]</b></p><ol class="orderedlist" type="1" compact><li class="listitem" value="0"><p>center[центральный]</p></li></ol></div><p>

</p><div class="orderedlist" title="stereo[стерео]"><p class="title"><b>stereo[стерео]</b></p><ol class="orderedlist" type="1" compact><li class="listitem" value="0"><p>left[левый]</p></li><li class="listitem"><p>right[правый]</p></li></ol></div><p>

</p><div class="orderedlist" title="quadraphonic[квадрофонический]"><p class="title"><b>quadraphonic[квадрофонический]</b></p><ol class="orderedlist" type="1" compact><li class="listitem" value="0"><p>left front[левый передний]</p></li><li class="listitem"><p>right front[правый передний]</p></li><li class="listitem"><p>left rear[левый задний]</p></li><li class="listitem"><p>right rear[правый задний]</p></li></ol></div><p>

</p><div class="orderedlist" title="surround 4.0[окружение 4.0]"><p class="title"><b>surround 4.0[окружение 4.0]</b></p><ol class="orderedlist" type="1" compact><li class="listitem" value="0"><p>left front[левый передний]</p></li><li class="listitem"><p>right front[правый передний]</p></li><li class="listitem"><p>center rear[центральный задний]</p></li><li class="listitem"><p>center front[центральный передний]</p></li></ol></div><p>

</p><div class="orderedlist" title="surround 5.0[]окружение 5.0"><p class="title"><b>surround 5.0[]окружение 5.0</b></p><ol class="orderedlist" type="1" compact><li class="listitem" value="0"><p>left front[левый передний]</p></li><li class="listitem"><p>right front[правый передний]</p></li><li class="listitem"><p>left rear[левый задний]</p></li><li class="listitem"><p>right rear[правый задний]</p></li><li class="listitem"><p>center front[центральный передний]</p></li></ol></div><p>

</p><div class="orderedlist" title="surround 5.1[окружение 5.1]"><p class="title"><b>surround 5.1[окружение 5.1]</b></p><ol class="orderedlist" type="1" compact><li class="listitem" value="0"><p>left front[левый передний]</p></li><li class="listitem"><p>right front[правый передний]</p></li><li class="listitem"><p>left rear[левый задний]</p></li><li class="listitem"><p>right rear[правый задний]</p></li><li class="listitem"><p>center front[центральный передний]</p></li><li class="listitem"><p>subwoofer[сабвуфер]</p></li></ol></div><p>
</p><p>
Опция <tt class="option">-channels</tt> используется для запроса количества каналов у
аудио декодера. Некоторые аудио кодеки используют указанное количество каналов
для определения необходимо ли сведение каналов. Заметьте, что это не всегда
отражается на количестве выходных каналов. Например, используя
<tt class="option">-channels 4</tt> для проигрывания стерео MP3 файла будет по-прежнему
выводить звук на два канала, поскольку MP3 кодек не создает дополнительных каналов.
</p><p>
Аудио плагин <tt class="option">channels</tt> может использоваться для создания или
удаления каналов, и полезен для управления количеством каналов, отсылаемых на
звуковую карту. Смотрите следующие разделы для получения информации о манипуляции
каналами.
</p></div><div class="sect3" title="3.6.2.2. Воспроизведение моно на двух колонках"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-channels-mono"></a>3.6.2.2. Воспроизведение моно на двух колонках</h4></div></div></div><p>
Моно звук намного лучше звучит, при воспроизведении на двух колонках - особенно
при использовании наушников. Аудиофайлы, реально имеющие один канал, автоматически
проигрываются через две колонки; к сожалению, множество файлов с моно звуком
кодированы как стерео с тишиной в одном из каналов. Простейший и безопасный
способ воспроизведения одинакового звука на обеих колонках состоит в использовании
плагина <tt class="option">extrastereo</tt>:
</p><pre class="screen">
mplayer <em class="replaceable"><code>filename</code></em> -af extrastereo=0
</pre><p>
</p><p>
Он усредняет оба канала, делая каждый в два раза тише изначального.
В следующих разделах приводятся другие способы сделать то же самое
без уменьшения громкости, но они сложнее и требуют указания различных опций
в зависимости от того, какой канал остается. Если вам действительно требуется
управлять громкостью, бутет проще поэкспериментировать с плагином
<tt class="option">volume</tt> и определить верное значение. Например:

</p><pre class="screen">mplayer <em class="replaceable"><code>filename</code></em> -af extrastereo=0,volume=5</pre><p>

</p></div><div class="sect3" title="3.6.2.3. Копирование/перемещение каналов"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-channels-copying"></a>3.6.2.3. Копирование/перемещение каналов</h4></div></div></div><p>
Плагин <tt class="option">channels</tt> может переместить любой или все каналы.
Установка всех подопций плагина <tt class="option">channels</tt>
не так проста и требует определенной аккуратности.

</p><div class="orderedlist"><ol class="orderedlist" type="1" compact><li class="listitem"><p>
  Определитесь, сколько выходных каналов  вам необходимо. Это первая подопция.
</p></li><li class="listitem"><p>
  Посчитайте количество перемещаемых каналов. Это вторая подопция.Каждый канал может быть
  перемещен в несколько отличных каналов одновременно, но учтите, что исходный канал
  (даже при перемещении в одно место) будет пуст, пока в него не переместится
  какой-либо другой. Для копирования канала, оставляя исходный неизменным, просто
  переместите канал одновременно в требуемый и исходный. Например:
  </p><pre class="programlisting">
канал 2 --&gt; канал 3
канал 2 --&gt; канал 2</pre><p>
</p></li><li class="listitem"><p>
  Запишите копии каналов в виде пары подопций. Заметьте, что первый канал - это 0,
  второй - 1 и т.д. Порядок следования значений не имеет, пока они правильно сгруппированы
  в пары <em class="replaceable"><code>исходный:результирующий</code></em>.
</p></li></ol></div><p>
</p><h5><a name="id2546207"></a>Пример: один канал на две колонки</h5><p>
Это пример другого способа воспроизвести один канал на обе колонки.
В нем предполагается, что левый канал должен воспроизводиться, а правый надо отбросить.
Выполняем шаги, описанные выше:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Для создания по каналу на каждую из колонок, первая подопция должна быть 2.
</p></li><li class="listitem"><p>
  Левый канал надо переместить на правый и на себя, чтобы он не оставался пуст.
  Всего два перемещения, делаем вторую подопцию тоже равной "2".
</p></li><li class="listitem"><p>
  Для перемещения левого канала (канал 0) в правый (канал 1) пара подопций имеет вид "0:1",
  "0:0" перемещает левый канал на себя.
</p></li></ol></div><p>
Собираем все вместе:
</p><pre class="screen">
mplayer <em class="replaceable"><code>filename</code></em> -af channels=2:2:0:1:0:0
</pre><p>
</p><p>
Преимущество этого примере перед  <tt class="option">extrastereo</tt> состоит в том,
что громкость каждого канала такая же как у исходного. Недостаток заключается в
необходимости изменить подопции на "2:2:1:0:1:1", если желаемый
канал - правый. К тому же его труднее запомнить и набрать.
</p><h5><a name="id2546295"></a>Пример: левый канал на две колонки (сокращение)</h5><p>
На самом деле есть более простой способ использования плагина
<tt class="option">channels</tt> для воспроизведения левого канала на обеих колонках:
</p><pre class="screen">mplayer <em class="replaceable"><code>filename</code></em> -af channels=1</pre><p>
Второй канал отбрасывается и, при отсутствии других подопций, остается
единственным. Драйвер звуковой карты автоматически воспроизводит одноканальный
звук на обеих колонках. Но это сработает только если желаемый канал - левый.
</p><h5><a name="id2546332"></a>Пример: дублирование передних каналов на задние</h5><p>
Другая обычная операция - это дублирование передних каналов и воспроизведение
их на задних колонках при квадрофонической настройке.
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Выходных каналов должно быть четыре. Первая подопция равна "4".
</p></li><li class="listitem"><p>
  Каждый из передних каналов надо переместить на соответствующий задний и на себя.
  Это четыре перемещения, так что вторая подопция равна "4".
</p></li><li class="listitem"><p>
  Левый передний (канал 0) надо переместить на левый задний (канал 2): "0:2".
  Левый передний также надо переместить на себя: "0:0". правый передний (канал 1)
  перемещается на правый задний (канал 3): "1:3", и на себя: "1:1".
</p></li></ol></div><p>
Собираем все и получаем:
</p><pre class="screen">
mplayer <em class="replaceable"><code>filename</code></em> -af channels=4:4:0:2:0:0:1:3:1:1
</pre><p>
</p></div><div class="sect3" title="3.6.2.4. Микширование каналов"><div class="titlepage"><div><div><h4 class="title"><a name="advaudio-channels-mixing"></a>3.6.2.4. Микширование каналов</h4></div></div></div><p>
Плагин <tt class="option">pan</tt> пожет микшировать каналы в указанных пользователем
пропорциях. Он может делать все, что <tt class="option">channels</tt>, и даже больше.
К сожалению, подопции намного сложнее.
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Определите со скольки каналами будете работать. Вам необходимо указать это
  при помощи <tt class="option">-channels</tt> и/или <tt class="option">-af channels</tt>.
  Дальнейшие примеры покажут когда какую использовать.
</p></li><li class="listitem"><p>
  Решите, сколько каналов скормить <tt class="option">pan</tt> (дополнительные декодированные
  каналы отбрасываются). Это первая подопция, она также определяет сколько каналов
  готовится к выводу).
</p></li><li class="listitem"><p>
  Оставшиеся подопции указывают какая часть каждого входного канала микшируется в
  в каждый выходной. Это самая сложная часть. Для решения задачи, разделите
  подопции на несколько наборов, по одному на каждый выходной канал. Каждая
  подопция в наборе относится к входному каналу.
  </p><p>
  <tt class="option">pan</tt> принимает значения от 0 до 512, давая от 0% до 51200%
  громкости исходного канала. Будьте осторожны, используя значения больше 1,
  если вы превысить диапазон сэмплинга вашей звуковой карты, вы услышите
  противный треск и скрежет. Если хотите, можете вслед за
  <tt class="option">pan</tt> указать <tt class="option">,volume</tt> для задействования обрезки,
  но лучше держать значения <tt class="option">pan</tt> достаточно низкими, чтобы не
  требовалось обрезание.
  </p></li></ol></div><p>
</p><h5><a name="id2546527"></a>Пример: один канал на две колонки</h5><p>
Это еще один пример воспроизведения левого канала на двух колонках.
Следуя инструкциям выше:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
<tt class="option">pan</tt> должен выдать два канала, т.о. первая подопция равна "2".
</p></li><li class="listitem"><p>
  Поскольку входных каналов два, будет два набора подопций.
  Так как выходных каналов тоже два, то  будет по две подопции в каждом наборе.
  Левый канал из файла должен перейти с полной громкостью в новые левый и правый.
  Таким образом, первый набор подопций будет "1:1".
  правый канал должен быть отброшен, поэтому второй набор равен "0:0".
  Любые значения 0 в конце могут быть опущены, но для более легкого понимания мы их оставим.
</p></li></ol></div><p>
Соединение опций дает:
</p><pre class="screen">mplayer <em class="replaceable"><code>filename</code></em> -af pan=2:1:1:0:0</pre><p>
Если вместо правого канала нужен левый,  подопции для <tt class="option">pan</tt>
будут "2:0:0:1:1".
</p><h5><a name="id2546606"></a>Пример: левый канал на две колонки (сокращение)</h5><p>
Как и с <tt class="option">channels</tt>, существует сокращенный вариант, который работает только
для левого канала:
</p><pre class="screen">mplayer <em class="replaceable"><code>filename</code></em> -af pan=1:1</pre><p>
Поскольку <tt class="option">pan</tt> имеет только один входной канал (остальные отбрасываются),
будет только одна подопция, указывающая, что единственный канал получает 100% собственной
громкости.
</p><h5><a name="id2546645"></a>Пример: сведение 6-канального PCM</h5><p>
Декодер <span class="application">MPlayer</span>'а для 6-канального PCM не способен сводить каналы.
Здесь описан способ сведения PCM, используя <tt class="option">pan</tt>:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Количество выходных каналов равно 2, значит первая подопция равна "2".
</p></li><li class="listitem"><p>
  С шестью входными каналами будем иметь шесть наборов подопций. К счастью, поскольку
  мы беспокоимся о выводе только первых двух, достаточно создать два набора;
  оставшиеся можно опустить. Имейте ввиду, что не все многоканальные имеют одинаковый
  порядок каналов. пример показывает как свести файл с порядком как у AC-3 5.1:
</p><pre class="programlisting">
0 - передний левый
1 - передний правый
2 - задний левый
3 - задний правый
4 - центральный передний
5 - сабвуфер</pre><p>
  В первом наборе указаны проценты от исходной громкости, в соответствующем порядке,
  которую каждый выходной канал получит от переднего левого канала: "1:0".
  Правый передний должен перейти в правый: "0:1".
  То же для задних: "1:0" и "0:1"
  Центральный должен попасть в оба с половинной громкостью: "0.5:0.5", и
  сабвуфер переходит в оба канала с полной громкостью: "1:1".
</p></li></ol></div><p>
Все вместе:
</p><pre class="screen">
mplayer <em class="replaceable"><code>6-channel.wav</code></em> -af pan=2:1:0:0:1:1:0:0:1:0.5:0.5:1:1
</pre><p>
Проценты, указанные выше всего лишь пример. подстраивайте их как вам удобно.
</p><h5><a name="id2546748"></a>Пример: Воспроизведение звука 5.1 на больших колонках без сабвуфера</h5><p>
Если у вас есть пара огромных передних колонок, нет надобности тратиться на
сабвуфер для полноценной системы 5.1. Если использовать <tt class="option">-channels 5</tt>
для запроса к liba52 на декодирование 5.1 аудио в 5.0, канал сабвуфера просто
отбрасывается. Если вы сотите самостоятельно распределить канал
сабвуфера, то потребуется ручное сведение при помощи <tt class="option">pan</tt>:

</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Поскольку <tt class="option">pan</tt> надо анализировать все шесть каналов, укажите
<tt class="option">-channels 6</tt>, чтобы liba52 декодировал их все.
</p></li><li class="listitem"><p>
  <tt class="option">pan</tt> выводит только пять каналов, первая подопция равна 5.
</p></li><li class="listitem"><p>
  Шесть входных каналов означает шесть наборов по пять подопций в каждом.
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc" compact><li class="listitem"><p>
    Левый передний дублируется только на себя:
    "1:0:0:0:0"
  </p></li><li class="listitem"><p>
    То же для правого переднего:
    "0:1:0:0:0"
  </p></li><li class="listitem"><p>
    То же для левого заднего:
    "0:0:1:0:0"
  </p></li><li class="listitem"><p>
    И то же для правого заднего:
    "0:0:0:1:0"
  </p></li><li class="listitem"><p>
    Центральный передний, тоже:
    "0:0:0:0:1"
  </p></li><li class="listitem"><p>
    И, наконец, мы должны решить что же делать с сабвуфером,
    например, половина на передний правый и половина на передний левый:
    "0.5:0.5:0:0:0"
  </p></li></ul></div><p>
</p></li></ol></div><p>
Собирая все подопции месте, получаем:
</p><pre class="screen">
mplayer <em class="replaceable"><code>dvd://1</code></em> -channels 6 -af pan=5:1:0:0:0:0:0:1:0:0:0:0:0:1:0:0:0:0:0:1:0:0:0:0:0:1:0.5:0.5:0:0:0
</pre><p>
</p></div></div><div class="sect2" title="3.6.3. Программная подстройка звука"><div class="titlepage"><div><div><h3 class="title"><a name="advaudio-volume"></a>3.6.3. Программная подстройка звука</h3></div></div></div><p>
Некоторые звуковые дорожки без усиления слишком тихие для комфортного прослушивания.
Это становится проблемой, если звуковое оборудование не способно усиливать сигнал.
Опция <tt class="option">-softvol</tt> указывает <span class="application">MPlayer</span>'у
использовать встроенный микшер. После этого вы можете использовать клавиши
подстройки громкости (по-умолчанию <span class="keycap"><b>9</b></span> и <span class="keycap"><b>0</b></span>)
чтобы достичь значительно более громкого звучания. Заметьте, что это
не исключает использования микшера вашей карты; <span class="application">MPlayer</span>
всего лишь усиливает сигнал перед отправкой его на звуковую карту.
Следующим пример может являться неплохим началом:
</p><pre class="screen">
mplayer <em class="replaceable"><code>quiet-file</code></em> -softvol -softvol-max 300
</pre><p>
Опция <tt class="option">-softvol-max</tt> указывает максимально допустимый уровень звука в
процентах от исходного. Например, <tt class="option">-softvol-max 200</tt> позволит
увеличивать громкость вдвое по сравнению с оригинальным звуком.
Использование больших значений с<tt class="option">-softvol-max</tt>; высокий уровень
громкости не будет достигнуть без использования клавиш регулирования громкости.
Единственный минус больших значений заключается в том, что, поскольку
<span class="application">MPlayer</span>  регулирует громкость в процентах от
максимума, вы не будете иметь той же точности при использовании клавиш
регулирования громкости.
Используйте меньшее значение <tt class="option">-softvol-max</tt> и/или укажите
<tt class="option">-volstep 1</tt> если нужна повышенная точность.
</p><p>
Опция <tt class="option">-softvol</tt> работает, управляя аудио плагином
<tt class="option">volume</tt>. Если вам надо воспроизвести файл с определенной
громкостью от начальной, можете указать <tt class="option">volume</tt> вручную:
</p><pre class="screen">mplayer <em class="replaceable"><code>quiet-file</code></em> -af volume=10</pre><p>
Будет воспроизведен файл в усилением в 10 децибел. Будьте осторожны,
используя плагин <tt class="option">volume</tt> - вы можете легко повредить
ваши уши слишком громким звуком. Начните с маленьких значений и постепенно
увеличивайте, пока не почувствуете, что достаточно. Также, если
указать черезчур высокие значения, <tt class="option">volume</tt> может потребоваться
обрезать звук, чтобы избежать отправления на карту данных, превышающих
допустимые значение; это приведет к искажению звука.
</p></div></div></div><div class="chapter" title="Глава 4. Использование CD/DVD"><div class="titlepage"><div><div><h2 class="title"><a name="cd-dvd"></a>Глава 4. Использование CD/DVD</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#drives">4.1. Приводы CD/DVD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#drives_linux">4.1.1. Linux</a></span></dt><dt><span class="sect2"><a href="#drives_freebsd">4.1.2. FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dvd">4.2. Воспроизведение DVD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#region_code">4.2.1. Региональный код</a></span></dt></dl></dd><dt><span class="sect1"><a href="#vcd">4.3. Воспроизведение VCD</a></span></dt></dl></div><div class="sect1" title="4.1. Приводы CD/DVD"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="drives"></a>4.1. Приводы CD/DVD</h2></div></div></div><p>
Современные приводы CD-ROM могут работать на очень высоких скоростях, некоторые
из них способны регулировать скорость чтения. Несколько аргументов за
использование этой возможности:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  На высоких оборотах возрастает вероятность ошибки при чтении, особенно с
  плохо штампованных дисков. Уменьшение скорости может предотвратить потерю
  данных в этом случае.
</p></li><li class="listitem"><p>
  Многие CD-ROM приводы ужасно шумят, а снижение скорости может привести
  к уменьшению шума.
</p></li></ul></div><div class="sect2" title="4.1.1. Linux"><div class="titlepage"><div><div><h3 class="title"><a name="drives_linux"></a>4.1.1. Linux</h3></div></div></div><p>
Вы можете уменьшить скорость вращения IDE CD-ROM приводов программами
<span class="command"><strong>hdparm</strong></span>,<span class="command"><strong>setcd</strong></span> или <span class="command"><strong>cdctl</strong></span>. Это работает так:
</p><pre class="screen">hdparm -E <em class="replaceable"><code>[скорость]</code></em> <em class="replaceable"><code>[устройство cdrom]</code></em></pre><p>
</p><pre class="screen">setcd -x <em class="replaceable"><code>[скорость]</code></em> <em class="replaceable"><code>[устройство cdrom]</code></em></pre><p>
</p><pre class="screen">cdctl -bS <em class="replaceable"><code>[скорость]</code></em></pre><p>
</p><p>
Если используется эмуляция SCSI, Вам следует применять настройки к реальному IDE
устройству, а не сэмулированному SCSI.
</p><p>
Если у Вас есть привилегии администратора, следующая команда
тоже может оказаться полезной:
</p><pre class="screen">echo file_readahead:2000000 &gt; /proc/ide/<em class="replaceable"><code>[устройство cdrom]</code></em>/settings</pre><p>
</p><p>
Таким образом, предварительно считывается 2 мегабайта (полезно при
дисках с царапинами). Если поставить слишком большое значение, то постоянный
запуск и остановка вращения диска ужасно снизят эффективность.
Рекомендуется также подстроить привод, используя <span class="command"><strong>hdparm</strong></span>:
</p><pre class="screen">hdparm -d1 -a256 -u1 <em class="replaceable"><code>[устройство cdrom]</code></em></pre><p>
</p><p>
Этой командой включается прямой доступ к памяти[DMA], предварительное
чтение и размаскировка IRQ (прочтите man-страницу <span class="command"><strong>hdparm</strong></span>,
с более подробным описанием).
</p><p>
Обратитесь к
"<tt class="filename">/proc/ide/<em class="replaceable"><code>[устройство cdrom]</code></em>/settings</tt>"
для подстройки Вашего CD-ROM привода.
</p><p>
Вы можете настроить скорость SCSI CD-ROM приводов с помощью
<span class="command"><strong>sdparm</strong></span>, необходима версия 1.03 или выше:
</p><pre class="screen">sdparm --command=speed=<em class="replaceable"><code>[скорость в кБ/с]</code></em> <em class="replaceable"><code>[устройство cdrom]</code></em></pre><p>
Скорость должна быть указана в килобайтах в секунду, привод
округлит её надлежащим образом. Пожалуйста, обратитесь с странице
руководства sdparm для деталей.
</p><p>
There is also a dedicated tool that works for
<a class="ulink" href="http://das.ist.org/~georg/" target="_top">Plextor SCSI drives</a>.
</p></div><div class="sect2" title="4.1.2. FreeBSD"><div class="titlepage"><div><div><h3 class="title"><a name="drives_freebsd"></a>4.1.2. FreeBSD</h3></div></div></div><p>Скорость:
</p><pre class="screen">cdcontrol [-f <em class="replaceable"><code>устройство</code></em>] speed <em class="replaceable"><code>[скорость]</code></em></pre><p>DMA: </p><pre class="screen">sysctl hw.ata.atapi_dma=1</pre></div></div><div class="sect1" title="4.2. Воспроизведение DVD"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dvd"></a>4.2. Воспроизведение DVD</h2></div></div></div><p>
Полный список возможных опций можно прочитать в man странице.
Синтаксис для воспроизведения стандартного DVD таков:
</p><pre class="screen">mplayer dvd://<em class="replaceable"><code>&lt;ролик&gt;</code></em> [-dvd-device <em class="replaceable"><code>устройство</code></em>]</pre><p>
</p><p>
Пример:
</p><pre class="screen">mplayer dvd://1 -dvd-device /dev/hdc</pre><p>
</p><p>
Если вы собрали <span class="application">MPlayer</span> с поддержкой dvdnav, синтаксис тот же,
просто укажите dvdnav:// вместо dvd://.
</p><p>
Устройство DVD по умолчанию — это <tt class="filename">/dev/dvd</tt>. Если Ваши
настройки отличаются, создайте символическую ссылку или укажите правильное
устройство в командной строке, используя опцию <tt class="option">-dvd-device</tt>.
</p><p>
<span class="application">MPlayer</span> использует библиотеки <code class="systemitem">libdvdread
</code> и <code class="systemitem">libdvdcss</code> для воспроизведения и расшифровки DVD.
Эти две библиотеки содержатся в дереве исходного кода
<span class="application">MPlayer</span>'а, так что отдельно устанавливать их не нужно.
Вы также можете использовать уже установленные в системе версии библиотек, но это
<span class="bold"><strong>не рекомендуется</strong></span>, так как может приводить к
ошибкам, несовместимости и потере скорости.
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
В случае проблем с декодированием DVD, попробуйте отключить supermount или
другие подобные удобства. Некоторые RPC-2 устройства могут требовать
уcтановку кода региона.
</p></div><p title="Расшифровка DVD"><b>Расшифровка DVD. </b>
Расшифровка DVD осуществляется библиотекой <code class="systemitem">libdvdcss</code>.
Метод может быть указан переменной окружения <code class="envar">DVDCSS_METHOD</code>,
подробную информацию смотрите на странице руководства man.
</p><div class="sect2" title="4.2.1. Региональный код"><div class="titlepage"><div><div><h3 class="title"><a name="region_code"></a>4.2.1. Региональный код</h3></div></div></div><p>
Современные DVD приводы имеют дурацкое ограничение, называемое
<a class="ulink" href="http://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%B4_%D0%B7%D0%BE%D0%BD%D1%8B_DVD" target="_top">региональным кодом</a>.
Это — способ заставить DVD приводы воспроизводить DVD диски, созданные для одного из
шести различных регионов, на которые разделен мир.
Как может группа людей сесть за стол, придумать подобное и
при этом ожидать, что мир 21-го века поклонится их воле — это
за пределами человеческого понимания.
</p><p>
Приводы, реализующие региональную защиту исключительно при помощи
программного обеспечения, известны как RPC-1 приводы, реализующие ее
аппаратно — RPC-2. RPC-2 приводы позволяют пять раз изменить код региона,
после чего он фиксируется навсегда. В Linux Вы можете воспользоваться
утилитой <a class="ulink" href="http://linvdr.org/projects/regionset/" target="_top">regionset</a>
для установки регионального кода Вашего DVD привода.
</p><p>
К счастью, возможна переделка RPC-2 приводов в RPC-1, через
обновление прошивки. Укажите модель Вашего DVD привода в Вашем любимом
поисковике или посмотрите на форуме и разделах загрузок на
<a class="ulink" href="http://www.rpc1.org/" target="_top">"Странице прошивок"</a>.
Хотя обычные предостережения, касающиеся обновления прошивки, остаются в силе,
опыт избавления от региональной защиты в основном положителен.
</p></div></div><div class="sect1" title="4.3. Воспроизведение VCD"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="vcd"></a>4.3. Воспроизведение VCD</h2></div></div></div><p>
Полный список возможных опций можно прочитать в man. Синтаксис для обычного
Видео-CD (VCD):
</p><pre class="screen">mplayer vcd://<em class="replaceable"><code>&lt;дорожка&gt;</code></em> [-cdrom-device <em class="replaceable"><code>&lt;устройство&gt;</code></em>]</pre><p>
Пример:
</p><pre class="screen">mplayer vcd://2 -cdrom-device /dev/hdc</pre><p>
Устройство VCD по умолчанию — <tt class="filename">/dev/cdrom</tt>. Если Ваши
настройки отличаются, создайте символическую ссылку добавьте правильное название
в командной строке после опции <tt class="option">-cdrom-device</tt>.
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
По крайней мере Plextor'ы и некоторые Toshiba SCSI CD-ROM приводы показывают
ужасную производительность при чтении VCD'ов. Это объясняется тем, что
CDROMREADRAW <code class="systemitem">ioctl</code> на этих приводах реализован не полностью.
Если Вы имеете некоторые познания в сфере программирования SCSI, пожалуйста
<a class="ulink" href="../../tech/patches.txt" target="_top">помогите нам</a> в написании поддержки
SCSI generic для VCD.
</p></div><p>
В настоящий момент Вы можете извлечь данные с VCD, используя
<a class="ulink" href="http://ftp.ntut.edu.tw/ftp/OS/Linux/packages/X/viewers/readvcd/" target="_top">
readvcd</a>, и воспроизвести получившийся файл <span class="application">MPlayer
</span>'ом.
</p><p title="Структура VCD"><b>Структура VCD. </b>
VCD составлен из секторов CD-ROM XA, т.е. дорожек CD-ROM mode 2 form 1 и form 2:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Первая дорожка записана в mode 2 form 2 формате, что, в частности, означает
  использование коррекции ошибок L2. Дорожка содержит файловую систему ISO-9660 с
  секторами по 2048 байт. Там содержатся метаданные VCD,
  и картинки, часто использующиеся в меню. Здесь также могут храниться
  фрагменты MPEG для меню, но каждый из них должен быть разбит на кусочки по
  150 секторов. Еще файловая система может хранить файлы или программы,
  не имеющие отношения к работе с VCD.
</p></li><li class="listitem"><p>
  Вторая и остальные дорожки содержат MPEG-поток секторами по 2324 байта, по
  одному пакету MPEG PS на сектор вместо файловой системы. Это дорожки в формате
  mode 2 form 1 и хранят больше информации на один сектор за счет потери возможности
  некоторой коррекции ошибок. После первой дорожки также допустимо присутствие
  дорожки CD-DA. В некоторых ОС используются различные трюки, чтобы сделать  эти
  не-ISO-9660 дорожки видимыми  в файловой системе. Но Linux
  — это не тот случай (пока).
  Здесь MPEG данные <span class="bold"><strong>не могут быть смонтированы</strong></span>.
  (Вы когда-нибудь монтировали аудио диск
  для того, чтобы его воспроизвести?) Так как большинство фильмов находится именно на
  таких дорожках, попробуйте сначала <tt class="option">vcd://2</tt>.
</p></li><li class="listitem"><p>
  Существуют VCD диски без первой дорожки (единственная дорожка без файловой
  системы). Они проигрываются, но не монтируются.
</p></li><li class="listitem"><p>
  Описание стандарта Video CD называется
  Philips "White Book" и, как правило, недоступна в онлайн, т.к. должна приобретаться
  у Philips. Более подробная информация о Video CD может быть найдена в
  <a class="ulink" href="http://www.vcdimager.org/pub/vcdimager/manuals/0.7/vcdimager.html#SEC4" target="_top">документации vcdimager</a>.
</p></li></ul></div><p title="Структура VCD">
</p><p title="Про файлы .DAT"><b>Про файлы .DAT. </b>
Файл примерно в 600 мегабайт на первой дорожке не настоящий! Это так
называемый ISO-переход, созданный, чтобы позволить Windows обрабатывать эти
дорожки (Windows вообще запрещает приложениям использовать прямой доступ
к устройствам). Под Linux Вы не можете копировать эти файлы (они выглядят, как
мусор). Под Windows это возможно, поскольку там iso9660 эмулирует прямой доступ
к дорожкам через этот файл. Чтобы проигрывать .DAT файл Вам нужен драйвер,
из Linux версии PowerDVD. Это модифицированный драйвер
iso9660 файловой системы (<tt class="filename">vcdfs/isofs-2.4.X.o</tt>), который
способен эмулировать прямой доступ к дорожкам через этот файл. Если Вы
замонтируете диск, используя их драйвер, Вы можете копировать и даже проигрывать
.DAT файлы <span class="application">MPlayer</span>'ом. Но это не будет работать со
стандартным драйвером iso9660 из ядра Linux! Используйте вместо этого
<tt class="option">vcd://</tt>. Альтернативами для копирования VCD может послужить новый
драйвер <a class="ulink" href="http://www.elis.rug.ac.be/~ronsse/cdfs/" target="_top">cdfs</a> (не
входит в официальное ядро) который показывает дорожки[сессии] на диске как файлы
образов и <a class="ulink" href="http://cdrdao.sf.net/" target="_top">cdrdao</a>, приложение для
побитового чтения/копирования CD.
</p></div></div><div class="chapter" title="Глава 5. TV"><div class="titlepage"><div><div><h2 class="title"><a name="tv"></a>Глава 5. TV</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#tv-input">5.1. TV вход</a></span></dt><dd><dl><dt><span class="sect2"><a href="#tv-compilation">5.1.1. Компиляция</a></span></dt><dt><span class="sect2"><a href="#tv-tips">5.1.2. Советы по использованию</a></span></dt><dt><span class="sect2"><a href="#tv-examples">5.1.3. Примеры</a></span></dt></dl></dd><dt><span class="sect1"><a href="#tv-teletext">5.2. Телетекст</a></span></dt><dd><dl><dt><span class="sect2"><a href="#tv-teletext-implementation-notes">5.2.1. Замечания реализации</a></span></dt><dt><span class="sect2"><a href="#tv-teletext-usage">5.2.2. Использование телетекста</a></span></dt><dt><span class="sect2"><a href="#tv-teletext-hotkeys">5.2.3. Горячие клавиши телетекста</a></span></dt></dl></dd></dl></div><div class="sect1" title="5.1. TV вход"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tv-input"></a>5.1. TV вход</h2></div></div></div><p>
В этой секции описывается, как включить <span class="bold"><strong>просмотр/захват
с V4L-совместимого TV тюнера</strong></span>. См. man страницу, для описания TV опций
и кнопок управления.
</p><div class="sect2" title="5.1.1. Компиляция"><div class="titlepage"><div><div><h3 class="title"><a name="tv-compilation"></a>5.1.1. Компиляция</h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Шаг 1"><p>
  Во-первых, Вам нужно перекомпилировать <span class="application">MPlayer</span>,
  <tt class="filename">./configure</tt> автоматически обнаружит заголовки ядра,
  относящиеся к v4l, и наличие <tt class="filename">/dev/video*</tt> устройств.
  Если они существуют, будет собрана поддержка TV (см. вывод
  <tt class="filename">./configure</tt>).
</p></li><li class="step" title="Шаг 2"><p>
  Убедитесь, что Ваш тюнер работает с другими TV приложениями под Linux,
  например <span class="application">XawTV</span>.
</p></li></ol></div></div><div class="sect2" title="5.1.2. Советы по использованию"><div class="titlepage"><div><div><h3 class="title"><a name="tv-tips"></a>5.1.2. Советы по использованию</h3></div></div></div><p>
Полный список опций доступен на страницах руководства (man).
Вот всего несколько советов:

</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Используйте опцию <tt class="option">channels</tt>. Пример:
  </p><pre class="screen">-tv channels=26-MTV1,23-TV2</pre><p>
  Объяснение: При использовании такой опции, будут использоваться только каналы 26
  и 23, и, кроме того, будет приятный OSD текст при переключении между каналами,
  отображающий название канала. Пробелы в названиях каналов должны быть заменены
  символом "_".
</p></li><li class="listitem"><p>
  Выберите разумные размеры изображения. Размеры полученного
  изображения должны делиться на 16.
</p></li><li class="listitem"><p>
  Если Вы захватываете видео с вертикальным разрешением выше половины полного
  разрешения (т.е. 288 для PAL или 240 для NTSC), то получаемые вами 'кадры'
  на самом деле будут чередующимися[interleaved] парами полей. В зависимости от того,
  что вы собираетесь делать с видео, можно оставить их в таком виде,
  произвести разрушающую (с возможной потерей качества) построчную развёртку,
  либо разделить пары обратно в отдельные поля.
  </p><p>
  Иначе Вы получите фильм с сильными искажениями в
  сценах с быстрыми движениями, и управление битпотоком, скорее всего, будет даже не
  в состоянии поддерживать необходимый уровень битпотока, поскольку артефакты
  чересстрочной развёртки создают огромное количество мелких деталей и поэтому
  отнимают большую часть полосы пропускания. Вы можете включить преобразование в
  построчную развёртку,
  используя <tt class="option">-vf pp=DEINT_TYPE</tt>. Обычно <tt class="option">pp=lb</tt>
  работает хорошо, но это уже субъективное мнение. Другие алгоритмы
  преобразования в построчную развёртку см. на man-странице и попробуйте их.
  </p></li><li class="listitem"><p>
  Обрежьте пустое пространство. Когда вы захватываете видео, зоны по краям, как правило,
  черны или содержат просто шум. Это опять съедает часть битпотока.
  Точнее, это не сами чёрные зоны, а контрастный переход от чёрного к более
  светлому видео, но это сейчас не важно. Прежде чем Вы начнёте захватывать,
  подстройте аргументы опции <tt class="option">crop</tt>, чтобы обрезать весь мусор по
  краям. Ещё раз, не забудьте сохранить получившиеся размеры изображения
  разумными.
</p></li><li class="listitem"><p>
  Отслеживайте загрузку CPU. Она не должна пересекать 90% границу большую часть
  времени. Если у Вас большой размер буфера захвата,
  <span class="application">MEncoder</span> переживёт
  перегрузку в течение нескольких секунд, но не более того. Лучше отключить 3D
  OpenGL, хранители экрана и другую подобную гадость.
</p></li><li class="listitem"><p>
  Не меняйте системные часы. <span class="application">MEncoder</span> использует
  системные часы для A/V синхронизации. Если Вы переведёте системные часы
  (особенно назад), <span class="application">MEncoder</span> запутается,
  и Вы начнёте терять кадры. Это особенно
  важный вопрос, если Вы подключены к сети и используете какие-нибудь программы
  синхронизации времени, в духе NTP. Вы должны отключить NTP во время захвата,
  если Вы действительно хотите сделать хорошую запись.
</p></li><li class="listitem"><p>
  Изменяйте значение <tt class="option">outfmt</tt> только если Вы знаете, что Вы
  делаете, или Ваши карта/драйвер не поддерживают значение по умолчанию
  (пространство цветов YV12). В старых версиях <span class="application">MPlayer</span>/
  <span class="application">MEncoder</span> было необходимо выставлять нужное значение
  формата вывода.
  Эта проблема должна быть решена в текущих версиях и опция <tt class="option">outfmt</tt>
  больше не требуется, поскольку значение по умолчанию подходит в
  большинстве случаев. Например если Вы будете захватывать в DivX, используя
  <code class="systemitem">libavcodec</code> и укажете
  <tt class="option">outfmt=RGB24</tt> для улучшения качества
  полученного изображения, то Вы увидите, что в действительности, изображение все
  равно будет перекодировано в YV12, поэтому все что Вы получите, это огромная
  загрузка CPU.
</p></li><li class="listitem"><p>
  Чтобы использовать пространство цветов I420 (<tt class="option">outfmt=i420</tt>), Вы
  должны указать опцию <tt class="option">-vc rawi420</tt> в связи с конфликтом fourcc с
  видео кодеком Intel Indeo.
</p></li><li class="listitem"><p>
  Есть несколько путей захвата аудио. Вы можете получить звук, либо используя Вашу
  звуковую карту и внешний кабель, соединяющий видео карту и линейный вход[line-in],
  либо используя встроенный АЦП на чипе bt878. В этом случае, Вы должны
  загрузить драйвер <span class="bold"><strong>btaudio</strong></span>. Читайте файл
  <tt class="filename">linux/Documentation/sound/btaudio</tt> (в дереве ядра, не
  <span class="application">MPlayer</span>'а) с некоторыми инструкциями по
  использованию этого драйвера.
</p></li><li class="listitem"><p>
  Если <span class="application">MEncoder</span> не может открыть аудио устройство,
  убедитесь, что оно действительно доступно. Возможны некоторые трудности со
  звуковыми серверами, например arts (KDE) и esd (GNOME). Если у Вас
  полнодуплексная звуковая карта (почти все современные карты это поддерживают),
  и Вы используете KDE, попробуйте отметить галочку "full duplex" в меню настроек
  звукового сервера.
</p></li></ul></div><p>
</p></div><div class="sect2" title="5.1.3. Примеры"><div class="titlepage"><div><div><h3 class="title"><a name="tv-examples"></a>5.1.3. Примеры</h3></div></div></div><div class="informalexample"><p>
Фиктивный вывод, AAlib :)
</p><pre class="screen">mplayer -tv driver=dummy:width=640:height=480 -vo aatv://</pre><p>
</p></div><div class="informalexample"><p>
Ввод со стандартного V4L:
</p><pre class="screen">
mplayer -tv driver=v4l:width=640:height=480:outfmt=i420 -vc rawi420 -vo xv tv://
</pre><p>
</p></div><div class="informalexample"><p>
Более изощрённый пример. Это заставляет <span class="application">MEncoder</span> захватывать
полное PAL изображение, обрезать края и изменить развёртку картинки на построчную,
используя алгоритм линейного смешивания. Аудио сжимается до постоянного
битпотока 64 кБ/с, используя LAME кодек. Эти установки подходят для захвата фильмов.
</p><pre class="screen">
mencoder -tv driver=v4l:width=768:height=576 -oac mp3lame -lameopts cbr:br=64\
     -ovc lavc -lavcopts vcodec=mpeg4:vbitrate=900 \
     -vf crop=720:544:24:16,pp=lb -o <em class="replaceable"><code>output.avi</code></em> tv://
</pre><p>
</p></div><div class="informalexample"><p>
Здесь, изображение будет дополнительно масштабировано до 384x288 и сжато с
битпотоком 350 кБ/с в режиме высокого качества. Опция vqmax даёт волю
квантайзеру и позволяет компрессору видео действительно достичь столь
низкого битпотока, правда ценой качества. Это может быть полезно для захвата
длинных TV серий, где качество не особенно важно.
</p><pre class="screen">
mencoder -tv driver=v4l:width=768:height=576 \
    -ovc lavc -lavcopts vcodec=mpeg4:vbitrate=350:vhq:vqmax=31:keyint=300 \
    -oac mp3lame -lameopts cbr:br=48 -sws 1 -o <em class="replaceable"><code>output.avi</code></em> \
    -vf crop=720:540:24:18,pp=lb,scale=384:288 tv://
</pre><p>
Также возможно указать меньшие размеры изображения в опции <tt class="option">-tv</tt>
и пропустить программное масштабирование, но приведённый подход использует
максимальное доступное количество информации и чуть более устойчив к шуму.
Чипы bt8x8 из-за аппаратных ограничений могут усреднять пиксели только по
горизонтали.
</p></div></div></div><div class="sect1" title="5.2. Телетекст"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tv-teletext"></a>5.2. Телетекст</h2></div></div></div><p>
На данный момент телетекст доступен только в MPlayer для v4l и v4l2 драйверов.
</p><div class="sect2" title="5.2.1. Замечания реализации"><div class="titlepage"><div><div><h3 class="title"><a name="tv-teletext-implementation-notes"></a>5.2.1. Замечания реализации</h3></div></div></div><p>
<span class="application">MPlayer</span> поддерживает обычный текст, псевдографику и
навигационные ссылки.
К сожалению, цветные страницы поддерживаются пока не полностью - все страницы
отображаются оттенками серого.
Страницы с субтитрами (еще известные как Closed Captions) тоже поддерживаются.
</p><p>
<span class="application">MPlayer</span> начинает кешировать все страницы телетекста
с момента начала просмотра TV, так что вам не потребуется ожидать загрузки
интересующий страницы.
</p><p>
Замечание: Использование телетекста с <tt class="option">-vo xv</tt> приводит к появлению странных цветов.
</p></div><div class="sect2" title="5.2.2. Использование телетекста"><div class="titlepage"><div><div><h3 class="title"><a name="tv-teletext-usage"></a>5.2.2. Использование телетекста</h3></div></div></div><p>
Чтобы включить декодирование телетекста, вы должны указать VBI устройство, из которого
следует читать данные (обычно <tt class="filename">/dev/vbi0</tt> в Linux).
Это можно сделать, указав <tt class="option">tdevice</tt> в вашем файле конфигурации:
</p><pre class="screen">tv=tdevice=/dev/vbi0</pre><p>
</p><p>
Вам может потребоваться указать код языка телетекста для вашей страны.
Чтобы получить список всех доступных языковых кодов, используйте
</p><pre class="screen">tv=tdevice=/dev/vbi0:tlang=<em class="replaceable"><code>-1</code></em></pre><p>
Вот пример для Русского:
</p><pre class="screen">tv=tdevice=/dev/vbi0:tlang=<em class="replaceable"><code>33</code></em></pre><p>
</p><p>
</p></div><div class="sect2" title="5.2.3. Горячие клавиши телетекста"><div class="titlepage"><div><div><h3 class="title"><a name="tv-teletext-hotkeys"></a>5.2.3. Горячие клавиши телетекста</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Клавиша</th><th>Описание</th></tr></thead><tbody><tr><td>X</td><td>Включает/выключает отображение телетекста</td></tr><tr><td>C</td><td>Циклически переключает режими отрисовки (непрозрачный, прозрачный, инфертированный непрозрачный,
  инвертированный прозрачный</td></tr><tr><td>Left/Right</td><td>Переходит к предыдущей/следующей странице телетекста</td></tr><tr><td>PageUp/PageDown</td><td>Перходит к следующей/предыдущей дополнительной странице телетекста</td></tr><tr><td>Цифры</td><td>Вводят номер страницы для перехода к ней</td></tr></tbody></table></div></div></div></div><div class="chapter" title="Глава 6. Радио"><div class="titlepage"><div><div><h2 class="title"><a name="radio"></a>Глава 6. Радио</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#radio-input">6.1. Радио вход</a></span></dt><dd><dl><dt><span class="sect2"><a href="#radio-compilation">6.1.1. Компиляция</a></span></dt><dt><span class="sect2"><a href="#radio-tips">6.1.2. Советы по использованию</a></span></dt><dt><span class="sect2"><a href="#radio-examples">6.1.3. Примеры</a></span></dt></dl></dd></dl></div><div class="sect1" title="6.1. Радио вход"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="radio-input"></a>6.1. Радио вход</h2></div></div></div><p>
В этой секции описывается как включить прослушивание
радио при помощи V4L совместимого Радио тюнера. Смотрите man страницу для
описания  опций и кнопок управления.
</p><div class="sect2" title="6.1.1. Компиляция"><div class="titlepage"><div><div><h3 class="title"><a name="radio-compilation"></a>6.1.1. Компиляция</h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Шаг 1"><p>
  Во-первых, вам необходимо перекомпилировать <span class="application">MPlayer</span>
  при помощи <tt class="filename">./configure</tt> с указанием опций
  <tt class="option">--enable-radio</tt> и (если хотите включить поддержку записи)
  <tt class="option">--enable-radio-capture</tt>.
</p></li><li class="step" title="Шаг 2"><p>
  Убедитесь, что ваш тюнер работает с другими приложениями в Linux, например
  <span class="application">XawTV</span>.
</p></li></ol></div></div><div class="sect2" title="6.1.2. Советы по использованию"><div class="titlepage"><div><div><h3 class="title"><a name="radio-tips"></a>6.1.2. Советы по использованию</h3></div></div></div><p>
Полный список опций доступен на страницах руководства (man).
Вот всего несколько советов:

</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Использование <tt class="option">channels</tt> опции. Пример:
  </p><pre class="screen">-radio channels=104.4-Sibir,103.9-Maximum</pre><p>
  Объяснение: при указании этой опции, будут доступны только радиостанции
  104.4 и 103.9. Кроме того, будет приятный OSD текст при переключении между каналами,
  отображающий название канала. Пробелы в названиях каналов должны быть заменены
  символом "_"
</p></li><li class="listitem"><p>
  Есть несколько путей захвата аудио. Вы можете получить звук, либо используя Вашу
  звуковую карту и внешний кабель, соединяющий видео карту и линейный вход[line-in],
  либо используя встроенный ADC на в чипе saa7134. В этом случае, Вы должны
  загрузить драйвер <code class="systemitem">saa7134-alsa</code> или
  <code class="systemitem">saa7134-oss</code>.
</p></li><li class="listitem"><p>
  <span class="application">MEncoder</span> не может быть использован для захвата звука,
  поскольку он требует обязательного наличия видео-потока.Таким образом, вы можете
  производит захват либо используя программу <span class="application">arecord</span>
  из проекта ALSA, либо используя
  <tt class="option">-ao pcm:file=file.wav</tt>. Во втором случае вы не будете слышать ничего во
  время захвата (за исключение случая, когда вы используете line-in кабель, и слушаете
  звук непосредственно с линейного входа).
</p></li></ul></div><p>
</p></div><div class="sect2" title="6.1.3. Примеры"><div class="titlepage"><div><div><h3 class="title"><a name="radio-examples"></a>6.1.3. Примеры</h3></div></div></div><div class="informalexample"><p>
Вход со стандартного V4L (используя line-in кабель, запись отключена.):
</p><pre class="screen">mplayer radio://104.4</pre><p>
</p></div><div class="informalexample"><p>
Вход со стандартного V4L (используя line-in кабель, запись отключена. Используется интерфейс
V4Lv1):
</p><pre class="screen">mplayer -radio driver=v4l radio://104.4</pre><p>
</p></div><div class="informalexample"><p>
прослушивание второй радиостанции из списка:
</p><pre class="screen">mplayer -radio channels=104.4=Sibir,103.9=Maximm  radio://2</pre><p>
</p></div><div class="informalexample"><p>
Получение звука через шину pci с внутреннего ADC радио тюнера. В этом примере
тюнер используется как вторая звуковая карта (ALSA устройство hw:1,0).
Для карт, основанных на saa7134, либо
<code class="systemitem">saa7134-alsa</code>, либо <code class="systemitem">saa7134-oss</code>
модуль должен быть загружен.
</p><pre class="screen">
mplayer -rawaudio rate=32000 radio://2/capture \
    -radio adevice=hw=1.0:arate=32000:channels=104.4=Sibir,103.9=Maximm
</pre><p>
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
При использовании имен устройств ALSA, двоеточия необходимо заменить на
равенства, запятые - на точки.
</p></div><p>
</p></div></div></div></div><div class="chapter" title="Глава 7. Устройства вывода видео"><div class="titlepage"><div><div><h2 class="title"><a name="video"></a>Глава 7. Устройства вывода видео</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#mtrr">7.1. Настройка MTRR</a></span></dt><dt><span class="sect1"><a href="#xv">7.2. Xv</a></span></dt><dd><dl><dt><span class="sect2"><a href="#tdfx">7.2.1. 3dfx карты</a></span></dt><dt><span class="sect2"><a href="#s3">7.2.2. S3 карты</a></span></dt><dt><span class="sect2"><a href="#nvidia">7.2.3. nVidia карты</a></span></dt><dt><span class="sect2"><a href="#ati">7.2.4. ATI карты</a></span></dt><dt><span class="sect2"><a href="#neomagic">7.2.5. NeoMagic карты</a></span></dt><dt><span class="sect2"><a href="#trident">7.2.6. Trident карты</a></span></dt><dt><span class="sect2"><a href="#kyro">7.2.7. Kyro/PowerVR карты</a></span></dt><dt><span class="sect2"><a href="#intel">7.2.8. Карты Intel</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dga">7.3. DGA</a></span></dt><dt><span class="sect1"><a href="#sdl">7.4. SDL</a></span></dt><dt><span class="sect1"><a href="#svgalib">7.5. SVGAlib</a></span></dt><dt><span class="sect1"><a href="#fbdev">7.6. Вывод во фреймбуфер (FBdev)</a></span></dt><dt><span class="sect1"><a href="#mga_vid">7.7. Matrox фреймбуфер (mga_vid)</a></span></dt><dt><span class="sect1"><a href="#tdfxfb">7.8. Поддержка 3Dfx YUV</a></span></dt><dt><span class="sect1"><a href="#tdfx_vid">7.9. tdfx_vid</a></span></dt><dt><span class="sect1"><a href="#opengl">7.10. OpenGL вывод</a></span></dt><dt><span class="sect1"><a href="#aalib">7.11. AAlib - отображение в текстовом режиме</a></span></dt><dt><span class="sect1"><a href="#caca">7.12. 
<code class="systemitem">libcaca</code> - Цветная ASCII Art библиотека
</a></span></dt><dt><span class="sect1"><a href="#vesa">7.13. VESA - вывод в VESA BIOS</a></span></dt><dt><span class="sect1"><a href="#x11">7.14. X11</a></span></dt><dt><span class="sect1"><a href="#vidix">7.15. VIDIX</a></span></dt><dd><dl><dt><span class="sect2"><a href="#vidix-ati">7.15.1. ATI карты</a></span></dt><dt><span class="sect2"><a href="#vidix-mga">7.15.2. Matrox карты</a></span></dt><dt><span class="sect2"><a href="#vidix-trident">7.15.3. Trident карты</a></span></dt><dt><span class="sect2"><a href="#vidix-3dlabs">7.15.4. 3DLabs карты</a></span></dt><dt><span class="sect2"><a href="#vidix-nvidia">7.15.5. nVidia карты</a></span></dt><dt><span class="sect2"><a href="#vidix-sis">7.15.6. SiS карты</a></span></dt></dl></dd><dt><span class="sect1"><a href="#directfb">7.16. DirectFB</a></span></dt><dt><span class="sect1"><a href="#dfbmga">7.17. DirectFB/Matrox (dfbmga)</a></span></dt><dt><span class="sect1"><a href="#mpeg_decoders">7.18. MPEG декодеры</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dvb">7.18.1. DVB ввод и вывод</a></span></dt><dt><span class="sect2"><a href="#dxr2">7.18.2. DXR2</a></span></dt><dt><span class="sect2"><a href="#dxr3">7.18.3. DXR3/Hollywood+</a></span></dt></dl></dd><dt><span class="sect1"><a href="#other">7.19. Другое оборудование вывода видео</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zr">7.19.1. Zr</a></span></dt><dt><span class="sect2"><a href="#blinkenlights">7.19.2. Blinkenlights[Мерцающие огни?]</a></span></dt></dl></dd><dt><span class="sect1"><a href="#tvout">7.20. Поддержка TV-выхода</a></span></dt><dd><dl><dt><span class="sect2"><a href="#tvout-mga-g400">7.20.1. Matrox G400 карты</a></span></dt><dt><span class="sect2"><a href="#tv-out_matrox_g450">7.20.2. Matrox G450/G550 карты</a></span></dt><dt><span class="sect2"><a href="#tvout-ati">7.20.3. ATI карты</a></span></dt><dt><span class="sect2"><a href="#tvout-nvidia">7.20.4. nVidia</a></span></dt><dt><span class="sect2"><a href="#tvout-neomagic">7.20.5. NeoMagic</a></span></dt></dl></dd></dl></div><div class="sect1" title="7.1. Настройка MTRR"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mtrr"></a>7.1. Настройка MTRR</h2></div></div></div><p>
ОЧЕНЬ важно проверить, правильно ли установлены MTRR регистры,
поскольку они могут дать большой прирост производительности.
</p><p>
Выполните <span class="command"><strong>cat /proc/mtrr</strong></span>:
</p><pre class="screen">
<code class="prompt">--($:~)--</code> cat /proc/mtrr
reg00: base=0xe4000000 (3648MB), size=  16MB: write-combining, count=9
reg01: base=0xd8000000 (3456MB), size= 128MB: write-combining, count=1</pre><p>
</p><p>
Здесь все верно, показана моя Matrox G400 с 16Мб памяти. Я выполнил это из-под
XFree 4.x.x, который автоматически устанавливает регистры MTRR.
</p><p>
Если ничего не сработало, вам придется сделать это вручную. Во-первых,
вы должны определить базовый  адрес. Существует три способа выяснить его:

</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  из сообщений запуска X11, например:
  </p><pre class="screen">
(--) SVGA: PCI: Matrox MGA G400 AGP rev 4, Memory @ 0xd8000000, 0xd4000000
(--) SVGA: Linear framebuffer at 0xD8000000</pre><p>
</p></li><li class="listitem"><p>
  из <tt class="filename">/proc/pci</tt> (используйте команду <span class="command"><strong>lspci -v</strong></span>):
  </p><pre class="screen">
01:00.0 VGA compatible controller: Matrox Graphics, Inc.: Unknown device 0525
Memory at d8000000 (32-bit, prefetchable)</pre><p>
</p></li><li class="listitem"><p>
  из сообщений драйвера ядра mga_vid (используйте <span class="command"><strong>dmesg</strong></span>):
  </p><pre class="screen">mga_mem_base = d8000000</pre><p>
</p></li></ol></div><p>
</p><p>
Теперь давайте найдем объем памяти. Это очень просто, просто преобразуйте
размер видео памяти в шестнадцатеричный формат, или используйте таблицу:
</p><div class="informaltable"><table border="0"><colgroup><col><col></colgroup><tbody><tr><td>1 MB</td><td>0x100000</td></tr><tr><td>2 MB</td><td>0x200000</td></tr><tr><td>4 MB</td><td>0x400000</td></tr><tr><td>8 MB</td><td>0x800000</td></tr><tr><td>16 MB</td><td>0x1000000</td></tr><tr><td>32 MB</td><td>0x2000000</td></tr></tbody></table></div><p>
</p><p>
Вы знаете базовый адрес и размер памяти, так давайте настроим регистры MTRR!
Например, для вышеуказанной карты Matrox (<code class="literal">base=0xd8000000</code>)
с 32Мб памяти (<code class="literal">size=0x2000000</code>) просто выполните:
</p><pre class="screen">
echo "base=0xd8000000 size=0x2000000 type=write-combining" &gt; /proc/mtrr
</pre><p>
</p><p>
Не все CPU имеют MTRR. Например, старый K6-2 (около  266MHz,
степпинг 0) не имеет MTRR, но у степпинга 12 они уже есть
(запустите <span class="command"><strong>cat /proc/cpuinfo</strong></span> чтобы это проверить).
</p></div><div class="sect1" title="7.2. Xv"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xv"></a>7.2. Xv</h2></div></div></div><p>
Под XFree86 4.0.2 или новее, вы можете использовать функции работы с YUV[YUV routines]
вашей видеокарты, используя расширение XVideo, то, которое используется при указании опциии
<tt class="option">-vo xv</tt>.

К тому же этот драйвер поддерживает управление
яркостью/контрастностью/цветностью/и т.д. (кроме случая использования старого ,медленного
DivX кодека DirectShow, который везде это поддерживает), смотрите страницу man.

</p><p>
Чтобы  заставить его работать, убедитесь, что выполняется следующее:

</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Требуется использовать XFree86 4.0.2 или новее (предыдущие версии не меют XVideo)
</p></li><li class="listitem"><p>
  Ваша карта действительно поддерживает аппаратное ускорение (современные - да)
</p></li><li class="listitem"><p>
  X загружают расширение XVideo, это похоже на:
  </p><pre class="programlisting">(II) Loading extension XVideo</pre><p>
  в <tt class="filename">/var/log/XFree86.0.log</tt>
  </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
   Это всего лишь загружается расширение XVideo. При нормальной установке оно грузится
   всегда, это не означает, что загружена <span class="bold"><strong>аппаратная</strong></span>
   поддержка XVideo.
  </p></div><p>
</p></li><li class="listitem"><p>
  Ваша карта имеет поддержку Xv для Linux. Чтобы это проверить, запустите
  <span class="command"><strong>xvinfo</strong></span>, являющуюся частью дистрибутива XFree86. Она должна
  выдать на экран длинный текст, похожий на этот:
  </p><pre class="screen">
X-Video Extension version 2.2
screen #0
  Adaptor #0: "Savage Streams Engine"
    number of ports: 1
    port base: 43
    operations supported: PutImage
    supported visuals:
      depth 16, visualID 0x22
      depth 16, visualID 0x23
    number of attributes: 5
(...)
    Number of image formats: 7
      id: 0x32595559 (YUY2)
        guid: 59555932-0000-0010-8000-00aa00389b71
        bits per pixel: 16
        number of planes: 1
        type: YUV (packed)
      id: 0x32315659 (YV12)
        guid: 59563132-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        type: YUV (planar)
(...и т.д....)</pre><p>
  Карта должна поддерживать YUY2 пакованные и YUV12 планарные[planar] форматы
  пикселов, чтобы быть полезной в <span class="application">MPlayer</span>.
</p></li><li class="listitem"><p>
  И, наконец, проверьте, что <span class="application">MPlayer</span> собран с
  поддержкой 'xv'. Выполните <span class="command"><strong>mplayer -vo help | grep xv </strong></span>.
  Если поддержка 'xv' включена, то увидите похожую строку:
  </p><pre class="screen">  xv      X11/Xv</pre><p>
</p></li></ol></div><p>
</p><div class="sect2" title="7.2.1. 3dfx карты"><div class="titlepage"><div><div><h3 class="title"><a name="tdfx"></a>7.2.1. 3dfx карты</h3></div></div></div><p>
Хорошо известно, что старые 3dfx драйвера имеют проблемы с ускорением XVideo, они не
поддерживают ни YUY2 ни YV12, ни т.п. Проверьте, что у вас XFree86 версии
4.2.0 или новее, он может работать с YV12 и YUY2, в то время как предыдущие версии,
включая 4.1.0, <span class="bold"><strong>с YV12 приводят к краху</strong></span>.

Если вы столкнулись со странными эффектами при использовании <tt class="option">-vo xv</tt>,
попробуйте SDL (он тоже имеет поддержку XVideo), и посмотрите поможет ли это. Обратитесь к
разделу <a class="link" href="#sdl" title="7.4. SDL">SDL</a> за подробностями.
</p><p>
<span class="bold"><strong>ИЛИ</strong></span>, попробуйте НОВЫЙ
<tt class="option">-vo tdfxfb</tt> драйвер! Смотрите раздел <a class="link" href="#tdfxfb" title="7.8. Поддержка 3Dfx YUV">tdfxfb</a>.
</p></div><div class="sect2" title="7.2.2. S3 карты"><div class="titlepage"><div><div><h3 class="title"><a name="s3"></a>7.2.2. S3 карты</h3></div></div></div><p>
S3 Savage3D, должны прекрасно работать, но для Savage4 используйте XFree86 версии 4.0.3 или
выше (в случае проблем с изображением попробуйте 16bpp). По поводу S3 Virge:
она поддерживает xv, но карта сама по себе слишком медленная, так что лучше будет ее
продать.
</p><p>
Существует родной драйвер фреймбуфера для карт S3 Virge, аналогичный
tdfxfb. Настройте ваш фреймбуфер (например, укажите ядру
"<tt class="option">vga=792 video=vesa:mtrr</tt>") и воспользуйтесь
<tt class="option">-vo s3fb</tt> (<tt class="option">-vf yuy2</tt> и <tt class="option">-dr</tt>
тоже помогут).
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
Пока не ясно в каких моделях Savage отсутствует поддержка YV12, и преобразование
осуществляется драйвером (медленно). Если вы грешите на свою карту, возьмите
свежий драйвер иди вежливо спросите в списке рассылки MPlayer-users
о драйвере с поддержкой MMX/3DNow!.
</p></div></div><div class="sect2" title="7.2.3. nVidia карты"><div class="titlepage"><div><div><h3 class="title"><a name="nvidia"></a>7.2.3. nVidia карты</h3></div></div></div><p>
nVidia под Linux - не всегда хороший выбор ... Открытые драйвера XFree86
поддерживают большинство этих карт, но в некоторых случаях придется
использовать закрытый бинарный драйвер от nVidia, доступный на
<a class="ulink" href="http://www.nvidia.com/object/linux.html" target="_top">сайте nVidia</a>.
Этот драйвер также всегда необходим для задействования 3D ускорения.
</p><p>

Карты Riva128 не имеют поддержки XVideo с драйвером nVidia от XFree86 :(
Подайте жалобу nVidia.
</p><p>
Тем не менее, <span class="application">MPlayer</span> имеет
<a class="link" href="#vidix" title="7.15. VIDIX">VIDIX</a> драйвер для большинства карт nVidia. Сейчас он
в стадии беты и имеет некоторые недостатки. За подробостями обращайтесь
к разделу <a class="link" href="#vidix-nvidia" title="7.15.5. nVidia карты">nVidia VIDIX</a>.
</p></div><div class="sect2" title="7.2.4. ATI карты"><div class="titlepage"><div><div><h3 class="title"><a name="ati"></a>7.2.4. ATI карты</h3></div></div></div><p>
<a class="ulink" href="http://gatos.sf.net" target="_top">Драйвер GATOS</a>
(который стоит использовать, если у вас не Rage128 или Radeon) по-умолчанию имеет включенную
опцию VSYNC. Это значит, что скорость декодирования (!) синхронизирована с частотой обновления
монитора. Если воспроизведение кажется медленным, попробуйте как-нибудь отключить VSYNC или
установите частоту обновления в n*(fps[кадров/с] фильма) Гц.
</p><p>
Radeon VE - если нужен X, используйте XFree86 4.2.0 или новее.
Нет поддержки TV-выхода. Конечно, с <span class="application">MPlayer</span> вы можете успешно
получить <span class="bold"><strong>ускоренное</strong></span> отображение, с или без
<span class="bold"><strong>TV-выхода</strong></span>, без каких-либо библиотек X.
Читайте раздел <a class="link" href="#vidix" title="7.15. VIDIX">VIDIX</a>.
</p></div><div class="sect2" title="7.2.5. NeoMagic карты"><div class="titlepage"><div><div><h3 class="title"><a name="neomagic"></a>7.2.5. NeoMagic карты</h3></div></div></div><p>
Эти карты можно найти во многих ноутбуках. Вы должны использовать XFree86 4.3.0 или
более новый, или использовать
<a class="ulink" href="http://www.mplayerhq.hu/MPlayer/contrib/NeoMagic-driver/" target="_top">Xv-совместимые драйвера</a>.
от Stefan Seyfried. Просто выберите подходящий для вашей версии XFree86.
</p><p>
XFree86 4.3.0 включает поддержку Xv, недавно Bohdan Horst отослал небольшой
<a class="ulink" href="http://www.mplayerhq.hu/MPlayer/contrib/NeoMagic-driver/neo_driver.patch" target="_top">патч</a>
для исходников XFree86, ускоряющий операции с фреймбуфером (и XVideo) в четыре раза.
Патч был включен в XFree86 CVS и должен быть в следующем релизе после 4.3.0.
</p><p>
Чтобы сделать возможным воспроизведение фильмов DVD разрешения поправьте ваш XF86Config как
указано здесь:
</p><pre class="programlisting">
Section "Device"
    [...]
    Driver "neomagic"
    <span class="emphasis"><em>Option "OverlayMem" "829440"</em></span>
    [...]
EndSection</pre><p>
</p></div><div class="sect2" title="7.2.6. Trident карты"><div class="titlepage"><div><div><h3 class="title"><a name="trident"></a>7.2.6. Trident карты</h3></div></div></div><p>
Если хотите использовать Xv с картой Trident, учитывая, что они не работают с
4.1.0, установите XFree 4.2.0.
4.2.0 добавляет поддержку полноэкранного Xv с картой Cyberblade XP.
</p><p>
Другой вариант: <span class="application">MPlayer</span> имеет
<a class="link" href="#vidix" title="7.15. VIDIX">VIDIX</a> драйвер для карт Cyberblade/i1.
</p></div><div class="sect2" title="7.2.7. Kyro/PowerVR карты"><div class="titlepage"><div><div><h3 class="title"><a name="kyro"></a>7.2.7. Kyro/PowerVR карты</h3></div></div></div><p>
Если хотите использовать Xv с картами на базе Kyro (например,
Hercules Prophet 4000XT), следует скачать драйверы с
<a class="ulink" href="http://www.powervr.com/" target="_top">сайта PowerVR</a>.
</p></div><div class="sect2" title="7.2.8. Карты Intel"><div class="titlepage"><div><div><h3 class="title"><a name="intel"></a>7.2.8. Карты Intel</h3></div></div></div><p>
Эти карты можно обнаружить во многих ноутбуках. Рекомендуется Xorg последней версии.
</p><p>
Для воспроизведения контента размера DVD (и более) поправьте
ваш XF86Config/xorg.conf как указано здесь:
</p><pre class="programlisting">
Section "Device"
    [...]
    Driver "intel"
    <span class="emphasis"><em>Option "LinearAlloc" "6144"</em></span>
    [...]
EndSection
</pre><p>
Отсутствие этой опции скорее всего приведет к появлению ошибки
</p><pre class="screen">X11 error: BadAlloc (insufficient resources for operation)</pre><p>
при попытке использовать <tt class="option">-vo xv</tt>.
</p></div></div><div class="sect1" title="7.3. DGA"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dga"></a>7.3. DGA</h2></div></div></div><p title="ПРЕАМБУЛА"><b>ПРЕАМБУЛА. </b>
Этот документ пытается сказать несколько слов о том, что такое DGA в целом и
что можт сделать DGA драйвер  для <span class="application">MPlayer</span>
(а что нет).
</p><p title="ЧТО ТАКОЕ DGA"><b>ЧТО ТАКОЕ DGA. </b>
<acronym class="acronym">DGA</acronym> это сокращение от <span class="emphasis"><em>Direct Graphics
Access[Прямой Доступ к Графике]</em></span>  и означает обход
программами X сервера и прямое изменение ими памяти фреймбуфера.
Говоря техническим языком, это происходит при помощи отображения[mapping]
памяти фреймбуфера в адресное пространство вашего процесса. Это позволяется
ядром, только если у вас есть привилегии суперпользователя. Вы можете
получить их либо войдя в систему под именем
<code class="systemitem">root</code>, либо установив SUID бит на
исполняемый файл <span class="application">MPlayer</span> (<span class="bold"><strong>не
рекомендуется</strong></span>).
</p><p>
Есть две версии DGA: DGA1 используется XFree 3.x.x и DGA2, появившийся в XFree 4.0.1.
</p><p>
DGA1 предоставляет только прямой доступ в фреймбуферу, как описано выше.
Для переключения видеорежимов придется обратиться в расширению XVidMode.
</p><p>
DGA2 объединяет возможности расширения XVidMode и, к тому же, позволяет изменять
глубину цвета отображения. Таким образом, вы можете,работая, в основном,
в X с 32-х битной глубиной цвета, переключиться на глубину 15 бит и наоборот.
</p><p>
Однако DGA имеет некоторые недостатки. Похоже, оно каким-то образом зависит от
используемого графического чипа и реализации видеодрайвера сервера X,
управляющего этим чипом. Так что он работает не на всех системах.
</p><p title="УСТАНОВКА ПОДДЕРЖКИ DGA ДЛЯ MPLAYER"><b>УСТАНОВКА ПОДДЕРЖКИ DGA ДЛЯ MPLAYER. </b>
Во-первых, убедитесь, что X загружает расширение DGA, смотрите в
<tt class="filename">/var/log/XFree86.0.log</tt>:

</p><pre class="programlisting">(II) Loading extension XFree86-DGA</pre><p title="УСТАНОВКА ПОДДЕРЖКИ DGA ДЛЯ MPLAYER">

Смотрите, <span class="bold"><strong>крайне рекомендуется</strong></span> XFree86 4.0.x или старше!
DGA драйвер программы <span class="application">MPlayer</span> определяется автоматически скриптом
<tt class="filename">./configure</tt>, или можете принудительно указать его использование
опцией <tt class="option">--enable-dga</tt>.
</p><p>
Если драйвер не смог переключиться на меньшее разрешение, поэкспериментируйте с
опциями <tt class="option">-vm</tt> (только для X 3.3.x), <tt class="option">-fs</tt>,
<tt class="option">-bpp</tt>, <tt class="option">-zoom</tt> чтобы найти видеорежим
в который поместиться фильм. Конвертера Пока что нет :(
</p><p>
Получите права <code class="systemitem">root</code>. DGA требует
права root для прямой записи в видеопамять. Если хотите запускать от имени обычного
пользователя, установите бит SUID на <span class="application">MPlayer</span>:

</p><pre class="screen">
chown root <em class="replaceable"><code>/usr/local/bin/mplayer</code></em>
chmod 750 <em class="replaceable"><code>/usr/local/bin/mplayer</code></em>
chmod +s <em class="replaceable"><code>/usr/local/bin/mplayer</code></em>
</pre><p>

Теперь это работает и под обычным пользователем.
</p><div class="caution" title="Риск безопасности" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Риск безопасности</h3><p>
В этом заключается <span class="bold"><strong>большой</strong></span> риск безопасности!
<span class="bold"><strong>Никогда</strong></span> не делайте этого на сервере или комппьютере,
к которому имеют доступ другие люди, т.к. они могут получить права root через
<span class="application">MPlayer</span> с битом SUID.
</p></div><p>
Теперь используйте опцию <tt class="option">-vo dga</tt>, и вперед! (мы надеемся :)
Можете попробовать, работает ли у вас опция <tt class="option">-vo sdl:driver=dga</tt>!
Это намного быстрее!
</p><p title="ПЕРЕКЛЮЧЕНИЕ РЕЖИМОВ"><a name="dga-modelines"></a><b>ПЕРЕКЛЮЧЕНИЕ РЕЖИМОВ. </b>
DGA драйвер позволяет переключать режимы (менять разрешение) выходного сигнала.
Это позволяет избежать (медленного) программного масштабирования и в то же
время предоставить полноэкранное изображение. В идеале следует переключаться в
режим с таким же (необязательно с сохранением пропорций) как у видеоданных разрешением,
но X сервер позволяет переключаться в режимы, предопределенные в
<tt class="filename">/etc/X11/XF86Config</tt>
(<tt class="filename">/etc/X11/XF86Config-4</tt> для XFree 4.X.X соответственно).
Они определяются так называемыми моделайнами[modelines] и зависят
возможностей вашей видеокарты. X сервер читает этот файл при старте и
отключает режимы, недопустимые для вашего оборудования. Вы можете определить
какие режимы остались, посмотрев лог файл X11. Он может быть найден в:
<tt class="filename">/var/log/XFree86.0.log</tt>.
</p><p>
Вот значения, про которые известно, что они работают с чипом Riva128 при
использовании X драйвера nv.o.
</p><pre class="programlisting">
Section "Modes"
  Identifier "Modes[0]"
  Modeline "800x600"  40     800 840 968 1056  600 601 605 628
  Modeline "712x600"  35.0   712 740 850 900   400 410 412 425
  Modeline "640x480"  25.175 640 664 760 800   480 491 493 525
  Modeline "400x300"  20     400 416 480 528   300 301 303 314 Doublescan
  Modeline "352x288"  25.10  352 368 416 432   288 296 290 310
  Modeline "352x240"  15.750 352 368 416 432   240 244 246 262 Doublescan
  Modeline "320x240"  12.588 320 336 384 400   240 245 246 262 Doublescan
EndSection
</pre><p title="DGA &amp; MPLAYER"><b>DGA &amp; MPLAYER. </b>
DGA используется программой <span class="application">MPlayer</span> двумя способами:
можно указать SDL использовать его (<tt class="option">-vo sdl:driver=dga</tt>) и
с помощью DGA драйвера (<tt class="option">-vo dga</tt>). Все сказанное выше верно для обоих;
в следующих разделах будет рассказано как работает DGA драйвер для
<span class="application">MPlayer</span>.
</p><p title="ВОЗМОЖНОСТИ"><b>ВОЗМОЖНОСТИ. </b>
DGA запускается указанием <tt class="option">-vo dga</tt> в командной строке. По-умолчанию,
он пытается переключить режим с ближайшим к оригинальному видео разрешением.
Он преднамеренно игнорирует опции  <tt class="option">-vm</tt> и <tt class="option">-fs</tt>
(переключение видеорежимов и полноэкранный режим) - он всегда старается
занять как можно большую площадь экрана переключением видеорежима,
избегая таким образом использования дополнительных тактов CPU для
масштабирования изображения. Если выбранный режим вам не нравится, можете
принудительно указать использовать разрешение ближайшее к указанному вами опциями
<tt class="option">-x</tt> и <tt class="option">-y</tt>. При указании опции
<tt class="option">-v</tt>, DGA драйвер выведет, кроме множества других вещей, список
всех поддерживаемых режимов, указанных в <tt class="filename">XF86Config</tt>.
Имея DGA2 вы также можете указать использование определенной глубины цвета
при помощи опции <tt class="option">-bpp</tt>. Допустимыми значениями являются 15, 16, 24 и 32.
Зависит от оборудования, какие значения поддерживаются  аппаратно, а для каких необходимо
производить (возможно медленное) преобразование.
</p><p>

Если вам повезло иметь достаточно свободной памяти[offscreen memory], чтобы поместить
туда изображение целиком, DGA драйвер будет использовать двойную буферизацию,
что приведет к более плавному воспроизведению фильма. Он сообщит вам включена ли
двойная буферизация или нет.
</p><p>
Двойная буферизация означает, что каждый следующий кадр вашего фильма рисуется
в некоторую память[offscreen memory], пока отображается текущий кадр.
Когда следующий кадр готов, графическому чипу сообщается его расположение
в памяти, и чип просто выбирает оттуда данные для отображения.
В это время новыми видео данными заполняется другой участок буфера.
</p><p>
Двойная буферизация может быть задействована опцией
<tt class="option">-double</tt> и отключена при помощи
<tt class="option">-nodouble</tt>. В данный момент двойной буфер по-умолчанию отключен.
При использовании DGA драйвера, экранное отображение (OSD) работает только
с двойной буферизацией. Однако, включение двойной буферизации  может привести
к существенному снижению скорости (на моем K6-II+ 525 оно использует дополнительные
20% времени CPU!) в зависимости от реализации DGA для вашего оборудования.
</p><p title="ПРОБЛЕМЫ БЫСТРОДЕЙСТВИЯ"><b>ПРОБЛЕМЫ БЫСТРОДЕЙСТВИЯ. </b>

Проще говоря, DGA доступ к фреймбуферу должен быть настолько быстр, насколько
быстр используемый X11 драйвер c дополнительной выгодой[benefit] получения
полноэкранного изображения. Процентные значения скорости, выводимые
<span class="application">MPlayer</span>, должны интерпретироваться с некоторой
осторожностью, например, с драйвером X11 они не включают время, используемое
сервером X11 непосредственно для прорисовки. Подключите терминал к
последовательному порту и запустите <span class="command"><strong>top</strong></span>, чтобы
увидеть, что на самом деле происходит.
</p><p>
Проще говоря, ускорение, полученное от использования DGA относительно
'обычного' использования X11, сильно зависит от видео карты и того,
насколько хорошо оптимизирован модуль X11 для него.
</p><p>
Если у вас медленная система, лучше использовать глубину 15 или 16 бит,
поскольку это потребует половину пропускной способности памяти 32-х
битного дисплея.
</p><p>
Использование глубины 24 бита - хорошая идея, даже если ваша карта
аппаратно поддерживает только 32 бита, поскольку передается на 25%
меньше данных по сравнению с режимом 32/32.
</p><p>
Приходилось видеть, как некоторые AVI файлы воспроизводились на Pentium MMX 266.
AMD K6-2 CPU может работать начиная с 400 МГц и выше.
</p><p title="ИЗВЕСТНЫЕ ОШИБКИ"><b>ИЗВЕСТНЫЕ ОШИБКИ. </b>
Ну, по мнению некоторых разработчиков XFree, DGA - это немного монстр.
Они говорят, что лучше его не использовать. Его реализация не
безупречна для любого существующего драйвера XFree.
изъянов.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  С XFree 4.0.3 и <tt class="filename">nv.o</tt> существует ошибка приводящая
  к странным цветам.
</p></li><li class="listitem"><p>
  ATI драйвер требует  неоднократного переключения режима после
  завершения использования DGA.
</p></li><li class="listitem"><p>
  Некоторые драйвера просто не в состоянии переключиться обратно в
  нормальный режим (используйте
  <span class="keycap"><b>Ctrl</b></span>+<span class="keycap"><b>Alt</b></span>+<span class="keycap"><b>Keypad +</b></span>
  и
  <span class="keycap"><b>Ctrl</b></span>+<span class="keycap"><b>Alt</b></span>+<span class="keycap"><b>Keypad -</b></span>
  для нормального переключения).
</p></li><li class="listitem"><p>
  Некоторые драйвера просто отображают странные цвета.
</p></li><li class="listitem"><p>
  Некоторые драйвера неверно сообщают о количестве памяти, которое они отобразили в
  адресное пространство процесса, так что vo_dga не будет использовать
  двойную буферизацию (SIS?).
</p></li><li class="listitem"><p>
  Некоторые драйвера, похоже, не могут сообщить  даже об одном верном режиме.
  В этом случае DGA рухнет, сообщая о невероятном режиме
  100000x100000 или о чем-нибудь похожем.
</p></li><li class="listitem"><p>
  OSD работает только с задействованным двойным буфером (иначе он моргает).
</p></li></ul></div></div><div class="sect1" title="7.4. SDL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sdl"></a>7.4. SDL</h2></div></div></div><p>
<acronym class="acronym">SDL</acronym> (Simple Directmedia Layer) - это, в основном, унифицированный
видео/аудио интерфейс. Программы, его использующие, знают только про SDL, а не про
то, какой видео или аудио драйвер реально используется. Например, порт игры Doom,
используя SDL, может запуститься на svgalib, aalib, X, fbdev и других, вам
придется только указать (для примера) используемый видеодрайвер при помощи
переменной окружения <code class="envar">SDL_VIDEODRIVER</code>. Ну, в теории.
</p><p>

Для карт/драйверов, не поддерживающих XVideo, мы использовали в
<span class="application">MPlayer</span> собственные возможности программного масштабирования
SDL'вских X11 драйверов, пока не написали наш собственный (более быстрый и изящный)
программный модуль масштабирования. Также мы использовали его aalib вывод, но
теперь у нас есть свой, более удобный. До некоторых пор его DGA режим был
лучше нашего. Хотите получить его прямо сейчас ? :)
</p><p>
Он также помогает с некоторыми сбоящими  драйверами/картами, если видео
прерывается (если это не проблема недостаточного быстродействия), или заикается звук.
</p><p>
SDL видео вывод поддерживает отображения субтитров внизу, на черной полосе (если она есть).
</p></div><div class="sect1" title="7.5. SVGAlib"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="svgalib"></a>7.5. SVGAlib</h2></div></div></div><p title="УСТАНОВКА"><b>УСТАНОВКА. </b>
потребуется установить svgalib и ее пакет разработки, чтобы
<span class="application">MPlayer</span> собрал свой SVGAlib драйвер (определяется
автоматически, но можко включить принудительно), и отредактировать
<tt class="filename">/etc/vga/libvga.config</tt> в соответствии с вашией картой и монитором.
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
Убедитесь, что не используете опцию <tt class="option">-fs</tt>, поскольку она включает
использование программного масштабирования и работает медленно. Если вам действительно
это необходимо, используйте опцию <tt class="option">-sws 4</tt>, которая будет давать плохое
качество, но несколько быстрее.
</p></div><p title="ПОДДЕРЖКА EGA (4BPP)"><b>ПОДДЕРЖКА EGA (4BPP). </b>
SVGAlib включает в себя EGAlib, и <span class="application">MPlayer</span> имеет
возможность выводить любой фильм в 16-ти цветах. Используется в таких вариантах:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  EGA карта с EGA монитором: 320x200x4bpp, 640x200x4bpp, 640x350x4bpp
</p></li><li class="listitem"><p>
  EGA карта с CGA монитором: 320x200x4bpp, 640x200x4bpp
</p></li></ul></div><p>
Значение bpp (бит на пиксел) должно быть вручную установлено в 4:
<tt class="option">-bpp 4</tt>
</p><p>
Возможно потребуется отмасштабировать фильм, чтобы уместить в размеры EGA режима:
</p><pre class="screen">-vf scale=640:350</pre><p>
or
</p><pre class="screen">-vf scale=320:200</pre><p>
</p><p>
Для масштабирования требуется быстрый алгоритм с плохим качеством:
</p><pre class="screen">-sws 4</pre><p>
</p><p>
Возможно надо отключить автоматическую коррекцию пропорций:
</p><pre class="screen">-noaspect</pre><p>
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
Как показывает мой опыт, лучшее качество на EGA экране получается
при небольшом уменьшении яркости:
<tt class="option">-vf eq=-20:0</tt>. Мне также пришлось уменьшить частоту дискретизации [samplerate]
на моей машине, поскольку звук не работал на 44kГц.
<tt class="option">-srate 22050</tt>.
</p></div><p>
ВЫ можете включить OSD и субтитры только с плагином <tt class="option">expand</tt>,
смотрите страницу руководства man для точных параметров.
</p></div><div class="sect1" title="7.6. Вывод во фреймбуфер (FBdev)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="fbdev"></a>7.6. Вывод во фреймбуфер (FBdev)</h2></div></div></div><p>
Надо ли собирать FBdev автоматически определяется скриптом
<tt class="filename">./configure</tt>. Прочтите документацию на фреймбуйер в
исходниках ядра (<tt class="filename">Documentation/fb/*</tt>) для более подробной
информации.
</p><p>
Если ваша карта не поддерживает стандарт VBE 2.0 (старые ISA/PCI карты, такие
как S3 Trio64), а только VBE 1.2 (или еще старее?): ну, VESAfb все же будет доступна,
но вам потребуется загрузить SciTech Display Doctor (она же UniVBE) до загрузки Linux.
Используйте загрузочный диск DOS или что либо другое. И не забудьте зарегистрировать
ваш UniVBE ;))
</p><p>
Драйвер FBdev вместе с прочими принимает несколько дополнительных параметров:
</p><div class="variablelist"><dl><dt><span class="term"><tt class="option">-fb</tt></span></dt><dd><p>
    указывает какой устройство фреймбуфера использовать
    (по-умолчанию: <tt class="filename">/dev/fb0</tt>)
  </p></dd><dt><span class="term"><tt class="option">-fbmode</tt></span></dt><dd><p>
    название используемого режима (в соответствии с <tt class="filename">/etc/fb.modes</tt>)
  </p></dd><dt><span class="term"><tt class="option">-fbmodeconfig</tt></span></dt><dd><p>
    конфигурационный файл с режимами (по-умолчанию: <tt class="filename">/etc/fb.modes</tt>)
  </p></dd><dt><span class="term"><tt class="option">-monitor-hfreq</tt>, </span><span class="term"><tt class="option">-monitor-vfreq</tt>, </span><span class="term"><tt class="option">-monitor-dotclock</tt></span></dt><dd><p>
    <span class="bold"><strong>важные</strong></span> знаячения, смотрите
    <tt class="filename">example.conf</tt>
  </p></dd></dl></div><p>
При желании переключиться в особый режим используйте:
</p><pre class="screen">
mplayer -vm -fbmode <em class="replaceable"><code>название_режима</code></em> <em class="replaceable"><code>имя_файла</code></em>
</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <tt class="option">-vm</tt> в одиночку выберет наиболее подходящий режим из
  <tt class="filename">/etc/fb.modes</tt>. Также может использоваться совместно с
  <tt class="option">-x</tt> и <tt class="option">-y</tt>. Опция
  <tt class="option">-flip</tt> поддерживается, только если формат точки фильма совпадает с
  форматом точки видеорежима. Обратите внимание на значение bpp, fbdev пытается
  использовать текущий или указанный вами опцией <tt class="option">-bpp</tt>.
</p></li><li class="listitem"><p>
  Опция <tt class="option">-zoom</tt> не поддерживается (используйте <tt class="option">-vf scale</tt>).
  Вы не можете использовать режимы с 8bpp (или меньше).
</p></li><li class="listitem"><p>
  Вы, возможно, захотите отключить курсор:
  </p><pre class="screen">echo -e '\033[?25l'</pre><p>
  или
  </p><pre class="screen">setterm -cursor off</pre><p>
  и хранитель экрана:
  </p><pre class="screen">setterm -blank 0</pre><p>
  Чтобы снова включить курсор:
  </p><pre class="screen">echo -e '\033[?25h'</pre><p>
  или
  </p><pre class="screen">setterm -cursor on</pre><p>
</p></li></ul></div><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
Смена режимов FBdev <span class="emphasis"><em>не работает</em></span> с VESA фреймбуфером.
Не просите об этом, т.к. это не ограничения <span class="application">MPlayer</span>.
</p></div></div><div class="sect1" title="7.7. Matrox фреймбуфер (mga_vid)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mga_vid"></a>7.7. Matrox фреймбуфер (mga_vid)</h2></div></div></div><p>
<code class="systemitem">mga_vid</code> - это комбинация драйвера вывода и модуля ядра
Linux, использующая модуль видео масштабирования/оверлея
Matrox G200/G400/G450/G550 для выполнения YUV-&gt;RGB преобразования цветового
пространства и произвольного масштабирования.
<code class="systemitem">mga_vid</code> имеет аппаратную поддержку VSYNC с тройной
буферизацией. Работает как во фреймбуфер
консоли, так и под X, но только с Linux 2.4.x.
</p><p>
Версию этого драйверя для Linux 2.6.x ищите на
<a class="ulink" href="http://attila.kinali.ch/mga/" target="_top">http://attila.kinali.ch/mga/</a>.
</p><div class="procedure" title="Установка:"><a name="id2556200"></a><p class="title"><b>Установка:</b></p><ol class="procedure" type="1"><li class="step" title="Шаг 1"><p>
  чтобы использовать его, придется, во-первых, скомпилировать <tt class="filename">mga_vid.o</tt>:
  </p><pre class="screen">
cd drivers
make</pre><p>
</p></li><li class="step" title="Шаг 2"><p>
  Затем запустите (под <code class="systemitem">root</code>)
  </p><pre class="screen">make install</pre><p>
  что должно установить модуль и создать для Вас файл устройства.
  Загрузите драйвер:
  </p><pre class="screen">insmod mga_vid.o</pre><p>
</p></li><li class="step" title="Шаг 3"><p>
  Вам следует проверить определение размера памяти, используя
  команду <span class="command"><strong>dmesg</strong></span>. Если он неверен, укажите опцию
  <tt class="option">mga_ram_size</tt>
  (но сначала <span class="command"><strong>rmmod mga_vid</strong></span>),
  указав размер памяти в Мб:
  </p><pre class="screen">insmod mga_vid.o mga_ram_size=16</pre><p>
</p></li><li class="step" title="Шаг 4"><p>
  чтобы в случае необходимости загружать его автоматической, сначала добавьте
  следующую строку в конец файла <tt class="filename">/etc/modules.conf</tt>:

  </p><pre class="programlisting">alias char-major-178 mga_vid</pre><p>
</p></li><li class="step" title="Шаг 5"><p>
  Теперь надо (пере)скомпилировать <span class="application">MPlayer</span>,
  <span class="command"><strong>./configure</strong></span> определит
  <tt class="filename">/dev/mga_vid</tt> и соберет драйвер 'mga'.
  Использование его в <span class="application">MPlayer</span> осуществляется
  опцией <tt class="option">-vo mga</tt>, если используете консоль matroxfb, или
  опцией <tt class="option">-vo xmga</tt> из-под XFree86 3.x.x или 4.x.x.
</p></li></ol></div><p>
Драйвер mga_vid работает совместно с Xv.
</p><p>
Из файла устройства <tt class="filename">/dev/mga_vid</tt> можно получать некоторую информацию,
например, командой
</p><pre class="screen">cat /dev/mga_vid</pre><p>
В него можно писать для изменения яркости:
</p><pre class="screen">echo "brightness=120" &gt; /dev/mga_vid</pre><p>
</p><p>
В том же каталоге есть тестовая программа, называющаяся
<span class="command"><strong>mga_vid_test</strong></span>. Если все работает нормально, она должна
рисовать на экране изображения 256x256.
</p></div><div class="sect1" title="7.8. Поддержка 3Dfx YUV"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tdfxfb"></a>7.8. Поддержка 3Dfx YUV</h2></div></div></div><p>
Этот драйвер использует ядерный драйвер фреймбуфера tdfx для воспроизведения
фильмой с YUV ускорением. Вам потребуется ядро с поддержкой tdfxfb и перекомпиляция с
</p><pre class="screen">./configure --enable-tdfxfb</pre><p>
</p></div><div class="sect1" title="7.9. tdfx_vid"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tdfx_vid"></a>7.9. tdfx_vid</h2></div></div></div><p>
Это комбинация модуля Linux ядра и драйвера вывода видео, аналогичный
<a class="link" href="#mga_vid" title="7.7. Matrox фреймбуфер (mga_vid)">mga_vid</a>.
Вам потребуется 2.4.x ядро с драйвером <code class="systemitem">agpgart</code>,
поскольку <code class="systemitem">tdfx_vid</code> использует AGP.
Укажите <span class="command"><strong>configure</strong></span> опцию <tt class="option">--enable-tdfxfb</tt>
для сборки драйвера вывода видео и соберите модуль ядра, как указано далее.
</p><div class="procedure" title="Установка tdfx_vid.o модуля ядра:"><a name="id2556497"></a><p class="title"><b>Установка tdfx_vid.o модуля ядра:</b></p><ol class="procedure" type="1"><li class="step" title="Шаг 1"><p>
  Скомпилируйте <tt class="filename">tdfx_vid.o</tt>
  </p><pre class="screen">
cd drivers
make</pre><p>
</p></li><li class="step" title="Шаг 2"><p>
  Запустите (от <code class="systemitem">root</code>):
  </p><pre class="screen">make install</pre><p>
  что должно установить модуль и создать для Вас файл устройства.
  Загрузите драйвер:
  </p><pre class="screen">insmod tdfx_vid.o</pre><p>
</p></li><li class="step" title="Шаг 3"><p>
  Чтобы сделать его загружающимся/выгружающимся автоматически, сначала вставьте
  следующую строку в конец <tt class="filename">/etc/modules.conf</tt>:

  </p><pre class="programlisting">alias char-major-178 tdfx_vid</pre><p>
</p></li></ol></div><p>
В том же каталоге есть тестовая программа, называющаяся
<span class="command"><strong>tdfx_vid_test</strong></span>. Она должна вывести некоторую полезную
информацию, если все работает нормально.
</p></div><div class="sect1" title="7.10. OpenGL вывод"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="opengl"></a>7.10. OpenGL вывод</h2></div></div></div><p>
<span class="application">MPlayer</span> поддерживает воспроизведение фильмов через OpenGL,
но если ваша платформа/драйвер поддерживает xv, как в случае PC с Linux,
лучше используйте xv, производительность OpenGL значительно ниже. Если у вас
реализация X11 без поддержки xv, OpenGL жизнеспособная замена.
</p><p>
К сожалению, не все драйвера поддерживают эту возможность. Драйвера
Utah-GLX (для XFree86 3.3.6) имеют ее для всех карт.
Подробности установки смотрите <a class="ulink" href="http://utah-glx.sf.net" target="_top">http://utah-glx.sf.net</a>.
</p><p>
XFree86(DRI) 4.0.3 или новее поддерживает OpenGL с картами Matrox и Radeon,
4.2.0 или более поздние поддерживают и Rage128.
Инструкции по закачиванию и установке смотрите на <a class="ulink" href="http://dri.sf.net" target="_top">http://dri.sf.net</a> .
</p><p>
Подсказка от одного из наших пользователей: видео вывод GL может использоваться
для получения синхронизированного по вертикали TV вывода. Необходимо установить
переменную окружения (как минимум для nVidia):
</p><p>
<span class="command"><strong>export __GL_SYNC_TO_VBLANK=1</strong></span>
</p></div><div class="sect1" title="7.11. AAlib - отображение в текстовом режиме"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aalib"></a>7.11. AAlib - отображение в текстовом режиме</h2></div></div></div><p>
AAlib - это библиотека для отображения графики в текстовом режиме, используя мощный
ASCII рендерер[renderer]. Существует <span class="emphasis"><em>множество</em></span> программ уже
поддерживающих ее, такие как Doom, Quake, и т.д. <span class="application">MPlayer</span>
содержит очень удобный драйвер для нее. Если <tt class="filename">./configure</tt>
обнаруживает установленную aalib, будет собран libvo драйвер для aalib.
</p><p>
В AA Window можно использовать некоторые клавиши для изменения настроек рендеринга:
</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Клавиша</th><th>Действие</th></tr></thead><tbody><tr><td><span class="keycap"><b>1</b></span></td><td>
  уменьшить контрастность
</td></tr><tr><td><span class="keycap"><b>2</b></span></td><td>
  увеличить контрастность
</td></tr><tr><td><span class="keycap"><b>3</b></span></td><td>
  уменьшить яркость
</td></tr><tr><td><span class="keycap"><b>4</b></span></td><td>
  увеличить яркость
</td></tr><tr><td><span class="keycap"><b>5</b></span></td><td>
  включение/отключение быстрого рендеринга
</td></tr><tr><td><span class="keycap"><b>6</b></span></td><td>
  установка режима зашумления[dithering] (отсутствие, распределение ошибки[error distribution], Floyd Steinberg)
</td></tr><tr><td><span class="keycap"><b>7</b></span></td><td>
  инвертировать изображение
</td></tr><tr><td><span class="keycap"><b>8</b></span></td><td>
  переключение между управлением aa и <span class="application">MPlayer</span>
</td></tr></tbody></table></div><div class="variablelist" title="Могут быть использованы следующие опции командной строки:"><p class="title"><b>Могут быть использованы следующие опции командной строки:</b></p><dl><dt><span class="term"><tt class="option">-aaosdcolor=<em class="replaceable"><code>V</code></em></tt></span></dt><dd><p>
    Смена цвета OSD
  </p></dd><dt><span class="term"><tt class="option">-aasubcolor=<em class="replaceable"><code>V</code></em></tt></span></dt><dd><p>
    Смена цвета субтитров
    </p><p>
    где <em class="replaceable"><code>V</code></em> может быть:
    <code class="literal">0</code> (нормальный),
    <code class="literal">1</code> (темный),
    <code class="literal">2</code> (жирный),
    <code class="literal">3</code> (жирный шрифт),
    <code class="literal">4</code> (реверсный[reverse]),
    <code class="literal">5</code> (специальный).
  </p></dd></dl></div><div class="variablelist" title="AAlib сама предоставляет большое количество опций. Вот некоторые из важных::"><p class="title"><b>AAlib сама предоставляет большое количество опций. Вот некоторые из важных::</b></p><dl><dt><span class="term"><tt class="option">-aadriver</tt></span></dt><dd><p>
    Установить рекомендуемый aa драйвер (X11, curses, Linux).
  </p></dd><dt><span class="term"><tt class="option">-aaextended</tt></span></dt><dd><p>
    Использовать все 256 символов.
  </p></dd><dt><span class="term"><tt class="option">-aaeight</tt></span></dt><dd><p>
    Использовать восьмибитную ASCII.
  </p></dd><dt><span class="term"><tt class="option">-aahelp</tt></span></dt><dd><p>
    Выводит все опции  aalib.
  </p></dd></dl></div><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
Рандеринг очень сильно загружает CPU, особенно при использовании AA-on-X
(использование aalib под X), и меньше при использовании стандартной не-фреймбуфер
консоли. Используйте SVGATextMode, чтобы настроить большой текстовый режим и
наслаждайтесь! (второй выход карт Hercules рулит[secondary head Hercules cards
rock] :) ), но, IMHO, вы можете использовать опцию  <tt class="option">-vf 1bpp</tt>, чтобы
получить графику на hgafb :)
</p></div><p>
Используйте опцию <tt class="option">-framedrop</tt>, если ваш компьютер недостаточно быстр
для отрисовки всех кадров!
</p><p>
При воспроизведении на терминале, вы получите лучшую скорость и качество при
использовании драйвера Linux, а не curses(<tt class="option">-aadriver linux</tt>).
Но при этом вы долны иметь право записи в
<tt class="filename">/dev/vcsa<em class="replaceable"><code>&lt;терминал&gt;</code></em></tt>!
Это не определяется aalib автоматически, но vo_aa вместо нее пытается определить
лучший режим. Смотрите <a class="ulink" href="http://aa-project.sf.net/tune" target="_top">http://aa-project.sf.net/tune</a> для
дальнейших задач тюнинга.
</p></div><div class="sect1" title="7.12. libcaca - Цветная ASCII Art библиотека"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="caca"></a>7.12. 
<code class="systemitem">libcaca</code> - Цветная ASCII Art библиотека
</h2></div></div></div><p>
Библиотека <a class="ulink" href="http://sam.zoy.org/projects/libcaca/" target="_top"><code class="systemitem">libcaca</code></a> -
это графическая библиотека, выводящая чекст вместо пикселов, так что она может
работать на старых видео картах или текстовых терминалах. Она не такая, как
знаменитая <code class="systemitem">AAlib</code>.
<code class="systemitem">libcaca</code> требует терминал для своей работы,
так что она будет работать на всех unix системах (включая Max OS X), используя
библиотеку <code class="systemitem">slang</code> или
<code class="systemitem">ncurses</code>, под DOS используя библиотеку
<code class="systemitem">conio.h</code>, и под windows, используя либо
<code class="systemitem">slang</code>, либо
<code class="systemitem">ncurses</code> (через Cygwin эмуляцию), либо
<code class="systemitem">conio.h</code>. Если скрипт
<tt class="filename">./configure</tt>
определяет <code class="systemitem">libcaca</code>, то caca libvo драйвер
будет собран.
</p><div class="itemizedlist" title="Отличия от AAlib следующие:"><p class="title"><b>Отличия от <code class="systemitem">AAlib</code> следующие:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
   16 доступных цветов для вывода символов (256 цветовых пар)
</p></li><li class="listitem"><p>
   зашумление[dithering] цветного изображения
</p></li></ul></div><div class="itemizedlist" title="Но libcaca также имеет следующие ограничения:"><p class="title"><b>Но <code class="systemitem">libcaca</code> также имеет следующие
ограничения:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
   нет поддержки яркости, контрастности, гаммы
</p></li></ul></div><p>
ВЫ можете использовать следующие клавиши в окне caca для изменения опций
рендеринга:
</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Клавиша</th><th>Действие</th></tr></thead><tbody><tr><td><span class="keycap"><b>d</b></span></td><td>
  Перключение методов зашумления[dithering] <code class="systemitem">libcaca</code>.
</td></tr><tr><td><span class="keycap"><b>a</b></span></td><td>
  Перекллючение сглаживания[antialiasing] <code class="systemitem">libcaca</code>.
</td></tr><tr><td><span class="keycap"><b>b</b></span></td><td>
  Переключение фона <code class="systemitem">libcaca</code>.
</td></tr></tbody></table></div><div class="variablelist" title="libcaca также анализирует следующие переменные окружения:"><p class="title"><b><code class="systemitem">libcaca</code> также анализирует следующие
переменные окружения:</b></p><dl><dt><span class="term"><tt class="option">CACA_DRIVER</tt></span></dt><dd><p>
    Установить рекомендуемый caca драйвер, например ncurses, slang, x11.
  </p></dd><dt><span class="term"><tt class="option">CACA_GEOMETRY (только X11)</tt></span></dt><dd><p>
    Указывает количество строк и столбцов, например, 128x50.
  </p></dd><dt><span class="term"><tt class="option">CACA_FONT (только X11)</tt></span></dt><dd><p>
    Указывает используемый шрифт, например, fixed, nexus.
  </p></dd></dl></div><p>
Используйте опцию <tt class="option">-framedrop</tt>, если ваш компьютер недостаточно быстр для
рендеринга всех кадров.
</p></div><div class="sect1" title="7.13. VESA - вывод в VESA BIOS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="vesa"></a>7.13. VESA - вывод в VESA BIOS</h2></div></div></div><p>
Этот драйвер был разработатн и представлен как <span class="bold"><strong>универсальный
драйвер</strong></span> для любых карт с VESA VBE 2.0 совместимым BIOS.
Другое преимущество этого драйвера заключается в том ,что он пытается принудительно
включить TV вывод.
<em class="citetitle">VESA BIOS EXTENSION (VBE) Версия 3.0 Дата: 16 сентября, 1998</em>
(Страница 70) гласит:
</p><div class="blockquote"><blockquote class="blockquote"><p title="Dual-Controller Designs"><b>Dual-Controller Designs. </b>
VBE 3.0 поддерживает дизайн с двумя контроллерами, предполагая, что поскольку
оба контроллера обычно имеют одного производителя, и управляются единственной
BIOS ROM на той же карте, то возможно скрыть от приложения факт наличия на самом
деле двух контроллеров. Это ограничивает их независимое одновременное использование,
но позволяет приложениям, выпущенным до VBE 3.0
нормально работать. VBE функция 00h (Вернуть информацию о контроллере) возвращает
комбинированную информацию двух контроллеров, включая объединенный список
доступных режимов. Когда приложение выбирает режим, активируется соответствующий
контроллер. Каждая из остальных VBE функций затем работает  с активным
контроллером.
</p></blockquote></div><p>
Так что у вас ест шанс получить работающий TV выход, используя этот драйвер.
(Предполагается, что TV-выход - отдельный контроллер[standalone head] или
отдельный выход как минимум.)
</p><div class="itemizedlist" title="ПРЕИМУЩЕСТВА"><p class="title"><b>ПРЕИМУЩЕСТВА</b></p><ul class="itemizedlist" type="disc" compact><li class="listitem"><p>
  У вас есть шанс смотреть фильмы, <span class="bold"><strong>даже если Linux
  не знает</strong></span> ваше видео оборудование.
</p></li><li class="listitem"><p>
  Вам не требуется устанавливать в Linux ничего, относящегося к графике
  (вроде X11 (он же XFree86), fbdev и т.п.). Этот драйвер может запускаться
  из <span class="bold"><strong>текстового режима</strong></span>.
</p></li><li class="listitem"><p>
  У вас есть шанс получить <span class="bold"><strong>работающий TV-выход</strong></span>.
  (Это известно как минимум для ATI карт).
</p></li><li class="listitem"><p>
  Этот драйвер вызывает обработчик <code class="function">int 10h</code>, так что это
  не эмуляция - он вызывает <span class="bold"><strong>реальные</strong></span>
  вещи <span class="emphasis"><em>реального</em></span> BIOS в <span class="emphasis"><em>реальном режиме</em></span>
  (на самом деле vm86 режим).
</p></li><li class="listitem"><p>
  С ним вы можете использовать VIDIX, получая ускоренное отображение видео,
  <span class="bold"><strong>и</strong></span> TV вывод одновременно!
  (Рекомендуется для ATI карт.)
</p></li><li class="listitem"><p>
  Если у вас есть VESA VBE 3.0+, и вы где-то указали
  <tt class="option">monitor-hfreq, monitor-vfreq, monitor-dotclock</tt>
  (в файле конфигурации или в командной строке), то получите наибольшую возможную
  частоту обновления. (Используя General Timing Formula). Чтобы задействовать
  эту возможность, вы должны указать <span class="bold"><strong>все</strong></span> опции
  вашего монитора.
</p></li></ul></div><div class="itemizedlist" title="НЕДОСТАТКИ"><p class="title"><b>НЕДОСТАТКИ</b></p><ul class="itemizedlist" type="disc" compact><li class="listitem"><p>
   Это работает только на <span class="bold"><strong>x86 системах</strong></span>.
</p></li><li class="listitem"><p>
  Может использоваться только пользователем <code class="systemitem">root</code>.
</p></li><li class="listitem"><p>
  В данный момент доступно только для <span class="bold"><strong>Linux</strong></span>.
</p></li></ul></div><div class="important" title="Важно" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Важно</h3><p>
Не используйте этот драйвер с <span class="bold"><strong>GCC 2.96</strong></span>!
Он не будет работать!
</p></div><div class="variablelist" title="ОПЦИИ КОМАНДНОЙ СТРОКИ, ДОСТУПНЫЕ ДЛЯ VESA"><p class="title"><b>ОПЦИИ КОМАНДНОЙ СТРОКИ, ДОСТУПНЫЕ ДЛЯ VESA</b></p><dl><dt><span class="term"><tt class="option">-vo vesa:<em class="replaceable"><code>опции</code></em></tt></span></dt><dd><p>
    данный момент распознаются: <code class="literal">dga</code> для включения режима dga
    и <code class="literal">nodga</code> для его отключения. В dga режиме вы можете включить
    двойную буферизацию опцией <tt class="option">-double</tt>. Замечание: вы можете
    опустить эти параметры для <span class="bold"><strong>автоопределения</strong></span>
    режима dga.
  </p></dd></dl></div><div class="itemizedlist" title="ИЗВЕСТНЫЕ ПРОБЛЕМЫ И СПОСОБЫ ИХ РЕШЕНИЯ"><p class="title"><b>ИЗВЕСТНЫЕ ПРОБЛЕМЫ И СПОСОБЫ ИХ РЕШЕНИЯ</b></p><ul class="itemizedlist" type="disc" compact><li class="listitem"><p>
  Если вы установили <span class="bold"><strong>NLS</strong></span> шрифт на вашем
  Linux и запускаете VESA драйвер из текстового режима, то после завершения
  <span class="application">MPlayer</span> у вас окажется загруженным
  <span class="bold"><strong>ROM шрифт</strong></span> вместо национального.
  Вы можете загрузить национальный шрифт снова, воспользовавшись утилитой
  <span class="command"><strong>setsysfont</strong></span> из дистрибутива Mandrake/Mandriva, например.
  (<span class="bold"><strong>Подсказка</strong></span>: Та же утилита используется для
  локализации fbdev).
</p></li><li class="listitem"><p>
  Некоторые <span class="bold"><strong>графические драйверы Linux</strong></span> не обновляют
  активный <span class="bold"><strong>BIOS режим</strong></span> в DOS памяти.
  Таким образом, если у вас подобная проблема - всегда используете VESA драйвер
  только из <span class="bold"><strong>текстового режима</strong></span>. Иначе в любом случае будет
  активирован текстовый режим (#03) и вам придется перезагружать компьютер..
</p></li><li class="listitem"><p>
  Часто после завершения работы  VESA драйвера вы получаете
  <span class="bold"><strong>черный</strong></span> экран. Чтобы вернуться в обычный режим
  просто переключитесь на другую консоль (нажав
  <span class="keycap"><b>Alt</b></span>+<span class="keycap"><b>F&lt;x&gt;</b></span>)
  затем переключитесь обратно тем же способом.
</p></li><li class="listitem"><p>
  Для получения <span class="bold"><strong>работающего TV выхода</strong></span> необходимо,
  чтобы TV разъем был подключен до включения вашего PC, т.к. видео BIOS
  инициализирует себя только один раз во время POST процедуры.
</p></li></ul></div></div><div class="sect1" title="7.14. X11"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="x11"></a>7.14. X11</h2></div></div></div><p>
Избегайте, если возможно. Вывод в X11 (используя расширение разделяемой памяти) -
без какого-либо ускорения.Поддерживается (MMX/3DNow/SSE ускоренное, но все равно
медленное) программное масштабирование, используйте опции <tt class="option">-fs -zoom</tt>.
Большинство карт имеют поддержку масштабирования,  для этого используйте вывод
<tt class="option">-vo xv</tt>, или <tt class="option">-vo xmga</tt> для карт Matrox.
</p><p>
Проблема в том, что большинство драйверов карт не поддерживают аппаратное
ускорение на втором мониторе/TV. В этом случае вы увидите окно зеленого/синего
цвета вместо изображения, и этот драйвер будет полезным,
но требуется мощный CPU для программного масштабирования. Не используйте
программный вывод+масштабирование SDL драйвера, он имеет худшее качество
картинки!
</p><p>
Программное масштабирование очень медленное, лучше попробуйте вместо этого
изменить видео режим. Это очень просто. Смотрите <a class="link" href="#dga-modelines" title="ПЕРЕКЛЮЧЕНИЕ РЕЖИМОВ">раздел DGA
режимы</a> и вставьте соответствующие строки в ваш <tt class="filename">XF86Config</tt>.

</p><div class="itemizedlist"><ul class="itemizedlist" type="disc" compact><li class="listitem"><p>
  Если у вас XFree86 4.x.x: используйте <tt class="option">-vm</tt> опцию. Она
  переключится в режим с подходящим разрешением. Если нет:
</p></li><li class="listitem"><p>
  C XFree86 3.x.x: циклически переключайтесь между разными разрешениями с помощью
  клавиш
  <span class="keycap"><b>Ctrl</b></span>+<span class="keycap"><b>Alt</b></span>+<span class="keycap"><b>Доп. клавиша
  плюс</b></span>
  и
  <span class="keycap"><b>Ctrl</b></span>+<span class="keycap"><b>Alt</b></span>+<span class="keycap"><b>Доп. клавиша
  минус</b></span>.
</p></li></ul></div><p>
</p><p>
Если не находите вставленные видео режимамы, просмотрите  вывод Xfree86.
Некоторые драйверы не могут использовать низкие частоты пикселизации (количество
отрисовываемых пикселей в секунду), необходимые для видео режимов с низким разрешением.
</p></div><div class="sect1" title="7.15. VIDIX"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="vidix"></a>7.15. VIDIX</h2></div></div></div><p title="ПРЕАМБУЛА"><b>ПРЕАМБУЛА. </b>
<acronym class="acronym">VIDIX</acronym> - это аббревиатура для
<span class="bold"><strong>VID</strong></span>eo
<span class="bold"><strong>I</strong></span>nterface
for *ni<span class="bold"><strong>X</strong></span>
(Видео интерфейс для Unix).
VIDIX разработан и введен как интерфейс для быстрых драйверов пространства
пользователя[user-space], обеспечивающих такую же производительность, как mga_vid
для карт Matrox. Они к тому же хорошо переносимы.
</p><p>
Этот интерфейс был разработан, чтобы уместить существующие интерфейсы ускорения видео
(известные как mga_vid, rage128_vid, radeon_vid, pm3_vid) в единую схему.
Он предоставляет высокоуровневый интерфейс к чипам, известным как
BES (BackEnd scalers) или OV (Video Overlays). Он не предоставляет низкоуровневого интерфейса
к вещам, известным как графические серверы (Я не хочу соревноваться с командой X11
в переключении режимов.) Т.е. основная цель интерфейса - ускорить до максимума
скорость воспроизведения видео.
</p><div class="itemizedlist" title="ИСПОЛЬЗОВАНИЕ"><p class="title"><b>ИСПОЛЬЗОВАНИЕ</b></p><ul class="itemizedlist" type="disc" compact><li class="listitem"><p>
  Вы можете использовать отдельный видеодрайвер: <tt class="option">-vo xvidix</tt>.
  Этот драйвер был разработан как X11 фронтенд к VIDIX технологии. Он
  требует X сервер и может работать только под ним.  Имейте ввиду, что
  поскольку этот драйвер напрямую обращается к оборудованию в обход драйвера X,
  то могут быть повреждены растровые изображения, кешированные в памяти
  видеокарты.
  Вы можете предотвратить это, ограничив размер видеопамяти, используемой X,
  XF86Config опцией "VideoRam" в разделе устройств. Вам следует установить этот
  параметр в количество установленной видеопамяти минус 4Мб. Если у вас меньше
  8Мб видеопамяти, вместо этого можно использовать опцию "XaaNoPixmapCache" в
  разделе экранов.
</p></li><li class="listitem"><p>
  Существует консольный VIDIX драйвер: <tt class="option">-vo cvidix</tt>.
  Для большинства карт требуется работающий и инициализированный фреймбуфер
  (в противном случае просто испортите изображение на экране),
  и вы будете иметь тот же эффект, что и с <tt class="option">-vo mga</tt> или
  <tt class="option">-vo fbdev</tt>. Карты nVidia, тем не менее, способны выводить
  полностью графическое видео в настоящей текстовой консоли. Смотрите раздел
  <a class="link" href="#vidix-nvidia" title="7.15.5. nVidia карты">nvidia_vid</a> для более подробной информации.
  Чтобы избавиться от такста на полях и мерцающего курсора попробуйте нечто подобное
  </p><pre class="screen">setterm -cursor off &gt; /dev/tty9</pre><p>
  (предполагая, что <code class="systemitem">tty9</code> ранее не использовался) и затем переключитесь
  на <code class="systemitem">tty9</code>.
  С другой стороны, <tt class="option">-colorkey 0</tt> должна дать вам видео, работающее "на фоне",
  однако правильность работы этого зависит от функцинальности colorkey.
  </p></li><li class="listitem"><p>
  Вы можете использовать подустройство VIDIX, примененное к различным
  драйверам видео вывода, например: <tt class="option">-vo vesa:vidix</tt>
  (<span class="bold"><strong>только Linux</strong></span>) и
  <tt class="option">-vo fbdev:vidix</tt>.
</p></li></ul></div><p>
Это действительно неважно, какой драйвер вывода видео используется с
<span class="bold"><strong>VIDIX</strong></span>.
</p><div class="itemizedlist" title="ТРЕБОВАНИЯ"><p class="title"><b>ТРЕБОВАНИЯ</b></p><ul class="itemizedlist" type="disc" compact><li class="listitem"><p>
  Видеокарта должна находиться в графическом режиме (кроме карт nVidia с
  драйвером <tt class="option">-vo cvidix</tt>).
</p></li><li class="listitem"><p>
  Драйвер вывода видео <span class="application">MPlayer</span> должен знать
  текущий видеорежим и быть способным сообщить VIDIX некоторые видео характеристики сервера.
</p></li></ul></div><p title="СПОСОБЫ ИСПОЛЬЗОВАНИЯ"><b>СПОСОБЫ ИСПОЛЬЗОВАНИЯ. </b>
Когда VIDIX используется в качестве <span class="bold"><strong>подустройства</strong></span> (<tt class="option">-vo
vesa:vidix</tt>), настройка видеорежима производится драйвером вывода видео
(короче говоря <span class="bold"><strong>vo_server</strong></span>). Следовательно, вы можете
передать в командную строку <span class="application">MPlayer</span> те же ключи, что и для
vo_server. Дополнительно он понимает ключ <tt class="option">-double</tt>
как глобально видимый параметр. (Я рекомендую использовать этот ключ с VIDIX как минимум
для карт ATI). <tt class="option">-vo xvidix</tt> дополнительно понимает следующие опции:
<tt class="option">-fs -zoom -x -y -double</tt>.
</p><p>
Вы можете напрямую указать  VIDIX драйвер третьим параметром к командной строке:
</p><pre class="screen">
mplayer -vo xvidix:mga_vid.so -fs -zoom -double <em class="replaceable"><code>file.avi</code></em>
</pre><p>
или
</p><pre class="screen">
mplayer -vo vesa:vidix:radeon_vid.so -fs -zoom -double -bpp 32 <em class="replaceable"><code>file.avi</code></em>
</pre><p>
Но это опасно, и вам не следует этого делать. В этом случае принудительно
запускается указанный драйвер и результат может быть непредсказуемым
(он может <span class="bold"><strong>подвесить</strong></span> ваш компьютер).
Вам следует это делать ТОЛЬКО если вы абсолютно уверены, что он работает и
<span class="application">MPlayer</span> не использует его автоматически.
Пожалуйста, сообщите об этом разработчикам. Правильный путь - использование
VIDIX без аргументов для задействования автоопределения драйвера.
</p><p>
Поскольку VIDIX требует прямой доступ к оборудованию, вы можете либо
запускать его от имени root, либо установить SUID бит на исполняемый файл
<span class="application">MPlayer</span> ((<span class="bold"><strong>Внимание:
Это большой риск безопасности</strong></span>).
Как вариант, вы можете использовать специальный модуль ядра, как этот:
</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Шаг 1"><p>

  Скачайте <a class="ulink" href="http://www.arava.co.il/matan/svgalib/" target="_top">разрабатываемую версию</a>
  svgalib (например 1.9.17), <span class="bold"><strong>ИЛИ</strong></span>
  версию, созданную Alex специально для использования с <span class="application">MPlayer</span>
  (она не требует наличия исходников svgalib для компиляции)
  <a class="ulink" href="http://www.mplayerhq.hu/MPlayer/contrib/svgalib/svgalib_helper-1.9.17-mplayer.tar.bz2" target="_top">отсюда</a>.
</p></li><li class="step" title="Шаг 2"><p>
  Скомпилируйте модуль в каталоге <tt class="filename">svgalib_helper</tt>
  (он может быть найден внутри каталога
  <tt class="filename">svgalib-1.9.17/kernel/</tt>, если вы скачали исходники
  с сайта svgalib) и выполните insmod для него.
</p></li><li class="step" title="Шаг 3"><p>
  Для создания необходимых устройств в каталоге <tt class="filename">/dev</tt>,
  выполните от имени root команду </p><pre class="screen">make device</pre><p> в
  <tt class="filename">svgalib_helper</tt>.
</p></li><li class="step" title="Шаг 4"><p>
  Переместите каталог <tt class="filename">svgalib_helper</tt> в
  подкаталог <tt class="filename">vidix</tt> дерева исходных текстов
  <span class="application">MPlayer</span>.
</p></li><li class="step" title="Шаг 5"><p>
  Удалите комментарий перед строкой CFLAGS, содержащий строку "svgalib_helper"
  в файле <tt class="filename">vidix/Makefile</tt>.
</p></li><li class="step" title="Шаг 6"><p>
  Перекомпилируйте.
  </p></li></ol></div><div class="sect2" title="7.15.1. ATI карты"><div class="titlepage"><div><div><h3 class="title"><a name="vidix-ati"></a>7.15.1. ATI карты</h3></div></div></div><p>
В даный момент для большинства карт ATI, начиная от Mach64 и заканчивая последними
Radeon, имеется встроенная поддержка.
</p><p>
Существует два скомпилрованных бинарных файла: <tt class="filename">radeon_vid</tt> для
Radeon и <tt class="filename">rage128_vid</tt> для карт Rage 128. Вы можете принудительно
использовать один из них или позволить VIDIX автоматически опробовать все доступные
драйверы.
</p></div><div class="sect2" title="7.15.2. Matrox карты"><div class="titlepage"><div><div><h3 class="title"><a name="vidix-mga"></a>7.15.2. Matrox карты</h3></div></div></div><p>
Сообщалось, что работают Matrox G200, G400, G450 и G550.
</p><p>

Драйвер поддерживает видео эквалайзеры и должем быть столь же быстр, как и
<a class="link" href="#mga_vid" title="7.7. Matrox фреймбуфер (mga_vid)">Matrox фреймбуфер</a>
</p></div><div class="sect2" title="7.15.3. Trident карты"><div class="titlepage"><div><div><h3 class="title"><a name="vidix-trident"></a>7.15.3. Trident карты</h3></div></div></div><p>
Существует драйвер для чипсета Trident Cyberblade/i1, который можно найти
на материнских платах VIA Epia.
</p><p>
Драйвер написан и поддерживается
<a class="ulink" href="http://www.blackfiveservices.co.uk/EPIAVidix.shtml" target="_top">Alastair M. Robinson</a>.
</p></div><div class="sect2" title="7.15.4. 3DLabs карты"><div class="titlepage"><div><div><h3 class="title"><a name="vidix-3dlabs"></a>7.15.4. 3DLabs карты</h3></div></div></div><p>
Хотя драйвер для чипов 3DLabs GLINT R3 и Permedia3 существует, никто его не
тестировал, так что отчеты приветствуются.
</p></div><div class="sect2" title="7.15.5. nVidia карты"><div class="titlepage"><div><div><h3 class="title"><a name="vidix-nvidia"></a>7.15.5. nVidia карты</h3></div></div></div><p>
Уникальная особенность драйвера nvidia_vid заключается в способности отображать
видео в <span class="bold"><strong>простой, чисто текстовой консоли</strong></span> - без
какого бы то ни было фреймбуфера или магии с X. Для этой цели мы будем использовать
драйвер вывода видео <tt class="option">cvidix</tt>, как показывет следующий пример:
</p><pre class="screen">mplayer -vo cvidix <em class="replaceable"><code>example.avi</code></em></pre><p>
</p></div><div class="sect2" title="7.15.6. SiS карты"><div class="titlepage"><div><div><h3 class="title"><a name="vidix-sis"></a>7.15.6. SiS карты</h3></div></div></div><p>
Это, как и nvidia_vid, весьма экспериментальный код.
</p><p>
Он тестировался на SiS 650/651/740 (наиболее распространный чипсет, используемый в
SiS версиях байрбонов[barebones] "Shuttle XPC")
</p><p>
Отчеты ожидаются!
</p></div></div><div class="sect1" title="7.16. DirectFB"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="directfb"></a>7.16. DirectFB</h2></div></div></div><div class="blockquote"><blockquote class="blockquote"><p>
"DirectFB - это графическая библиотека, которая была разработана с учетом
особенностей встроенных систем. Она предоставляет максимум производительности
при минимуме используемых ресурсов и накладных расходов." -
процитировано с <a class="ulink" href="http://www.directfb.org" target="_top">http://www.directfb.org</a>
</p></blockquote></div><p>Я исключу описание возможностей DirectFB из этого раздела.</p><p>
Несмотря на то, что <span class="application">MPlayer</span> не поддерживается в DirectFB
как "video провайдер", этот драйвер вывода видео задействует воспроизведение
видео через DirectFB. Он будет - конечно - работать с ускорением, на моей Matrox G400
скорость DirectFB такая же как у XVideo.
</p><p>
Всегда старайтесь использовать последнюю версию DirectFB. Вы можете использовать опции
DirectFB в командной строке, при помощи <tt class="option">-dfbopts</tt>. Выбор слоя
производится методом подустройства, например.: <tt class="option">-vo directfb:2</tt>
(по-умолчанию -1: автоопределение)
</p></div><div class="sect1" title="7.17. DirectFB/Matrox (dfbmga)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dfbmga"></a>7.17. DirectFB/Matrox (dfbmga)</h2></div></div></div><p>
Прочтите <a class="link" href="#directfb" title="7.16. DirectFB">основной DirectFB</a> раздел для общей информации.
</p><p>
Этот драйвер вывода видео задействует CRTC2 (на втором мониторе[second head]) на картах
Matrox G400/G450/G550, отображающий видео
<span class="bold"><strong>независимо</strong></span> от первого монитора[first head].
</p><p>
Ville Syrjala имеет
<a class="ulink" href="http://www.sci.fi/~syrjala/directfb/Matrox_TV-out_README.txt" target="_top">README</a>
и
<a class="ulink" href="http://www.sci.fi/~syrjala/directfb/matrox-tv-out-howto" target="_top">HOWTO</a>
на своей странице, описывающие как задействовать вывод DirectFB TV на картах Matrox.
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
Первая версия DirectFB, на которой удалось это сделать, была
0.9.17 (имеющая ошибки, требует <code class="systemitem">surfacemanager</code>
патч с указанного выше URL). Портирование кода CRTC2 в
<a class="link" href="#mga_vid" title="7.7. Matrox фреймбуфер (mga_vid)">mga_vid</a> планируется уже несколько лет,
<a class="ulink" href="../../tech/patches.txt" target="_top">патчи</a> приветствуются.
</p></div></div><div class="sect1" title="7.18. MPEG декодеры"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mpeg_decoders"></a>7.18. MPEG декодеры</h2></div></div></div><div class="sect2" title="7.18.1. DVB ввод и вывод"><div class="titlepage"><div><div><h3 class="title"><a name="dvb"></a>7.18.1. DVB ввод и вывод</h3></div></div></div><p>
<span class="application">MPlayer</span> поддерживает карты с чипсетом Siemens DVB и
таких производителей, как Siemens, Technotrend, Galaxis или Hauppauge.
Последние DVB драйверы доступны с <a class="ulink" href="http://www.linuxtv.org" target="_top">сайта Linux TV</a>.
Если вы собираетесь делать программное транскодирование, у вас должен быть как минимум 1ГГц CPU.
</p><p>
Скрипт configure должен определить вашу DVB карту. Если нет, принудительно укажите
определение с помошью
</p><pre class="screen">./configure --enable-dvb</pre><p>
Если заголовочные файлы ost находятся не в стандартных каталогах, укажите путь с
</p><pre class="screen">
./configure --with-extraincdir=<em class="replaceable"><code>каталог исходников DVB</code></em>/ost/include
</pre><p>
Затем компилируйте и устанавливайте как обычно.
</p><p title="ИСПОЛЬЗОВАНИЕ"><b>ИСПОЛЬЗОВАНИЕ. </b>
Аппаратное декодирование потоков, содержащих MPEG-1/2 видео и/или MPEG аудио, может быть
выполнено следующей командой:
</p><pre class="screen">mplayer -ao mpegpes -vo mpegpes <em class="replaceable"><code>file.mpg|vob</code></em></pre><p title="ИСПОЛЬЗОВАНИЕ">
</p><p>
Декодирование любых других видео потоков требует транскодирования в MPEG-1,
поэтому оно медленно и, возможно, не стоит неприятностей, особенно если ваш
компьютер медленный.
Его можно добиться, используя команду:
</p><pre class="screen">
mplayer -ao mpegpes -vo mpegpes <em class="replaceable"><code>yourfile.ext</code></em>
mplayer -ao mpegpes -vo mpegpes -vf expand <em class="replaceable"><code>yourfile.ext</code></em>
</pre><p>
Имейте в виду, что DVB карты поддерживают высоту изображения только 288 и 576 для PAL и
240 и 480 для NTSC. Для других значений высоты вы <span class="bold"><strong>должны</strong></span>
отмасштабировать изображение, добавив <tt class="option">scale=ширина:высота</tt> к опции
<tt class="option">-vf</tt> с желаемыми значениями ширины и высоты.
DVB карты допускают различные значения ширины: 720, 704, 640, 512, 480, 352 и т.д. и
производят аппаратное масштабирование по горизонтали, так что в большинстве случаев
масштабировать по горизонтали не нужно. Для 512x384 (пропорции 4:3) MPEG-4 (DivX)
попробуйте:
</p><p>Если у вас есть широкоформатный фильм и вы не хотите растягивать его на
полную высоту, используйте плагин <tt class="option">expand=w:h</tt> для добавления черных
полос. Чтобы посмотреть 640x384 MPEG-4 (DivX), попробуйте:
</p><pre class="screen">
mplayer -ao mpegpes -vo mpegpes -vf expand=640:576 <em class="replaceable"><code>file.avi</code></em>
</pre><p>
</p><p>
Если ваш CPU слишком слаб для полноразмерного 720x576 MPEG-4 (DivX), попробуйте уменьшить
размер:
</p><pre class="screen">mplayer -ao mpegpes -vo mpegpes -vf scale=352:576 <em class="replaceable"><code>file.avi</code></em>
</pre><p>
</p><p>Если скорость не увеличилась, попробуйте уменьшить размер по вертикали тоже:
</p><pre class="screen">
mplayer -ao mpegpes -vo mpegpes -vf scale=352:288 <em class="replaceable"><code>file.avi</code></em>
</pre><p>
</p><p>
Для OSD и субтитров используйте возможности OSD плагина expand. Так, вместо
<tt class="option">expand=w:h</tt> или <tt class="option">expand=w:h:x:y</tt>, используйте
<tt class="option">expand=w:h:x:y:1</tt> (5-й параметр <tt class="option">:1</tt> в конце для
включения OSD рендеринга). Вы можете слегка подвинуть изображение вверх, чтобы получить
большую черную область для субтитров. Вы также можете переместить субтитры вверх, если
они выходят за пределы TV экрана, используйте для этого <tt class="option">-subpos &lt;0-100&gt;</tt>
(<tt class="option">-subpos 80</tt> - хороший выбор).
</p><p>
Чтобы воспроизвести не-25fps фильмы на PAL TV или на машине со слабым CPU, добавьте опцию

<tt class="option">-framedrop</tt>.
</p><p>
Для сохранения пропорций MPEG-4 (DivX) файлов и получения оптимальных параметров
масштабирования (аппаратное горизонтальное и программное вертикальное масштабирование с
сохранением пропорций), используйте плагин dvbscale:
</p><pre class="screen">
for a  4:3 TV: -vf dvbscale,scale=-1:0,expand=-1:576:-1:-1:1
for a 16:9 TV: -vf dvbscale=1024,scale=-1:0,expand=-1:576:-1:-1:1
</pre><p>
</p><p title="Цифровое TV (DVB драйвер ввода )"><b>Цифровое TV (DVB драйвер ввода ). </b>Вы можете использовать DVB карту для просмотра Цифрового TV.</p><p>
Вы должны иметь установленные программы <span class="command"><strong>scan</strong></span> и
<span class="command"><strong>szap/tzap/czap/azap</strong></span>; все они входят в пакет драйверов.
</p><p>
Проверьте, что ваши драйверы правильно работают с такими программами, как
<a class="ulink" href="http://sf.net/projects/dvbtools/" target="_top"><span class="command"><strong>dvbstream</strong></span></a>
(это основа DVB драйвера ввода).
</p><p>
Теперь вам следует создать файл <tt class="filename">~/.mplayer/channels.conf</tt>,
с понятным <span class="command"><strong>szap/tzap/czap/azap</strong></span> синтаксисом, или
позволить <span class="command"><strong>scan</strong></span> сделать это для вас.
</p><p>
Если у вас несколько разнотипных карт (например, для спутникового TV, наземного ,
кабельного и ATSC), можете сохранить файлы как
<tt class="filename">~/.mplayer/channels.conf.sat</tt>,
<tt class="filename">~/.mplayer/channels.conf.ter</tt>,
<tt class="filename">~/.mplayer/channels.conf.cbl</tt>,
и <tt class="filename">~/.mplayer/channels.conf.atsc</tt>,
соответственно, с тем, чтобы можно было явно указать <span class="application">MPlayer</span>
какой файл использовать вместо стандартного <tt class="filename">~/.mplayer/channels.conf</tt>,
и какую карту с ним использовать.
</p><p>
Убедитесь, что в <tt class="filename">channels.conf</tt> находятся каналы
!-- FIXME Free to Air --&gt;
<span class="emphasis"><em>только</em></span> для обычного телевидения[Free to Air], иначе
<span class="application">MPlayer</span> будет ожидать передачи незашифрованных данных.
</p><p>
В полях аудио и видео вы можете использовать расширенный синтаксис:
<tt class="option">...:pid[+pid]:...</tt> (в каждом максимум  6 pid'ов);
в этом случае <span class="application">MPlayer</span> включит в поток все указанные
pid плюс pid 0 (содержащий PAT). В каждую строку всегда следует включать
PMT и PCR pid'ы для соответствующего канала (если вы их знаете).
Также можно указать 8192, при этом будут выбраны все pid на этой частоте, и Вы сможете
потом переключаться между программами при помощи TAB.
Это может потребовать большей пропускной способности, однако дешевые карты
всегда пересылают все каналы как минимум до ядра, так что в этом случае разница
будет небольшой.
Другие возможные применения: телетекст pid, второая аудио дорожка, и т.д.
</p><p>
Если <span class="application">MPlayer</span> часто жалуется на
</p><pre class="screen">Too many video/audio packets in the buffer</pre><p> или
если вы заметили растущую рассинхронизацию между звуком и видео
проверьте наличие PCR pid'а в вашем потоке (требующегося для
соблюдения модели буферизации передатчика) и/или
попробуйте воспользоваться libavformat MPEG-TS декодером, добавив
<tt class="option">-demuxer lavf -lavfdopts probesize=128</tt> в
командную строку.
</p><p>
Для показа первого из доступных каналов, запустите
</p><pre class="screen">mplayer dvb://</pre><p>
</p><p>
Если вы хотите посмотреть определенный канал, например R1, запустите
</p><pre class="screen">mplayer dvb://R1</pre><p>
</p><p>
Если у вас больше одной карты, также надо указать номер той, с которой доступен канал:
</p><pre class="screen">mplayer dvb://2@R1</pre><p>
</p><p>
Для смены канала, нажимайте клавиши <span class="keycap"><b>h</b></span> (следующий) и
<span class="keycap"><b>k</b></span> (предыдущий), или используйте
<a class="link" href="#osdmenu" title="2.4.3. OSD меню">OSD меню</a>.
</p><p>
Для временного отключения аудио или видео потока скопируйте
следующие строки в <tt class="filename">~/.mplayer/input.conf</tt>:
</p><pre class="screen">
% set_property  switch_video -2
&amp; step_property switch_video
? set_property  switch_audio -2
^ step_property switch_audio
</pre><p>
(Заменяя горячие клавиши по своему усмотрению.) При нажатии на клавишу,
соответствующую switch_x -2, поток будет закрыт;
при нажатии на клавишу, соответствующую step_x, поток будет открыт снова.
Имейте в виду, что этот механизм переключения не будет работать как следует,
когда в мультиплексоре присутствует несколько аудио или видео потоков.
</p><p>
Во время воспроизведения (не во время записи) для предотвращения заикания
и таких ошибок, как 'Your system is too slow', имеет смысл добавить
</p><pre class="screen">
-mc 10 -speed 0.97 -af scaletempo
</pre><p>
к опциям командной строки, исправив параметры scaletempo по своему усмотрению.
</p><p>
Если ваш <tt class="filename">~/.mplayer/menu.conf</tt> содержит запись
<code class="literal">&lt;dvbsel&gt;</code>, как в файле с примерами
<tt class="filename">etc/dvb-menu.conf</tt> (можете использовать его чтобы
перезаписать <tt class="filename">~/.mplayer/menu.conf</tt>), главное меню
будет отображать подменю, позволяющее вам выбрать один из присутствующих
в <tt class="filename">channels.conf</tt> каналов, возможно, с предшествующим
ему подменю с DVB выбором карт, доступных <span class="application">MPlayer</span>.
</p><p>
Если хотите записать какую-то программу на диск, используйте
</p><pre class="screen">mplayer -dumpfile r1.ts -dumpstream dvb://R1</pre><p>
</p><p>
Если хотите вместо этого записать ее в другом формате (перекодировать), следует
использовать такую команду:
</p><pre class="screen">
mencoder -o <em class="replaceable"><code>r1.avi</code></em> -ovc xvid -xvidencopts bitrate=800 \
    -oac mp3lame -lameopts cbr:br=128 -pp=ci dvb://R1
</pre><p>
</p><p>
Полный список опций для DVB драйвера ввода можно найти на странице руководства man.
</p><p title="БУДУЩЕЕ"><b>БУДУЩЕЕ. </b>
Если у вас есть вопросы, или вы хотите получать сообщения о новых возможностях и
принять участие в дискуссиях на эту тему, подпишитесь на список рассылки
<a class="ulink" href="http://lists.mplayerhq.hu/mailman/listinfo/mplayer-dvb" target="_top">MPlayer-DVB</a>.
Помните, что язык рассылки - Английский.
</p><p>
В будущем вы можете рассчитывать на возможность отображения OSD и субтитров,
используя встроенные OSD возможности DVB карт.
</p></div><div class="sect2" title="7.18.2. DXR2"><div class="titlepage"><div><div><h3 class="title"><a name="dxr2"></a>7.18.2. DXR2</h3></div></div></div><p>
<span class="application">MPlayer</span> поддерживает аппаратное ускорение воспроизведения
с картами Creative DXR2.
</p><p>
Прежде всего вам потребуется правильно установленные DXR2 драйверы. Их и руководство по
установке можно найти на сайте <a class="ulink" href="http://dxr2.sf.net/" target="_top">Ресурсного Центра DXR2</a>.
</p><div class="variablelist" title="ИСПОЛЬЗОВАНИЕ"><p class="title"><b>ИСПОЛЬЗОВАНИЕ</b></p><dl><dt><span class="term"><tt class="option">-vo dxr2</tt></span></dt><dd><p>Включить TV выход.</p></dd><dt><span class="term"><tt class="option">-vo dxr2:x11</tt> or <tt class="option">-vo dxr2:xv</tt></span></dt><dd><p>Включить вывод через оверлей в X11.</p></dd><dt><span class="term"><tt class="option">-dxr2 &lt;option1:option2:...&gt;</tt></span></dt><dd><p>Эта опция используется для управления драйвером DXR2.</p></dd></dl></div><p>
Чипсет оверлея, использовавшийся на DXR2 довольно плохого качества, но
с настройками по-умолчанию будет работать у всех. OSD может работать
с оверлеем (не на TV), отрисовывая себя в ключевом цвете[colorkey].
С настройками ключевого цвета[colorkey] по-умолчанию, вы можете получить
разные результаты, скорее всего увидите ключевой цвет[colorkey] вокруг
символов или другие забавные эффекты. Но при правильных настройках,
можно получить вполне приемлемый результат.
</p><p>Смотрите страницу man руководства для списка доступных опций.</p></div><div class="sect2" title="7.18.3. DXR3/Hollywood+"><div class="titlepage"><div><div><h3 class="title"><a name="dxr3"></a>7.18.3. DXR3/Hollywood+</h3></div></div></div><p>
<span class="application">MPlayer</span> поддерживает аппаратно ускоренное воспроизведение
картами Creative DXR3 и Sigma Designs Hollywood Plus. Обе эти карты используют
MPEG декодер на чипе em8300 от Sigma Designs
</p><p>
Прежде всего вам потребуются правильно установленные драйвера DXR3/H+, версии
0.12.0 или выше. Драйверы и инструкции по установке могут быть найдены на
сайте <a class="ulink" href="http://dxr3.sf.net/" target="_top">DXR3 &amp; Hollywood Plus для Linux</a>
<tt class="filename">configure</tt> должен автоматически определить вашу карту,
компиляция должна пройти без проблем.
</p><div class="variablelist" title="ИСПОЛЬЗОВАНИЕ"><p class="title"><b>ИСПОЛЬЗОВАНИЕ</b></p><dl><dt><span class="term"><tt class="option">-vo dxr3:prebuf:sync:norm=x:<em class="replaceable"><code>device</code></em></tt></span></dt><dd><p>
Опция <tt class="option">overlay</tt> активирует оверлей вместо TV-out. Для корректной работы
она требует его правильной настройки. Самый простой способ правильно его
настроить - сначала запустить autocal, затем запустить mplayer с драйвером
dxr3 и выключенным оверлеем, потом запустить dxr3view. В dxr3view вы можете
менять настройки оверлея и видеть результат в реальном времени, может быть,
в будущем эта возможность будет поддерживаться в <span class="application">MPlayer</span>
GUI. После того как оверлей правильно настроен, надобность в dxr3view отпадает.
Опция <tt class="option">prebuf</tt> включает пребуферинг. Пребуферинг - это возможность
чипа em8300, позволяющая ему хранить более одного кадра видео в каждый момент времени.
Это значит, что при включенном пребуферинге <span class="application">MPlayer</span>
будет пытаться всегда держать буфер заполненным данными. Если у вас медленная машина,
то <span class="application">MPlayer</span> будет забирать практически 100% CPU.
Это особенно часто случается, если вы воспроизводите чистые MPEG потоки
(DVD, SVCD и т.д.), т.к., поскольку <span class="application">MPlayer</span> не должен
перекодировать их в MPEG, то он заполняет буфер очень быстро.
С пребуферингом воспроизведение видео <span class="bold"><strong>значительно</strong></span>
меньше зависит от остальных программ, прибирающих к рукам CPU, он не будет
терять кадры, кроме случая, когда приложения захватит CPU на довольно длительное
время. При запуске без пребуферинга, em8300 намного более чувствителен к
загрузке CPU, так что настоятельно рекомендуется включить <tt class="option">-framedrop</tt>
опцию <span class="application">MPlayer</span> для избежания потери синхронизации.
<tt class="option">sync</tt> включит алгоритм синхронизации. Пока что это еще
экспериментальная возможность. С включенной sync возможностью будут постоянно
проверяться встроенные часы em8300, и если начинается отклонение от
часов <span class="application">MPlayer</span> чип будет сброшен, что приведет к
пропуску всех запаздывающих кадров.
</p><p>
<tt class="option">norm=x</tt> установит TV стандарт DXR3 карты без необходимости
использования внешних утилит вроде em8300setup. Допустимые стандарты: 5 = NTSC, 4 = PAL-60,
3 = PAL. Специальные стандарты 2 (автонастройка, используя  PAL/PAL-60) и 1 (автонастройка
используя PAL/NTSC) решают какой стандарт использовать на основе частоты кадров.
because they decide which norm to use by looking at the frame
rate of the movie. norm = 0 (по-умолчанию) не изменяет текущий стандарт.
</p><p>
<tt class="option"><em class="replaceable"><code>device</code></em></tt> = номер устройства, если их у вас несколько
em8300 карт.
Любые из этих опций могут быть опущены.
</p><p>
<tt class="option">:prebuf:sync</tt>, похоже, отлично работает при воспроизведении фильмов MPEG-4 (DivX).
Пользователи сообщали о проблемах при использования prebuf опции при воспроизведении
файлов MPEG-1/2. Вы можете попробовать запустить программу сначала вообще без указания опций,
если же имеете проблемы с синхронизацией или с DVD субтитрами, попытайтесь с <tt class="option">:sync</tt>.
</p></dd><dt><span class="term"><tt class="option">-ao oss:/dev/em8300_ma-<em class="replaceable"><code>X</code></em></tt></span></dt><dd><p>
  Для вывода звука, где <em class="replaceable"><code>X</code></em> - номер устройства (0, если карта одна).
  </p></dd><dt><span class="term"><tt class="option">-af resample=<em class="replaceable"><code>xxxxx</code></em></tt></span></dt><dd><p>
  em8300 не может воспроизводить частоты дискретизации ниже 44100Hz. Если частота
  ниже 44100Hz, выберите либо 44100Hz, либо 48000Hz в зависимости от
  того, какая частота ближайшая. Т.е. если фильм использует 22050Hz укажите 44100Hz, т.к.
  44100 / 2 = 22050, если 24000Hz, используйте 48000Hz, т.к. 48000 / 2 = 24000 и т.д.
  Это не работает с цифровым выводом звука (<tt class="option">-ac hwac3</tt>).
  </p></dd><dt><span class="term"><tt class="option">-vf lavc</tt></span></dt><dd><p>
  Для просмотра не-MPEG контента на em8300 (напрмер MPEG-4 (DivX) или RealVideo)
  вы должны указать MPEG-1 видеоплагин, такой как
  <code class="systemitem">libavcodec</code> (lavc).
  Дополнительную информацию о <tt class="option">-vf lavc</tt> смотрите на странице
  руководства man. На данный момент неизвестно способа установить
  значение fps для em8300, что означает фиксированную величину, равную 30000/1001 fps,
  поэтому крайне рекомендуется использовать
  <tt class="option">-vf lavc=<em class="replaceable"><code>quality</code></em>:25</tt>, особенно, если
  используете пребуферинг. Почему 25, а не 30000/1001? Ну, причина в том, что при
  использовании 30000/1001 изображение начинает слегка дрожать. Причина нам неизвестна.
  Если вы ставите это значение где-то между 25 и 27 картинка стабилизируется.
  Пока что мы можем только принять это как факт
  </p></dd><dt><span class="term"><tt class="option">-vf expand=-1:-1:-1:-1:1</tt></span></dt><dd><p>
  Хотя драйвер DXR3 может помещать некоторый OSD в  MPEG-1/2/4 видео, он
  имеет намного более плохое качество, чем традиционный OSD
  <span class="application">MPlayer</span>, и имеет несколько проблем при обновлении к
  тому же. Команда, указанная выше, сначала отконвертирует входное видео в
  MPEG-4 (это обязательно, извините), затем применит плагин expand, который не будет
  ничего расширять (-1: по-умоляанию), но наложит нормальное OSD на картинку
  (это все, что делает "1" в конце строки).
  </p></dd><dt><span class="term"><tt class="option">-ac hwac3</tt></span></dt><dd><p>
  em8300 поддерживает воспроизведение звука AC-3 (окружающий звук) через
  цифровой аудио выход карты.Смотрите опцию <tt class="option">-ao oss</tt> выше,
  она должна использоваться для указания вывода через DXR3 вместо звуковой карты.
  </p></dd></dl></div></div></div><div class="sect1" title="7.19. Другое оборудование вывода видео"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="other"></a>7.19. Другое оборудование вывода видео</h2></div></div></div><div class="sect2" title="7.19.1. Zr"><div class="titlepage"><div><div><h3 class="title"><a name="zr"></a>7.19.1. Zr</h3></div></div></div><p>
Это видеодрайвер (<tt class="option">-vo zr</tt>) для некоторого количества MJPEG карт
захвата/воспроизведения (тестировался на DC10+ и Buz, но также должен работать для
LML33, DC10). Драйвер работает, кодируя кадр в JPEG, и отправляя его карте.
Для кодирования JPEG используется и требуется библиотека
<code class="systemitem">libavcodec</code>.
Со специальным режимом <span class="emphasis"><em>cinerama</em></span>,
вы можете смотреть фильмы на действительно широком экране, который можно получить,
иемя два проектора и две MJPEG карты.  В зависимости от разрешения
и настроек качества, этот драйвер может потребовать существенной мощности CPU,
не забывайте указывать <tt class="option">-framedrop</tt>, если маша машина
слишком медленная. Замечание: Мой AMD K6-2 350МГц является (с
<tt class="option">-framedrop</tt>) вполне подходящим для просмотра материала размера VCD,
и фильмов с уменьшенным разрешением.
</p><p>
Этот драйвер общается с драйвером ядра, доступном на
<a class="ulink" href="http://mjpeg.sf.net" target="_top">http://mjpeg.sf.net</a>, так что сначала должен корректно заработать  второй.
Наличие MJPEG карты автоматически определяется скриптом
<tt class="filename">configure</tt>, если этого не происходит, включите принудительное определение
при помощи
</p><pre class="screen">./configure --enable-zr</pre><p>
</p><p>
Вывод может управляться несколькими опциями, подробные описания можно найти
на странице руководства man, короткий список опций получите, выполнив
</p><pre class="screen">mplayer -zrhelp</pre><p>
</p><p>
Такие вещи как масштабирование и OSD не осуществляются этим
драйвером, но могут быть сделаны, используя видеоплагины. Например, предположим, что
вы имеете фильм с разрешением 512x272 и хотите просмотреть эго в полноэкранном
режиме на DC10+. Есть три главные возможности: вы можете отмасштабировать фильм
до ширины 768, 384 или 192. По причинам производительности и качества я бы
выбрал масштабирование до 384x204, используя быстрый билинейный программный
модуль. Командная строка:
</p><pre class="screen">
mplayer -vo zr -sws 0 -vf scale=384:204 <em class="replaceable"><code>movie.avi</code></em>
</pre><p>
</p><p>
Обрезка может быть выполнена плагином <tt class="option">crop</tt> и самим драйвером.
Предполагая, что фильм слишком широк для отображения на Buz, и вы хотите
использовать <tt class="option">-zrcrop</tt> для уменьшения ширины, то необходимо применить
следующую команду:
</p><pre class="screen">
mplayer -vo zr -zrcrop 720x320+80+0 <em class="replaceable"><code>benhur.avi</code></em>
</pre><p>
</p><p>
Если вы хотите использовать плагин <tt class="option">crop</tt>, выполните
</p><pre class="screen">
mplayer -vo zr -vf crop=720:320:80:0 <em class="replaceable"><code>benhur.avi</code></em>
</pre><p>
</p><p>
Дополнительное указание <tt class="option">-zrcrop</tt> активизирует
режим <span class="emphasis"><em>cinerama</em></span>, т.е. вы можете распределить фильм на несколько
TV или проекторов для создания большего экрана. Предположим у вас два проектора.
Левый подключен к Buz на <tt class="filename">/dev/video1</tt>,а правый подключен
к DC10+ на <tt class="filename">/dev/video0</tt>. Фильм имеет разрешение 704x288.
Также предположим, что вы хотите выводить на правый проектор в черно-белом цвете, а
левый должен иметь JPEG кадры качества 10. в этом случае вы должны указать:
</p><pre class="screen">
mplayer -vo zr -zrdev /dev/video0 -zrcrop 352x288+352+0 -zrxdoff 0 -zrbw \
    -zrcrop 352x288+0+0 -zrdev /dev/video1 -zrquality 10 \
        <em class="replaceable"><code>movie.avi</code></em>
</pre><p>
</p><p>
Можно видеть, что опции, встречающиеся до второго <tt class="option">-zrcrop</tt>, применяются
только к DC10+, а опции после второго применяются только к Buz.
Максимальное количество карт для режима <span class="emphasis"><em>cinerama</em></span> равно
четырем, так что вы можете построить 2x2 видеостену.
</p><p>
Наконец важное замечание: Не запускайте и не останавливайте XawTV на устройстве
воспроизведения, это может подвесить ваш компьютер. Тем не менее, можно прекрасно
<span class="bold"><strong>СНАЧАЛА</strong></span> запустить XawTV, <span class="bold"><strong>ЗАТЕМ</strong></span>
запустить <span class="application">MPlayer</span>, подождать, пока <span class="application">MPlayer</span>
завершит работу и <span class="bold"><strong>ЗАТЕМ</strong></span> остановить XawTV.
</p></div><div class="sect2" title="7.19.2. Blinkenlights[Мерцающие огни?]"><div class="titlepage"><div><div><h3 class="title"><a name="blinkenlights"></a>7.19.2. Blinkenlights[Мерцающие огни?]</h3></div></div></div><p>
Этот драйвер способен воспроизводить, используя Blinkenlights UDP протокол. Если не
знаете, что такое <a class="ulink" href="http://www.blinkenlights.de/" target="_top">Blinkenlights</a>
или его преемник <a class="ulink" href="http://www.blinkenlights.de/arcade/" target="_top">Arcade</a>,
выясните это. Хотя это, возможно, реже всего используемый драйвер, без сомнения,
это самая клевая вещь, предлагаемая <span class="application">MPlayer</span>. Просто
посмотрите некоторые из
<a class="ulink" href="http://www.blinkenlights.de/video.en.html" target="_top">видеороликов документации Blinkenlights</a>.
На видео Arcade вы можете видеть драйвер видеовывода Blinkenlights в действии в 00:07:50.
</p></div></div><div class="sect1" title="7.20. Поддержка TV-выхода"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tvout"></a>7.20. Поддержка TV-выхода</h2></div></div></div><div class="sect2" title="7.20.1. Matrox G400 карты"><div class="titlepage"><div><div><h3 class="title"><a name="tvout-mga-g400"></a>7.20.1. Matrox G400 карты</h3></div></div></div><p>
Под Linux есть два способа получить работающий TV выход на G400:
</p><div class="important" title="Важно" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Важно</h3><p>
инструкции по TV-выходу для Matrox G450/G550, смотрите в следующем разделе!
</p></div><div class="variablelist"><dl><dt><span class="term">XFree86</span></dt><dd><p>
    Используя драйвер и HAL модуль, доступный с
    <a class="ulink" href="http://www.matrox.com" target="_top">сайта Matrox</a>. Это даст вам X на TV.
    </p><p>
    <span class="bold"><strong>Этот метод на дает ускоренного воспроизведения</strong></span>
    как под Windows! Второй выход имеет только YUV фреймбуфер, <span class="emphasis"><em>BES</em></span>
    (Back End Scaler, модуль YUV масштабирования на картах G200/G400/G450/G550) на
    нем не работает! Драйвер windows как-то это обходит, возможно используя
    3D движок для масштабирования, а YUV фреймбуфер - для вывода отмасштабированного
    изображения. Если вы действительно хотите использовать X, используйте опции
    <tt class="option">-vo x11 -fs -zoom</tt>, но это будет <span class="bold"><strong>МЕДЛЕННО</strong></span>,
    и будет иметь включенную защиту от копирования <span class="bold"><strong>Macrovision</strong></span>
    (можно "обойти" Macrovision используя этот
    <a class="ulink" href="http://avifile.sf.net/mgamacro.pl" target="_top">скрипт на perl</a>).
    </p></dd><dt><span class="term">Framebuffer</span></dt><dd><p>
    Используя <span class="bold"><strong>модули matroxfb</strong></span> в 2.4 ядрах.
    2.2 ядра не имеют в этих модулях возможности работы с TV-out, так что для нашего
    дела непригодны. Вы должны включить ВСЕ matroxfb-относящиеся возможности во время компиляции
    (кроме MultiHead), и скомпилировать их в <span class="bold"><strong>модули</strong></span>!
    Вам также необходима задействованная I2C.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Шаг 1"><p>
      Войдите в <tt class="filename">TVout</tt> и наберите
      <span class="command"><strong>./compile.sh</strong></span>. Установите
      <tt class="filename">TVout/matroxset/matroxset</tt>
      куда-нидудь в ваши <code class="envar">PATH</code>.
    </p></li><li class="step" title="Шаг 2"><p>
      Если вы еще не имеете установленного <span class="command"><strong>fbset</strong></span>, поместите
      <tt class="filename">TVout/fbset/fbset</tt>
      куда-нибуть в ваши <code class="envar">PATH</code>.
    </p></li><li class="step" title="Шаг 3"><p>
      Еслы <span class="command"><strong>con2fb</strong></span> у вас еще не установлен, поместите
      <tt class="filename">TVout/con2fb/con2fb</tt>
      куда-нибуть в ваши <code class="envar">PATH</code>.
    </p></li><li class="step" title="Шаг 4"><p>
      Затем войдите в каталог <tt class="filename">TVout/</tt>
      в исходниках <span class="application">MPlayer</span>, и запустите
      <tt class="filename">./modules</tt> от имени root. Ваша консоль из текстового режима
      переключится в режим фреймбуфера (обратно не получится!).
    </p></li><li class="step" title="Шаг 5"><p>
      Затем, ОТРЕДАКТИРУЙТЕ и запустите скрипт <tt class="filename">./matroxtv</tt>.
      Он покажет вам очень простое меню. Нажмите <span class="keycap"><b>2</b></span> и
      <span class="keycap"><b>Enter</b></span>. Теперь вы должны иметь одинаковую картинку на
      мониторе и TV. Если картинка на TV (PAL по-умолчанию) имеет некоторые
      странные полосы, значит скрипт не смог корректно установить разрешение
      (на 640x512 по-умолчанию). Попробуйте другие разрешения из меню
      и/или поэкспериментируйте с fbset.
    </p></li><li class="step" title="Шаг 6"><p>
      Йоу. Следующая задача - убрать курсор с tty1 (или где он есть), и выключить
      гашение экрана. Запустите следующие команды:

      </p><pre class="screen">
echo -e '\033[?25l'
setterm -blank 0</pre><p>
      or
      </p><pre class="screen">
setterm -cursor off
setterm -blank 0</pre><p>
      Возможно вы захотите поместить вышеуказанное в скрипт, добавив очистку экрана.
      Чтобы вернуть курсор назад
      </p><pre class="screen">echo -e '\033[?25h'</pre><p> или
      </p><pre class="screen">setterm -cursor on</pre><p>
    </p></li><li class="step" title="Шаг 7"><p>
      Готово. Запускайте воспроизведение
      </p><pre class="screen">
mplayer -vo mga -fs -screenw 640 -screenh 512 <em class="replaceable"><code>filename</code></em></pre><p>

      (Если используете X, переключитесь теперь в matroxfb при помощи, например
      <span class="keycap"><b>Ctrl</b></span>+<span class="keycap"><b>Alt</b></span>+<span class="keycap"><b>F1</b></span>.)
      Замените <code class="literal">640</code> и <code class="literal">512</code>, если установили другое
      разрешение...
    </p></li><li class="step" title="Шаг 8"><p>
      <span class="bold"><strong>Наслаждайтесь супер-быстрым, супер-навороченным выводом Matrox TV
      (лучше чем Xv)!</strong></span>
    </p></li></ol></div></dd></dl></div><p title="Создание кабеля Matrox TV-out"><b>Создание кабеля Matrox TV-out. </b>
Никто не дает никаких гарантий и не несет никакой ответственности
за возможное нанесение ущерба, вызванное выполнением инструкций, указанныех в этой
документации.
</p><p title="Кабель для G400"><b>Кабель для G400. </b>
Четвертый контакт CRTC2 коннектора - это композитный видео сигнал. Земля - шестой,
седьмой и восьмой контакты. (информация получена от Balázs Rácz)
</p><p title="Кабель для G450"><b>Кабель для G450. </b>
Первый контакт CRTC2 коннектора - это композитный видео сигнал. Земля - пятый,
шестой, седьмой и пятнадцатый (5, 6, 7, 15) контакты.
(информация получена от Balázs Kerekes)
</p></div><div class="sect2" title="7.20.2. Matrox G450/G550 карты"><div class="titlepage"><div><div><h3 class="title"><a name="tv-out_matrox_g450"></a>7.20.2. Matrox G450/G550 карты</h3></div></div></div><p>
Поддержка TV выхода для этих карт была добавлена недавно, и пока отсутствует в основном
ядре. В данный момент <span class="bold"><strong>mga_vid</strong></span> не может быть использован
AFAIK, поскольку дрйвер G450/G550 работает только в одной конфигурации:
первый чип CRTC (с наибольшим количеством возможностей) на первом экране
(мониторе), и второй чип CRTC (без <span class="bold"><strong>BES</strong></span> - для объяснения,
что такое BES, смотрите раздел о G400 выше) на TV. Так что в настоящий момент вы
можете использовать только драйвер вывода <span class="emphasis"><em>fbdev</em></span> программы
<span class="application">MPlayer</span>.
</p><p>
Первый CRTC не может быть перенаправлен на второй выход на текущий момент.
Автор драйвера ядра matroxfb - Petr Vandrovec - возможно добавит поддержку для
этого, отображая вывод первого CRTC одновременно на два выхода, как в данный момент и
рекомендуется для G400, смотрите раздел выше.
</p><p>
Необходимый патч для ядра и детальное HOWTO можно скачать с
<a class="ulink" href="http://www.bglug.ca/matrox_tvout/" target="_top">http://www.bglug.ca/matrox_tvout/</a>
</p></div><div class="sect2" title="7.20.3. ATI карты"><div class="titlepage"><div><div><h3 class="title"><a name="tvout-ati"></a>7.20.3. ATI карты</h3></div></div></div><p title="ПРЕАМБУЛА"><b>ПРЕАМБУЛА. </b>
Сейчас ATI не хочет поддерживать ни один из ее TV-out чипов под Linux, по причине
технологии лицензированной ими у Macrovision.
</p><div class="itemizedlist" title="СТАТУС ПОДДЕРЖКИ TV-OUT ДЛЯ КАРТ ATI ПОД LINUX"><p class="title"><b>СТАТУС ПОДДЕРЖКИ TV-OUT ДЛЯ КАРТ ATI ПОД LINUX</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>ATI Mach64</strong></span>:
  поддерживается <a class="ulink" href="http://gatos.sf.net" target="_top">GATOS</a>.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>ASIC Radeon VIVO</strong></span>:
  поддерживается <a class="ulink" href="http://gatos.sf.net" target="_top">GATOS</a>.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Radeon</strong></span> и <span class="bold"><strong>Rage128</strong></span>:
  поддерживается <span class="application">MPlayer</span>!
  Смотрите разделы <a class="link" href="#vesa" title="7.13. VESA - вывод в VESA BIOS">VESA драйвер</a> и
  <a class="link" href="#vidix" title="7.15. VIDIX">VIDIX</a>.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Rage Mobility P/M, Radeon, Rage 128, Mobility M3/M4</strong></span>:
  поддерживается <a class="ulink" href="http://www.stud.uni-hamburg.de/users/lennart/projects/atitvout/" target="_top">atitvout</a>.
</p></li></ul></div><p>
Для других карт просто используйте <a class="link" href="#vesa" title="7.13. VESA - вывод в VESA BIOS">VESA</a> драйвер, без
VIDIX. Конечно, требуется мощный CPU.
</p><p>
Единственная вещь, которую надо сделать - <span class="bold"><strong>Иметь TV коннектор
подключенным до загрузки вашего PC</strong></span>, поскольку видео BIOS инициализирует
себя только один раз во время POST процедуры.
</p></div><div class="sect2" title="7.20.4. nVidia"><div class="titlepage"><div><div><h3 class="title"><a name="tvout-nvidia"></a>7.20.4. nVidia</h3></div></div></div><p>
Во-первых, вы ДОЛЖНЫ скачать закрытые драйверы с <a class="ulink" href="http://nvidia.com" target="_top">http://nvidia.com</a>.
Я не буду описывать процесс установки и настройки, поскольку это выходит за рамки данной
документации.
</p><p>
После того, как XFree86, XVideo, и 3D ускорение заработает правильно, отредактируйте раздел
Device для вашей карты в файле <tt class="filename">XF86Config</tt>, в соответствии с
указанным ниже примером (адаптируйте к вашей карте/TV):

</p><pre class="programlisting">
Section "Device"
        Identifier      "GeForce"
        VendorName      "ASUS"
        BoardName       "nVidia GeForce2/MX 400"
        Driver          "nvidia"
        #Option         "NvAGP" "1"
        Option          "NoLogo"
        Option          "CursorShadow"  "on"

        Option          "TwinView"
        Option          "TwinViewOrientation" "Clone"
        Option          "MetaModes" "1024x768,640x480"
        Option          "ConnectedMonitor" "CRT, TV"
        Option          "TVStandard" "PAL-B"
        Option          "TVOutFormat" "Composite"
EndSection
</pre><p>
</p><p>
Конечно же важная часть - это TwinView.
</p></div><div class="sect2" title="7.20.5. NeoMagic"><div class="titlepage"><div><div><h3 class="title"><a name="tvout-neomagic"></a>7.20.5. NeoMagic</h3></div></div></div><p>
Чип NeoMagic найден на различных ноутбуках, некоторые из которых оснащаются
простым аналоговым TV кодером, некоторые имеют более продвинутый.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>Чип аналогового кодера</strong></span>:
  Сообщалось, что надежный TV выход можно получить, используя
  <tt class="option">-vo fbdev</tt> или <tt class="option">-vo fbdev2</tt>.
  Вам требуется иметь vesafb скомпилированный в вашем ядре и передать
  следующие параметры в командной строке ядра:
  <tt class="option">append="video=vesafb:ywrap,mtrr" vga=791</tt>.
  Вам следует запустить <span class="application">X</span>, затем переключитесь в
  консольный режим при помощи, например,
  <span class="keycap"><b>Ctrl</b></span>+<span class="keycap"><b>Alt</b></span>+<span class="keycap"><b>F1</b></span>.
  Если вы не запустите <span class="application">X</span> до запуска
  <span class="application">MPlayer</span> в консоли, видео станет медленным и
  дрожащим[choppy] (объяснения приветствуются).
  Залогиньтесь в консоли и запустите следующую команду:

  </p><pre class="screen">clear; mplayer -vo fbdev -zoom -cache 8192 dvd://</pre><p>

  Теперь вы должны увидеть фильм, запущенный в консольном режиме, заполняющий
  примерно половину LCD экрана вашего ноутбука.
  Для переключения в TV нажмите
  <span class="keycap"><b>Fn</b></span>+<span class="keycap"><b>F5</b></span> три раза.
  Тестировался на Tecra 8000, 2.6.15 ядре с vesafb, ALSA v1.0.10.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Chrontel 70xx чип кодирования</strong></span>:
  Найден на IBM Thinkpad 390E и, возможно, других Thinkpad или ноутбуках.
  </p><p>
  Необходимо использовать <tt class="option">-vo vesa:neotv_pal</tt> для PAL или
  <tt class="option">-vo vesa:neotv_ntsc</tt> для NTSC.
  Это даст TV выход, работающий в следующих 16 bpp и 8 bpp режимах:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>NTSC 320x240, 640x480 and maybe 800x600 too.</p></li><li class="listitem"><p>PAL  320x240, 400x300, 640x480, 800x600.</p></li></ul></div><p>Режим 512x384 не поддерживается в BIOS. Вы должны масштабировать
  изображение в другое разрешение для задействования TV выхода. Если вы видите
  изображение на экране в разрешении 640x480 или 800x600, но не 320x240 или другом
  меньшем разрешении, вам требуется заменить две таблицы в <tt class="filename">vbelib.c</tt>.
  Смотрите функцию vbeSetTV для подробностей. Пожалуйста, свяжитесь  автором в этом
  случае.
  </p><p>
  Известные проблемы: только VESA, не реализованы различные настройки, такие как яркость,
  контрастность, уровень черного, фильтр дрожания[flickfilter].
  </p></li></ul></div><p>
</p></div></div></div><div class="chapter" title="Глава 8. Портинг"><div class="titlepage"><div><div><h2 class="title"><a name="ports"></a>Глава 8. Портинг</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#linux">8.1. Linux</a></span></dt><dd><dl><dt><span class="sect2"><a href="#debian">8.1.1. Debian пакеты</a></span></dt><dt><span class="sect2"><a href="#rpm">8.1.2. RPM пакеты</a></span></dt><dt><span class="sect2"><a href="#arm">8.1.3. ARM</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsd">8.2. *BSD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#freebsd">8.2.1. FreeBSD</a></span></dt><dt><span class="sect2"><a href="#openbsd">8.2.2. OpenBSD</a></span></dt><dt><span class="sect2"><a href="#darwin">8.2.3. Darwin</a></span></dt></dl></dd><dt><span class="sect1"><a href="#unix">8.3. Коммерческие Unix</a></span></dt><dd><dl><dt><span class="sect2"><a href="#solaris">8.3.1. Solaris</a></span></dt><dt><span class="sect2"><a href="#hp-ux">8.3.2. HP-UX</a></span></dt><dt><span class="sect2"><a href="#aix">8.3.3. AIX</a></span></dt><dt><span class="sect2"><a href="#qnx">8.3.4. QNX</a></span></dt></dl></dd><dt><span class="sect1"><a href="#windows">8.4. Windows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#cygwin">8.4.1. <span class="application">Cygwin</span></a></span></dt><dt><span class="sect2"><a href="#mingw">8.4.2. <span class="application">MinGW</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#macos">8.5. Mac OS</a></span></dt><dd><dl><dt><span class="sect2"><a href="#osx_gui">8.5.1. MPlayer OS X GUI</a></span></dt></dl></dd></dl></div><div class="sect1" title="8.1. Linux"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="linux"></a>8.1. Linux</h2></div></div></div><p>
Основная платформа разработки — это Linux на x86, хотя
<span class="application">MPlayer</span> работает под многими другими портами Linux.
Бинарные пакеты <span class="application">MPlayer</span>'а доступны из нескольких источников.
Тем не менее,
<span class="bold"><strong>ни один из этих пакетов не поддерживается</strong></span>.
Сообщайте о проблемах их авторам, а не нам.
</p><div class="sect2" title="8.1.1. Debian пакеты"><div class="titlepage"><div><div><h3 class="title"><a name="debian"></a>8.1.1. Debian пакеты</h3></div></div></div><p>
Чтобы создать Debian пакет, выполните следующие команды в каталоге с исходным
кодом <span class="application">MPlayer</span>'а:
</p><pre class="screen">fakeroot debian/rules binary</pre><p>

Если  вы хотите передать дополнительные опции configure, установите
соответствующее значение переменной окружения <code class="envar">DEB_BUILD_OPTIONS</code>.
В частности, если хотите поддержку GUI и OSD, укажите:

</p><pre class="screen">DEB_BUILD_OPTIONS="--enable-gui --enable-menu" fakeroot debian/rules binary</pre><p>

Вы также можете передать некоторые переменные в Makefile. Например, если
желаете компилировать gcc 3.4 даже если это не основной компилятор:

</p><pre class="screen">CC=gcc-3.4 DEB_BUILD_OPTIONS="--enable-gui" fakeroot debian/rules binary</pre><p>

Для очистки дерева исходных текстов воспользуйтесь командой:

</p><pre class="screen">fakeroot debian/rules clean</pre><p>

В качестве root'а Вы затем можете установить <tt class="filename">.deb
</tt> пакет:
</p><pre class="screen">dpkg -i ../mplayer_<em class="replaceable"><code>версия</code></em>.deb</pre><p>
</p><p>
Какое-то время Christian Marillat собирал неофициальные Debian пакеты с
<span class="application">MPlayer</span>, <span class="application">MEncoder</span>
и бинарными кодеками, так что вы можете их скачать (выполнить apt-get)
с его <a class="ulink" href="http://www.debian-multimedia.org/" target="_top">сайта</a>.
</p></div><div class="sect2" title="8.1.2. RPM пакеты"><div class="titlepage"><div><div><h3 class="title"><a name="rpm"></a>8.1.2. RPM пакеты</h3></div></div></div><p>
Dominik Mierzejewski поддерживает официальные Fedora Core RPM пакеты
<span class="application">MPlayer</span>'а. Они доступны в
<a class="ulink" href="http://rpm.livan.org/" target="_top">репозитории Livna</a>.
</p><p>
Mandrake/Mandriva RPM пакеты доступны с <a class="ulink" href="http://plf.zarb.org/" target="_top">P.L.F.</a>.
SuSE включала искалеченную версию <span class="application">MPlayer</span>'а в дистрибутив.
Из последних релизов они убрали эти пакеты. Вы можете взять
работающие RPM с
<a class="ulink" href="http://packman.links2linux.de/?action=128" target="_top">links2linux.de</a>.
</p></div><div class="sect2" title="8.1.3. ARM"><div class="titlepage"><div><div><h3 class="title"><a name="arm"></a>8.1.3. ARM</h3></div></div></div><p>
<span class="application">MPlayer</span> работает на Linux PDA с ARM процессором,
например Sharp Zaurus, Compaq Ipaq. Простейший способ получить <span class="application">
MPlayer</span> — это скачать его с
пакетных репозиториев
<a class="ulink" href="http://www.openzaurus.org" target="_top">OpenZaurus</a>. Если Вы хотите
скомпилировать его самостоятельно, обратите внимание на каталоги
<a class="ulink" href="http://openzaurus.bkbits.net:8080/buildroot/src/packages/mplayer?nav=index.html%7Csrc/.%7Csrc/packages" target="_top">mplayer</a>
и
<a class="ulink" href="http://openzaurus.bkbits.net:8080/buildroot/src/packages/libavcodec?nav=index.html%7Csrc/.%7Csrc/packages" target="_top">libavcodec</a>
в корне сборки дистрибутива OpenZaurus. Там всегда найдутся
свежий Makefile и патчи, используемые для сборки SVN <span class="application">MPlayer</span>'а вместе с
<code class="systemitem">libavcodec</code>.
Если Вам нужен GUI, используйте встроенный в xmms
</p></div></div><div class="sect1" title="8.2. *BSD"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bsd"></a>8.2. *BSD</h2></div></div></div><p>
<span class="application">MPlayer</span> работает на всех известных семействах BSD.
Существуют портированные[ports]/пакеты сорцов[pkgsrcs]/fink/
и т.п. версии <span class="application">MPlayer</span>, которые, наверное, проще использовать,
чем просто исходный код.
</p><p>
Чтобы собрать <span class="application">MPlayer</span>, Вам понадобится GNU make (gmake —
родной BSD make не будет работать) и свежая версия binutils.
</p><p>
Если <span class="application">MPlayer</span> ругается, что он не может найти
<tt class="filename">/dev/cdrom</tt> или
<tt class="filename">/dev/dvd</tt>, создайте соответствующую ссылку:
</p><pre class="screen">ln -s /dev/<em class="replaceable"><code>Ваше_cdrom_устройство</code></em> /dev/cdrom</pre><p>
</p><p>
Чтобы использовать Win32 DLL'и с <span class="application">MPlayer</span>'ом, Вам необходимо
перекомпилировать
ядро с "<code class="envar">option USER_LDT</code>" (если только у Вас не FreeBSD-CURRENT,
где это включено по умолчанию).
</p><div class="sect2" title="8.2.1. FreeBSD"><div class="titlepage"><div><div><h3 class="title"><a name="freebsd"></a>8.2.1. FreeBSD</h3></div></div></div><p>
Если Ваш CPU поддерживает SSE, перекомпилируйте ядро с
"<code class="envar">options CPU_ENABLE_SSE</code>" (необходимо FreeBSD-STABLE
или патчи к ядру).
</p></div><div class="sect2" title="8.2.2. OpenBSD"><div class="titlepage"><div><div><h3 class="title"><a name="openbsd"></a>8.2.2. OpenBSD</h3></div></div></div><p>
В связи с ограничениями в различных версиях gas (конфликт настройки адресов и MMX),
Вы должны будете компилировать в два шага: сначала убедитесь, что не родной as
— первый в Вашем <code class="envar">$PATH</code> и выполните <span class="command"><strong>gmake -k
</strong></span>, затем убедитесь, что будет использоваться родная версия и запустите
<span class="command"><strong>gmake</strong></span>.
</p><p>
Начиная с OpenBSD 3.4 подобный хак больше не нужен.
</p></div><div class="sect2" title="8.2.3. Darwin"><div class="titlepage"><div><div><h3 class="title"><a name="darwin"></a>8.2.3. Darwin</h3></div></div></div><p>
См. секцию <a class="link" href="#macos" title="8.5. Mac OS">Mac OS</a>.
</p></div></div><div class="sect1" title="8.3. Коммерческие Unix"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="unix"></a>8.3. Коммерческие Unix</h2></div></div></div><p>
<span class="application">MPlayer</span> был портирован на некоторые коммерческие варианты Unix.
Поскольку окружения разработки этих систем отличаются от свободных Unix'ов,
вам придется самостоятельно произвести некоторые действия, чтобы сборка заработала.
</p><div class="sect2" title="8.3.1. Solaris"><div class="titlepage"><div><div><h3 class="title"><a name="solaris"></a>8.3.1. Solaris</h3></div></div></div><p>
<span class="application">MPlayer</span> должен работать под Solaris 2.6 и более
новыми версиями. Для звука используйте звуковой драйвер SUN с
опцией <tt class="option">-ao sun</tt>.
</p><p>
На <span class="bold"><strong>UltraSPARC</strong></span>'ах, <span class="application">MPlayer</span>
использует преимущество их расширения <span class="bold"><strong>VIS</strong></span>
(эквивалент MMX), но (в настоящий момент) только в
<code class="systemitem">libmpeg2</code>,
<code class="systemitem">libvo</code>
and <code class="systemitem">libavcodec</code>, но не в
<code class="systemitem">mp3lib</code>. Вы сможете просматривать VOB'ы
на 400MHz CPU. Вам потребуется установленная
<a class="ulink" href="http://www.sun.com/sparc/vis/mediaLib.html" target="_top"><code class="systemitem">mLib</code></a>.
</p><p><span class="bold"><strong>Предостережение:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>mediaLib</strong></span> в данный
  момент отключена по умолчанию в
  <span class="application">MPlayer</span> из-за поломанности.
  Пользователи SPARC, компилировавшие MPlayer с mediaLib
  сообщали об изобилии зелёного оттенка в видео, кодируемом и
  декодируемом libavcodec.
  Если хотите, можете включить ее:
  </p><pre class="screen">$ ./configure --enable-mlib</pre><p>
  Вы делаете это на свой страх и риск, пользователи x86 не жолжны
  <span class="bold"><strong>никогда</strong></span> использовать mediaLib, поскольку
  это очень сильно скажется на производительности MPlayer.
</p></li></ul></div><p>
Чтобы собрать программу, Вам потребуется GNU <span class="application">make</span>
(<tt class="filename">gmake</tt>, <tt class="filename">/opt/sfw/gmake</tt>), родной
Solaris make не будет работать. Типичная ошибка которую Вы будете
получать при использовании Solaris make, вместо GNU make:
</p><pre class="screen">
% /usr/ccs/bin/make
make: Fatal error in reader: Makefile, line 25: Unexpected end of line seen
</pre><p>
</p><p>
На Solaris SPARC, Вам потребуется GNU C/C++ Compiler; при этом не имеет
значения, был ли GNU C/C++ компилятор сконфигурирован с или без GNU ассемблера.
</p><p>
На Solaris x86, Вам потребуются GNU ассемблер и GNU C/C++ компилятор,
сконфигурированный, чтобы использовать GNU ассемблер! На x86 платформах
код <span class="application">MPlayer</span>'а использует много MMX, SSE и 3DNOW!
инструкций, которые Sun'овский ассемблер <tt class="filename">/usr/ccs/bin/as</tt>
не может скомпилировать.
</p><p>
Скрипт <tt class="filename">configure</tt> пытается обнаружить, какой ассемблер
используется Вашей командой "gcc" (в том случае, если автоопределение
не сработает, используйте опцию
<tt class="option">--as=<em class="replaceable"><code>/там/где/у/Вас/установлен/gnu-as</code></em></tt>,
чтобы сообщить скрипту <tt class="filename">configure</tt>, где можно обнаружить
GNU "as" на Вашей системе).
</p><p>Решение общих проблем:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Сообщения об ошибках <tt class="filename">configure</tt> на Solaris x86 системах при
  использовании GCC без GNU ассемблера:
  </p><pre class="screen">
% configure
...
Checking assembler (/usr/ccs/bin/as) ... , failed
Please upgrade(downgrade) binutils to 2.10.1...</pre><p>
  (Решение: Установите и используйте gcc, сконфигурированный с
  <tt class="option">--with-as=gas</tt>)
</p><p>
Типичная ошибка при сборке GNU C компилятором, который не использует GNU as:
</p><pre class="screen">
% gmake
...
gcc -c -Iloader -Ilibvo -O4 -march=i686 -mcpu=i686 -pipe -ffast-math
    -fomit-frame-pointer  -I/usr/local/include   -o mplayer.o mplayer.c
Assembler: mplayer.c
"(stdin)", line 3567 : Illegal mnemonic
"(stdin)", line 3567 : Syntax error
... more "Illegal mnemonic" and "Syntax error" errors ...
</pre><p>
</p></li><li class="listitem"><p>
  <span class="application">MPlayer</span> может сообщить о нарушении сегментации при
  кодировании и декодировании видео, использующего  win32codecs:
  </p><pre class="screen">
...
Trying to force audio codec driver family acm...
Opening audio decoder: [acm] Win32/ACM decoders
sysi86(SI86DSCR): Invalid argument
Couldn't install fs segment, expect segfault


MPlayer interrupted by signal 11 in module: init_audio_codec
...</pre><p>
  Это из-за изменений в sysi86() в Solaris 10 и пре-Solaris
  Nevada b31 релизах. Исправлено в Solaris Nevada b32; тем не менее
  Sun еще следует портировать исправление обратно на Solaris 10. Проект MPlayer
  осведомил Sun об этой проблеме и патч в данный момент готовится для
  Solaris 10. Больше информации об этой ошибке ищите
  на:
  <a class="ulink" href="http://bugs.opensolaris.org/bugdatabase/view_bug.do?bug_id=6308413" target="_top">http://bugs.opensolaris.org/bugdatabase/view_bug.do?bug_id=6308413</a>.
</p></li><li class="listitem"><p>
В связи с ошибками в Solaris 8, Вы не сможете проигрывать DVD диски, размером
больше 4 Гб:
</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>
  Под Solaris 8 x86 драйвер sd(7D) содержит ошибку, проявляющуюся при доступе
  к дискам, размером &gt; 4 Гб на устройствах с логическим размером блока !=
  DEV_BSIZE (например CD-ROM и DVD диски).
  Из-за целочисленного 32-х битного переполнения, происходит доступ к дисковому адресу
  по модулю 4 Гб
  (<a class="ulink" href="http://groups.yahoo.com/group/solarisonintel/message/22516" target="_top">http://groups.yahoo.com/group/solarisonintel/message/22516</a>).
  Проблема отсутствует в SPARC версиях Solaris 8.
</p></li><li class="listitem"><p>
  Похожая ошибка существует в коде файловой системы hsfs(7FS) (ISO9660),
  hsfs может не поддерживать разделы/диски больше 4 Гб, доступ к данным
  происходит по модулю 4 Гб
  (<a class="ulink" href="http://groups.yahoo.com/group/solarisonintel/message/22592" target="_top">http://groups.yahoo.com/group/solarisonintel/message/22592</a>).
  Проблемы с hsfs могут быть исправлены установкой патча 109764-04 (sparc) /
  109765-04 (x86).
</p></li></ul></div></li></ul></div></div><div class="sect2" title="8.3.2. HP-UX"><div class="titlepage"><div><div><h3 class="title"><a name="hp-ux"></a>8.3.2. HP-UX</h3></div></div></div><p>
Joe Page на своей домашней странице держит подробное
<a class="ulink" href="http://users.rcn.com/joepage/mplayer_on_hpux11.htm" target="_top">HOWTO</a>
по <span class="application">MPlayer</span> на HP-UX, написанное Martin Gansser.
С этими инструкциями сборка должна работать "прямо из коробки".
Следующая информация взята оттуда.
</p><p>
Вам потребуется GCC 3.4.0 или полее поздней версии, GNU make версии 3.80
или новее и SDL 1.2.7 или более новый. HP cc не может создать работоспособную
программу, предыдущие версии GCC глючат. Для функционирования OpenGL
необходимо установить Mesa, после чего должны заработать драйвера вывода видео
gl и gl2, хотя, в зависимости от быстродействия CPU, скорость может быть ужасной.
GNU esound является хорошей заменой довольно бедной звуковой системе HP-UX.
</p><p>
Произведите сканирование шины SCSI
на предмет наличия DVD устройства:

</p><pre class="screen">
# ioscan -fn

Class          I            H/W   Path          Driver    S/W State    H/W Type        Description
...
ext_bus 1    8/16/5      c720  CLAIMED INTERFACE  Built-in SCSI
target  3    8/16/5.2    tgt   CLAIMED DEVICE
disk    4    8/16/5.<span class="bold"><strong>2</strong></span>.<span class="bold"><strong>0</strong></span>  sdisk CLAIMED DEVICE     <span class="bold"><strong>PIONEER DVD-ROM DVD-305</strong></span>
                         /dev/dsk/c1t2d0 <span class="bold"><strong>/dev/rdsk/c1t2d0</strong></span>
target  4    8/16/5.7    tgt   CLAIMED DEVICE
ctl     <span class="bold"><strong>1</strong></span>    8/16/5.7.0  sctl  CLAIMED DEVICE     Initiator
                         /dev/rscsi/c1t7d0 /dev/rscsi/c1t7l0 /dev/scsi/c1t7l0
...
</pre><p>

Вывод показывает, что по адресу 2 шины SCSI находится Pioneer DVD-ROM.
Экземпляр карты для аппаратного пути 8/16 равен 1.
</p><p>
Создайте ссылку от сырого устройства к DVD устройству.

</p><pre class="screen">
ln -s /dev/rdsk/c<em class="replaceable"><code>&lt;SCSI bus instance&gt;</code></em>t<em class="replaceable"><code>&lt;SCSI target ID&gt;</code></em>d<em class="replaceable"><code>&lt;LUN&gt;</code></em> /dev/<em class="replaceable"><code>&lt;device&gt;</code></em>
</pre><p>
Пример:
</p><pre class="screen">ln -s /dev/rdsk/c1t2d0 /dev/dvd</pre><p>
</p><p>
Далее следуют решения некоторых общих проблем:

</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Крах при запуске с таким сообщением об ошибке:
  </p><pre class="screen">
/usr/lib/dld.sl: Unresolved symbol: finite (code) from /usr/local/lib/gcc-lib/hppa2.0n-hp-hpux11.00/3.2/../../../libGL.sl</pre><p>
  </p><p>
  Это значит, что функция <code class="systemitem">.finite().</code> недоступна в стандартной
  математической библиотеке HP-UX.
  Вместо этого используйте <code class="systemitem">.isfinite().</code>.
  Решение: Используйте последнюю версию Mesa из репозитория.
  </p></li><li class="listitem"><p>
  Крах при воспроизведении со следующей ошибкой:
  </p><pre class="screen">
/usr/lib/dld.sl: Unresolved symbol: sem_init (code) from /usr/local/lib/libSDL-1.2.sl.0</pre><p>
  </p><p>
  Решение: Используйте опцию extralibdir программы configure
  <tt class="option">--with-extralibdir="/usr/lib -lrt"</tt>
  </p></li><li class="listitem"><p>
  MPlayer вылетает с нарушением сегментации и сообщением вроде этого:
  </p><pre class="screen">
Pid 10166 received a SIGSEGV for stack growth failure.
Possible causes: insufficient memory or swap space, or stack size exceeded maxssiz.
Segmentation fault</pre><p>
  </p><p>
  Решение:
  Ядро HP-UX по-умолчанию для каждого процесса имеет размер стека равный 8MB(?).
  (11.0 и новые патчи для 10.20 позволяют вам увеличить <code class="systemitem">maxssiz</code>
  вплоть до 350MB для 32-х битных программ). Вы должны расширить
  <code class="systemitem">maxssiz</code>
  и перекомпилировать ядро (и перезагрузиться). Чтобы сделать это, можно использовать SAM.
  (Находясь в нем, проверьте параметр <code class="systemitem">maxdsiz</code> на предмет
  максимального количества данных, которые могут использоваться программами.
  64 Мб по умолчанию может хватить или не хватить в зависимости от Ваших приложений.)
  </p></li></ul></div><p>
</p></div><div class="sect2" title="8.3.3. AIX"><div class="titlepage"><div><div><h3 class="title"><a name="aix"></a>8.3.3. AIX</h3></div></div></div><p>
<span class="application">MPlayer</span> успешно собирается на AIX 5.1,
5.2, и 5.3, используя GCC 3.3 или новее. Сборка
<span class="application">MPlayer</span> не проверена на AIX 4.3.3 и более ранних.
Крайне рекомендуется собирать
<span class="application">MPlayer</span> используя GCC 3.4 или старше, и, как минимум,
GCC 4.0, если собираете на POWER5.
</p><p>
Убедитесь, что используете GNU make
(<tt class="filename">/opt/freeware/bin/gmake</tt>) для сборки
<span class="application">MPlayer</span>, поскольку столкнетесь с проблемами при
использовании <tt class="filename">/usr/ccs/bin/make</tt>.
</p><p>

По-прежнему ведется работа над кодом определения CPU.
Проверены следующие архитектуры:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>604e</p></li><li class="listitem"><p>POWER3</p></li><li class="listitem"><p>POWER4</p></li></ul></div><p>
На следующих архитектурах не проверялось, но должно работать:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>POWER</p></li><li class="listitem"><p>POWER2</p></li><li class="listitem"><p>POWER5</p></li></ul></div><p>
</p><p>
Вывод звука через Ultimedia Services не поддерживается, т.к.
Ultimedia была убрана из AIX 5.1; таким образом, остается единственный
вариант: использовать драйвер AIX Open Sound system (OSS) от
4Front Technologies с
<a class="ulink" href="http://www.opensound.com/aix.html" target="_top">http://www.opensound.com/aix.html</a>.
Для некоммерческого использования 4Front Technologies
распространяет драйвер OSS под AIX 5.1 бесплатно; несмотря на это,
на текущий день нет драйверов вывода звука для AIX 5.2 или 5.3.
drivers for AIX 5.2 or 5.3. Это означает, что сейчас
<span class="bold"><strong>AIX 5.2 и 5.3 несовместимы с выводом звука MPlayer.</strong></span>
</p><p>Решения для общих проблем:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Если вы столкнулись с такой ошибкой <tt class="filename">configure</tt>:
  </p><pre class="screen">
$ ./configure
...
Checking for iconv program ... no
No working iconv program found, use
--charset=US-ASCII to continue anyway.
Messages in the GTK-2 interface will be broken then.</pre><p>
  Это из-за того, что AIX использует нестандартные имена кодировок;
  поэтому перекодировка сообщений в данный момент не работает.
  Решение - использовать:
  </p><pre class="screen">$ ./configure --charset=noconv</pre><p>
  </p></li></ul></div></div><div class="sect2" title="8.3.4. QNX"><div class="titlepage"><div><div><h3 class="title"><a name="qnx"></a>8.3.4. QNX</h3></div></div></div><p>
Вам нужно скачать и установить SDL для QNX. Затем запустите
<span class="application">MPlayer</span> с опциями <tt class="option">-vo sdl:photon</tt>
и <tt class="option">-ao sdl:nto</tt>, и все будет работать быстро.
</p><p>
Вывод <tt class="option">-vo x11</tt> будет ещё медленнее, чем под Linux, поскольку под
QNX X'ы <span class="emphasis"><em>эмулируются</em></span>, что ОЧЕНЬ медленно.
</p></div></div><div class="sect1" title="8.4. Windows"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="windows"></a>8.4. Windows</h2></div></div></div><p>
Да, <span class="application">MPlayer</span> работает под Windows под
<a class="ulink" href="http://www.cygwin.com/" target="_top"><span class="application">Cygwin</span></a> и
<a class="ulink" href="http://www.mingw.org/" target="_top"><span class="application">MinGW</span></a>.
Пока ещё нет официального GUI, но версия командной строки полностью функциональна.
Обратитесь к списку рассылки
<a class="ulink" href="http://lists.mplayerhq.hu/mailman/listinfo/mplayer-cygwin/" target="_top">MPlayer-cygwin</a>
за помощью и дополнительной информацией.
Официальные бинарники под Windows могут быть найдены на
<a class="ulink" href="http://www.mplayerhq.hu/design7/dload.html" target="_top">странице загрузки</a>.
Пакеты установки и простые GUI фронтенды доступны из внешних
источников, мы собрали их в разделе Windows на
<a class="ulink" href="http://www.mplayerhq.hu/design7/projects.html#windows" target="_top">нашей
странице проектов</a>.
</p><p>
При нежелании использовать командную строку поможет простой трюк:
поместите на рабочий стол ссылку, со следующим содержимым в секции execute:
</p><pre class="screen"><em class="replaceable"><code>c:\путь\к\</code></em>mplayer.exe %1</pre><p>
Это позволит <span class="application">MPlayer</span> воспроизводить любой фильм,
который вы перетащите на созданный ярлык. Добавьте <tt class="option">-fs</tt>
для полноэкранного режима.
</p><p>
Лучшие результаты получаются при использовании родного DirectX видео
вывода (<tt class="option">-vo directx</tt>). Альтернативой является использование OpenGL или
SDL, но производительность OpenGL сильно зависит от машины, а SDL на некоторых
системах искажает видео или вылетает.
Если изображение искажено, попробуйте отключить аппаратное ускорение, указав
<tt class="option">-vo directx:noaccel</tt>. Скачайте
<a class="ulink" href="http://www.mplayerhq.hu/MPlayer/contrib/win32/dx7headers.tgz" target="_top">файлы заголовков
DirectX 7</a>, чтобы скомпилировать видео драйвер DirectX. Кроме того,
вам потребуется установленный DirectX 7, чтобы работал DirectX видеодрайвер.
</p><p>
<a class="link" href="#vidix" title="7.15. VIDIX">VIDIX</a> теперь доступен и под Windows, как
<tt class="option">-vo winvidix</tt>, хотя это ещё экспериментально и требует небольшой
ручной установки. Скачайте
<a class="ulink" href="http://www.mplayerhq.hu/MPlayer/releases/win32/dhahelperwin/dhahelper.sys" target="_top">dhahelper.sys</a> или
<a class="ulink" href="http://www.mplayerhq.hu/MPlayer/releases/win32/dhahelperwin/withmtrr/dhahelper.sys" target="_top">dhahelper.sys (с поддержкой MTRR)</a>
и скопируйте его в каталог
<tt class="filename">vidix/dhahelperwin</tt> в Вашем дереве
исходного кода <span class="application">MPlayer</span>'а.
Откройте консоль и перейдите в этот каталог. Теперь наберите
</p><pre class="screen">gcc -o dhasetup.exe dhasetup.c</pre><p>
и запустите
</p><pre class="screen">dhasetup.exe install</pre><p>
под Администратором. Теперь Вам нужно перезагрузить машину.
</p><p>
Для получения наилучших результатов, <span class="application">MPlayer</span>
должен использовать пространство цветов, аппаратно поддерживаемое Вашей
видеокартой. К сожалению, многие графические драйверы под Windows ошибочно
сообщают, что некоторые пространства цветов поддерживаются аппаратно.
Чтобы найти какие именно, попробуйте
</p><pre class="screen">
mplayer -benchmark -nosound -frames 100 -vf format=<em class="replaceable"><code>colorspace</code></em> <em class="replaceable"><code>movie</code></em>
</pre><p>,
где <em class="replaceable"><code>colorspace</code></em> может быть любым пространством
цветов из вывода опции <tt class="option">-vf format=fmt=help</tt>. Если Вы найдёте
пространство цветов, которое Ваша карта особенно плохо поддерживает,
опция <tt class="option">-vf noformat=<em class="replaceable"><code>colorspace</code></em></tt>
помешает его использованию. Добавьте это в ваш конфигурационный файл, чтобы
это пространство цветов больше никогда не использовалось.
</p><p>Существуют специальные пакеты кодеков для Windows, доступные на нашей
  <a class="ulink" href="http://www.mplayerhq.hu/design7/dload.html" target="_top">странице загрузки</a>,
  позволяющие воспроизводить форматы, для которых пока нет родной поддержки.
  Поместите их куда-нибудь в пути или укажите
  <tt class="filename">configure</tt> опцию
  <tt class="option">--codecsdir=<em class="replaceable"><code>c:/path/to/your/codecs</code></em></tt>
  (или <tt class="option">--codecsdir=<em class="replaceable"><code>/path/to/your/codecs</code></em></tt>, но
  только под <span class="application">Cygwin</span>).
  У нас были сообщения о том,
  что Real DLL должны быть доступны пользователю, запускающему
  <span class="application">MPlayer</span>, для записи, но только на
  некоторых системах (NT4). Если у Вас проблемы с ними, попробуйте сделать их
  доступными на запись.
</p><p>
Вы можете воспроизводить VCD, проигрывая <tt class="filename">.DAT</tt>
или <tt class="filename">.MPG</tt> файлы, которые Windows показывает на VCD.
Вот как это работает (указывайте букву диска Вашего CD-ROM):
</p><pre class="screen">mplayer <em class="replaceable"><code>d:/mpegav/avseq01.dat</code></em></pre><p>
В качестве альтернативы вы можете напрямую воспроизводить VCD дорожки, указав:
</p><pre class="screen">mplayer vcd://<em class="replaceable"><code>&lt;дорожка&gt;</code></em> -cdrom-device <em class="replaceable"><code>d:</code></em>
</pre><p>
DVDs также работают, укажите <tt class="option">-dvd-device</tt> с буквой Вашего DVD-ROM:
</p><pre class="screen">
mplayer dvd://<em class="replaceable"><code>&lt;title&gt;</code></em> -dvd-device <em class="replaceable"><code>d:</code></em>:
</pre><p>
Консоль <span class="application">Cygwin</span>/<span class="application">MinGW</span>
весьма медленная. Перенаправление вывода или
использование опции <tt class="option">-quiet</tt> улучшает производительность на
некоторых системах. Прямой рендеринг (<tt class="option">-dr</tt>)
также может помочь.  Если воспроизведение
прерывисто, попробуйте <tt class="option">-autosync 100</tt>. Если какие-то из этих
опций Вам помогут, стоит поместить их в конфигурационный файл.
</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Если у Вас Pentium 4 и Вы заметили крахи при использовании кодеков RealPlayer,
  попробуйте отключить hyperthreading.
</p></div><div class="sect2" title="8.4.1. Cygwin"><div class="titlepage"><div><div><h3 class="title"><a name="cygwin"></a>8.4.1. <span class="application">Cygwin</span></h3></div></div></div><p>
Для компиляции <span class="application">MPlayer</span> требуется запустить
<span class="application">Cygwin</span> версии 1.5.0 или старше.
</p><p>
Файлы заголовков DirectX надо распаковать в
<tt class="filename">/usr/include/</tt> или
<tt class="filename">/usr/local/include/</tt>.
</p><p>
Вы можете найти инструкции и файлы для запуска SDL под
<span class="application">Cygwin</span> на
<a class="ulink" href="http://www.libsdl.org/extras/win32/cygwin/" target="_top">сайте libsdl</a>.
</p></div><div class="sect2" title="8.4.2. MinGW"><div class="titlepage"><div><div><h3 class="title"><a name="mingw"></a>8.4.2. <span class="application">MinGW</span></h3></div></div></div><p>
Прежде, установка версии <span class="application">MinGW</span>,
способной скомпилировать <span class="application">MPlayer</span>, была
сложновата, но сейчас все работает с самого начала. Просто установите
<span class="application">MinGW</span> 3.1.0 или более новый и MSYS 1.0.9 или старше и
укажите постустановщику MSYS, что <span class="application">MinGW</span>
установлен.
</p><p>
Распакуйте файлы заголовков DirectX в
<tt class="filename">/mingw/include/</tt>.
</p><p>
Для поддержки сжатых заголовкоав MOV необходима
<a class="ulink" href="http://www.gzip.org/zlib/" target="_top">zlib</a>, которую
<span class="application">MinGW</span> по умолчанию не предоставляет.
Сконфигурируйте её, указав <tt class="option">--prefix=/mingw</tt> и установите
её до компиляции <span class="application">MPlayer</span>'а.
</p><p>
Полные инструкции по сборке <span class="application">MPlayer</span> и необходимых
библиотек могут быть найдены на странице
<a class="ulink" href="http://www.mplayerhq.hu/MPlayer/contrib/win32/MPlayer-MinGW-Howto.txt" target="_top">MPlayer MinGW HOWTO</a>.
</p></div></div><div class="sect1" title="8.5. Mac OS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="macos"></a>8.5. Mac OS</h2></div></div></div><p>
<span class="application">MPlayer</span> не работает на Mac OS версий меньше 10,
но компилируется "из коробки" на Mac OS X 10.2 и старше. Предпочитаемым компилятором
является версия Apple GCC 3.x или более позднего. Вы можете получить начальное окружение
для компиляции, установив Apple'овский
<a class="ulink" href="http://developer.apple.com/tools/download/" target="_top">Xcode</a>.
Если у вас Mac OS X 10.3.9 или выше и QuickTime 7, можете использовать
драйвер видео вывода <tt class="option">corevideo</tt>.
</p><p>
К сожалению, основное окружение не позволяет получить преимущество от всех
приятных возможностей <span class="application">MPlayer</span>. В частности,
чтобы иметь включенную поддержку OSD, потребуются установленные в системе
библиотеки <code class="systemitem">fontconfig</code>
и <code class="systemitem">freetype</code>.
В отличие от остальных Unix'ов, таких как Linux и клоны BSD, OS X
не имеет поставляющейся с ОС систему управления пакетами.
</p><p>
Есть как минимум два на выбор:
<a class="ulink" href="http://fink.sourceforge.net/" target="_top">Fink</a> и
<a class="ulink" href="http://www.macports.org/" target="_top">MacPorts</a>.
Они оба предоставляют одинаковый сервис (т.е. огромное количество пакетов
для установки, разрешение зависимостей, возможность простой
установки/обновления/удаления пакетов и т.д.).
Fink предлагает как предкомпилированные бинарные пакеты, так и сборку
всего из исходников, в то время как MacPorts предлагает только собирать из
исходных текстов.
Автор данного руководства выбрал MacPorts исходя из того простого соображения,
что его базовая установка легче.
Последующие примеры будут основаны на MacPorts.
</p><p>
В частности для компиляции <span class="application">MPlayer</span> с поддержкой OSD:
</p><pre class="screen">sudo port install pkgconfig</pre><p>
Это установит <span class="application">pkg-config</span>, который является системой
управления флагами компиляции/сборки библиотек.
Скрипт <code class="systemitem">configure</code> программы <span class="application">MPlayer</span>
использует его для правильного обнаружения библиотек.
Тем же способом можно установить <span class="application">fontconfig</span>:
</p><pre class="screen">sudo port install fontconfig</pre><p>
Затем можно продолжить, запустив <span class="application">MPlayer</span>'овский
<code class="systemitem">configure</code> скрипт (задайте переменные окружения
<code class="systemitem">PKG_CONFIG_PATH</code> и <code class="systemitem">PATH</code> так,
чтобы <code class="systemitem">configure</code> мог найти библиотеки, установленные
при помощи MacPorts):
</p><pre class="screen">
PKG_CONFIG_PATH=/opt/local/lib/pkgconfig/ PATH=$PATH:/opt/local/bin/ ./configure
</pre><p>
</p><div class="sect2" title="8.5.1. MPlayer OS X GUI"><div class="titlepage"><div><div><h3 class="title"><a name="osx_gui"></a>8.5.1. MPlayer OS X GUI</h3></div></div></div><p>
Вы можете получить родной GUI для <span class="application">MPlayer</span> вместе с
предкомпилированными бинарниками <span class="application">MPlayer</span> для Mac OS X
из проекта
<a class="ulink" href="http://mplayerosx.sf.net/" target="_top">MPlayerOSX</a>, но предупреждаем:
этот проект давно не развивается.
</p><p>
К счастью, <span class="application">MPlayerOSX</span> был подхвачен членом команды
<span class="application">MPlayer</span>. Предварительные релизы доступны с нашей
<a class="ulink" href="http://mplayerhq.hu/dload.html" target="_top">страницы загрузки</a>
и скоро ожидается официальный релиз.
</p><p>
Чтобы самостоятельно собрать <span class="application">MPlayerOSX</span> из
исходный текстов, вам потребуется
<code class="systemitem">mplayerosx</code>,
<code class="systemitem">main</code> и копию
<code class="systemitem">main</code> SVN модуля, называющегося
<code class="systemitem">main_noaltivec</code>.
<code class="systemitem">mplayerosx</code> - это GUI frontend,
<code class="systemitem">main</code> - это MPlayer, а
<code class="systemitem">main_noaltivec</code> - это MPlayer собранный без поддержки AltiVec.
</p><p>
Для извлечения модулей из SVN:

</p><pre class="screen">
svn checkout svn://svn.mplayerhq.hu/mplayerosx/trunk/ mplayerosx
svn checkout svn://svn.mplayerhq.hu/mplayer/trunk/ main
</pre><p>
</p><p>
Чтобы собрать <span class="application">MPlayerOSX</span> потребуется настроить что-то вроде этого:
</p><pre class="screen">
MPlayer_source_directory
   |
   |---&gt;main           (MPlayer Subversion исходники)
   |
   |---&gt;main_noaltivec (MPlayer Subversion исходники, сконфигурированные с --disable-altivec)
   |
   \---&gt;mplayerosx     (MPlayer OS X Subversion исходники)
</pre><p>
Сначала надо собрать main и main_noaltivec.
</p><p>
Для начала, чтобы добиться максимальной обратной совместимости, установите
переменную окружения:
</p><pre class="screen">export MACOSX_DEPLOYMENT_TARGET=10.3</pre><p>
</p><p>
Затем сконфигурируйте:
</p><p>
Если конфигурируете для G4 или более позднего CPU с поддержкой AltiVec,
делайте так:
</p><pre class="screen">
./configure --disable-gl --disable-x11
</pre><p>
Если конфигурируете для машины c G3 без AltiVec, используйте:
</p><pre class="screen">
./configure --disable-gl --disable-x11 --disable-altivec
</pre><p>
Вам может потребоваться отредактировать <tt class="filename">config.mak</tt> и изменить
<code class="systemitem">-mcpu</code> и <code class="systemitem">-mtune</code>
с <code class="systemitem">74XX</code> на <code class="systemitem">G3</code>.
</p><p>
Продолжайте с
</p><pre class="screen">make</pre><p>
после чего идите в каталог mplayerosx и там наберите:
</p><pre class="screen">make dist</pre><p>
Это создаст сжатый архив <code class="systemitem">.dmg</code> с котовым к использованию
бинарником.
</p><p>
Также можно использовать проект <span class="application">Xcode</span> 2.1;
более старый <span class="application">Xcode</span> 1.x больше не работает.
</p></div></div></div><div class="chapter" title="Глава 9. Основы использования MEncoder"><div class="titlepage"><div><div><h2 class="title"><a name="mencoder"></a>Глава 9. Основы использования <span class="application">MEncoder</span></h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#menc-feat-selecting-codec">9.1. Выбор кодеков и формата файлов</a></span></dt><dt><span class="sect1"><a href="#menc-feat-selecting-input">9.2. Выбор входного файла или устройства</a></span></dt><dt><span class="sect1"><a href="#menc-feat-mpeg4">9.3. Двухпроходное кодирование MPEG-4 ("DivX")</a></span></dt><dt><span class="sect1"><a href="#menc-feat-handheld-psp">9.4. Кодирование в Sony PSP видео формат</a></span></dt><dt><span class="sect1"><a href="#menc-feat-mpeg">9.5. Кодирование в MPEG формат</a></span></dt><dt><span class="sect1"><a href="#menc-feat-rescale">9.6. Масштабирование фильмов</a></span></dt><dt><span class="sect1"><a href="#menc-feat-streamcopy">9.7. копирование потока</a></span></dt><dt><span class="sect1"><a href="#menc-feat-enc-images">9.8. Кодирование из нескольких входных файлов изображений (JPEG, PNG, TGA, SGI)</a></span></dt><dt><span class="sect1"><a href="#menc-feat-extractsub">9.9. Извлечение DVD субтитров в файл VOBsub</a></span></dt><dt><span class="sect1"><a href="#aspect">9.10. Сохранение пропорций</a></span></dt></dl></div><p>
Полный список доступных опций <span class="application">MEncoder</span> и примеры
смотрите на странице руководства man.

Ряд наглядных примеров и подробные руководства по использованию отдельных
параметров кодирования, можно узнать прочтя
<a class="ulink" href="../../tech/encoding-tips.txt" target="_top">советы по кодированию</a>, которые мы
собрали из отдельных нитей[threads] рассылки MPlayer-users. В архивах
<a class="ulink" href="http://lists.mplayerhq.hu/pipermail/mencoder-users/" target="_top">здесь</a>
и, особенно по поводу старых вещей,
<a class="ulink" href="http://lists.mplayerhq.hu/pipermail/mplayer-users/" target="_top">здесь</a>
найдется множество дискуссий, посвященных всех аспектам и проблемам кодирования
при помощи  <span class="application">MEncoder</span>.
</p><div class="sect1" title="9.1. Выбор кодеков и формата файлов"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-selecting-codec"></a>9.1. Выбор кодеков и формата файлов</h2></div></div></div><p>
Аудио и видео кодеки для кодирования выбираются опциями
<tt class="option">-oac</tt> и <tt class="option">-ovc</tt>, соответственно.
Наберите для примера:
</p><pre class="screen">mencoder -ovc help</pre><p>
чтобы получить список всех видео кодеков поддерживаемых
версией <span class="application">MEncoder</span>, установленной на вашей машине.
Доступны следующие варианты:
</p><p>
Аудио кодеки:
</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Название кодека</th><th>Описание</th></tr></thead><tbody><tr><td>mp3lame</td><td>Кодируйте в VBR, ABR или CBR MP3 с LAME</td></tr><tr><td>lavc</td><td>Используйте один из кодеков библиотеки <a class="link" href="#menc-feat-enc-libavcodec-audio-codecs" title="10.3.2. Аудио кодеки libavcodec"><code class="systemitem">libavcodec</code></a></td></tr><tr><td>faac</td><td>FAAC AAC аудио кодер</td></tr><tr><td>toolame</td><td>MPEG Audio Layer 2 кодер</td></tr><tr><td>twolame</td><td>MPEG Audio Layer 2 кодер, основанный на tooLAME</td></tr><tr><td>pcm</td><td>Несжатый PCM звук</td></tr><tr><td>copy</td><td>Не перекодировать, просто копировать сжатые кадры</td></tr></tbody></table></div><p>
</p><p>
Видео кодеки:
</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Название кодека</th><th>Описание</th></tr></thead><tbody><tr><td>lavc</td><td>Используйте один из кодеков библиотеки <a class="link" href="#menc-feat-enc-libavcodec-video-codecs" title="10.3.1. Видео кодеки libavcodec"><code class="systemitem">libavcodec</code></a></td></tr><tr><td>xvid</td><td>Xvid, MPEG-4 Advanced Simple Profile (ASP) кодек</td></tr><tr><td>x264</td><td>x264, MPEG-4 Advanced Video Coding (AVC), AKA[он же] H.264 кодек</td></tr><tr><td>nuv</td><td>nuppel видео, используемое некоторыми приложениями реального времени</td></tr><tr><td>raw</td><td>Несжатые видео кадры</td></tr><tr><td>copy</td><td>Не перекодировать, просто скопировать сжатые кадры</td></tr><tr><td>frameno</td><td>Использовался для 3-х проходного кодирования (не рекомендуется)</td></tr></tbody></table></div><p>
</p><p>
Формат выходных файлов выбирается опцией <tt class="option">-of</tt>.
Наберите:
</p><pre class="screen">mencoder -of help</pre><p>
чтобы получить список всех форматов, поддерживаемых версией
<span class="application">MEncoder</span>, установленного на вашей машине.
Доступны следующие варианты:
</p><p>
Форматы файлов:
</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Название формата</th><th>Описание</th></tr></thead><tbody><tr><td>lavf</td><td>Один из форматов, поддерживаемых библиотекой
  <code class="systemitem">libavformat</code></td></tr><tr><td>avi</td><td>'Слоеное' Аудио-Видео</td></tr><tr><td>mpeg</td><td>MPEG-1 и MPEG-2 PS</td></tr><tr><td>rawvideo</td><td>сырой видео поток (без мультиплексирования - только видео поток)</td></tr><tr><td>rawaudio</td><td>сырой аудио поток (без мультиплексирования - только аудио поток)</td></tr></tbody></table></div><p>
AVI является родным форматом для  <span class="application">MEncoder</span>,
что означает наилучшую его поддержку,
<span class="application">MEncoder</span> изначально разрабатывался для этого формата.
Как замечено выше, другие форматы тоже пригодны, но
вы можете столкнуться с проблемами при их использовании.
</p><p>
форматы файлов библиотеки <code class="systemitem">libavformat</code>:
</p><p>
Если вы выбрали <code class="systemitem">libavformat</code> для
мультиплексирования выходного файла (используя <tt class="option">-of lavf</tt>),
подходящий формат файла будет определен по расширению выходного файла.
Вы можете заставить использовать конкретный формат опцией
<tt class="option">format</tt> библиотеки
<code class="systemitem">libavformat</code>.

</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>название формата <code class="systemitem">libavformat</code></th><th>Описание</th></tr></thead><tbody><tr><td>mpg</td><td>MPEG-1 и MPEG-2 PS</td></tr><tr><td>asf</td><td>Advanced Streaming Format</td></tr><tr><td>avi</td><td>'Слоеное' Аудио-Видео</td></tr><tr><td>wav</td><td>Waveform Аудио</td></tr><tr><td>swf</td><td>Macromedia Flash</td></tr><tr><td>flv</td><td>Macromedia Flash видео</td></tr><tr><td>rm</td><td>RealMedia</td></tr><tr><td>au</td><td>SUN AU</td></tr><tr><td>nut</td><td>
  открытый формат NUT (экспериментальный и пока не полностью соответствующий спецификации)
  </td></tr><tr><td>mov</td><td>QuickTime</td></tr><tr><td>mp4</td><td>MPEG-4 формат</td></tr><tr><td>dv</td><td>Sony Digital Видео формат</td></tr><tr><td>mkv</td><td>Открытый аудио/видео контейнер Matroska</td></tr></tbody></table></div><p>
Как видите, <code class="systemitem">libavformat</code>
позволяет <span class="application">MEncoder</span> мультиплексировать во
множество форматов.
К сожалению, поскольку <span class="application">MEncoder</span> изначально не разрабатывался
для поддержки форматов, отличных от AVI, вам следует относиться к результирующему
файлу с определенной долей паранойи. Убедитесь, что в порядке Аудио/видео синхронизация, и
файл воспроизводится не только в <span class="application">MPlayer</span>.
</p><div class="example"><a name="encode_to_macromedia_flash_format"></a><p class="title"><b>Пример 9.1. Кодирование в формат Macromedia Flash</b></p><div class="example-contents"><p>
Создание видео Macromedia Flash, подходящего для воспроизведения в веб браузере плагином
Macromedia Flash:
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.avi</code></em> -o <em class="replaceable"><code>output.flv</code></em> -of lavf \
    -oac mp3lame -lameopts abr:br=56 -srate 22050 -ovc lavc \
    -lavcopts vcodec=flv:vbitrate=500:mbd=2:mv0:trell:v4mv:cbp:last_pred=3
</pre><p>
</p></div></div><br class="example-break"></div><div class="sect1" title="9.2. Выбор входного файла или устройства"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-selecting-input"></a>9.2. Выбор входного файла или устройства</h2></div></div></div><p>
<span class="application">MEncoder</span> может кодировать из файлов или непосредственно
с DVD или VCD диска.
Просто укажите имя файла в командной строке для кодирования из файла,
или <tt class="option">dvd://</tt><em class="replaceable"><code>номер_ролика</code></em> или
<tt class="option">vcd://</tt><em class="replaceable"><code>номер_дорожки</code></em> для кодирования
DVD ролика или VCD дорожки.
Если вы уже скопировали DVD на жесткий диск (може воспользоваться утилитой вроде
<span class="application">dvdbackup</span>, доступной на многих системах),
и желаете кодировать из копии, вледует по-прежнему использовать
<tt class="option">dvd://</tt> синтаксис, вместе с <tt class="option">-dvd-device</tt>
с последующим путек к корню копии DVD.

Опции <tt class="option">-dvd-device</tt> и <tt class="option">-cdrom-device</tt> также могут
быть использованы для переопределения путей к файлам устройств для
чтения прямо с диска, если значения по-умолчанию
<tt class="filename">/dev/dvd</tt> и <tt class="filename">/dev/cdrom</tt> не подходят для
вашей системы.
</p><p>
При кодировании с DVD, часто бывает желательно выбрать раздел или диапазон
разделов для кодирования. для этой цели можно использовать опцию
<tt class="option">-chapter</tt>.
Например, <tt class="option">-chapter</tt> <em class="replaceable"><code>1-4</code></em>
будет кодировать только разделы DVD с 1-го по 4-й.
Это особенно полезно при кодировании 1400Мб с целью уместить их на 2 CD,
так как вы можете разбить фильм точно на границе раздела, вместо
середины некоторой сцены.
</p><p>
  Если у вас есть поддерживаемая карта TV захвата, вы также можете
  кодировать с TV входа.
  Используйте <tt class="option">tv://</tt><em class="replaceable"><code>номер_канала</code></em> в качестве
  имени файла, и опцию <tt class="option">-tv</tt> для настройки различный параметров захвата.
  DVB вход работает аналогично.
</p></div><div class="sect1" title='9.3. Двухпроходное кодирование MPEG-4 ("DivX")'><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-mpeg4"></a>9.3. Двухпроходное кодирование MPEG-4 ("DivX")</h2></div></div></div><p>
Название происходит из того факта, что кодирование файла производится
<span class="emphasis"><em>дважды</em></span>.
Первое кодирование (дублирующий проход) создает несколько временных файлов
(<tt class="filename">*.log</tt>) размером в несколько мегабайт, не удаляйте их пока
(вы можете удалить AVI или вообще не создавать видеофайл, перенаправив его
в <tt class="filename">/dev/null</tt>). На втором проходе, с использованием данных о
битпотоке из временных файлов, формируется готовый выходной. Получившийся файл
будет иметь намного лучшее качество картинки. Если слышите об этом в первый раз,
обратитесь к руководствам, которые можно найти в интернет.
</p><div class="example"><a name="copy_audio_track"></a><p class="title"><b>Пример 9.2. копирование звуковой дорожки</b></p><div class="example-contents"><p>
Кодирование (двухпроходное) второй дорожки DVD в MPEG-4 ("DivX") AVI с
копированием звуковой дорожки.
</p><pre class="screen">
mencoder dvd://2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=1 -oac copy -o /dev/null
mencoder dvd://2 -ovc lavc -lavcopts vcodec=mpeg4:mbd=2:trell:vpass=2 \
    -oac copy -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
</p></div></div><br class="example-break"><div class="example"><a name="encode_audio_track"></a><p class="title"><b>Пример 9.3. кодирование звуковой дорожки</b></p><div class="example-contents"><p>
Кодирование (в два прохода) DVD в MPEG-4 ("DivX") AVI с кодированием
звуковой дорожки в MP3. Будьте аккуратны, используя этот метод, так как в некоторых случаях
это может привести к рассинхронизации аудио/видео.
</p><pre class="screen">
mencoder dvd://2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=1 \
    -oac mp3lame -lameopts vbr=3 -o /dev/null
mencoder dvd://2 -ovc lavc -lavcopts vcodec=mpeg4:mbd=2:trell:vpass=2 \
    -oac mp3lame -lameopts vbr=3 -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
</p></div></div><br class="example-break"></div><div class="sect1" title="9.4. Кодирование в Sony PSP видео формат"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-handheld-psp"></a>9.4. Кодирование в Sony PSP видео формат</h2></div></div></div><p>
<span class="application">MEncoder</span> поддерживает кодирование в видео формат
Sony PSP, но, в зависимости от ревизии программного обеспечения PSP,
с различными ограничениями. Можете не беспокоиться, если не будете
нарушать следующие ограничения:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>Битовый поток</strong></span>: не должен превышать 1500кбит/с,
  тем не менее, последние версии очень хорошо поддерживали  любой битрейт, пока
  заголовок не требовал черезчур большого значения.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Размеры</strong></span>: ширина и высота PSP видео должна быть
  кратна 16, а произведение ширина * высота не должно превышать 64000.
  В некоторых случаях возможно воспроизведение видео большего размера.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Звук</strong></span>: частота дискретизации должна быть
  24кГц для MPEG-4, и 48кГц для H.264.
</p></li></ul></div><p>
</p><div class="example"><a name="encode_for_psp"></a><p class="title"><b>Пример 9.4. Кодирование для PSP</b></p><div class="example-contents"><p>
</p><pre class="screen">
mencoder -ofps 30000/1001 -af lavcresample=24000 -vf harddup -of lavf \
    -oac lavc -ovc lavc -lavcopts aglobal=1:vglobal=1:vcodec=mpeg4:acodec=aac \
    -lavfopts format=psp \
<em class="replaceable"><code>input.video</code></em> -o <em class="replaceable"><code>output.psp</code></em>
</pre><p>
Заметьте, что можно задать заголовок видео опцией
<tt class="option">-info name=<em class="replaceable"><code>Заголовок_Фильма</code></em></tt>.
</p></div></div><br class="example-break"></div><div class="sect1" title="9.5. Кодирование в MPEG формат"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-mpeg"></a>9.5. Кодирование в MPEG формат</h2></div></div></div><p>
<span class="application">MEncoder</span> может создавать файлы формата MPEG (MPEG-PS).
MPEG-1 или MPEG-2 обычно используют по причине кодирования в более
ограниченные форматы, такие как SVCD, VCD или DVD.
Особые требования для этих форматов описаны в
<a class="link" href="#menc-feat-vcd-dvd" title="10.8. Использование MEncoder для создания VCD/SVCD/DVD-совместимых файлов."> руководстве по созданию VCD и DVD</a>
section.
</p><p>
Чтобы сменить формат выходного файла <span class="application">MEncoder</span>, используйте
опцию <tt class="option">-of mpeg</tt>.
</p><div class="informalexample"><p>
Пример:
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.avi</code></em> -of mpeg -ovc lavc -lavcopts
vcodec=mpeg1video \
    -oac copy <em class="replaceable"><code>other_options</code></em> -o <em class="replaceable"><code>output.mpg</code></em>
</pre><p>
Создается файл MPEG-1 пригодный для воспроизведения на системах с минимальной поддержкой
мультимедиа, таких как только что установленные Windows:
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.avi</code></em> -of mpeg -mpegopts format=mpeg1:tsaf:muxrate=2000 \
    -o <em class="replaceable"><code>output.mpg</code></em> -oac lavc -lavcopts acodec=mp2:abitrate=224 -ovc lavc \
    -lavcopts vcodec=mpeg1video:vbitrate=1152:keyint=15:mbd=2:aspect=4/3
</pre><p>
То же, но используя <code class="systemitem">libavformat</code> MPEG
мультиплексор:
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.avi</code></em> -o <em class="replaceable"><code>VCD.mpg</code></em> -ofps 25 -vf scale=352:288,harddup -of lavf \
    -lavfopts format=mpg -oac lavc -lavcopts acodec=mp2:abitrate=224 -ovc lavc \
    -lavcopts vcodec=mpeg1video:vrc_buf_size=327:keyint=15:vrc_maxrate=1152:vbitrate=1152:vmax_b_frames=0
</pre><p>
</p></div><div class="note" title="Подсказка:" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Подсказка:</h3><p>
Если по каким-то причинам видео после второго прохода вас не устраивает,
можно снова запустить кодирование с другими значениями битпотока, при
условии, что вы сохранили статистику предыдущего прохода.
Это возможно, потому что основная задача файла со статистикой - записывать
сложность каждого кадра, которая жестко с битпотоком не связана.
Следует иметь в виду, что, несмотря на это, лучшее качество получается если
значения результирующего битпотока всех проходов не сильно отличаются.
</p></div></div><div class="sect1" title="9.6. Масштабирование фильмов"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-rescale"></a>9.6. Масштабирование фильмов</h2></div></div></div><p>
Часто возникает потребность изменить размер изображения у фильма.
Причин может быть много: уменьшение размера файла, пропускная способность сети,
и т.д. Большинство производят масштабирование даже при конвертации DVD или SVCD в AVI.
Если есть желание провести масштабирование, прочтите раздел
<a class="link" href="#aspect" title="9.10. Сохранение пропорций">Сохранение пропорций</a>.
</p><p>
Процесс масштабирование осуществляется плагином <code class="literal">scale</code>:
<tt class="option">-vf scale=<em class="replaceable"><code>ширина</code></em>:<em class="replaceable"><code>высота</code></em></tt>.
Качество может быть установлено опцией <tt class="option">-sws</tt>.
Если не указано, <span class="application">MEncoder</span> будет использовать 2: бикубическое.
</p><p>
Использование:
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.mpg</code></em> -ovc lavc -lavcopts vcodec=mpeg4:mbd=2:trell \
    -vf scale=640:480 -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
</p></div><div class="sect1" title="9.7. копирование потока"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-streamcopy"></a>9.7. копирование потока</h2></div></div></div><p>
<span class="application">MEncoder</span> может обрабатывать входные потоки двумя способами:
<span class="bold"><strong>кодировать</strong></span> или <span class="bold"><strong>копировать</strong></span>
их. Этот раздел о <span class="bold"><strong>копировании</strong></span>.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>Видео поток</strong></span> (опция <tt class="option">-ovc copy</tt>):
  можно делать классные вещи :) Вроде помещения (не преобразования!) FLI или VIVO или
  MPEG-1 видео в AVI файл! Конечно, проиграть такие файлы сможет только
  <span class="application">MPlayer</span> :) И, возможно, никакого реальной пользы в
  этом нет. Реально: копирование видеопотока может быть полезно, если надо кодировать только
  аудио поток (например, несжатый PCM в MP3).
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Аудио поток</strong></span> (опция <tt class="option">-oac copy</tt>):
  straightforward. Возможно взять внешний файл (MP3, WAV) и уплотнить[mux] его в выходной
  поток. Воспользуйтесь опцией <tt class="option">-audiofile <em class="replaceable"><code>имя_файла</code></em></tt>,
  чтобы сделать это.
</p></li></ul></div><p>
Использование <tt class="option">-oac copy</tt> для копирования из одного формата в другой
может потребовать указания <tt class="option">-fafmttag</tt> для сохранения тэга аудио формата
из оригинального файла. Например, если вы преобразовываете NSV файл со звуком AAC
в формат AVI, аудио формат будет неверен и должен быть изменен. Чтобы получить список
тэгов аудио формата проверьте <tt class="filename">codecs.conf</tt>.
</p><p>
Пример:
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.nsv</code></em> -oac copy -fafmttag 0x706D \
    -ovc lavc -lavcopts vcodec=mpeg4:mbd=2:trell -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
</p></div><div class="sect1" title="9.8. Кодирование из нескольких входных файлов изображений (JPEG, PNG, TGA, SGI)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-enc-images"></a>9.8. Кодирование из нескольких входных файлов изображений (JPEG, PNG, TGA, SGI)</h2></div></div></div><p>
<span class="application">MEncoder</span> может создавать фильмы из одного или более
JPEG, PNG, TGA или других файлов изображений. Простым копированием кадров он может создавать MJPEG
(Motion JPEG), MPNG (Motion PNG) или MTGA (Motion TGA) файлы.
</p><div class="orderedlist" title="Разъяснение процесса:"><p class="title"><b>Разъяснение процесса:</b></p><ol class="orderedlist" type="1"><li class="listitem"><p>
  <span class="application">MEncoder</span> <span class="emphasis"><em>декодирует</em></span> изображение(я) с помощью
  <code class="systemitem">libjpeg</code> (при декодировании PNG, он будет
  использовать <code class="systemitem">libpng</code>).
</p></li><li class="listitem"><p>
  <span class="application">MEncoder</span> затем скармливает декодированное изображение выбранному
  видео компрессору (DivX4, Xvid, FFmpeg msmpeg4, и .т.д).
</p></li></ol></div><p title="примеры"><b>примеры. </b>
The explanation of the <tt class="option">-mf</tt> option is in the man page.

</p><div class="informalexample"><p>
Создание файла MPEG-4 из всех JPEG файлов текущего каталога:
</p><pre class="screen">
mencoder mf://*.jpg -mf w=800:h=600:fps=25:type=jpg -ovc lavc \
    -lavcopts vcodec=mpeg4:mbd=2:trell -oac copy -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
</p></div><p title="примеры">

</p><div class="informalexample"><p>
Создание файла MPEG-4 из некоторых JPEG файлов текущего каталога:
</p><pre class="screen">
mencoder mf://<em class="replaceable"><code>frame001.jpg,frame002.jpg</code></em> -mf w=800:h=600:fps=25:type=jpg \
    -ovc lavc -lavcopts vcodec=mpeg4:mbd=2:trell -oac copy -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
</p></div><p title="примеры">

</p><div class="informalexample"><p>
Создание файла MPEG-4 из явного списка JPEG файлов (list.txt в текущем каталоге содержит
список файлов, используемых в качестве источника, по одному в строке):
</p><pre class="screen">
mencoder mf://<em class="replaceable"><code>@list.txt</code></em> -mf w=800:h=600:fps=25:type=jpg \
    -ovc lavc -lavcopts vcodec=mpeg4:mbd=2:trell -oac copy -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
</p></div><p title="примеры">

Вы можете смешивать различные типы изображений независимо от используемого
метода — отдельные файлы, маска или файл со списком — при условии,
конечно, что они имеют одинаковое разрешение.
Так что вы можете, например, взять титульный кадр из PNG файла, а затем
поместить слайдшоу из JPEG фотографий.

</p><div class="informalexample"><p>
Создание файла Motion JPEG (MJPEG) из всех JPEG файлов текущего каталога:
</p><pre class="screen">
mencoder mf://*.jpg -mf w=800:h=600:fps=25:type=jpg -ovc copy -oac copy -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
</p></div><p title="примеры">

</p><div class="informalexample"><p>
Создание несжатого файла из всех PNG файлов текущего каталога:
</p><pre class="screen">
mencoder mf://*.png -mf w=800:h=600:fps=25:type=png -ovc raw -oac copy -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
</p></div><p title="примеры">

</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
Ширина должна быть целым числом, кратным 4, это ограничение формата RAW RGB AVI.
</p></div><p title="примеры">

</p><div class="informalexample"><p>
Создание файла Motion PNG (MPNG) из всех PNG файлов текущего каталога:
</p><pre class="screen">
mencoder mf://*.png -mf w=800:h=600:fps=25:type=png -ovc copy -oac copy -o <em class="replaceable"><code>output.avi</code></em></pre><p>
</p></div><p title="примеры">

</p><div class="informalexample"><p>
Создание файла Motion TGA (MTGA) из всех TGA файлов текущего каталога:
</p><pre class="screen">
mencoder mf://*.tga -mf w=800:h=600:fps=25:type=tga -ovc copy -oac copy -o <em class="replaceable"><code>output.avi</code></em></pre><p>
</p></div><p title="примеры">
</p></div><div class="sect1" title="9.9. Извлечение DVD субтитров в файл VOBsub"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-extractsub"></a>9.9. Извлечение DVD субтитров в файл VOBsub</h2></div></div></div><p>
<span class="application">MEncoder</span> способен извлекать субтитры из DVD в файлы формата
VOBsub. Они состоят из пары файлов, оканчивающихся на
<tt class="filename">.idx</tt> и <tt class="filename">.sub</tt> и обычно
упакованы в один <tt class="filename">.rar</tt> архив.
<span class="application">MPlayer</span> может воспроизводить из при помощи опций
<tt class="option">-vobsub</tt> и <tt class="option">-vobsubid</tt>.
</p><p>
Вы указываете базовое имя (т.е. без расширения <tt class="filename">.idx</tt> или
<tt class="filename">.sub</tt>) выходных файлов с помощью
<tt class="option">-vobsubout</tt> и индекс этих субтитров в результирующем файле
при помощи <tt class="option">-vobsuboutindex</tt>.
</p><p>
Если источником является не DVD следует использовать <tt class="option">-ifo</tt> для
указания указания файла <tt class="filename">.ifo</tt>, необходимого для создания
результирующего <tt class="filename">.idx</tt> файла.
</p><p>
Если источником является не DVD и у вас нет <tt class="filename">.ifo</tt> файла,
используйте опцию <tt class="option">-vobsubid</tt> для указания, какой ид языка
следует записать в <tt class="filename">.idx</tt> файл.
</p><p>
При каждом запуске субтитры будут добавляться в конец файлов, если
<tt class="filename">.idx</tt> и <tt class="filename">.sub</tt> уже существуют.
Так что вам следует удалять их перед началом.
</p><div class="example"><a name="copying_two_subtitles_from_a_dvd_while_doing_two_pass_encoding"></a><p class="title"><b>Пример 9.5. копирование двух субтитров из DVD при выполнении двухпроходного кодирования</b></p><div class="example-contents"><pre class="screen">
rm <em class="replaceable"><code>subtitles.idx</code></em> <em class="replaceable"><code>subtitles.sub</code></em>
mencoder dvd://1 -oac copy -ovc lavc -lavcopts vcodec=mpeg4:vpass=1 \
    -vobsubout subtitles -vobsuboutindex 0 -sid 2
mencoder dvd://1 -oac copy -ovc lavc -lavcopts vcodec=mpeg4:mbd=2:trell:vpass=2 \
    -vobsubout subtitles -vobsuboutindex 1 -sid 5</pre></div></div><br class="example-break"><div class="example"><a name="copying_a_french_subtitle_from_an_mpeg_file"></a><p class="title"><b>Пример 9.6. Копирование французских субтитров из MPEG файла</b></p><div class="example-contents"><pre class="screen">
rm <em class="replaceable"><code>subtitles.idx</code></em> <em class="replaceable"><code>subtitles.sub</code></em>
mencoder <em class="replaceable"><code>movie.mpg</code></em> -ifo <em class="replaceable"><code>movie.ifo</code></em> -vobsubout <em class="replaceable"><code>subtitles</code></em> -vobsuboutindex 0 \
    -vobsuboutid fr -sid 1 -nosound -ovc copy
</pre></div></div><br class="example-break"></div><div class="sect1" title="9.10. Сохранение пропорций"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aspect"></a>9.10. Сохранение пропорций</h2></div></div></div><p>
DVD и SVCD (т.е. MPEG-1/2) файлы содержат информацию о пропорции, которая описывает
как проигрыватель должен масштабировать видео поток, чтобы люди не становились яйцеголовыми.
(напр.: 480x480 + 4:3 = 640x480). Хотя при кодировании в  AVI (DivX) файлы вы избавлены от этой
проблемы, т.к. заголовки AVI не содержат это значение.
Масштабирование изображения отвратительно и расточительно, есть лучший путь!
</p><p>There is</p><p>
MPEG-4 имеет уникальную возможность: видео поток может хранить требуемые ему пропорции.
Да, в точности как MPEG-1/2 (DVD, SVCD) и H.263 файлы. К сожалению, немного проигрывателей
кроме <span class="application">MPlayer</span> поддерживают этот MPEG-4 атрибут.
</p><p>
Эта возможность может использоваться только с
<code class="systemitem">libavcodec</code>'овским
<code class="systemitem">mpeg4</code> кодеком. Имейте в виду: хотя
<span class="application">MPlayer</span> корректно воспроизведет файл, другие
проигрыватели могут использовать неверные пропорции.
</p><p>
Вы серьезно должны обрезать черные полосы выше и ниже изображения.
Смотрите страницу руководства man по использованию <code class="systemitem">cropdetect</code> и
<code class="systemitem">crop</code> плагинов.
</p><p>
Использование:
</p><pre class="screen">mencoder <em class="replaceable"><code>sample-svcd.mpg</code></em> -vf crop=714:548:0:14 -oac copy -ovc lavc \
    -lavcopts vcodec=mpeg4:mbd=2:trell:autoaspect -o <em class="replaceable"><code>output.avi</code></em></pre><p>
</p></div></div><div class="chapter" title="Глава 10. Кодирование с MEncoder"><div class="titlepage"><div><div><h2 class="title"><a name="encoding-guide"></a>Глава 10. Кодирование с <span class="application">MEncoder</span></h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#menc-feat-dvd-mpeg4">10.1. Создание высококачественного MPEG-4 ("DivX") рипа из DVD фильма</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-preparing-encode">10.1.1. Подготовка к кодированию: Идентификация исходного материала и кадровой
  частоты</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-preparing-encode-fps">10.1.1.1. Определение кадровой частоты источника</a></span></dt><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-preparing-encode-material">10.1.1.2. Идентификация исходного материала</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-2pass">10.1.2. Постоянный квантователь в сравнении с многопроходностью</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-constraints">10.1.3. Ограничения для эффективного кодирования</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-crop">10.1.4. Усечение и масштабирование</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-resolution-bitrate">10.1.5. Выбор разрешения и битпотока</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-resolution-bitrate-compute">10.1.5.1. Расчёт разрешения</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-filtering">10.1.6. Фильтрация</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-interlacing">10.1.7. Чересстрочная развёртка и телесин</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-encoding-interlaced">10.1.8. Кодирование чересстрочного видео</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-av-sync">10.1.9. Замечания об аудио/видео синхронизации</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-codec">10.1.10. Выбор видеокодека</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-audio">10.1.11. Аудио</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-muxing">10.1.12. Мультиплексирование</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-muxing-filter-issues">10.1.12.1. Улучшение мультиплексирования и надёжности A/V синхронизации</a></span></dt><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-muxing-avi-limitations">10.1.12.2. Ограничения контейнера AVI</a></span></dt><dt><span class="sect3"><a href="#menc-feat-dvd-mpeg4-muxing-matroska">10.1.12.3. Мультиплексирование в контейнер Matroska (Матрёшка)</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#menc-feat-telecine">10.2. Как работать с телесином и чересстрочной развёрткой на NTSC DVD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-telecine-intro">10.2.1. Введение</a></span></dt><dt><span class="sect2"><a href="#menc-feat-telecine-ident">10.2.2. Как распознать тип Вашего видео</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-telecine-ident-progressive">10.2.2.1. Построчная развёртка</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-ident-telecined">10.2.2.2. Телесин</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-ident-interlaced">10.2.2.3. Чересстрочная развертка</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-ident-mixedpt">10.2.2.4. Смешанные построчная развертка и телесин</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-ident-mixedpi">10.2.2.5. Смешанные построчная и чересстрочная развертки</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-telecine-encode">10.2.3. Как кодировать каждую категорию</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-telecine-encode-progressive">10.2.3.1. Построчная развертка</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-encode-telecined">10.2.3.2. Телесин</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-encode-interlaced">10.2.3.3. Чересстрочная развертка</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-encode-mixedpt">10.2.3.4. Смешанные построчная развертка и телесин</a></span></dt><dt><span class="sect3"><a href="#menc-feat-telecine-encode-mixedpi">10.2.3.5. Смешанные построчная и чересстрочная развертки</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-telecine-footnotes">10.2.4. Примечания</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-enc-libavcodec">10.3. Кодирование семейством кодеков <code class="systemitem">libavcodec</code>
</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-enc-libavcodec-video-codecs">10.3.1. Видео кодеки <code class="systemitem">libavcodec</code></a></span></dt><dt><span class="sect2"><a href="#menc-feat-enc-libavcodec-audio-codecs">10.3.2. Аудио кодеки <code class="systemitem">libavcodec</code></a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-enc-libavcodec-audio-codecs-pcmadpcm">10.3.2.1. Дополнительная таблица PCM/ADPCM форматов</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-lavc-encoding-options">10.3.3. Опции кодирования libavcodec</a></span></dt><dt><span class="sect2"><a href="#menc-feat-mpeg4-lavc-example-settings">10.3.4. Примеры настроек кодирования</a></span></dt><dt><span class="sect2"><a href="#custommatrices">10.3.5. Нестандартные inter/intra матрицы</a></span></dt><dt><span class="sect2"><a href="#menc-feat-dvd-mpeg4-example">10.3.6. Пример</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-xvid">10.4. Кодирование кодеком <code class="systemitem">Xvid</code></a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-xvid-intro">10.4.1. Какие опции следует использовать для получения лучших результатов?</a></span></dt><dt><span class="sect2"><a href="#menc-feat-xvid-encoding-options">10.4.2. Опции кодирования <code class="systemitem">Xvid</code></a></span></dt><dt><span class="sect2"><a href="#menc-feat-xvid-encoding-profiles">10.4.3. Профили кодирования</a></span></dt><dt><span class="sect2"><a href="#menc-feat-xvid-example-settings">10.4.4. Примеры настроек кодирования</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-x264">10.5. Кодирование кодеком <code class="systemitem">x264</code></a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-x264-encoding-options">10.5.1. Опции кодирования x264</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-x264-encoding-options-intro">10.5.1.1. Введение</a></span></dt><dt><span class="sect3"><a href="#menc-feat-x264-encoding-options-speedvquality">10.5.1.2. Опции, затрагивающие, в основном, скорость и качество</a></span></dt><dt><span class="sect3"><a href="#menc-feat-x264-encoding-options-misc-preferences">10.5.1.3. Опции, относящиеся к различным предпочтениям</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-x264-example-settings">10.5.2. Примеры настроек кодирования</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-video-for-windows">10.6. 
  Кодирование семейством кодеков <code class="systemitem">Video For Windows</code>
</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-enc-vfw-video-codecs">10.6.1. Поддерживаемые кодеки Video for Windows</a></span></dt><dt><span class="sect2"><a href="#menc-feat-video-for-windows-bitrate-settings">10.6.2. Использование vfw2menc для создания файла настроек кодека.</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-quicktime-7">10.7. Использование <span class="application">MEncoder</span>
для создания совместимых с <span class="application">QuickTime</span>
файлов</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-quicktime-7-why-use-it">10.7.1. Зачем необходимо создавать совместимые с <span class="application">QuickTime</span>
файлы?</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-constraints">10.7.2. Ограничения <span class="application">QuickTime</span> 7</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-crop">10.7.3. Обрезание</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-scale">10.7.4. Масштабирование</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-avsync">10.7.5. A/V синхронизация</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-bitrate">10.7.6. Битпоток</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-example">10.7.7. Пример кодирования</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-remux">10.7.8. Ремультиплексирование в MP4</a></span></dt><dt><span class="sect2"><a href="#menc-feat-quicktime-7-metadata">10.7.9. Добавление тегов метаданных</a></span></dt></dl></dd><dt><span class="sect1"><a href="#menc-feat-vcd-dvd">10.8. Использование <span class="application">MEncoder</span>
  для создания VCD/SVCD/DVD-совместимых файлов.</a></span></dt><dd><dl><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-constraints">10.8.1. Ограничения формата</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-constraints-resolution">10.8.1.1. Ограничения форматов</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-constraints-gop">10.8.1.2. Ограничения на размер GOP</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-constraints-bitrate">10.8.1.3. Ограничения на битпоток</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-output">10.8.2. Опции вывода</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-output-aspect">10.8.2.1. Пропорции</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-a-v-sync">10.8.2.2. Сохранение A/V синхронизации</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-output-srate">10.8.2.3. Преобразование частоты дискретизации</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-lavc">10.8.3. Использование libavcodec для VCD/SVCD/DVD кодирования</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-lavc-intro">10.8.3.1. Введение</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-lavc-options">10.8.3.2. lavcopts</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-lavc-examples">10.8.3.3. Примеры</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-lavc-advanced">10.8.3.4. Расширенные опции</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-audio">10.8.4. Кодирование звука</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-audio-toolame">10.8.4.1. toolame</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-audio-twolame">10.8.4.2. twolame</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-audio-lavc">10.8.4.3. libavcodec</a></span></dt></dl></dd><dt><span class="sect2"><a href="#menc-feat-vcd-dvd-all">10.8.5. Собирая все вместе</a></span></dt><dd><dl><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-pal-dvd">10.8.5.1. PAL DVD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-ntsc-dvd">10.8.5.2. NTSC DVD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-pal-ac3-copy">10.8.5.3. PAL AVI, содержащий AC-3 звук, в DVD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-ntsc-ac3-copy">10.8.5.4. NTSC AVI, содержащий AC-3 звук, в DVD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-pal-svcd">10.8.5.5. PAL SVCD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-ntsc-svcd">10.8.5.6. NTSC SVCD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-pal-vcd">10.8.5.7. PAL VCD</a></span></dt><dt><span class="sect3"><a href="#menc-feat-vcd-dvd-all-ntsc-vcd">10.8.5.8. NTSC VCD</a></span></dt></dl></dd></dl></dd></dl></div><div class="sect1" title='10.1. Создание высококачественного MPEG-4 ("DivX") рипа из DVD фильма'><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-dvd-mpeg4"></a>10.1. Создание высококачественного MPEG-4 ("DivX") рипа из DVD фильма</h2></div></div></div><p>
Одним часто задаваемым вопросом является "Как мне сделать рип самого высокого
качества для заданного размера?". Другой вопрос "Как мне создать DVD рип с самым
высоким возможным качеством? Я не беспокоюсь о размере файла, мне нужно лишь
наилучшее качество.".
</p><p>
Последний вопрос, похоже, отчасти неверно сформулирован. В конце концов, если
Вы не беспокоитесь о размере файла, почему бы просто не скопировать весь MPEG-2
видео поток с DVD? Конечно, Ваш AVI файл будет занимать около 5GB,
но если Вы желаете наилучшее качество и не волнуетесь о размере, то это,
несомненно, лучшее решение.
</p><p>
В действительности, причиной, по которой Вы хотите перекодировать DVD в MPEG-4,
является именно Ваше <span class="bold"><strong>беспокойство</strong></span>
о размере файла.
</p><p>
Сложно дать универсальный рецепт о создании DVD рипа очень высокого
качества. Необходимо рассмотреть несколько факторов, и Вы должны
понимать эти детали, иначе Вы, скорее всего, разочаруетесь своими
результатами. Ниже мы исследуем некоторые из этих вопросов, а затем
рассмотрим пример. Мы предполагаем, что Вы используете
<code class="systemitem">libavcodec</code> для кодирования видео,
хотя теория также применима и к другим кодекам.
</p><p>
Если это кажется для Вас слишком сложным, то Вам, пожалуй, следует использовать
один из многочисленных неплохих фронтендов, указанных в
<a class="ulink" href="http://www.mplayerhq.hu/design7/projects.html#mencoder_frontends" target="_top">разделе MEncoder</a>
нашей страницы родственных проектов.
Так Вы должны получить высококачественные рипы без особых размышлений,
поскольку большинство этих утилит разработаны для принятия умных решений за Вас.
</p><div class="sect2" title="10.1.1. Подготовка к кодированию: Идентификация исходного материала и кадровой частоты"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-preparing-encode"></a>10.1.1. Подготовка к кодированию: Идентификация исходного материала и кадровой
  частоты</h3></div></div></div><p>
Прежде, чем даже задумываться о кодировании фильма, Вам необходимо выполнить
некоторые предварительные действия.
</p><p>
Первым и наиболее важным шагом перед кодированием должно быть определение
типа содержимого, с которым Вы работаете.
Если источником Ваших исходных материалов является DVD или
широковещательное/кабельное/спутниковое TV, оно будет содержаться в одном из
двух форматов: NTSC для Северной Америки и Японии, PAL для Европы и т.д..
Однако, важно понимать, что это только форматирование для показа на
телевидении, и оно часто
<span class="bold"><strong>не</strong></span> соответствует
исходному формату фильма.
Опыт показывает, что NTSC материал существенно более сложен для кодирования,
т.к. в нём содержится больше элементов, которые нужно идентифицировать.
Для проведения удачного кодирования, Вам необходимо знать исходный формат.
Отказ от принятия этого во внимание приведёт к различным дефектам в Вашем
кодировании, включая безобразные гребешки (артефакты чересстрочной развёртки)
и повторяющиеся или даже потерянные кадры.
Кроме ухудшения картинки, артефакты так же уменьшают эффективность кодирования:
Вы получите худшее качество на единицу битпотока.
</p><div class="sect3" title="10.1.1.1. Определение кадровой частоты источника"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-dvd-mpeg4-preparing-encode-fps"></a>10.1.1.1. Определение кадровой частоты источника</h4></div></div></div><p>
Вот список, содержащий общие типы исходных материалов, где они,
преимущественно, встречаются и их свойства:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>Стандартный фильм</strong></span>: Производятся
  для театральных показов на 24 fps [кадр/сек].
</p></li><li class="listitem"><p>
  <span class="bold"><strong>PAL видео</strong></span>: Записывается с помощью
  PAL видеокамеры при 50 полях в секунду.
  Поле состоит только из чётных или нечётных линий кадра.
  Телевидение было разработано для обновления этих полей попеременно,
  что используется как вид дешёвого аналогового сжатия.
  Человеческий глаз, предположительно, компенсирует это, но однажды
  поняв чересстрочную развёртку, Вы научитесь видеть её и на TV и
  Вам больше никогда не понравится телевидение.
  Два поля <span class="bold"><strong>не</strong></span> составляют
  целый кадр, поскольку они снимаются с задержкой в 1/50 секунды
  и, следовательно, не формируют одно изображение, за исключением случая
  полного отсутствия движения.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>NTSC видео</strong></span>: Записывается с помощью
  NTSC видеокамеры при 60000/1001 полях в секунду, или 60 полях в секунду
  в эпоху чёрно-белого TV.
  В других отношениях аналогично PAL.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Анимация</strong></span>: Обычно рисуется на 24 fps,
  но также существуют разновидности со смешанной кадровой частотой.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Компьютерная графика (CG)</strong></span>: Может
  быть с любой частотой кадров, но некоторые встречаются чаще остальных;
  24 и 30 кадров в секунду типичны для NTSC, и 25 fps типично для PAL.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Старый фильм</strong></span>: Различные низкие
  кадровые частоты.
</p></li></ul></div></div><div class="sect3" title="10.1.1.2. Идентификация исходного материала"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-dvd-mpeg4-preparing-encode-material"></a>10.1.1.2. Идентификация исходного материала</h4></div></div></div><p>
Фильмы, состоящие из кадров, называются фильмами с построчной (или прогрессивной)
развёрткой, а состоящие из независимых полей — фильмами с чересстрочной
развёрткой или просто видео; однако, последний термин двусмысленный.
</p><p>
Из-за дальнейших усложнений, некоторые фильмы будут смесью
нескольких, указанных выше.
</p><p>
Наиболее важным различием между всеми этими форматами является
то, что одни из них основаны на кадрах, а другие — на полях.
<span class="bold"><strong>Любой</strong></span> фильм, подготовленный для
просмотра на телевидении (включая DVD), преобразуется в формат,
основанный на полях.

Различные методы, с помощью которых это может быть сделано, совокупно
называются "телесин" (англ. telecine), одним из вариантов которого
является отвратительный NTSC "3:2 пулдаун" (англ. pulldown).
За исключением случаев, когда формат исходного материала был
также основан на полях (и с такой же частотой полей), Вы получите
фильм в формате отличном от исходного.
</p><div class="itemizedlist" title="Существует несколько общих типов пулдауна:"><p class="title"><b>Существует несколько общих типов пулдауна:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>PAL 2:2 пулдаун</strong></span>: Наилучший из всех.
  Каждый кадр показывается за время длительности двух полей путем
  извлечения чётных и нечётных строк и их попеременного показа.
  Если в исходном материале 24 fps, то это ускоряет воспроизведение фильма
  на 4%.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>PAL 2:2:2:2:2:2:2:2:2:2:2:3 пулдаун</strong></span>:
  Каждый 12-й кадр показывается за время длительности трёх полей,
  вместо двух.
  Это помогает избежать проблемы 4%-го ускорения, но делает обращение
  процесса существенно более сложным.
  Такие вещи обычно наблюдаются в музыкальных произведениях, где
  изменение скорости на 4% существенно повредит музыкальную партитуру.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>NTSC 3:2 телесин</strong></span>: Кадры показываются
  попеременно за время длительности 3-х полей или 2-х полей.
  Это даёт частоту полей в 2.5 раза больше исходной частоты кадров.
  Результат также очень незначительно замедляется от 60 до 60000/1001
  полей в секунду для поддержания частоты полей NTSC.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>NTSC 2:2 пулдаун</strong></span>: Используется
  для отображения материала с 30 fps на NTSC.
  Так же мил, как и 2:2 PAL пулдаун.
</p></li></ul></div><p>
Так же существуют методы для преобразования между NTSC и PAL видео,
но подобные темы выходят за рамки данного руководства.
Если Вам попался такой фильм, и Вы хотите кодировать его,
лучшим решением будет найти копию в исходном формате.
Преобразование между этими двумя форматами вносит большие потери
и не может быть точно обращено, так что Ваше кодирование
существенно пострадает, если оно делается из преобразованного
источника.
</p><p>
Когда видео находится на DVD, последовательные пары полей
группируются как кадр, даже если они не предназначены для
одновременного отображения.
Стандарт MPEG-2, используемый на DVD и цифровом TV предоставляет
возможность одновременно кодировать исходные кадры с построчной
развёрткой и сохранять число полей, в течении которых кадр
должен быть показан, в его заголовке.
Если был использован такой метод, фильм часто будет называться
как "мягкий телесин", т.к. процесс только указывает DVD-плееру
о необходимости применения пулдауна к фильму, не изменяя при этом
сам фильм.
Этот случай существенно предпочтителен, т.к. он может быть легко обращён
(в действительности, проигнорирован) кодером и т.к. он сохраняет
максимальное качество.
Однако, многие широковещательные и DVD студии не используют
надлежащую технологию кодирования и вместо этого производят
фильмы с "жёстким телесином", где поля в действительности
повторяются в кодированном MPEG-2.
</p><p>
Порядок действия в таких случаях будет описан
<a class="link" href="#menc-feat-telecine" title="10.2. Как работать с телесином и чересстрочной развёрткой на NTSC DVD">позже в данном руководстве</a>.
Сейчас мы дадим Вам несколько советов по идентификации типа
материала, с которым Вы работаете:
</p><div class="itemizedlist" title="Регионы NTSC:"><p class="title"><b>Регионы NTSC:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Если при просмотре Вашего фильма <span class="application">MPlayer</span>
  выводит, что частота кадров была изменена до 24000/1001 и она
  никогда не меняется обратно, то это почти наверняка содержимое
  с построчной развёрткой, которое было подвергнуто
  "мягкому телесину".
</p></li><li class="listitem"><p>
  Если <span class="application">MPlayer</span> отображает попеременные
  переключения частоты кадров между 24000/1001 и 30000/1001, и Вы
  иногда видите "гребешки", есть несколько возможностей.
  Сегменты с 24000/1001 fps почти наверняка являются "мягко
  телесиненным" содержимым с построчной развёрткой, но части с
  30000/1001 fps могут быть как "жёстко телесиненым" содержимым
  с 24000/1001 fps, так и NTSC видео с 60000/1001 полями в секунду.
  Используйте два нижеследующих руководства для определения того,
  с каким случаем Вы имеете дело.
</p></li><li class="listitem"><p>
  Если <span class="application">MPlayer</span> никогда не показывает
  изменения кадровой частоты и каждый отдельный кадр, где есть
  движение, оказывается гребёнкой, Ваш фильм есть NTSC видео с
  60000/1001 полями в секунду.
</p></li><li class="listitem"><p>
  Если <span class="application">MPlayer</span> никогда не показывает
  изменения кадровой частоты и два кадра из каждых пяти оказываются
  гребёнкой, Ваш фильм представляет собой "жёстко телесиненное"
  содержимое с 24000/1001 fps.
</p></li></ul></div><div class="itemizedlist" title="Регионы PAL:"><p class="title"><b>Регионы PAL:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Если Вы не видите никакой гребёнки, Ваш фильм есть 2:2 пулдаун.
</p></li><li class="listitem"><p>
  Если Вы видите попеременную гребёнку каждые полсекунды,
  Ваш фильм представляет собой 2:2:2:2:2:2:2:2:2:2:2:3 пулдаун.
</p></li><li class="listitem"><p>
  Если Вы всегда видите гребёнки во время движения, значит Ваш
  фильм является PAL видео с 50 полями в секунду.
</p></li></ul></div><div class="note" title="Подсказка:" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Подсказка:</h3><p>
  <span class="application">MPlayer</span> может замедлить воспроизведение
  фильма с опцией -speed или воспроизводить его покадрово.
  Попробуйте использовать опцию <tt class="option">-speed 0.2</tt> для
  очень медленного просмотра фильма или нажимайте
  клавишу "<span class="keycap"><b>.</b></span>" для воспроизведения одного кадра
  за раз и идетнифицируйте образец, если не можете его увидеть на
  полной скорости.
</p></div></div></div><div class="sect2" title="10.1.2. Постоянный квантователь в сравнении с многопроходностью"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-2pass"></a>10.1.2. Постоянный квантователь в сравнении с многопроходностью</h3></div></div></div><p>
Возможно кодировать Ваш фильм, широко варьируя качество.
С современными видеокодерами и небольшим сжатием перед кодированием
(уменьшением размера и шумов) возможно достичь очень хорошего
качества при размере 700 МБ для 90-110-минутного широкоэкранного фильма.
Более того, всё, кроме самых длинных фильмов, может быть кодировано
с почти безупречным качеством на 1400 МБ.
</p><p>
Есть три подхода при кодировании видео: постоянный битпоток (CBR),
постоянный квантователь и многопроходность (ABR или усреднённый битпоток).
</p><p>
Сложность кадров фильма и, таким образом, число битов, нужных для их
сжатия может существенно отличаться от одной сцены к другой.
Современные видеокодеры могут подстраиваться под это в процессе
работы и варьировать битпоток.
Однако, в таких простых режимах как CBR кодеры не знают загруженность
битпотока в последующих сценах и т.о. не могут превысить затребованный
битпоток для больших промежутков времени.
Более совершенные режимы, такие как многопроходный режим, могут
учитывать статистику предыдущих проходов; это решает проблему,
упомянутую выше.
</p><div class="note" title="Замечание:" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание:</h3><p>
Большинство кодеков, поддерживающих ABR кодирование, поддерживают
только двупроходный режим, в то время как некоторые другие, такие
как <code class="systemitem">x264</code>,
<code class="systemitem">Xvid</code>
и <code class="systemitem">libavcodec</code> поддерживают
многопроходность, несколько улучшающую качество на каждом проходе,
однако, это улучшение не измеримо и не заметно после 4-го прохода
или около того.
Поэтому, в данном разделе дву- и многопроходность будут
использоваться взаимозаменяемо.
</p></div><p>
В каждом из этих режимов видеокодек (такой как
<code class="systemitem">libavcodec</code>)
разбивает видеокадр на макроблоки размером 16х16 пикселей и потом
применяет квантователь к каждому макроблоку. Чем меньше квантоваль,
тем лучше качество и выше битпоток.
Метод, используемый видео кодером для определения того, какой
квантователь использовать для данного макроблока, варьируется и
подлежит тонкой настройке. (Это крайнее упрощение реального
процесса, но основная концепция полезна для понимания.)
</p><p>
Когда Вы указываете постоянный битпоток, видеокодек будет кодировать
видео, отбрасывая детали столько, сколько необходимо и настолько мало,
насколько это возможно с целью оставаться ниже заданного битпотока.
Если Вас действительно не волнует размер файла, Вы можете также
использовать CBR и указать бесконечный битпоток. (На практике это
означает значение, достаточно большое для обозначения отсутствия
предела, например, 10000 Кбит.) В результате, без реального ограничения
битпотока, кодек использует наименьший возможный квантователь для
каждого макроблока (как указано опцией
<tt class="option">vqmin</tt> для
<code class="systemitem">libavcodec</code>, равной 2 по умолчанию).
Как только Вы укажите настолько низкий битпоток, что кодек будет
вынужден использовать более высокий квантователь, Вы почти наверняка
испортите качество Вашего видео.
Чтобы избежать этого, Вам, вероятно, придётся уменьшить размеры
Вашего видео, согласно методу, описанному далее в этом руководстве.
В общем, Вам следует избегать CBR совсем, если Вы заботитесь о качестве.
</p><p>
С постоянным квантователем кодек использует для всех макроблоков
один и тот же квантователь, указанный в опции
<tt class="option">vqscale</tt> (для
<code class="systemitem">libavcodec</code>).
Если Вы хотите рип наивысшего возможного качества, снова не взирая
на битпоток, Вы можете использовать
<tt class="option">vqscale=2</tt>.
Это приведёт к тому же битпотоку и PSNR (пику отношения сигнала к шуму),
что и CBR с
<tt class="option">vbitrate</tt>=бесконечности и значением по умолчанию
<tt class="option">vqmin</tt>, равным 2.
</p><p>
Проблема с постоянным квантованием заключается в том, что кодек использует
заданный квантователь вне зависимости от того, требуется это для
макроблока или нет. То есть возможно использование большего квантователя
для макроблока без ухудшения видимого качества. Зачем тратить биты на
излишне низкий квантователь? У Вашего процессора есть столько тактов,
сколько есть времени, но имеется лишь ограниченное число битов на
жёстком диске.
</p><p>
При двупроходном кодировании первый проход создаст рип фильма так,
как будто это был CBR, но сохранит лог свойств для каждого кадра.
Эта информация затем будет использована во время второго прохода
для принятия интеллектуальных решений о том, какой квантователь
следует использовать. Во время быстрого движения или сцен с
высокой детализацией с большой вероятностью будут использованы
б<span class="emphasis"><em>о</em></span>льшие квантователи, а во время медленного движения или сцен
с низкой детализацией — меньшие.
Обычно количество движения играет существенно более важную роль,
чем количество деталей.
</p><p>
Если Вы используете <tt class="option">vqscale=2</tt>, то Вы теряете биты.
Если Вы используете <tt class="option">vqscale=3</tt>, то Вы не получаете
рип наивысшего качества. Предположим, Вы делаете рип DVD, используя
<tt class="option">vqscale=3</tt>, результат получается 1800 Кбит.
Если Вы сделаете двупроходное кодирование с
<tt class="option">vbitrate=1800</tt>, получившееся видео будет обладать
<span class="bold"><strong>лучшим качеством</strong></span> для
<span class="bold"><strong>того же битпотока</strong></span>.
</p><p>
После того, как Вы сейчас убедились, что два прохода — это путь
к действию, возникает вопрос о том, какой битпоток использовать?
Ответ таков, что нет единого ответа. В идеале, Вы хотите выбрать
битпоток, при котором достигается наилучший баланс между качеством
и размером файла. Здесь возможны вариации в зависимости от
исходного видеоматериала.
</p><p>
Если размер не важен, хорошей отправной точкой для рипа очень высокого
качества будет 2000 Кбит +/- 200 Кбит.
Для видеоматериала с быстрым движением или высокой детализацией
или просто если у Вас очень разборчивый глаз, Вы можете использовать
2400 или 2600.
Для некоторых DVD Вы не заметите разницы на 1400 Кбит. Хорошей идеей
является экспериментирование со сценами на разных битпотоках, чтобы
почувствовать разницу.
</p><p>
Если Вашей целью является определённый размер, Вам нужно как-нибудь
вычислить битпоток. Но перед этим, Вам нужно знать, сколько места
нужно зарезервировать по аудио дорожку(и), так что Вам необходимо
сперва <a class="link" href="#menc-feat-dvd-mpeg4-audio" title="10.1.11. Аудио">извлечь их</a>.
Вы можете рассчитать битпоток с помощью следующей формулы:
<code class="systemitem">битпоток = (конечный_размер_в_МБайт - размер_звука_в_МБайт) *
1024 * 1024 / длительность_в_секундах * 8 / 1000</code>.
Например, для сжатия двухчасового фильма в 702 МБ CD, с 60 МБ
аудио дорожкой, битпоток видео должен составлять:
<code class="systemitem">(702 - 60) * 1024 * 1024 / (120*60) * 8 / 1000
= 740 кбит/сек</code>.
</p></div><div class="sect2" title="10.1.3. Ограничения для эффективного кодирования"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-constraints"></a>10.1.3. Ограничения для эффективного кодирования</h3></div></div></div><p>
Из-за особенностей MPEG-подобного сжатия, существуют различные
ограничения, которым Вы должны следовать для достижения
максимального качества.
MPEG разбивает видео на квадраты 16х16, называемые макроблоками.
Каждый макроблок состоит из 4 блоков 8х8 с информацией о люме
(интенсивности) и двух блоков 8х8 с информацией о хроме (цвете)
половинного разрешения (один для красно-бирюзовой оси и другой
для жёлто-голубой оси).
Даже если ширина и высота Вашего фильма не кратны 16, кодер
всё равно использует нужное количество макроблоков 16х16 для покрытия
всей области картинки, дополнительная область будет впустую потрачена.
Так что в интересах максимизации качества при фиксированном размере
файла, не стоит использовать размеры, не кратные 16.
</p><p>
У большинства DVD также есть определённое подобие чёрных полос на
краях. Если Вы их оставите, это может
<span class="bold"><strong>сильно</strong></span> повредить качество
несколькими путями.
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  MPEG-подобное сжатие очень чувствительно к преобразованиям
  частотных интервалов, в частности, к дискретному косинусному
  преобразованию (DCT), которое аналогично преобразованию Фурье.
  Этот вид сжатия эффективен для представления образов и сглаженных
  переходов, но у него возникают проблемы с острыми краями.
  Для кодирования последних Вам нужно гораздо больше битов, а иначе
  у Вас появится артефакт, известный как ореолы.
  </p><p>
  Частотные преобразования (DCT) выполняются независимо для каждого
  макроблока (на самом деле, для каждого блока), так что эта проблема
  возникает только в случае попадания острого края внутрь блока.
  Если Ваши чёрные поля возникают точно на границах, кратных 16
  пикселям, это не проблема.
  Однако, чёрные полосы на DVD редко хорошо расположены, так что
  на практике Вам всегда придётся усекать стороны для избежания
  этих проблем.
  </p></li></ol></div><p>
В дополнение к преобразованиям частотных интервалов, MPEG-подобное
сжатие использует векторы движения для отображения изменений от
одного кадра к другому. Векторы движения, естественно, работают
существенно менее эффективно для новых объектов, идущих от
краёв картинки, поскольку они отсутствуют в предыдущих кадрах.
Пока картинка простирается вплоть до края кодируемой области,
у векторов движения не возникает проблем с движением объектов
за пределы картинки. Однако, при наличии черных полей
могут возникнуть проблемы:
</p><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p>
  Для каждого макроблока MPEG-подобное сжатие сохраняет вектор,
  определяющий какая часть предыдущего кадра должна быть скопирована
  в этот макроблок как основа для предсказания следующего кадра.
  Кодированию подлежит только оставшаяся разность. Если макроблок
  простирается до края картинки и содержит часть чёрной полосы,
  то векторы движения других частей картинки перепишут чёрную полосу.
  Это означает, что много битов нужно потратить либо на повторное
  чернение переписанной полосы, либо (что более вероятно) вектор
  движения не будет использован вовсе и все изменения для этого
  макроблока будут явно кодированы. Так или иначе, эффективность
  кодирования существенно уменьшается.
  </p><p>
  Ещё раз, эта проблема возникает только в случае, если чёрные полосы
  не укладываются в границы, кратные 16.
  </p></li><li class="listitem"><p>
  Наконец, предположим, что у нас есть находящийся внутри картинки
  макроблок и объект движется в этот блок от края изображения.
  MPEG-подобное кодирование не может сказать "скопируй ту часть,
  что внутри картинки, но не чёрную полосу". Так что чёрная полоса
  также будет скопирована внутрь, в результате чего масса битов
  будет потрачена на кодирование части изображения, которое должно
  быть на месте полосы.
  </p><p>
  Для случаев, когда всё изображение движется к краю кодируемой
  области, у MPEG есть специальные оптимизации для повторяющегося
  копирования пикселей к краю картинки, когда вектор движения
  идёт извне области кодирования. Эта возможность становится
  бесполезной, если у фильма есть чёрные полосы. В отличии от
  случаев 1 и 2, выравнивание границ до кратности 16 здесь
  не поможет.
  </p></li><li class="listitem"><p>
  Несмотря на то, что границы полностью чёрные и никогда не изменяются,
  существуют, как минимум, определённые накладные расходы, связанные
  с наличием большего числа макроблоков.
</p></li></ol></div><p>
Благодаря всем этим причинам, рекомендуется полностью урезать
чёрные полосы. Более того, если есть области шумов/искажений
на краях картинки, то их урезание также поспособствует улучшению
качества кодирования. Видеофилы, желающие сохранить оригинал как
можно более точно, могут возражать против такого усечения; но
если Вы не планируете кодировать при постоянном квантователе,
качество, полученное при усечении, существенно превысит потери
информации на краях.
</p></div><div class="sect2" title="10.1.4. Усечение и масштабирование"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-crop"></a>10.1.4. Усечение и масштабирование</h3></div></div></div><p>
Вспомните из предыдущего раздела, что конечный размер картинки,
подлежащей кодированию, должен быть кратен 16 (как высота, так
и ширина). Это может быть достигнуто усечением, масштабированием
или комбинацией того и другого.
</p><p>
Есть несколько рекомендаций для усечения, которым необходимо следовать
для избежания повреждения фильма.
Обычный формат YUV, 4:2:0, сохраняет цветность (информацию о цвете)
половинной дискретизации, т.е. цветность сохраняется в два раза реже
в каждом направлении, чем яркостность (информация об интенсивности).
Рассмотрите следующую диаграмму, где L обозначает точки дискретизации
яркостности и C — цветности.
</p><div class="informaltable"><table border="1" width="40%"><colgroup><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"></colgroup><tbody><tr><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td></tr><tr><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td></tr><tr><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td></tr><tr><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td></tr><tr><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td></tr><tr><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td></tr></tbody></table></div><p>
Как Вы видите, строки и столбцы изображения естественным образом
идут в парах. Поэтому смещения и размеры усечения
<span class="emphasis"><em>должны</em></span> быть чётными числами.
Иначе цветность перестанет правильно соответствовать яркостности.
Теоретически возможно усечение с нечётными смещениями, но оно
потребует переквантования цветности, что потенциально является
операцией с потерей качества и не поддерживается фильтром
усечения сторон crop.
</p><p>
Более того, видео с чересстрочной развёрткой дискретизируется
следующим образом:
</p><div class="informaltable"><table border="1" width="80%"><colgroup><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"></colgroup><tbody><tr><td colspan="8" align="center">Верхнее поле</td><td colspan="8" align="center">Нижнее поле</td></tr><tr><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td></tr><tr><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td></tr><tr><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td></tr><tr><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td></tr><tr><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td><td colspan="2" align="center">C</td></tr><tr><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td><td align="center">L</td></tr></tbody></table></div><p>
Как Вы видите, структура повторяется только после 4 строк.
Так что для чересстрочного видео Ваше y-смещение и высота
усечения должны быть кратны 4.
</p><p>
Естественные разрешения DVD составляют 720x480 для NTSC и 720x576
для PAL, но существует флаг соотношения сторон, который указывает
является ли видео полноэкранным (4:3) или широкоэкранным (16:9).
Многие (если не большинство) широкоэкранных DVD не точно соответствуют
формату 16:9 и могут быть как 1.85:1, так и 2.35:1 (кинематографический формат).
Это означает, что в видео будут чёрные полосы, которые нужно усечь.
</p><p>
<span class="application">MPlayer</span> предоставляет фильтр обнаружения
усечения, который определяет прямоугольник, до которго нужно усечь
(<tt class="option">-vf cropdetect</tt>).
Запустите <span class="application">MPlayer</span> с
<tt class="option">-vf cropdetect</tt> и он выдаст настройки
усечения для удаления полей.
С целью получения точных параметров усечения, Вы должны проигрывать
фильм достаточно долго для того, чтоб была использована вся область
изображения.
</p><p>
Затем проверьте значения, полученные с помощью
<span class="application">MPlayer</span>, используя командную строку,
выведенную <tt class="option">cropdetect</tt>, и подстройте прямоугольник
при необходимости.
Фильтр <tt class="option">rectangle</tt> может быть полезен, позволив
Вам интерактивно менять прямоугольник усечения для Вашего фильма.
Не забывайте следовать указанным выше руководствам по делимости,
чтобы не испортить выравнивание цветности.
</p><p>
В ряде случаев масштабирование может быть нежелательным.
Масштабирование по вертикальному направлению затруднено для
чересстрочного видео, и если Вы хотите сохранить чересстрочность,
Вам, как правило, будет необходимо воздерживаться от масштабирования.
Если Вы не будете масштабировать, но всё ещё желаете размеры,
кратные 16, то Вам придётся проводить излишнее усечение.
Не проводите неполное усечение, поскольку чёрные полосы очень
плохи для кодирования!
</p><p>
Поскольку MPEG-4 использует макроблоки 16х16, Вы должны убедиться,
что каждое измерение кодируемого видео кратно 16; иначе Вы ухудшите
качество, особенно на малых битпотоках. Вы можете сделать это,
округлив ширину и высоту прямоугольника усечения до ближайшего
меньшего целого, кратного 16.
Как указано выше, при усечении Вам необходимо увеличить смещение по
Y на половину разности старой и новой высоты, так что полученное
видео будет браться из центра кадра.
И из-за способа дискретизации DVD видео, убедитесь, что смещение
есть чётное число. (Фактически, возьмите за правило никогда не
использовать нечётные величины для любых параметров усечения или
масштабирования видео.) Если Вы беспокоитесь из-за нескольких
излишне отброшенных битов, возможно, Вы предпочтёте взамен
масштабировать видео. Мы рассмотрим это ниже в нашем примере.
В действительности, Вы можете доверить фильтру
<tt class="option">cropdetect</tt> сделать для Вас всё вышеупомянутое,
т.к. у него есть необязательный параметр округления
<tt class="option">round</tt>, равный 16 по умолчанию.
</p><p>
Также будьте осторожны с "полутёмными" пикселями на краях. Убедитесь,
что они тоже отрезаются, иначе Вы будете тратить биты, которым есть
лучшее применение.
</p><p>
После всего выше сказанного и сделанного, Вы, вероятно, получите
видео не точно формата 1:85.1 или 2.35:1, а с чем-то близким
к этому.  Вы можете вычислить новый коэффициент соотношения
сторон вручную, но <span class="application">MEncoder</span>
предоставляет опцию для <code class="systemitem">libavcodec</code>,
называемую <tt class="option">autoaspect</tt>, которая сделает это для
Вас. Ни в коем случае не увеличивайте размер этого видео с целью
квадратизации пикселей, если Вы не желаете впустую потратить
место на жёстком диске.
Масштабирование должно выполняться при воспроизведении, и плеер
использует коэффициент соотношения сторон, сохранённый в AVI, для
определения правильного разрешения.
К сожалению, не все плееры используют эту информацию автомасштабирования,
поэтому Вам всё ещё может быть необходимо перемасштабирование.
</p></div><div class="sect2" title="10.1.5. Выбор разрешения и битпотока"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-resolution-bitrate"></a>10.1.5. Выбор разрешения и битпотока</h3></div></div></div><p>
Если Вы не собираетесь кодировать в режиме постоянного квантователя,
Вам нужно выбрать битпоток.
Понятие битпотока очень просто: это среднее число битов, которые
будут использованы для сохранения Вашего фильма, в секунду.
Обычно битпоток измеряется в килобитах (1000 бит) в секунду.
Размер Вашего фильма на диске есть битпоток, умноженный на
длительность фильма, плюс небольшие накладные расходы
(см. раздел
<a class="link" href="#menc-feat-dvd-mpeg4-muxing-avi-limitations" title="10.1.12.2. Ограничения контейнера AVI">контейнер AVI</a>
для примера).
Остальные параметры, такие как масштабирование, усечение и т.п.
<span class="bold"><strong>не</strong></span> изменят размер файла, пока
Вы также не измените битпоток!
</p><p>
Битпоток изменяется <span class="bold"><strong>не</strong></span>
пропорционально разрешению.
То есть файл разрешением 320х240 с 200 кбит/сек не будет
того же качества, что этот же фильм разрешением 640х480
и 800 кбит/сек!
Для этого есть две причины:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  <span class="bold"><strong>Восприятие</strong></span>: Вы сильнее
  замечаете MPEG артефакты, если они больше!
  Артефакты возникают на масштабе блоков (8х8).
  Ваш глаз не увидит ошибки в 4800 маленьких блоков так же
  легко, как и в 1200 больших блоков (предполагая
  масштабирование обоих фильмов на полный экран).
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Теоретическая</strong></span>: Когда Вы
  уменьшаете размер изображения, но продолжаете использовать
  блоки того же размера (8х8) для пространственных частотных
  преобразований, Вы перемещаете больше данных в высокочастотные
  полосы. Грубо говоря, каждый пиксель содержит больше деталей,
  чем раньше.
  Так что несмотря на то, что Ваша картинка с уменьшенным
  масштабом содержит 1/4 информации в пространственных направлениях,
  она всё ещё может содержать большУю часть информации в
  частотных интервалах (предполагая, что высокие частоты были
  не использованы в оригинальном 640х480 изображении).
</p></li></ol></div><p>
</p><p>
Последние руководства рекомендовали выбор битпотока и разрешения,
основываясь на приближении "бит на пиксель", но это обычно не
верно из-за упомянутых выше причин.
Похоже, лучшей оценкой является рост битпотока пропорционально
квадратному корню разрешения, так что 320х240 и 400 кбит/сек
должно быть сравнимо с 640х480 и 800 кбит/сек.
Однако, это не было строго проверено теоретически или эмпирически.
Кроме того, из-за существенного отличия фильмов по уровню шума,
деталей, количества движения и т.п., тщетно давать общие рекомендации
для "битов на длину диагонали" (аналог битов на пиксель, используя
квадратный корень).
</p><p>
Таким образом, мы обсудили сложность выбора битпотока и разрешения.
</p><div class="sect3" title="10.1.5.1. Расчёт разрешения"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-dvd-mpeg4-resolution-bitrate-compute"></a>10.1.5.1. Расчёт разрешения</h4></div></div></div><p>
Следующие шаги помогут Вам рассчитать разрешение для Вашего
кодирования без слишком сильного искажения видео, учитывая
несколько видов информации об исходном видео.
Прежде всего, Вам необходимо рассчитать коэффициент соотношения
сторон для кодированного видео:
<code class="systemitem">ARc = (Wc x (ARa / PRdvd )) / Hc</code>

</p><div class="itemizedlist" title="где:"><p class="title"><b>где:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Wc и Hc — ширина и высота усечённого видео,
</p></li><li class="listitem"><p>
  ARa — коэффициент соотношения сторон изображения, обычно 4/3 или 16/9,
</p></li><li class="listitem"><p>
  PRdvd — отношение пикселей DVD, что равно 1.25=(720/576) для PAL
  DVD и 1.5=(720/480) для NTSC DVD.
</p></li></ul></div><p>
</p><p>
Затем Вы можете рассчитать разрешение по X и Y, согласно определённому
фактору качества сжатия (CQ):
<code class="systemitem">ResY = INT(SQRT( 1000*Битпоток/25/ARc/CQ )/16) * 16</code>
и <code class="systemitem">ResX = INT( ResY * ARc / 16) * 16</code>.
</p><p>
Хорошо, но что такое CQ?
CQ соответствует числу битов на пиксель и на кадр для кодирования.
Грубо говоря, чем больше CQ, тем меньше вероятность увидеть
артефакты кодирования.
Однако, если у Вас есть заданный размер для Вашего фильма
(например, 1 или 2 CD), есть ограниченное общее число битов,
которые Вы можете потратить; поэтому важно найти хороший
компромисс между сжимаемостью и качеством.
</p><p>
CQ зависит от битпотока, эффективности видеокодека и разрешения фильма.
Обычно, в целях увеличения CQ, Вам нужно будет уменьшить размер
фильма, при условии, что битпоток, вычисленный как функция конечного
размера, и длина фильма постоянны.
С MPEG-4 ASP кодеками, такими как <code class="systemitem">Xvid</code>
и <code class="systemitem">libavcodec</code>, CQ
меньше 0.18 обычно приводит к изображению с большим числом
сегментов "квадратиками", из-за недостаточного числа битов для
кодирования информации в каждом макроблоке.
(MPEG4, как и многие другие кодеки, группирует пиксели в блоки по
несколько пикселей для сжатия изображения; если битов не хватает,
границы этих блоков заметны.)
Следовательно, благоразумно выбрать CQ в диапазоне от 0.20 до 0.22
для рипа на 1 CD и 0.26-0.28 для рипа на 2 CD при использовании
стандартных опций кодирования.
Более продвинутые опции кодирования, такие как указанные для
<a class="link" href="#menc-feat-mpeg4-lavc-example-settings" title="10.3.4. Примеры настроек кодирования"><code class="systemitem">libavcodec</code></a>
  и
<a class="link" href="#menc-feat-xvid-example-settings" title="10.4.4. Примеры настроек кодирования"><code class="systemitem">Xvid</code></a>
должны сделать возможным получение того же качества с CQ в диапазоне
от 0.18 до 0.20 для рипа на 1 CD и 0.24-0.26 для рипа на 2 CD.
Используя MPEG-4 AVC кодеки, такие как
<code class="systemitem">x264</code>, Вы можете использовать
CQ в диапазоне от 0.14 до 0.16 со стандартными опциями кодирования
и должны суметь достичь таких низких значений, как 0.10 — 0.12
с помощью
<a class="link" href="#menc-feat-x264-example-settings" title="10.5.2. Примеры настроек кодирования">продвинутых опций кодирования <code class="systemitem">x264</code></a>.
</p><p>
Пожалуйста, обратите внимание, что CQ — лишь показательная величина,
т.к. она зависит от кодируемого содержимого; CQ 0.18 может хорошо
смотреться для Бергмана (Bergman), в отличии от такого фильма как
Матрица (The Matrix), содержащего много сцен с быстрым движением.
С другой стороны, бесполезно увеличивать CQ выше 0.30, т.к. Вы
будете тратить биты без заметного увеличения качества.
Так же обратите внимание, что, как было указано выше в данном
руководстве, фильмам с низким разрешением (например, по сравнению с DVD)
необходим более высокий CQ для того, чтоб они выглядели хорошо.
</p></div></div><div class="sect2" title="10.1.6. Фильтрация"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-filtering"></a>10.1.6. Фильтрация</h3></div></div></div><p>
Изучение использования видео фильтров <span class="application">MEncoder</span>
важно для получения хороших результатов кодирования.
Вся обработка видео выполняется посредством фильтров: усечение,
масштабирование, подстройка цвета, удаление шума, увеличение
чёткости, деинтерлейс (преобразование видео из чересстрочной
развёртки в построчную), телесин, обратный телесин и удаление
блочной сегментации — и это лишь некоторые из них.
Вместе с огромным количеством поддерживаемых входных форматов,
разнообразие фильтров, доступных в <span class="application">MEncoder</span>,
является одним из его основных достоинств над другими аналогичными
программами.
</p><p>
Фильтры загружаются в цепочку с помощью опции -vf:

</p><pre class="screen">-vf фильтр1=опции,фильтр2=опции,...</pre><p>

Большинство фильтров используют численные значения опций,
разделённые двоеточиями, но синтаксис этих параметров различается
у разных фильтров, так что читайте мануал для детальной
информации о фильтрах, которые Вы желаете использовать.
</p><p>
Фильтры действуют на видео в порядке их загрузки.
Например, следующая цепочка:

</p><pre class="screen">-vf crop=688:464:12:4,scale=640:464</pre><p>

сперва усечёт область изображения до 688х464 с верхним левым
углом (12,4), а затем масштабирует результат до 640х464.
</p><p>
Некоторые фильтры нужно загружать в начале цепочки фильтров (или
рядом с ним) с целью получения преимущества от использования
информации после видеодекодера, которая будет потеряна или
искажена другими фильтрами.
Важнейшими примерами являются: <tt class="option">pp</tt> (постобработка,
только при выполнении операций удаления блочной сегментации
(deblocking) или увеличения чёткости краёв (deringing)),
<tt class="option">spp</tt> (другой фильтр постобработки, служащий для
удаления артефактов MPEG), <tt class="option">pullup</tt> (обратный
телесин), и <tt class="option">softpulldown</tt> (для преобразования
мягкого телесина в жёсткий).
</p><p>
В общем случае, Вам следует делать настолько мало фильтрации,
насколько это возможно, для того чтоб остаться близко к оригинальному
DVD источнику. Усечение часто необходимо (как описано выше), но
избегайте масштабирования видео. Несмотря на то, что уменьшение
размера иногда предпочтительно использованию бОльших
квантователей, нужно избегать и того, и другого: помните,
что мы с самого начала решили обменять биты на качество.
</p><p>
Также не корректируйте гамму, контрастность, яркость и т.п.. То,
что хорошо выглядит на Вашем мониторе, может плохо выглядеть
на других. Эти коррекции должны выполняться только при
воспроизведении.
</p><p>
Однако, есть одна вещь, которую Вы, быть может, захотите сделать —
это пропустить видео через очень слабый фильтр удаления шумов,
такой как <tt class="option">-vf hqdn3d=2:1:2</tt>.
Ещё раз, причиной этому является то, что этим битам можно найти
лучшее применение: зачем тратить их, кодируя шум, если Вы просто
можете вернуть этот шум в процессе воспроизведения?
Увеличение параметров для <tt class="option">hqdn3d</tt> дополнительно
улучшит сжимаемость, но увеличив значения слишком сильно, Вы рискуете
ухудшить различимость изображения.
Рекомендованные выше значения (<tt class="option">2:1:2</tt>) слегка
консервативны; не бойтесь экспериментировать с более высокими
значениями и самостоятельно оценивать результаты.
</p></div><div class="sect2" title="10.1.7. Чересстрочная развёртка и телесин"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-interlacing"></a>10.1.7. Чересстрочная развёртка и телесин</h3></div></div></div><p>
Почти все фильмы снимаются при 24 fps [кадр/сек]. Поскольку
в NTSC используется 30000/1001 fps, нужно выполнить некоторую
обработку для такого 24 fps видео, чтобы оно корректно
воспроизводилось при кадровой частоте NTSC. Этот процесс называется
3:2 пулдаун, обычно называемый телесин (поскольку пулдаун часто
применяется в процессе показа телевизионного фильма, англ. telecine);
и в упрощенном описании это работает путём замедления фильма до
24000/1001 fps и повтора каждого четвёртого кадра.
</p><p>
Однако, никакой специальной обработки не выполняется для видео
на PAL DVD, которое воспроизводится при 25 fps. (Технически PAL
может быть подверженным телесину, называемому 2:2 пулдаун, но на
практике это не применяется).
24 fps фильм просто проигрывается на 25 fps. В результате фильм
воспроизводится слегка быстрее, но если Вы не пришелец, то,
вероятно, не заметите разницы.
У большинства PAL DVD аудио скорректировано по высоте звука так,
что, воспроизводясь при 25 fps, оно звучит нормально, несмотря на
то, что аудиодорожка (и, следовательно, весь фильм) проигрываются
на 4% быстрее, чем NTSC DVD.
</p><p>
Поскольку видео на PAL DVD не переделывается, Вам не стоит
беспокоится о частоте кадров. У источника 25 fps и у Вашего
рипа будет 25 fps. Однако, если Вы делаете рип NTSC DVD фильма,
Вам, быть может, придётся выполнить обратный телесин.
</p><p>
Для фильмов, снятых на 24 fps, видео на NTSC DVD идёт либо с телесином
30000/1001, либо с построчной развёрткой 24000/1001 fps и
предназначается для телесина на лету с помощью DVD плеера.
С другой стороны, TV сериалы идут обычно только с чересстрочной развёрткой,
но без телесина. Это не строгое правило: есть сериалы с
чересстрочной развёрткой (например, Баффи, Убийца Вампиров
[Buffy the Vampire Slayer]), в то время как другие представляют
собой смесь построчной и чересстрочной развёртки (такие как
Ангел [Angel] или 24).
</p><p>
Настоятельно рекомендуется прочитать раздел о
<a class="link" href="#menc-feat-telecine" title="10.2. Как работать с телесином и чересстрочной развёрткой на NTSC DVD">работе с телесином и чересстрочной развёрткой в NTSC DVD</a>
для изучения способов обработки в разных ситуациях.
</p><p>
Однако, если Вы преимущественно делаете рипы фильмов, Вы, скорее
всего, имеете дело с 24 fps видео либо с построчной развёрткой,
либо с подвергнутым телесину; в последнем случае Вы можете использовать
<tt class="option">pullup</tt> фильтр: <tt class="option">-vf
pullup,softskip</tt>.
</p></div><div class="sect2" title="10.1.8. Кодирование чересстрочного видео"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-encoding-interlaced"></a>10.1.8. Кодирование чересстрочного видео</h3></div></div></div><p>
Если Вы желаете кодировать фильм с чересстрочной развёрткой
(NTSC или PAL видео), Вам нужно решить, будете ли Вы его
преобразовывать в построчную развёртку или нет.
Хотя такое преобразование (деинтерлейс) сделает Ваш фильм
пригодным для дисплеев с построчной развёрткой, таких как
компьютерные мониторы и проекторы, это будет иметь свою цену:
частота полей уменьшится вдвое от 50 или 60000/1001 до 25 или
30000/1001 поля в секунду, и примерно половина информации в
Вашем фильме будет потеряна в сценах со значительным движением.
</p><p>
Поэтому, если Вы кодируете для высококачественных архивных целей,
не рекомендуется делать деинтерлейс. Вы всегда можете преобразовать
развёртку фильма в процессе воспроизведения (при воспроизведении
на устройствах с построчной развёрткой).
Мощность современных компьютеров вынуждает плееры использовать
фильтр деинтерлейса, что слегка ухудшает качество изображения.
Но плееры будущего будут способны имитировать дисплей TV с
чересстрочной развёрткой, выполняя деинтерлейс на полной частоте
полей и интерполируя 50 или 60000/1001 кадров в секунду для
чересстрочного видео.
</p><p>
С чересстрочным видео нужно работать особым образом:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Высота усечения и смещение по оси y должны быть кратны 4.
</p></li><li class="listitem"><p>
  Любое вертикальное масштабирование должно выполняться в режиме
  чересстрочной развёртки.
</p></li><li class="listitem"><p>
  Фильтры постобработки и удаления шума могут не работать как
  ожидается, только если Вы особо не позаботитесь об их
  применении к одному полю за раз, иначе они могут
  повредить видео при неверном использовании.
</p></li></ol></div><p>
  Учитывая вышесказанное, вот наш первый пример:
</p><pre class="screen">
mencoder <em class="replaceable"><code>захват.avi</code></em> -mc 0 -oac lavc -ovc lavc -lavcopts \
vcodec=mpeg2video:vbitrate=6000:ilme:ildct:acodec=mp2:abitrate=224
</pre><p>
Обратите внимание на опции <tt class="option">ilme</tt> и <tt class="option">ildct</tt>.
</p></div><div class="sect2" title="10.1.9. Замечания об аудио/видео синхронизации"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-av-sync"></a>10.1.9. Замечания об аудио/видео синхронизации</h3></div></div></div><p>
Алгоритмы аудио/видео (A/V) синхронизации <span class="application">MEncoder</span>
были разработаны с целью восстановления файлов с повреждённой
синхронизацией.
Однако, в ряде случаев они могут привести к ненужному пропуску
или повторению кадров и, возможно, к лёгкой A/V рассинхронизации
корректных входных данных (конечно, проблемы A/V синхронизации
возникают только при обработке или копировании аудиотрека при
кодировании видео, что настоятельно рекомендуется).
Поэтому Вы можете переключиться на базовую A/V синхронизацию
с помощью опции <tt class="option">-mc 0</tt> или разместить это в
конфигурационном файле <code class="systemitem">~/.mplayer/mencoder</code>,
если Вы работаете только с хорошими источниками (DVD, TV-захват,
высококачественные MPEG-4 рипы и т.п.), а не с повреждёнными
файлами ASF/RM/MOV.
</p><p>
Если Вы хотите дополнительно защититься от странных пропусков
и повторений кадров, Вы можете одновременно использовать опции
<tt class="option">-mc 0</tt> и <tt class="option">-noskip</tt>.
Это предотвратит <span class="emphasis"><em>любую</em></span> A/V коррекцию, и
будет копировать кадры один в один, так что Вы не сможете это
использовать, если будете применять какие-либо фильтры, которые
непредсказуемо добавляют или отбрасывают кадры, либо если у
Вашего входного файла переменный битопоток!
Поэтому использование <tt class="option">-noskip</tt> в общем случае не
рекомендуется.
</p><p>
Сообщалось о том, что так называемое трёхпроходное аудиокодирование,
поддерживаемое <span class="application">MEncoder</span>, вызывало
A/V рассинхронизацию.
Это наверняка произойдёт при использовании совместно с некоторыми
фильтрами, поэтому сейчас <span class="emphasis"><em>не</em></span> рекомендуется
использовать трёхпроходный аудио режим.
Эта возможность оставлена только для совместимости и для опытных
пользователей, понимающих когда это безопасно, а когда нет.
Если Вы ранее никогда не слышали о трёхпроходном режиме, забудьте
даже о том, что мы его упоминали!
</p><p>
Также были сообщения об A/V рассинхронизации при кодировании
со стандартного ввода (stdin) с помощью <span class="application">MEncoder</span>.
Не делайте этого! Всегда взамен используйте файл или CD/DVD и т.п.
устройство.
</p></div><div class="sect2" title="10.1.10. Выбор видеокодека"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-codec"></a>10.1.10. Выбор видеокодека</h3></div></div></div><p>
То, какой видеокодек лучше выбрать, зависит от нескольких
факторов, таких как размер, качество, устойчивость к ошибкам,
практичность и распространённость, многие из которых сильно
зависят от личных предпочтений и технических ограничений.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>Эффективность сжатия</strong></span>:
  Достаточно очевидно, что большинство кодеков нового поколения
  разработаны для увеличения качества и степени сжатия.
  Поэтому, авторы данного руководства и многие другие люди полагают,
  что Вы не можете ошибиться
  <sup>[<a name="fn-menc-feat-dvd-mpeg4-codec-cpu" href="#ftn.fn-menc-feat-dvd-mpeg4-codec-cpu" class="footnote">1</a>]</sup>,
  выбирая MPEG-4 AVC кодеки (например,
  <code class="systemitem">x264</code>)
  вместо таких MPEG-4 ASP кодеков, как
  <code class="systemitem">libavcodec</code> MPEG-4 или
  <code class="systemitem">Xvid</code>.
  (Опытные разработчики кодеков могут быть заинтересованы в
  ознакомлении с точкой зрения Михаэля Нидермайера (Michael
  Niedermayer)
  "<a class="ulink" href="http://guru.multimedia.cx/?p=10" target="_top">почему MPEG4-ASP отстой</a>".)
  Аналогично, Вы должны получить лучшее качество с MPEG-4 ASP, по
  сравнению с MPEG-2 кодеками.
  </p><p>
  Однако, новые кодеки, находящиеся в интенсивной разработке,
  могут страдать от ещё не замеченных ошибок, которые могут
  испортить кодирование. Просто это плата за использование
  передовых технологий.
  </p><p>
  Более существенно то, что для начала использования нового кодека
  необходимо потратить время на изучение его опций так, чтобы Вы
  знали, что нужно подстраивать для достижения заданного качества
  изображения.
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>Аппаратная совместимость</strong></span>:
  Обычно необходимо длительное время для включения поддержки
  последних видеокодеков в автономные видеоплееры.
  В итоге, большинство поддерживает только MPEG-1 (наподобие
  VCD, XVCD и KVCD), MPEG-2 (например, DVD, SVCD и KVCD) и MPEG-4
  ASP (например, DivX,
  <code class="systemitem">libavcodec</code> LMP4 и
  <code class="systemitem">Xvid</code>)
  (Осторожно: обычно поддерживаются не все возможности MPEG-4 ASP).
  Пожалуйста, обратитесь к технической спецификации Вашего плеера
  (если она доступна) или к гугл (google) для детальной информации.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Лучшее соотношение качества и времени кодирования</strong></span>:
  Кодеки, уже использующиеся определённое время (например,
  <code class="systemitem">libavcodec</code> MPEG-4 и
  <code class="systemitem">Xvid</code>) обычно сильно
  оптимизированы всевозможными остроумными алгоритмами и
  ассемблерным SIMD кодом. Поэтому они обладают тенденцией
  достижения лучшего соотношения качества к времени кодирования.
  Однако, у них могут быть некоторые очень продвинутые опции,
  которые, будучи включенными, сделают кодирование очень медленным
  ради несущественного выигрыша.
  </p><p>
  Если Вам нужна высокая скорость, примерно придерживайтесь настроек
  видеокодека по умолчанию (хотя Вам стоит попробовать другие опции,
  упоминаемые в иных разделах данного руководства).
  </p><p>
  Вы так же можете рассмотреть вариант использования многопоточного
  кодека, хотя это полезно только для пользователей машин с
  несколькими процессорами.
  <code class="systemitem">libavcodec</code> MPEG-4 позволяет
  это, но выигрыш в скорости ограничен и есть небольшой отрицательный
  эффект для качества картинки.
  Многопоточное кодирование <code class="systemitem">Xvid</code>,
  включаемое опцией <tt class="option">threads</tt>, может использоваться для
  ускорения кодирования (на примерно 40-60% в типичных случаях)
  с небольшим ухудшением картинки или вообще без него.
  <code class="systemitem">x264</code> также позволяет
  многопоточное кодирование, что обычно ускоряет процесс на 94%
  для каждого CPU ядра с уменьшением PSNR от 0.005 дБ до 0.01 дБ при типичных
  настройках.
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>Личные предпочтения</strong></span>:
  Здесь всё становится почти неразумным: из-за тех же причин, по
  которым одни придерживаются DivX 3 в течении лет, в то время
  как новые кодеки уже творят чудеса, другие люди предпочитают
  <code class="systemitem">Xvid</code> или
  <code class="systemitem">libavcodec</code> MPEG-4
  использованию <code class="systemitem">x264</code>.
  </p><p>
  Вам нужно принимать решение самостоятельно; не слушайте советов
  людей, признающих только один кодек.
  Сделайте несколько образцов клипов из искомых источников и
  сравните разные опции кодирования и кодеки, с целью выбора
  того, что Вам наиболее подходит.
  Лучший кодек — это тот, которым Вы сами овладели, и
  который выглядит лучше всего для Ваших глаз на Вашем дисплее
  <sup>[<a name="fn-menc-feat-dvd-mpeg4-codec-playback" href="#ftn.fn-menc-feat-dvd-mpeg4-codec-playback" class="footnote">2</a>]</sup>!
  </p></li></ul></div><p>
Пожалуйста, обратитесь к разделу
<a class="link" href="#menc-feat-selecting-codec" title="9.1. Выбор кодеков и формата файлов">выбор кодеков и форматов контейнера</a>
для получения списка поддерживаемых кодеков.
</p></div><div class="sect2" title="10.1.11. Аудио"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-audio"></a>10.1.11. Аудио</h3></div></div></div><p>
Аудио — это гораздо более простая проблема: если Вы
беспокоитесь о качестве, просто оставьте всё как есть.
Даже потоки AC-3 5.1 не более чем 448 Кбит/с и они стоят каждого
бита. Вы можете соблазниться перекодированием аудио в
высококачественный Vorbis (он же ogg формат), но лишь то, что
у Вас сегодня нет A/V приёмника для пропускания AC-3, не означает,
что у Вас не будет его завтра. Для жизнеспособности Ваших DVD
рипов в будущем, сохраняйте поток AC-3.
Вы можете сохранить поток AC-3, копируя его непосредственно в
видеопоток <a class="link" href="#menc-feat-mpeg4" title='9.3. Двухпроходное кодирование MPEG-4 ("DivX")'>в процессе кодирования</a>.
Вы также можете извлечь AC-3 поток с целью мультиплексирования его
в контейнеры наподобие NUT или Matroska (Матрёшка).
</p><pre class="screen">
mplayer <em class="replaceable"><code>файл_источника.vob</code></em> -aid 129 -dumpaudio -dumpfile <em class="replaceable"><code>звук.ac3</code></em></pre><p>
сохранит в файл <em class="replaceable"><code>звук.ac3</code></em> аудиодорожку
с номером 129 из файла
<em class="replaceable"><code>файл_источника.vob</code></em> (Обратите внимание:
DVD VOB файлы обычно используют нумерацию аудио, отличную от
стандартной, что означает, что аудиодорожка VOB 129 — это вторая
аудиодорожка файла).
</p><p>
Но иногда у Вас действительно нет иного выбора, чем далее сжимать
звук для того, чтоб больше битов могло быть потрачено на видео.
Большинство людей предпочитают сжимать звук с помощью MP3 или
Vorbis аудиокодеков.
Последний является очень эффективным, но MP3 лучше поддерживается
аппаратными плеерами, хотя эта тенденция меняется.
</p><p>
<span class="emphasis"><em>Не</em></span> используйте <tt class="option">-nosound</tt> при
кодировании файла с аудио, даже если позже Вы будете отдельно
кодировать и мультеплексировать аудио.
Хотя это может работать в идеальных случаях, использование
<tt class="option">-nosound</tt> обычно скрывает ряд проблем в Ваших
настройках кодирования в командной строке.
Другими словами, наличие звуковой дорожки в процессе кодирования
гарантирует Вам, что в случае отсутствия сообщений, подобных
<span class="quote">«<span class="quote">Слишком много аудиопакетов в буфере</span>»</span>, у Вас будет
получена правильная синхронизация.
</p><p>
Вам необходимо обработать звук с помощью
<span class="application">MEncoder</span>.
Например, Вы можете копировать исходную звуковую дорожку в
процессе кодирования с помощью <tt class="option">-oac copy</tt> или
преобразовать её в "лёгкий" 4 кГц моно WAV PCM с помощью
<tt class="option">-oac pcm -channels 1 -srate 4000</tt>.
Иначе, в ряде случаев, будет создаваться видео файл,
рассинхронизированный с аудио.
Такие случаи происходят, когда число кадров видео исходного файла
не совпадает с полной длиной кадров аудио, или когда были
разрывы/сшивания потока, где появились пропущенные или излишние
аудиокадры.
Правильным решением подобных проблем является вставка тишины или
усечение аудио в таких точках.
Однако, <span class="application">MPlayer</span> не может это сделать
и если Вы демультиплексируете AC-3 аудио и кодируете его отдельным
приложением (или создаёте дамп в PCM с помощью
<span class="application">MPlayer</span>), сшивания останутся
нескорректированными и единственный испособ их исправить —
пропускать/дублировать видеокадры в местах сшивки.
Пока <span class="application">MEncoder</span> видит аудио при
кодировании видео, он может выполнять этот пропуск/дублирование
(что обычно не вызывыет проблем, т.к. происходит при полностью
чёрных кадрах или при смене сцен), но если
<span class="application">MEncoder</span> не доступно аудио, он просто
будет обрабатывать все кадры "как есть" и они не будут совпадать
с окончательным аудиопотоком, когда Вы, например, объедините
аудио и видео дорожки в Matroska файл.
</p><p>
Прежде всего, Вам необходимо преобразовать DVD звук в WAV файл,
который может использоваться аудиокодеком в качестве входных
данных. Например:
</p><pre class="screen">
mplayer <em class="replaceable"><code>исходный_файл.vob</code></em> -ao pcm:file=<em class="replaceable"><code>звук.wav</code></em>
    -vc dummy -aid 1 -vo null
</pre><p>
сохранит вторую аудиодорожку из файла
<em class="replaceable"><code>исходный_файл.vob</code></em> в файл
<em class="replaceable"><code>звук.wav</code></em>.
Возможно, Вы захотите нормализовать звук перед кодированием,
поскольку аудиодорожки DVD обычно записываются с маленькой
громкостью.
Вы можете использовать, например, утилиту <span class="application">normalize</span>,
доступную в большинстве дистрибутивов.
Если Вы пользуетесь Window$, утилита <span class="application">BeSweet</span>
делает то же самое.
Вы можете сжать в Vorbis или MP3. Например:
</p><pre class="screen">oggenc -q1 <em class="replaceable"><code>звук.wav</code></em></pre><p>
кодирует <em class="replaceable"><code>звук.wav</code></em> с качеством 1,
что примерно эквивалентно 80 Кб/с и является минимальным качеством,
при котором Вам нужно кодировать, если Вы заботитесь о качестве.
Пожалуйста, обратите внимание, что <span class="application">MEncoder</span>
на данный момент не поддерживает мультиплексирование аудиопотоков
Vorbis в выходной файл, поскольку он поддерживает только AVI и
MPEG контейнеры для выходных файлов, использование каждого из
которых может привести к проблемам A/V синхронизации с
некоторыми плеерами, в случае когда AVI файл содержит VBR
аудиопотоки наподобие Vorbis.
Не беспокойтесь, в данном документе будет рассказано как Вы
можете это сделать с помощью сторонних программ.
</p></div><div class="sect2" title="10.1.12. Мультиплексирование"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-muxing"></a>10.1.12. Мультиплексирование</h3></div></div></div><p>
Теперь, после того как Вы кодировали видео, скорее всего, Вы
захотите мультиплексировать его с одним или несколькими
аудиопотоками в такие видео контейнеры как AVI, MPEG,
Matroska или NUT.
На данный момент встроенная поддержка вывода аудио и видео в
<span class="application">MEncoder</span> есть только для форматов
контейнеров MPEG и AVI.
Например:
</p><pre class="screen">
mencoder -oac copy -ovc copy -o <em class="replaceable"><code>выходной_фильм.avi</code></em> \
    -audiofile <em class="replaceable"><code>исходный_звук.mp2</code></em> <em class="replaceable"><code>исходное_видео.avi</code></em>
</pre><p>
Это объединит видеофайл <em class="replaceable"><code>исходное_видео.avi</code></em>
и аудиофайл <em class="replaceable"><code>исходный_звук.mp2</code></em>
в AVI файл <em class="replaceable"><code>выходной_фильм.avi</code></em>.
Эта команда работает с MPEG-1 слой I, II и III (более
известный как MP3) аудио, WAV, а также с некоторыми иными
форматами аудио.
</p><p>
<span class="application">MEncoder</span>
обладает экспериментальной поддержкой
<code class="systemitem">libavformat</code> —
библиотеки из проекта FFmpeg, поддерживающей мультиплексирование
и демультиплексирование множества контейнеров.
Например:
</p><pre class="screen">
mencoder -oac copy -ovc copy -o <em class="replaceable"><code>выходной_фильм.asf</code></em> \
    -audiofile <em class="replaceable"><code>исходный_звук.mp2</code></em> <em class="replaceable"><code>исходное_видео.avi</code></em> \
    -of lavf -lavfopts format=asf
</pre><p>
Это сделает то же самое, что и предыдущий пример, но выходным
контейнером будет ASF.
Пожалуйста, обратите внимание, что эта поддержка весьма
экспериментальна (но становится лучше c каждым днём), и будет
работать только в случае компиляции <span class="application">MPlayer</span>
с включенной поддержкой
<code class="systemitem">libavformat</code> (что означает,
что в большинстве случаев бинарная версия из пакетов не будет
работать).
</p><div class="sect3" title="10.1.12.1. Улучшение мультиплексирования и надёжности A/V синхронизации"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-dvd-mpeg4-muxing-filter-issues"></a>10.1.12.1. Улучшение мультиплексирования и надёжности A/V синхронизации</h4></div></div></div><p>
Вы можете столкнуться с некоторыми серьёзными проблемами A/V
синхронизации при попытке мультиплексирования Вашего видео
с некоторыми аудиодорожками, где, как бы Вы не подбирали задержку
аудио, никогда не получается правильная синхронизация.
Это может происходить при использовании некоторых видеофильтров,
пропускающих или дублирующих некоторые кадры, например фильтров
обратного телесина.
Настоятельно рекомендуется добавлять видеофильтр
<tt class="option">harddup</tt> в конце цепочки фильтров для избежания
подобных проблем.
</p><p>
Без опции <tt class="option">harddup</tt>, в случае когда
<span class="application">MEncoder</span> хочет дублировать кадр, он
полагается на то, что мультиплексор расположит отметку в
контейнере таким образом, что последний кадр будет повторен для
достижения синхронизации без реальной записи кадра.
С опцией <tt class="option">harddup</tt>, <span class="application">MEncoder</span>
вместо этого просто ещё раз поместит последний кадр в цепочку
фильтров.
Это означает, что кодер получит <span class="emphasis"><em>точно</em></span>
такой же кадр дважды и сожмёт его.
Это приведёт у несколько большему файлу, но избавит от проблем
при демультиплексировании или ремультиплексировании с другими
форматами контейнеров.
</p><p>
Также у Вас может не быть иного выбора, как использовать
<tt class="option">harddup</tt> с форматами контейнеров, которые
не слишком плотно связаны с
<span class="application">MEncoder</span>, например, с форматами,
поддерживаемыми с помощью
<code class="systemitem">libavformat</code>,
которые могут не поддерживать дублирование кадров на уровне
контейнера.
</p></div><div class="sect3" title="10.1.12.2. Ограничения контейнера AVI"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-dvd-mpeg4-muxing-avi-limitations"></a>10.1.12.2. Ограничения контейнера AVI</h4></div></div></div><p>
Хотя это самый широко распространённый формат контейнера после
MPEG-1,  он также обладает некоторыми существенными недостатками.
Пожалуй, они наиболее очевидны в его избыточности.
Для каждой цепочки AVI файла теряется 24 байта на заголовки и
индекс.
Это приводит к чуть более 5 МБ/час или 1.0-2.5% избыточности
для 700 МБ фильма. Это не кажется большим, но может означать
разницу между возможностью использования 700 кбит/сек или
714 кбит/сек в случаях, когда каждый бит на счету.
</p><p>
В дополнение к малой эффективности, AVI также обладает следующими
серьёзными ограничениями:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Может быть сохранено только содержимое с фиксированной частотой
  кадров. В частности, это особенно ограничивает, когда Ваш
  исходный материал смешанного содержимого: например, является
  смесью NTSC видео и киноматериала.
  В действительности, есть хаки, позволяющие сохранять содержимое
  с переменным fps в AVI, но они увеличивают (и без того большую)
  избыточность впятеро или более того и поэтому непрактичны.
</p></li><li class="listitem"><p>
  Аудио в AVI файлах должно быть или с постоянным битпотоком (CBR)
  или с постоянным размером кадра (т.е. все кадры декодируются
  в одно и то же число выборок).
  К сожалению, самый эффективный кодек, Vorbis, не удовлетворяет
  ни одному из данных требований.
  Поэтому, если Вы планируете сохранять Ваш фильм в AVI, Вы должны
  использовать менее эффективный кодек, такой как MP3 или AC-3.
</p></li></ol></div><p>
Сказав всё это, отметим, что <span class="application">MEncoder</span>
на данный момент не поддерживает вывод с переменным fps или
Vorbis кодирование.
Поэтому Вы можете не рассматривать всё это как ограничения, если
<span class="application">MEncoder</span> — это единственный
инструмент, который Вы используете для кодирования.
Однако, возможно использовать <span class="application">MEncoder</span>
только для кодирования видео и затем использовать внешние
утилиты для кодирования аудио и мультиплексирования его в
контейнер другого формата.
</p></div><div class="sect3" title="10.1.12.3. Мультиплексирование в контейнер Matroska (Матрёшка)"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-dvd-mpeg4-muxing-matroska"></a>10.1.12.3. Мультиплексирование в контейнер Matroska (Матрёшка)</h4></div></div></div><p>
Matroska — это свободный, открытый стандарт формата
контейнера, нацеленный на предоставление большого количества
продвинутых возможностей, которые старые контейнеры (наподобие
AVI) не поддерживают.
Например, Matroska поддерживает аудиосодержимое с переменным
битпотоком (VBR), переменные частоты кадров (VFR), разделы,
файловые вложения, код обнаружения ошибок (EDC) и современные
A/V кодеки, такие как "Продвинутое Аудио Кодирование" ("Advanced
Audio Coding", AAC), "Vorbis" или "MPEG-4 AVC" (H.264), также
не поддерживаемые AVI.
</p><p>
Утилиты, необходимые для создания Matroska файлов, сообща
называются <span class="application">mkvtoolnix</span>, и доступны
для большинства Unix платформ, так же как и для Window$.
Поскольку Matroska — открытый формат, Вы можете найти
иные утилиты, которые лучше Вам подходят, но поскольку
<span class="application">mkvtoolnix</span> — наиболее общие
и поддерживаются самой командой разработчиков Matroska, мы
будем обсуждать только их использование.
</p><p>
Возможно, самым простым способом начать использовать Matroska
является использование <span class="application">MMG</span>,
графической оболочки, поставляемой с
<span class="application">mkvtoolnix</span>. Следуйте
<a class="ulink" href="http://www.bunkus.org/videotools/mkvtoolnix/doc/mkvmerge-gui.html" target="_top">руководству к mkvmerge GUI (mmg)</a>.
</p><p>
Также Вы можете мультиплексировать аудио и видео файлы используя
командную строку:
</p><pre class="screen">
mkvmerge -o <em class="replaceable"><code>выходной_файл.mkv</code></em> <em class="replaceable"><code>входное_видео.avi</code></em> <em class="replaceable"><code>входное_аудио1.mp3</code></em> <em class="replaceable"><code>входное_аудио2.ac3</code></em>
</pre><p>
Это объединит видеофайл <em class="replaceable"><code>входное_видео.avi</code></em>
и два аудиофайла <em class="replaceable"><code>входное_аудио1.mp3</code></em>
и <em class="replaceable"><code>входное_аудио2.ac3</code></em> в Matroska
файл <em class="replaceable"><code>выходной_файл.mkv</code></em>.
Как было отмечено ранее, Matroska способна реализовать гораздо
большее, например, множественные аудиодорожки (включая тонкую
настройку аудио/видео синхронизации), разделы, субтитры,
разбиение и т.д..
Пожалуйста, обратитесь к документации на эти приложения для
деталей.
</p></div></div></div><div class="sect1" title="10.2. Как работать с телесином и чересстрочной развёрткой на NTSC DVD"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-telecine"></a>10.2. Как работать с телесином и чересстрочной развёрткой на NTSC DVD</h2></div></div></div><div class="sect2" title="10.2.1. Введение"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-telecine-intro"></a>10.2.1. Введение</h3></div></div></div><p title="Что такое телесин?"><b>Что такое телесин? </b>
Если Вы не понимаете многое из того, что здесь написано,
прочтите
<a class="ulink" href="http://en.wikipedia.org/wiki/Telecine" target="_top">статью Википедии о телесине</a>.
Это понятное и разумно обширное описание того, что такое
телесин.
</p><p title="Замечание о числах."><b>Замечание о числах. </b>
Многие документы, включая указанную выше статью, ссылаются
на количество полей в секунду 59.94 для NTSC видео и
соответствующие кадровые частоты 29.97 (для подверженного
телесину и чересстрочного видео) и 23.976 (для построчного).
Для простоты в ряде статей эти числа даже округляются до 60, 30
и 24 соответственно.
</p><p>
Строго говоря, все эти числа являются аппроксимациями.
Чёрно-белое NTSC видео было точно с 60 полями в секунду, но
позже была выбрана частота 60000/1001 для адаптации цветовой
информации с одновременным сохранением совместимости с чёрно-белым
телевидением.
Цифровое NTSC видео (такое как на DVD) также с 60000/1001
полями в секунду. Отсюда возникла кадровая частота 30000/1001
кадр/сек для чересстрочного и телесиненного видео; построчное
видео идёт с 24000/1001 кадр/сек.
</p><p>
Старые версии документации <span class="application">MEncoder</span>
и много архивных сообщений из списков рассылки ссылаются на
59.94, 29.97 и 23.976. Вся документация <span class="application">MEncoder</span>
была обновлена для использования дробных значений, и Вам так же
следует их использовать.
</p><p>
<tt class="option">-ofps 23.976</tt> — неправильно.
Взамен нужно использовать <tt class="option">-ofps 24000/1001</tt>.
</p><p title="Как используется телесин."><b>Как используется телесин. </b>
Всё видео, предназначенное для просмотра на NTSC телевидении
должно быть с 60000/1001 полями в секунду. Фильмы, сделанные
для показа на TV часто снимаются непосредственно при 60000/1001
полей в секунду, но большинство кино снимается на 24 или
24000/1001 кадрах в секунду. В процессе создания DVD с
кинофильмом, видео преобразуется для телевидения с помощью
процесса, называемого телесин.
</p><p>
В действительности, видео никогда не хранится на DVD с
60000/1001 полями в секунду. Для видео, оригинально являющегося
60000/1001, каждая пара полей объединяется для формирования
кадра, приводя к 30000/1001 кадрам в секунду. Затем аппаратные
DVD плееры читают флаг, включенный в видеопоток, для определения
того какие, чётные или нечётные строки должны формировать первый
кадр.
</p><p>
Обычно, содержимое с частотой кадров 24000/1001 остаётся
неизменным при кодировании на DVD и DVD плеер должен выполнить
телесин на лету. Однако, иногда видео подвергается телесину
<span class="emphasis"><em>до</em></span> записи на DVD; и хотя оно изначально
было с 24000/1001 кадр/сек, видео становится с 60000/1001 полями
в секунду. Когда оно сохраняется на DVD, пары полей объединяются
для формирования 30000/1001 кадров в секунду.
</p><p>
При рассмотрении отдельных кадров, полученных из 60000/1001
полей в секунду, телесиненных или наоборот, чересстрочная
развёртка чётко видна в случае, если есть какое-либо движение,
поскольку одно поле (скажем, с чётными номерами строк)
отображает момент времени на 1/(60000/1001) секунды позже, чем
другое поле. Воспроизведение чересстрочного видео на компьютере
выглядит скверно по двум причинам: монитор обладает более высоким
разрешением и видео показывается покадрово, вместо отображения по
полям.
</p><div class="itemizedlist" title="Замечания:"><p class="title"><b>Замечания:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
Этот раздел применим только к NTSC DVD, а не к PAL.
</p></li><li class="listitem"><p>
Примеры командных строк <span class="application">MEncoder</span>
в данном разделе <span class="bold"><strong>не</strong></span>
предназначены для реального использования. Они просто являются
минимально необходимым требованием для кодирования
соответствующей категории видео. То, как сделать хорошие DVD
рипы или тонко настроить
<code class="systemitem">libavcodec</code> для
достижения максимального качества, не входит в рамки данного
раздела; обратитесь к другим разделам
<a class="link" href="#encoding-guide" title="Глава 10. Кодирование с MEncoder">Руководства по кодированию
с MEncoder</a>.
</p></li><li class="listitem"><p>
Есть несколько сносок, специфичных для данного руководства,
обозначенных следующим образом:
  <a class="link" href="#menc-feat-telecine-footnotes" title="10.2.4. Примечания">[1]</a>
</p></li></ul></div></div><div class="sect2" title="10.2.2. Как распознать тип Вашего видео"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-telecine-ident"></a>10.2.2. Как распознать тип Вашего видео</h3></div></div></div><div class="sect3" title="10.2.2.1. Построчная развёртка"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-ident-progressive"></a>10.2.2.1. Построчная развёртка</h4></div></div></div><p>
Видео с построчной развёрткой изначально записывается на
24000/1001 fps и сохраняется на DVD без чередования.
</p><p>
При воспроизведении DVD с построчной развёрткой в
<span class="application">MPlayer</span>, <span class="application">MPlayer</span>
выведет следующую строку при начале воспроизведения фильма:

</p><pre class="screen">demux_mpg: обнаружено 24000/1001 кадра/сек NTSC содержимое с построчной развёрткой,
переключаю частоту кадров.</pre><p>

Начиная с этого момента, demux_mpg никогда не должен
сообщать о том, что найдено
"30000/1001 кадров/сек NTSC содержимое".
</p><p>
При просмотре видео с построчной развёрткой Вы не должны никогда
наблюдать чересстрочность. Однако, будьте осторожны, поскольку
иногда есть небольшая примесь телесина там, где Вы этого не
ожидаете. Мной наблюдались DVD с TV-шоу, у которых была одна
секунда телесина при каждой смене сцен или в случайных на вид
местах. Однажды я видел DVD, у которого одна половина была с
построчной развёрткой, а вторая — телесиненной. Если Вы
желаете быть <span class="emphasis"><em>действительно</em></span> уверенными,
Вы можете просканировать весь фильм:

</p><pre class="screen">mplayer dvd://1 -nosound -vo null -benchmark</pre><p>

Использование <tt class="option">-benchmark</tt> позволяет
<span class="application">MPlayer</span> воспроизводить фильм столь
быстро, сколь это возможно; тем не менее, в зависимости от
Вашего железа, это может занять некоторое время. Всякий раз,
когда demux_mpg будет сообщать об изменении частоты кадров,
строка прямо над сообщением покажет Вам время, при котором
произошло изменение.
</p><p>
Иногда видео на DVD с построчной развёрткой называют
"мягким телесином", поскольку предполагается, что
телесин будет выполнен DVD плеером.
</p></div><div class="sect3" title="10.2.2.2. Телесин"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-ident-telecined"></a>10.2.2.2. Телесин</h4></div></div></div><p>
Телесиненное видео изначально снимается на 24000/1001 кадр/сек,
но подвергается телесину <span class="emphasis"><em>до</em></span> записи на DVD.
</p><p>
<span class="application">MPlayer</span> не (всегда) сообщает об
изменении частоты кадров при воспроизведении телесиненного
видео.
</p><p>
При просмотре телесиненного видео, Вы будете видеть "мерцающие"
артефакты чересстрочной развёртки: они будут многократно
повторяться и исчезать.
Вы можете детально это рассмотреть следующим образом:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><pre class="screen">mplayer dvd://1</pre></li><li class="listitem"><p>
  Переместитесь в часть фильма с движением.
  </p></li><li class="listitem"><p>
  Используйте клавишу <span class="keycap"><b>.</b></span> для покадровой перемотки
  вперёд.
  </p></li><li class="listitem"><p>
  Наблюдайте за последовательностью кадров с чересстрочной и
  построчной развёрткой. Если Вы видите следующую структуру:
  ЧЧЧПП,ЧЧЧПП,ЧЧЧПП,... (где Ч — чересстрочные, а П —
  построчные кадры), значит видео телесиненное. Если Вы
  наблюдаете иную структуру, видео может быть телесиненным,
  используя какой-либо нестандартный метод;
  <span class="application">MEncoder</span> не может преобразовать
  без потерь нестандартный телесин в построчную развёртку.
  Если Вы не видите вообще никакой структуры, значит наиболее
  вероятно, что видео с чересстрочной развёрткой.
  </p></li></ol></div><p>
</p><p>
Иногда подверженное телесину видео на DVD называют "жестким телесином".
Поскольку жесткий телесин уже имеет 60000/1001 полей в секунду, DVD
проигрыватель, воспроизводя его, не делает никаких преобразований.
</p><p>
Другой способ выяснить, был Ваш источник подвержен телесину или нет, заключается
в воспроизведении исходного материала с опциями командной строки
<tt class="option">-vf pullup</tt> и <tt class="option">-v</tt>, чтобы увидеть, как
<tt class="option">pullup</tt> сопоставляет кадры.
Если источник был телесиненным, Вы должны увидеть в консоли 3:2 структуру с
чередующимися <code class="systemitem">0+.1.+2</code> и <code class="systemitem">0++1</code>.
Преимущество этой техники состоит в том, что не требуется просматривать исходный
материал для его идентификации, это может быть полезно для автоматизации
процедуры кодирования или выполнения вышеуказанной процедуры удаленно через
медленное соединение.
</p></div><div class="sect3" title="10.2.2.3. Чересстрочная развертка"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-ident-interlaced"></a>10.2.2.3. Чересстрочная развертка</h4></div></div></div><p>
Чересстрочное видео изначально снималось на 60000/1001 полями в секунду,
и сохранялось на DVD с 30000/1001 кадрами в секунду. Эффект чересстрочности
(часто называемый "гребёнкой") — результат объединения пары полей в кадры.
Поля сдвинуты друг относительно друга на 1/(60000/1001) секунды,
и, когда отображаются одновременно, разница заметна.
</p><p>
Как и с подверженным телесину видео, <span class="application">MPlayer</span> не должен
сообщать о каких-либо изменениях частоты кадров при воспроизведении
чересстрочного содержимого.
</p><p>
Внимательно, кадр за кадром (при помощи клавиши <span class="keycap"><b>.</b></span>) рассматривая
чересстрочное видео, Вы увидите, что каждый отдельный кадр — чересстрочный.
</p></div><div class="sect3" title="10.2.2.4. Смешанные построчная развертка и телесин"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-ident-mixedpt"></a>10.2.2.4. Смешанные построчная развертка и телесин</h4></div></div></div><p>
Все видео со "смешанными построчной разверткой и телесином" изначально было с
24000/1001 кадрами в секунду, но некоторые его части оказались подвержены
телесину.
</p><p>
Когда <span class="application">MPlayer</span> воспроизводит эту категорию, он будет
(как правило, периодически) переключаться между "30000/1001 кадров/сек NTSC
содержимым" и "24000/1001 кадра/сек NTSC содержимым с построчной развёрткой".
Смотрите конец вывода <span class="application">MPlayer</span>, чтобы увидеть
эти сообщения.
</p><p>
Вам следует проверить разделы с "30000/1001 кадров/сек NTSC содержимым",
чтобы убедиться, что видео действительно телесиненное, а не просто
чересстрочное.
</p></div><div class="sect3" title="10.2.2.5. Смешанные построчная и чересстрочная развертки"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-ident-mixedpi"></a>10.2.2.5. Смешанные построчная и чересстрочная развертки</h4></div></div></div><p>
В содержимом со "смешанными построчной и чересстрочной развертками",
построчное и чересстрочное видео переплетаются друг с другом.
</p><p>
Эта категория выглядит также, как и "смешанные построчная развертка и телесин",
до тех пор, пока не проверите разделы 30000/1001 кадр/сек и не увидите,
что структура телесина отсутствует.
</p></div></div><div class="sect2" title="10.2.3. Как кодировать каждую категорию"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-telecine-encode"></a>10.2.3. Как кодировать каждую категорию</h3></div></div></div><p>
Как уже было сказано выше, последующие примеры командных строк
<span class="application">MEncoder</span> <span class="bold"><strong>не</strong></span> означают,
что надо использовать именно их; они всего лишь примеры минимального набора параметров
для правильного кодирования каждой категории.
</p><div class="sect3" title="10.2.3.1. Построчная развертка"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-encode-progressive"></a>10.2.3.1. Построчная развертка</h4></div></div></div><p>
Видео с построчной разверткой не требует специальной обработки для кодирования.
Единственный нужный Вам для уверенности параметр — это
<tt class="option">-ofps 24000/1001</tt>.
В противном случае <span class="application">MEncoder</span> будет пытаться кодировать
с 30000/1001 кадрами в секунду и создаст дублирующиеся кадры.
</p><p>
</p><pre class="screen">mencoder dvd://1 -oac copy -ovc lavc -ofps 24000/1001</pre><p>
</p><p>
Частый случай, однако, когда видео, выглядящее построчным, на самом деле
содержит очень короткие подверженные телесину части. Если Вы не уверены,
безопаснее будет считать его как видео со
<a class="link" href="#menc-feat-telecine-encode-mixedpt" title="10.2.3.4. Смешанные построчная развертка и телесин">смешанными построчной
разверткой телесином</a>.
Потеря скорости невелика<a class="link" href="#menc-feat-telecine-footnotes" title="10.2.4. Примечания">[3]</a>.
</p></div><div class="sect3" title="10.2.3.2. Телесин"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-encode-telecined"></a>10.2.3.2. Телесин</h4></div></div></div><p>
Телесин может быть обращён для получения оригинального 24000/1001 содержимого
при помощи процесса, называемого обратный телесин.
<span class="application">MPlayer</span> содержит несколько фильтров для выполнения
этого; лучший из них, <tt class="option">pullup</tt> описан в разделе
<a class="link" href="#menc-feat-telecine-encode-mixedpt" title="10.2.3.4. Смешанные построчная развертка и телесин">смешанные построчная развертка
и телесин</a>.
</p></div><div class="sect3" title="10.2.3.3. Чересстрочная развертка"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-encode-interlaced"></a>10.2.3.3. Чересстрочная развертка</h4></div></div></div><p>
На практике в большинстве случаев невозможно получить полностью построчное
видео из чересстрочного содержимого.
Единственный способ сделать это без потери половины вертикального разрешения
- это удвоить частоту кадров и попытаться "угадать", что должно составить
соответствующие линии каждого поля (этот способ имеет недостатки, смотрите метод
3).
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Кодируйте видео в чересстрочной форме. Обычно это наносит вред способности
  кодировщика хорошо сжимать, но <code class="systemitem">libavcodec</code>
  имеет два параметра специально для чуть лучшего сохранения чересстрочного
  видео: <tt class="option">ildct</tt> и <tt class="option">ilme</tt>. К тому же, настоятельно
  рекомендуется использовать
  <tt class="option">mbd=2</tt><a class="link" href="#menc-feat-telecine-footnotes" title="10.2.4. Примечания">[2]</a>,
  потому что при этом макроблоки в местах без движения будут кодированы как
  нечересстрочные. Имейте в виду, что <tt class="option">-ofps</tt> здесь НЕ нужна.
  </p><pre class="screen">mencoder dvd://1 -oac copy -ovc lavc -lavcopts ildct:ilme:mbd=2</pre><p>
</p></li><li class="listitem"><p>
  Используйте фильтр деинтерлейсинга перед кодированием. Существует несколько
  таких фильтров на выбор, каждый имеет свои преимущества и недостатки.
  Обратитесь к <tt class="option">mplayer -pphelp</tt> и <tt class="option">mplayer -vf help</tt>
  для определения доступных (grep по "deint"), прочтите
  <a class="ulink" href="http://guru.multimedia.cx/deinterlacing-filters/" target="_top">Сравнение
  фильтров деинтерлейсинга</a> Майкла Нидермайера (Michael Niedermayer),
  и поищите в <a class="ulink" href="http://www.mplayerhq.hu/design7/mailing_lists.html" target="_top">
  списках рассылки MPlayer</a>, чтобы найти множество обсуждений различных
  фильтров.
  И опять, частота кадров не меняется, поэтому никаких <tt class="option">-ofps</tt>.
  к тому же деинтерлейсинг следует производить после обрезания
  <a class="link" href="#menc-feat-telecine-footnotes" title="10.2.4. Примечания">[1]</a> и до масштабирования.
  </p><pre class="screen">mencoder dvd://1 -oac copy -vf yadif -ovc lavc</pre><p>
</p></li><li class="listitem"><p>
  К сожалению, эта опция сбоит с <span class="application">MEncoder</span>; она должна
  хорошо работать с <span class="application">MEncoder G2</span>, но его пока нет. Вы
  можете столкнуться с крахами. Как бы то ни было, назначение опции
  <tt class="option"> -vf tfields</tt> — создать полный кадр из каждого поля, что
  делает частоту кадров равной 60000/1001. Преимущество этого подхода в том, что
  никакие данные не теряются; однако, т.к. каждый кадр получается только из одного
  поля, недостающие строки должны как-то интерполироваться.

  Не существует очень хороших методов
  генерации недостающих данных, поэтому результат будет выглядеть несколько похожим
  на применение некоторых фильтров деинтерлейсинга. Генерация недостающих строк также создает
  другие проблемы, просто потому что количество данных удваивается.
  Таким образом, для сохранения качества требуются более высокие значения
  битпотока, и больше ресурсов процессора используется как для
  кодирования, так и для декодирования. <tt class="option">tfields</tt> имеет
  несколько различных опций, определяющих способ создания недостающих строк
  каждого кадра. Если выбрали этот способ, обратитесь к руководству и выберите
  ту опцию, которая лучше подходит для Вашего материала. Имейте в виду, что при
  использовании <tt class="option">tfields</tt> Вы
  <span class="bold"><strong>должны</strong></span> указать как <tt class="option">-fps</tt>, так
  и <tt class="option">-ofps</tt>, установив им значение, равное удвоенной частоте
  исходного материала.
  </p><pre class="screen">
mencoder dvd://1 -oac copy -vf tfields=2 -ovc lavc \
    -fps 60000/1001 -ofps 60000/1001</pre><p>
</p></li><li class="listitem"><p>
  Если планируете сильно уменьшать размер изображения, можно извлекать и
  декодировать только одно поле из двух. Конечно, Вы потеряете половину
  вертикального разрешения, но если планируется уменьшать размер как минимум
  вдвое, потеря будет не сильно заметна. В результате получится построчной
  развёртки файл с 30000/1001 кадрами в секунду. Процедура следующая:
  <tt class="option">-vf field</tt>, затем обрезание
  <a class="link" href="#menc-feat-telecine-footnotes" title="10.2.4. Примечания">[1]</a> и масштабирование
  соответствующим образом. Помните, что потребуется скорректировать масштабирование
  для компенсации уменьшенного вдвое вертикального разрешения.
  </p><pre class="screen">mencoder dvd://1 -oac copy -vf field=0 -ovc lavc</pre><p>
</p></li></ol></div></div><div class="sect3" title="10.2.3.4. Смешанные построчная развертка и телесин"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-encode-mixedpt"></a>10.2.3.4. Смешанные построчная развертка и телесин</h4></div></div></div><p>
Для преобразования видео со смешанными построчной разверткой и телесином в
полностью построчное необходимо к подверженным телесину частям применить
обратный телесин. Есть три описанных ниже способа добиться этого.
Заметьте, что следует <span class="bold"><strong>всегда</strong></span> применять обратный
телесин до какого-либо масштабирования; за исключением случая, когда Вы точно
знаете, что делаете, выполняйте обратный телесин также до обрезания
<a class="link" href="#menc-feat-telecine-footnotes" title="10.2.4. Примечания">[1]</a>.
<tt class="option">-ofps 24000/1001</tt> здесь необходима, поскольку видео на выходе
будет с 24000/1001 кадрами в секунду.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <tt class="option">-vf pullup</tt> разработана для обратного телесина материала,
  телесину подверженного, оставляя построчные данные как есть. Для правильной
  работы после <tt class="option">pullup</tt> <span class="bold"><strong>должен</strong></span>
  следовать фильтр <tt class="option">softskip</tt>, иначе произойдет крах
  <span class="application">MEncoder</span>.
  <tt class="option">pullup</tt> является, однако, самым чистым и точным методом,
  доступным для кодирования и телесина, и "смешанного построчного с телесином".
  </p><pre class="screen">
mencoder dvd://1 -oac copy -vf pullup,softskip \
    -ovc lavc -ofps 24000/1001</pre><p>
</p></li><li class="listitem"><p>
  <tt class="option">-vf filmdint</tt> похожа на
  <tt class="option">-vf pullup</tt>: оба фильтра пытаются сопоставить пару полей
  для формирования полного кадра. Однако <tt class="option">filmdint</tt> будет
  производить деинтерлейсинг одиночных полей, которым не может найти пару,
  в то время как <tt class="option">pullup</tt> попросту их отбросит.
  Вдобавок фильтры имеют различные алгоритмы анализа, и filmdint
  имеет тенденцию к более частому нахождению соответствий.
  Какой фильтр будет лучше работать зависит от исходного видео и
  личного вкуса; не бойтесь экспериментировать с тонкой настройкой
  опций фильтров, если у Вас возникли проблемы с любым из них (подробности
  смотрите на странице руководства man). Для большинства качественного
  исходного видео, однако, оба фильтра работают достаточно хорошо,
  так что начинать работать можно с любым из них.
  </p><pre class="screen">
mencoder dvd://1 -oac copy -vf filmdint -ovc lavc -ofps 24000/1001</pre><p>
</p></li><li class="listitem"><p>
  Более старый метод заключается не в применении обратного телесина к
  телесиненным частям, а, наоборот, в телесине не подверженных телесину частей и
  последующем применении обратного телесина ко всему видео. Звучит запутанно?
  softpulldown — это фильтр, проходящий по видео и делающий телесиненным весь
  файл. Если следом за softpulldown указать либо <tt class="option">detc</tt>, либо
  <tt class="option">ivtc</tt>, финальный результат будет полностью построчным.
  <tt class="option">-ofps 24000/1001</tt> необходима.
  </p><pre class="screen">
mencoder dvd://1 -oac copy -vf softpulldown,ivtc=1 -ovc lavc -ofps 24000/1001
  </pre><p>
</p></li></ul></div></div><div class="sect3" title="10.2.3.5. Смешанные построчная и чересстрочная развертки"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-telecine-encode-mixedpi"></a>10.2.3.5. Смешанные построчная и чересстрочная развертки</h4></div></div></div><p>
Существует две опции для этой категории, каждая из которых — это компромисс. Вы
должны выбрать, исходя из продолжительности/положения каждого типа.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Рассматривайте видео как построчное. Чересстрочные части будут выглядеть
  чересстрочными, и потребуется удаление некоторых из чересстрочных полей, что
  даст в результате некоторое скачкообразное дрожание. Вы можете использовать
  фильтр постобработки, если хотите, но это может несколько ухудшить
  построчные части.
  </p><p>
  Эта опция определенно не должна использоваться, если Вы хотите со
  временем отображать видео на чересстрочном устройстве (с помощью TV карты,
  например). Если у Вас есть чересстрочные кадры в видео с 24000/1001 кадрами в
  секунду, к ним, как и к прогрессивным, будет применен телесин. Половина их
  чересстрочных "кадров" будут отображаться с длительностью трех полей
  (3/(60000/1001) секунд), давая в результате неприятно выглядящий эффект
  
  "прыжка назад во времени". Даже если Вы пробуете это, Вы
  <span class="bold"><strong>должны</strong></span> использовать фильтр деинтерлейсинга,
  такой как <tt class="option">lb</tt> или <tt class="option">l5</tt>.
  </p><p>
  Для отображения на построчном дисплее это тоже может быть плохой идеей.
  Будут отбрасываться пары последовательных чересстрочных полей, приводя к
  разрывам, которые могут быть заметнее, чем при использовании второго метода,
  отображающего некоторые построчные кадры дважды. Чересстрочное видео с
  30000/1001 кадрами в секунду уже несколько прерывисто, потому что в реальности
  оно должно отображаться с 60000/1001 полями в секунду, так что дублирующиеся
  кадры не так сильно выделяются.
  </p><p>
  Так или иначе, лучше всего проанализировать Ваше содержимое и как Вы его
  собираетесь показывать. Если видео на 90% построчное и Вы никогда не будете
  показывать его на TV, Вам следует отдать предпочтение построчному варианту.
  Если оно только наполовину построчное, Вы, возможно, захотите кодировать
  его, как если бы оно было чересстрочным.
  </p></li><li class="listitem"><p>
  Считайте его чересстрочным. Некоторые кадры построчной части потребуют
  дублирования, что даст в результате некоторое скачкообразное дрожание. И
  снова, фильтры деинтерлейсинга могут несколько ухудшить построчные части.
</p></li></ul></div></div></div><div class="sect2" title="10.2.4. Примечания"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-telecine-footnotes"></a>10.2.4. Примечания</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p title="Об усечении сторон:"><b>Об усечении сторон: </b>
  Видеоданные на DVD хранятся в формате, называемом YUV 4:2:0. В YUV
  видео, люма ("яркость") и хрома ("цвет") хранятся отдельно.
  Поскольку человеческий глаз отчасти менее чувствителен к цвету, чем к яркости,
  в YUV 4:2:0 изображении присутствует только один цветностный пиксел на четыре
  яркостных. В изображении с построчной развёрткой каждый квадрат из четырёх яркостных
  пикселов (два на два) имеют один общий цветностный пиксел. Вы должны обрезать
  построчный YUV 4:2:0 до чётных размеров и использовать чётные смещения.
  Например,
  <tt class="option">crop=716:380:2:26</tt> — правильно, а
  <tt class="option">crop=716:380:3:26 </tt> — нет.
  </p><p>
  Когда имеете дело с чересстрочным YUV 4:2:0, ситуация чуть более сложная.
  Вместо разделения одного цветностного пиксела четырьмя яркостными пикселами в
  <span class="emphasis"><em>кадре</em></span>, каждые четыре яркостных пиксела каждого
  <span class="emphasis"><em>поля</em></span> разделяют цветностный пиксел. Когда поля объединены в
  кадр, каждая строка имеет высоту в один пиксел. Теперь, вместо квадрата из
  четырех яркостных пикселов мы имеем два соседних пиксела, а два других расположены
  на две строки ниже. Два яркостных пиксела следующей строки принадлежат
  другому полю, и, поэтому, разделяют другой пиксел цветности с двумя пикселами
  на две строки дальше. Вся эта неразбериха требует, чтобы вертикальные размеры
  и смещения обрезания были кратны четырем. Горизонтальные могут оставаться
  четными.
  </p><p>
  Для телесиненного видео я рекомендую производить обрезание после обратного
  телесина. Так как видео построчное, достаточно обрезать только по четным
  размерам. Если же действительно хотите получить небольшую прибавку к скорости,
  которую может дать обрезка, Вам придется производить усечение с вертикальными
  размерностями, кратными четырем. В противном случае фильтр обратного телесина
  не будет иметь правильных данных.
  </p><p>
  Для чересстрочного (не подверженного телесину) видео, Вы всегда должны
  производить усечение с вертикальными размерностями, кратными четырем, если
  только не используете <tt class="option">-vf field</tt> перед усечением.
  </p></li><li class="listitem"><p title="О параметрах кодирования и качестве:"><b>О параметрах кодирования и качестве: </b>
  Если я здесь рекомендую <tt class="option">mbd=2</tt>, это еще не значит, что эту
  опцию не следует использовать где-либо еще. Совместно с <tt class="option">trell</tt>,
  <tt class="option">mbd=2</tt> является одной из двух опций
  <code class="systemitem">libavcodec</code>, которые значительно
  увеличивают качество. Вам всегда следует использовать как минимум эти две,
  за исключением случая, когда потеря скорости кодирования недопустима
  (например, кодирование в реальном времени). Есть множество других
  <code class="systemitem">libavcodec</code> опций, улучшающих качество
  (и замедляющих кодирование), но их описание выходит за рамки этого
  документа.
  </p></li><li class="listitem"><p title="О производительности pullup:"><b>О производительности pullup: </b>
  Использование <tt class="option">pullup</tt> (совместно с <tt class="option">softskip</tt>)
  для видео с построчной развёрткой вполне безопасно и обычно является хорошей
  идеей, если только про источник не известно достоверно, что он полностью
  построчный. Потеря скорости мала в большинстве случаев.
  В минимальном варианте кодирования <tt class="option">pullup</tt> замедляет
  <span class="application">MEncoder</span> на 50%. Добавление обработки звука и
  продвинутых <tt class="option">lavcopts</tt> опций затмевает эту разницу, уменьшая
  падение производительности от использования <tt class="option">pullup</tt> до 2%.
  </p></li></ol></div></div></div><div class="sect1" title="10.3. Кодирование семейством кодеков libavcodec"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-enc-libavcodec"></a>10.3. Кодирование семейством кодеков <code class="systemitem">libavcodec</code>
</h2></div></div></div><p>
<code class="systemitem">libavcodec</code>
предоставляет возможность простого кодирования в множество интересных видео и
аудио форматов. Вы можете кодировать следующими кодеками (более или менее
свежий список):
</p><div class="sect2" title="10.3.1. Видео кодеки libavcodec"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-enc-libavcodec-video-codecs"></a>10.3.1. Видео кодеки <code class="systemitem">libavcodec</code></h3></div></div></div><p>
</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Название видео кодека</th><th>Описание</th></tr></thead><tbody><tr><td>mjpeg</td><td>Motion JPEG</td></tr><tr><td>ljpeg</td><td>JPEG без потери качества</td></tr><tr><td>jpegls</td><td>JPEG LS</td></tr><tr><td>targa</td><td>Targa рисунок</td></tr><tr><td>gif</td><td>GIF рисунок</td></tr><tr><td>bmp</td><td>BMP рисунок</td></tr><tr><td>png</td><td>PNG рисунок</td></tr><tr><td>h261</td><td>H.261</td></tr><tr><td>h263</td><td>H.263</td></tr><tr><td>h263p</td><td>H.263+</td></tr><tr><td>mpeg4</td><td>ISO стандарт MPEG-4 (DivX, Xvid совместимый)</td></tr><tr><td>msmpeg4</td><td>вариант пре-стандарта MPEG-4 от MS, v3 (он же DivX3)</td></tr><tr><td>msmpeg4v2</td><td>вариант пре-стандарта MPEG-4 от MS, v2 (используемый в старых ASF
  файлах)</td></tr><tr><td>wmv1</td><td>Windows Media Video, версия 1 (он же WMV7)</td></tr><tr><td>wmv2</td><td>Windows Media Video, версия 2 (он же WMV8)</td></tr><tr><td>rv10</td><td>RealVideo 1.0</td></tr><tr><td>rv20</td><td>RealVideo 2.0</td></tr><tr><td>mpeg1video</td><td>MPEG-1 видео</td></tr><tr><td>mpeg2video</td><td>MPEG-2 видео</td></tr><tr><td>huffyuv</td><td>сжатие без потерь</td></tr><tr><td>ffvhuff</td><td>huffyuv без потерь, модифицированный FFmpeg</td></tr><tr><td>asv1</td><td>ASUS Видео v1</td></tr><tr><td>asv2</td><td>ASUS Видео v2</td></tr><tr><td>ffv1</td><td>видео кодек без потерь из FFmpeg</td></tr><tr><td>svq1</td><td>Sorenson видео 1</td></tr><tr><td>flv</td><td>Sorenson H.263 используемый в Flash Видео</td></tr><tr><td>flashsv</td><td>Flash Screen Video</td></tr><tr><td>dvvideo</td><td>Sony Digital Video</td></tr><tr><td>snow</td><td>экспериментальный кодек FFmpeg, основанный на вейвлетах</td></tr><tr><td>zmbv</td><td>Zip Motion Blocks Video</td></tr><tr><td>dnxhd</td><td>AVID DNxHD</td></tr></tbody></table></div><p>

Первый столбец содержит названия кодеков, которые следует указывать после
<code class="literal">vcodec</code> опции, например:
<tt class="option">-lavcopts vcodec=msmpeg4</tt>
</p><div class="informalexample"><p>
Пример с MJPEG сжатием:
</p><pre class="screen">
mencoder dvd://2 -o title2.avi -ovc lavc -lavcopts vcodec=mjpeg -oac copy
</pre><p>
</p></div></div><div class="sect2" title="10.3.2. Аудио кодеки libavcodec"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-enc-libavcodec-audio-codecs"></a>10.3.2. Аудио кодеки <code class="systemitem">libavcodec</code></h3></div></div></div><p>
</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Название аудио кодека</th><th>Описание</th></tr></thead><tbody><tr><td>ac3</td><td>Dolby Digital (AC-3)</td></tr><tr><td>adpcm_*</td><td>Форматы Adaptive PCM, смотрите дополнительную таблицу</td></tr><tr><td>flac</td><td>Free Lossless Audio Codec (FLAC)</td></tr><tr><td>g726</td><td>G.726 ADPCM</td></tr><tr><td>libamr_nb</td><td>3GPP Adaptive Multi-Rate (AMR) узкополосный</td></tr><tr><td>libamr_wb</td><td>3GPP Adaptive Multi-Rate (AMR) широкополосный</td></tr><tr><td>libfaac</td><td>Advanced Audio Coding (AAC) - используя FAAC</td></tr><tr><td>libgsm</td><td>ETSI GSM 06.10 full rate</td></tr><tr><td>libgsm_ms</td><td>Microsoft GSM</td></tr><tr><td>libmp3lame</td><td>MPEG-1 audio layer 3 (MP3) - используя LAME</td></tr><tr><td>mp2</td><td>MPEG-1 audio layer 2 (MP2)</td></tr><tr><td>pcm_*</td><td>PCM форматы, смотрите дополнительную таблицу</td></tr><tr><td>roq_dpcm</td><td>Id Software RoQ DPCM</td></tr><tr><td>sonic</td><td>экспериментальный кодек от FFmpeg с потерями (lossy)</td></tr><tr><td>sonicls</td><td>экспериментальный кодек от FFmpeg без потерь (lossless)</td></tr><tr><td>vorbis</td><td>Vorbis</td></tr><tr><td>wmav1</td><td>Windows Media Audio v1</td></tr><tr><td>wmav2</td><td>Windows Media Audio v2</td></tr></tbody></table></div><p>

Первый столбец содержит названия кодеков, которые следует указывать после
<code class="literal">acodec</code> опции, например: <tt class="option">-lavcopts acodec=ac3</tt>
</p><div class="informalexample"><p>
Пример с AC-3 сжатием:
</p><pre class="screen">
mencoder dvd://2 -o title2.avi -oac lavc -lavcopts acodec=ac3 -ovc copy
</pre><p>
</p></div><p>
В отличие от видео кодеков <code class="systemitem">libavcodec</code>,
ее аудио кодеки не очень разумно используют отданные им биты, в силу
неудачной реализации некоторой минимальной психоакустической модели (если она
вообще есть), которая является характерной чертой большинства остальных реализаций кодеков.
Однако заметьте, что все эти аудио кодеки очень быстры и работают прямо из
коробки везде, где <span class="application">MEncoder</span> скомпилирован с
<code class="systemitem">libavcodec</code> (а почти всегда так оно и
есть), и не зависят от внешних библиотек.
</p><div class="sect3" title="10.3.2.1. Дополнительная таблица PCM/ADPCM форматов"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-enc-libavcodec-audio-codecs-pcmadpcm"></a>10.3.2.1. Дополнительная таблица PCM/ADPCM форматов</h4></div></div></div><p>
</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Название PCM/ADPCM кодека</th><th>Описание</th></tr></thead><tbody><tr><td>pcm_s32le</td><td>signed 32-bit little-endian</td></tr><tr><td>pcm_s32be</td><td>signed 32-bit big-endian</td></tr><tr><td>pcm_u32le</td><td>unsigned 32-bit little-endian</td></tr><tr><td>pcm_u32be</td><td>unsigned 32-bit big-endian</td></tr><tr><td>pcm_s24le</td><td>signed 24-bit little-endian</td></tr><tr><td>pcm_s24be</td><td>signed 24-bit big-endian</td></tr><tr><td>pcm_u24le</td><td>unsigned 24-bit little-endian</td></tr><tr><td>pcm_u24be</td><td>unsigned 24-bit big-endian</td></tr><tr><td>pcm_s16le</td><td>signed 16-bit little-endian</td></tr><tr><td>pcm_s16be</td><td>signed 16-bit big-endian</td></tr><tr><td>pcm_u16le</td><td>unsigned 16-bit little-endian</td></tr><tr><td>pcm_u16be</td><td>unsigned 16-bit big-endian</td></tr><tr><td>pcm_s8</td><td>signed 8-bit</td></tr><tr><td>pcm_u8</td><td>unsigned 8-bit</td></tr><tr><td>pcm_alaw</td><td>G.711 A-LAW </td></tr><tr><td>pcm_mulaw</td><td>G.711 μ-LAW</td></tr><tr><td>pcm_s24daud</td><td>signed 24-bit D-Cinema Audio формат</td></tr><tr><td>pcm_zork</td><td>Activision Zork Nemesis</td></tr><tr><td>adpcm_ima_qt</td><td>Apple QuickTime</td></tr><tr><td>adpcm_ima_wav</td><td>Microsoft/IBM WAVE</td></tr><tr><td>adpcm_ima_dk3</td><td>Duck DK3</td></tr><tr><td>adpcm_ima_dk4</td><td>Duck DK4</td></tr><tr><td>adpcm_ima_ws</td><td>Westwood Studios</td></tr><tr><td>adpcm_ima_smjpeg</td><td>SDL Motion JPEG</td></tr><tr><td>adpcm_ms</td><td>Microsoft</td></tr><tr><td>adpcm_4xm</td><td>4X Technologies</td></tr><tr><td>adpcm_xa</td><td>Phillips Yellow Book CD-ROM eXtended Architecture</td></tr><tr><td>adpcm_ea</td><td>Electronic Arts</td></tr><tr><td>adpcm_ct</td><td>Creative 16-&gt;4-bit</td></tr><tr><td>adpcm_swf</td><td>Adobe Shockwave Flash</td></tr><tr><td>adpcm_yamaha</td><td>Yamaha</td></tr><tr><td>adpcm_sbpro_4</td><td>Creative VOC SoundBlaster Pro 8-&gt;4-bit</td></tr><tr><td>adpcm_sbpro_3</td><td>Creative VOC SoundBlaster Pro 8-&gt;2.6-bit</td></tr><tr><td>adpcm_sbpro_2</td><td>Creative VOC SoundBlaster Pro 8-&gt;2-bit</td></tr><tr><td>adpcm_thp</td><td>Nintendo GameCube FMV THP</td></tr><tr><td>adpcm_adx</td><td>Sega/CRI ADX</td></tr></tbody></table></div><p>
</p></div></div><div class="sect2" title="10.3.3. Опции кодирования libavcodec"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-lavc-encoding-options"></a>10.3.3. Опции кодирования libavcodec</h3></div></div></div><p>
В идеале, Вы, наверное, хотели бы иметь возможность просто сказать кодировщику
переключиться на "высокое качество" и начать кодирование.
Это было бы замечательно, но, к сожалению, трудно реализуемо, поскольку
различные опции кодирования, в зависимости от исходного материала, дают в результате
различное качество.
Так происходит потому, что сжатие зависит от визуальных свойств видео.
Например, аниме и живая съемка имеют сильно отличающиеся свойства и,
поэтому, требуют разные опции для получения оптимального результата.
Хорошая новость состоит в том, что некоторые опции, такие как
<tt class="option">mbd=2</tt>, <tt class="option">trell</tt> и <tt class="option">v4mv</tt>,
никогда не следует опускать.
Детальное описание основных опций кодирования смотрите ниже.
</p><div class="itemizedlist" title="Опции для настройки:"><p class="title"><b>Опции для настройки:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>vmax_b_frames</strong></span>: хороши 1 или 2, в зависимости
  от фильма.
  Заметьте, если хотите, чтобы Ваш фильм декодировался DivX5, Вы должны
  активировать поддержку закрытых GOP, используя опцию <tt class="option">cgop</tt>
  <code class="systemitem">libavcodec</code>, но также должны деактивировать
  определение сцен, что не является хорошей идеей, поскольку несколько вредит
  эффективности.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>vb_strategy=1</strong></span>: помогает в высокодинамичных
  сценах.
  Для некоторых видео файлов vmax_b_frames может повредить качеству, но vmax_b_frames=2
  вместе с vb_strategy=1 поможет в этом случае.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>dia</strong></span>: диапазон поиска движения. Большие
  значения лучше и медленнее.
  Отрицательные значения — это совершенно другая шкала.
  Хорошими значениями являются -1 для быстрого кодирования или 2-4 — для
  медленного.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>predia</strong></span>: предпроход поиска движения.
  Не так важен, как dia. Хорошими являются значения от 1 (по умолчанию) до 4.
  Требует preme=2, чтобы быть действительно полезным.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>cmp, subcmp, precmp</strong></span>: Функция сравнения для
  поиска движения.
  Поэкспериментируйте со значениями 0 (по умолчанию), 2 (hadamard), 3 (dct), и 6
  (соотношение сигнал-шум).
  0 — самый быстрый и достаточен для precmp.
  В случае cmp и subcmp, 2 является хорошим для аниме, а 3 для живой съемки.
  6 может оказаться лучше, а может и нет, но он медленнее.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>last_pred</strong></span>: Количество предсказателей
  движения, берущихся из предыдущего кадра.
  1-3 или около того помогут Вам ценой небольшой потери в скорости.
  Большие значения медленны и не дают дополнительного улучшения.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>cbp, mv0</strong></span>: Контролирует выбор макроблоков.
  Незначительное снижение скорости с небольшим приростом в качестве.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>qprd</strong></span>: адаптивное квантование, основанное на
  сложности макроблока.
  Может сделать лучше или хуже в зависимости от видео и других опций.
  Она также может привести к появлению артефактов, если Вы не установите vqmax в
  некоторое разумно малое значение
  (хорошо — 6, может быть даже 4); vqmin=1 также может помочь.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>qns</strong></span>: очень медленно, особенно в комбинации с qprd.
  Эта опция укажет кодировщику минимизировать шум от артефактов сжатия вместо
  создания закодированного видео, полностью соответствующего исходному.
  Не используйте ее, если только не перепробовали настроить все, что было
  возможно, а результат все таки недостаточно хорош.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>vqcomp</strong></span>: Настраивает управление битпотоком.
  Какие значения являются хорошими, зависит от фильма.
  Если хотите, можете без опаски оставить значение по умолчанию.
  Уменьшение vqcomp отдает больше бит в сцены с низкой сложностью, увеличение
  его передает биты в очень сложные сцены (по умолчанию: 0.5, диапазон: 0-1.
  рекомендуемый диапазон: 0.5-0.7).
</p></li><li class="listitem"><p>
  <span class="bold"><strong>vlelim, vcelim</strong></span>: Устанавливает порог
  отбрасывания одиночного коэффициента для яркостной и цветностной плоскостей.
  Они кодируются независимо во всех MPEG-похожих алгоритмах.
  Идея этих опций заключается в использованию некоторой хорошей эвристики для
  определения момента, когда изменения в блоке ниже указанного Вами порога, и что его
  стоит кодировать как "блок без изменений".
  Это сохраняет биты и, возможно, ускоряет кодирование.
  vlelim=-4 и vcelim=9 выглядят неплохими для живой съемки, но, скорее всего, не
  помогут для аниме; при кодировании анимации Вам, возможно, следует оставить
  эту опцию неизменной.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>qpel</strong></span>: Четверьтпиксельная оценка движения.
  По-умолчанию, MPEG-4 использует полупиксельную точность для поиска движения,
  следовательно, эта опция вносит дополнительные накладные расходы, поскольку
  сохраняет больше информации в закодированном файле.
  Улучшение/ухудшение степени сжатия зависит от фильма, но обычно эта опция не
  очень эффективна для аниме.
  qpel всегда вносит значительный вклад в CPU время декодирования (+25% на
  практике).
</p></li><li class="listitem"><p>
  <span class="bold"><strong>psnr</strong></span>: не влияет на сам процесс кодирования,
  но выводит в файл тип/размер/качество каждого кадра, а также итоговый
  PSNR (Peak Signal to Noise Ratio, пиковое отношения сигнала к шуму) в конце
  процесса.
</p></li></ul></div><div class="itemizedlist" title="Опции, с которыми играть не стоит:"><p class="title"><b>Опции, с которыми играть не стоит:</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>vme</strong></span>: Значение по умолчанию является лучшим.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>lumi_mask, dark_mask</strong></span>: Психовизуальное
  адаптивное квантование.
  Не стоит играть с этими опциями, если заботитесь о качестве.
  Разумные значения могут быть эффективными в Вашем случае, но имейте в виду,
  что это весьма субъективно.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>scplx_mask</strong></span>: Пытается предотвратить появление
  квадратиков, но лучше выполнить постобработку.
</p></li></ul></div></div><div class="sect2" title="10.3.4. Примеры настроек кодирования"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-mpeg4-lavc-example-settings"></a>10.3.4. Примеры настроек кодирования</h3></div></div></div><p>
Следующие настройки — это примеры различных комбинаций опций кодирования,
которые влияют на соотношение скорость-качество при той же величине целевого
биптотока.
</p><p>
Все настройки кодирования проверялись на тестовом видео 720x448 @30000/1001 fps
с целевым битпотоком 900кбит/сек, на машине AMD-64 3400+ с 2400 МГц и 64 битном режиме.
Для каждой настройки кодирования указаны измеренная скорость кодирования (в
кадрах в секунду) и потеря PSNR (в дБ) по сравнению с настройкой "очень высокое
качество". Поймите, пожалуйста, что в зависимости от Вашего материала, типа
машины, прогресса разработки Вы можете получить сильно отличающиеся результаты.
</p><p>
</p><div class="informaltable"><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>Описание</th><th>Опции кодирования</th><th>скорость (в fps)</th><th>Относительная потеря PSNR (в дБ)</th></tr></thead><tbody><tr><td>Очень высокое качество</td><td><tt class="option">vcodec=mpeg4:mbd=2:mv0:trell:v4mv:cbp:last_pred=3:predia=2:dia=2:vmax_b_frames=2:vb_strategy=1:precmp=2:cmp=2:subcmp=2:preme=2:qns=2</tt></td><td>6fps</td><td>0дБ</td></tr><tr><td>Высокое качество</td><td><tt class="option">vcodec=mpeg4:mbd=2:trell:v4mv:last_pred=2:dia=-1:vmax_b_frames=2:vb_strategy=1:cmp=3:subcmp=3:precmp=0:vqcomp=0.6:turbo</tt></td><td>15fps</td><td>-0.5дБ</td></tr><tr><td>Быстрое</td><td><tt class="option">vcodec=mpeg4:mbd=2:trell:v4mv:turbo</tt></td><td>42fps</td><td>-0.74дБ</td></tr><tr><td>Реального времени</td><td><tt class="option">vcodec=mpeg4:mbd=2:turbo</tt></td><td>54fps</td><td>-1.21дБ</td></tr></tbody></table></div><p>
</p></div><div class="sect2" title="10.3.5. Нестандартные inter/intra матрицы"><div class="titlepage"><div><div><h3 class="title"><a name="custommatrices"></a>10.3.5. Нестандартные inter/intra матрицы</h3></div></div></div><p>
С этой возможностью
<code class="systemitem">libavcodec</code>,
Вы можете установить нестандартные inter (I-кадры/ключевые) и intra
(P-кадры/предсказанные) матрицы. Это поддерживается многими кодеками:
В <code class="systemitem">mpeg1video</code> и <code class="systemitem">mpeg2video</code>
также заявлена поддержка.
</p><p>
Обычное использовании этой опции — установить матрицы, предпочитаемые
спецификациями <a class="ulink" href="http://www.kvcd.net/" target="_top">KVCD</a>.
</p><p>
<span class="bold"><strong>KVCD Матрица Квантования "Notch":</strong></span>
</p><p>
Intra:
</p><pre class="screen">
 8  9 12 22 26 27 29 34
 9 10 14 26 27 29 34 37
12 14 18 27 29 34 37 38
22 26 27 31 36 37 38 40
26 27 29 36 39 38 40 48
27 29 34 37 38 40 48 58
29 34 37 38 40 48 58 69
34 37 38 40 48 58 69 79
</pre><p>

Inter:
</p><pre class="screen">
16 18 20 22 24 26 28 30
18 20 22 24 26 28 30 32
20 22 24 26 28 30 32 34
22 24 26 30 32 32 34 36
24 26 28 32 34 34 36 38
26 28 30 32 34 36 38 40
28 30 32 34 36 38 42 42
30 32 34 36 38 40 42 44
</pre><p>
</p><p>
Использование:
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.avi</code></em> -o <em class="replaceable"><code>output.avi</code></em> -oac copy -ovc lavc \
    -lavcopts inter_matrix=...:intra_matrix=...
</pre><p>
</p><p>
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.avi</code></em> -ovc lavc -lavcopts \
vcodec=mpeg2video:intra_matrix=8,9,12,22,26,27,29,34,9,10,14,26,27,29,34,37,\
12,14,18,27,29,34,37,38,22,26,27,31,36,37,38,40,26,27,29,36,39,38,40,48,27,\
29,34,37,38,40,48,58,29,34,37,38,40,48,58,69,34,37,38,40,48,58,69,79\
:inter_matrix=16,18,20,22,24,26,28,30,18,20,22,24,26,28,30,32,20,22,24,26,\
28,30,32,34,22,24,26,30,32,32,34,36,24,26,28,32,34,34,36,38,26,28,30,32,34,\
36,38,40,28,30,32,34,36,38,42,42,30,32,34,36,38,40,42,44 -oac copy -o svcd.mpg
</pre><p>
</p></div><div class="sect2" title="10.3.6. Пример"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-dvd-mpeg4-example"></a>10.3.6. Пример</h3></div></div></div><p>
Итак, Вы только что купили новенькую, блестящую копию фильма "Гарри Поттер и Тайная
Комната" (в широкоэкранном формате, конечно) и хотите сделать рип этого DVD так,
чтобы добавить его к Домашнему кинотеатру на PC. Это DVD первого региона,
поэтому NTSC. Пример ниже также применим и для PAL, за исключением того, что
надо будет опустить <tt class="option">-ofps 24000/1001</tt> (поскольку частота кадров
на выходе такая же, как и на входе), и, конечно, границы обрезания будут
другими.
</p><p>
После запуска <tt class="option">mplayer dvd://1</tt> мы следуем процессу, детально
описанному в разделе <a class="link" href="#menc-feat-telecine" title="10.2. Как работать с телесином и чересстрочной развёрткой на NTSC DVD">Как работать с телесином
и чересстрочностью в NTSC DVD</a>, и выясняем, что это 24000/1001 fps
построчное видео, а значит, использовать фильтры обратного телесина,
такие как <tt class="option">pullup</tt> или <tt class="option">filmdint</tt> не нужно.
</p><p><a name="menc-feat-dvd-mpeg4-example-crop"></a>
Далее, мы хотим определить верные границы обрезания, поэтому используем фильтр
cropdetect:
</p><pre class="screen">mplayer dvd://1 -vf cropdetect</pre><p>
Убедитесь, что переместились к полностью заполненному кадру (например,
к светлой сцене после пропущенных начальных титров и логотипов),
Вы должны увидеть в консоли <span class="application">MPlayer</span>:
</p><pre class="screen">crop area: X: 0..719  Y: 57..419  (-vf crop=720:362:0:58)</pre><p>
Затем снова воспроизводим фильм с этим фильтром для проверки его корректности:
</p><pre class="screen">mplayer dvd://1 -vf crop=720:362:0:58</pre><p>
И убеждаемся, что все выглядит прекрасно. Далее, проверяем, что ширина и высота
делятся на 16. С шириной все в порядке, а с высотой — нет.
Поскольку мы не заваливали математику в 7-ом классе, то знаем, что ближайшее
целое, меньшее 362 и кратное 16, равно 352.
</p><p>
Мы могли бы просто использовать <tt class="option">crop=720:352:0:58</tt>, но будет
лучше отрезать понемногу от верха и низа, чтобы центр остался на месте.
Мы уменьшили высоту на 10 пикселов, но не хотим увеличивать смещение по y на 5,
поскольку это нечетное число и отрицательно скажется на качестве.
Вместо этого, мы увеличим y на 4:
</p><pre class="screen">mplayer dvd://1 -vf crop=720:352:0:62</pre><p>
Другая причина, по которой мы урезаем пикселы сверху и снизу, заключаемся в том,
что мы хотим убедиться, что удалены все наполовину черные пикселы, если они есть.
Если Ваше видео подвержено телесину, убедитесь, что фильтр <tt class="option">pullup</tt> (или
любой другой фильтр обратного телесина, который Вы решили использовать)
находится в цепочке до фильтра crop.
Если оно чересстрочное, то перед обрезкой проведите деинтерлейсинг.
(Если решили сохранить чересстрочность видео, убедитесь, что вертикальный сдвиг
обрезания кратен 4.)
</p><p>
Если Вас действительно заботит потеря этих 10 пикселов, Вы можете
вместо этого отмасштабировать фильм, уменьшив размерности до ближайших
кратных 16 значений.
Цепочка фильтров будет выглядеть примерно так:
</p><pre class="screen">-vf crop=720:362:0:58,scale=720:352</pre><p>
Подобное уменьшение изображения будет означать потерю небольшого количества
деталей, хотя это, возможно, окажется незаметным. Масштабирование изображения в
сторону увеличения даст худшее качество (если Вы не увеличиваете битпоток).
Обрезка же полностью выбросит те пикселы. Это компромисс, идти на который или нет,
придется решать в каждом частном случае. Например, если DVD видео было создано
для телевидения, Вы можете захотеть избежать вертикального масштабирования,
поскольку дискретизация строк соответствует тому, как содержимое
изначально записывалось.
</p><p>
При проверке видим, что наш фильм имеет немного движения и большое количество
деталей, так что выбираем для битпотока значение 2400Кбит/сек.
</p><p>
Теперь мы готовы произвести двухпроходное кодирование. Проход первый:
</p><pre class="screen">
mencoder dvd://1 -ofps 24000/1001 -oac copy -o <em class="replaceable"><code>Harry_Potter_2.avi</code></em> -ovc lavc \
    -lavcopts vcodec=mpeg4:vbitrate=2400:v4mv:mbd=2:trell:cmp=3:subcmp=3:autoaspect:vpass=1 \
    -vf pullup,softskip,crop=720:352:0:62,hqdn3d=2:1:2
</pre><p>
И второй проход с теми же параметрами, за исключением <tt class="option">vpass=2</tt>:
</p><pre class="screen">
mencoder dvd://1 -ofps 24000/1001 -oac copy -o <em class="replaceable"><code>Harry_Potter_2.avi</code></em> -ovc lavc \
    -lavcopts vcodec=mpeg4:vbitrate=2400:v4mv:mbd=2:trell:cmp=3:subcmp=3:autoaspect:vpass=2 \
    -vf pullup,softskip,crop=720:352:0:62,hqdn3d=2:1:2
</pre><p>
</p><p>
Опции <tt class="option">v4mv:mbd=2:trell</tt> значительно улучшат качество ценой
времени кодирования. Нет никаких оснований отключать эти
опции, когда главным критерием является качество. Опции
<tt class="option">cmp=3:subcmp=3</tt> выбирают функцию сравнения, дающую
лучшее качество, чем стандартная. Вы можете поэкспериментировать с этим параметром
(возможные значения смотрите на man странице), поскольку разные функции могут
давать разный прирост в качестве в зависимости от исходного материала.
Например, если Вы замечаете, что <code class="systemitem">libavcodec</code>
производит слишком много блочных артефактов (квадратиков), то можете попытаться
выбрать экспериментальный NSSE в качестве функции сравнения при помощи опции
<tt class="option">*cmp=10</tt>.
</p><p>
Для этого фильма полученный AVI будет 138 минут длинной и размером около 3Гб.
И, поскольку Вы сказали, что размер файла значения не имеет, это вполне
приемлемый результат. Однако, если все-таки хотите получить меньший размер файла,
можете попробовать уменьшить битпоток. Увеличение битпотока имеет снижающийся эффект,
поэтому, хотя мы можем ясно видеть улучшение от 1800Кбит/сек до 2000Кбит/сек, оно
может быть не столь заметно выше 2000Кбит/сек.
</p><p>
Так как мы пропустили исходное видео через фильтр удаления шума, то, возможно,
захочется вернуть какую-то его часть во время воспроизведения.
Это, совместно с фильтром постобработки <tt class="option">spp</tt>, существенно
улучшит воспринимаемое качество и поможет избежать блочных артефактов в видео.
Опцией <tt class="option">autoq</tt> <span class="application">MPlayer</span>'а Вы можете
изменять величину производимой фильтром spp постобработки в зависимости от
доступных ресурсов CPU. Вдобавок, на этом этапе Вы можете захотеть применить
коррекцию гаммы и/или цвета для лучшего соответствия Вашему монитору. Например:
</p><pre class="screen">
mplayer <em class="replaceable"><code>Harry_Potter_2.avi</code></em> -vf spp,noise=9ah:5ah,eq2=1.2 -autoq 3
</pre><p>
</p></div></div><div class="sect1" title="10.4. Кодирование кодеком Xvid"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-xvid"></a>10.4. Кодирование кодеком <code class="systemitem">Xvid</code></h2></div></div></div><p>
<code class="systemitem">Xvid</code> — это свободная библиотека для
кодирования MPEG-4 ASP видео потоков.
Перед тем, как начать кодирование, Вам потребуется <a class="link" href="#xvid" title="2.5.1. Xvid">
настроить <span class="application">MEncoder</span> для его поддержки</a>.
</p><p>
Это руководство в основном нацелено на особенности применения тех же методов,
что описаны в руководстве по кодированию с помощью x264.
Поэтому, сначала прочтите, пожалуйста,
<a class="link" href="#menc-feat-x264-encoding-options-intro" title="10.5.1.1. Введение">первую часть</a>
того руководства.
</p><div class="sect2" title="10.4.1. Какие опции следует использовать для получения лучших результатов?"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-xvid-intro"></a>10.4.1. Какие опции следует использовать для получения лучших результатов?</h3></div></div></div><p>
Пожалуйста, начните с просмотра раздела
<code class="systemitem">Xvid</code> man страницы
<span class="application">MPlayer</span>.
Этот раздел предполагается как дополнение к man странице.
</p><p>
Настройки по умолчанию Xvid уже являются хорошим выбором между скоростью и
качеством, поэтому Вы можете без опасений придерживаться их, если следующий
раздел Вас озадачивает.
</p></div><div class="sect2" title="10.4.2. Опции кодирования Xvid"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-xvid-encoding-options"></a>10.4.2. Опции кодирования <code class="systemitem">Xvid</code></h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>vhq</strong></span>
  Эта опция влияет на алгоритм принятия решений о макроблоке, чем выше значение, тем
  мудрее будут решения.
  Значение по умолчанию можно без опаски использовать для любого кодирования, в
  то время, как более высокие значения всегда улучшат PSNR, но будут работать значительно
  медленнее.
  Заметьте, пожалуйста, что лучший PSNR не обязательно означает лучше выглядящую
  картинку, но говорит, что она ближе к оригиналу.
  Отключение этой опции заметно ускоряет кодирование; это может быть достойным
  компромиссом, если скорость Вам критична.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>bvhq</strong></span>
  То же, что и vhq, но для B-кадров.
  Имеет незначительное влияние на скорость и слегка улучшает качество (около
  +0.1дБ).
</p></li><li class="listitem"><p>
  <span class="bold"><strong>max_bframes</strong></span>
  Большее число допустимых последовательных B-кадров обычно улучшает
  сжимаемость, хотя оно может также привести к большему количеству блочных
  артефактов (квадратиков).
  Значение по умолчанию — хороший выбор между сжимаемостью и качеством, но Вы
  можете увеличить его до 3, если стеснены величиной битпотока.
  Вы также можете уменьшить это значение до 1 или 0, если печетесь об отличном качестве,
  впрочем в этом случае Вы должны убедиться, что целевой битпоток достаточно высок,
  дабы кодировщик не увеличивал значение квантователя, сохраняя нужную величину
  битпотока.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>bf_threshold</strong></span>
  Управляет чувствительностью кодировщика к B-кадрам, где большие значения
  приводят к использованию большего количества B-кадров (и наоборот).
  Опция должна использоваться совместно с <tt class="option">max_bframes</tt>;
  если Вы стеснены величиной битпотока, то должны увеличить и
  <tt class="option">max_bframes</tt>, и <tt class="option">bf_threshold</tt>,
  в том время как увеличение <tt class="option">max_bframes</tt> и уменьшение
  <tt class="option">bf_threshold</tt> позволят кодировщику использовать больше
  B-кадров в местах, где это <span class="bold"><strong>действительно</strong></span>
  необходимо.
  Низкое количество <tt class="option">max_bframes</tt> и высокое значение
  <tt class="option">bf_threshold</tt> — это, возможно, не самое мудрое решение,
  поскольку оно принудит кодировщик размещать B-кадры в местах, которые никак не
  выиграют от этого, тем самым ухудшая визуальное качество.
  Однако, если Вам требуется совместимость с аппаратными
  проигрывателями, поддерживающими только старые DivX профили (которые
  поддерживают только 1 последовательный B-кадр), это единственный способ
  увеличить сжимаемость при помощи B-кадров.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>trellis</strong></span>
  Оптимизирует процесс квантования для получения оптимального
  соотношения между PSNR и битпотоком, что позволяет существенно экономить биты.
  Эти биты впоследствии будут потрачены на другие части видео, что приведет к
  увеличению общего качества.
  Следует всегда оставлять эту опцию включенной, поскольку ее влияние на
  качество огромно. Даже если Вы заботитесь о скорости, не отключайте ее до тех
  пор, пока не выставили <tt class="option">vhq</tt> и остальные более CPU-прожорливые
  опции на минимум.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>hq_ac</strong></span>
  Активирует более точный метод оценки стоимости коэффициентов, что
  уменьшает размер файла примерно на 0.15 - 0.19% (соответствует увеличению
  PSNR меньше, чем на 0.01дБ), имея несущественное влияние на скорость.
  Поэтому, рекомендуется всегда держать эту опцию включенной.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>cartoon</strong></span>
  Разработана для лучшего кодирования мультфильмов и не влияет на скорость,
  поскольку всего-лишь настраивает эвристики принятия решений о режимах для
  этого типа содержимого.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>me_quality</strong></span>
  Это опция для настройки точности оценки движения.
  Чем выше <tt class="option">me_quality</tt>, тем точнее будет оценка оригинального
  движения и тем лучше получающийся отрывок будет фиксировать оригинальное движение.
  </p><p>
  Настройка по умолчанию лучше во всех случаях, поэтому не рекомендуется ее
  выключать, если только Вы действительно не гонитесь за скоростью, поскольку
  биты, сэкономленные хорошей оценкой движения, могут быть использованы
  где-нибудь еще, увеличивая общее качество.
  Таким образом, не используйте значения ниже 5, да и его — только в крайнем
  случае.
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>chroma_me</strong></span>
  Улучшает оценку движения, дополнительно принимая во внимание информацию о
  цвете, тогда как одна <tt class="option">me_quality</tt> использует только яркость.
  Это замедляет кодирование на 5-10%, но несколько улучшает визуальное качество,
  уменьшая эффект блочности и сокращая размер файла примерно на 1.3%.
  Если Вас интересует скорость, следует попробовать отключить эту опцию, прежде
  чем решите уменьшать значение <tt class="option">me_quality</tt>.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>chroma_opt</strong></span>
  Эта опция служит для увеличения качества цветного изображения вокруг чисто черных/белых
  границ вместо улучшения сжатия. Она также может помочь против
  эффекта "красных ступенек".
</p></li><li class="listitem"><p>
  <span class="bold"><strong>lumi_mask</strong></span>
  Пытается отдать меньший битпоток областям изображения, которые
  человеческий глаз не в состоянии увидеть достаточно хорошо, что
  позволит кодировщику потратить сэкономленные биты на более важные
  части картинки. Качество закодированного материала, привнесенное этой
  опцией, сильно зависит от личных предпочтений и от типа и настроек монитора,
  использовавшегося для просмотра (обычно результат выглядит не очень хорошо,
  если он яркий, или является TFT монитором).
</p></li><li class="listitem"><p>
  <span class="bold"><strong>qpel</strong></span>
  Увеличивает количество предполагаемых векторов движения, путём повышения
  точности оценки движения с полупиксельной до четвертьпиксельной.
  Идея состоит в том, чтобы найти лучшие векторы движения, которые взамен
  уменьшат битпоток (тем самым увеличивая качество).
  Однако, векторы движения с четверьтпиксельной точностью требуют большего
  количества дополнительных бит для кодирования, а векторы-кандидаты не всегда
  дают (значительно) лучшие результаты.
  Достаточно часто кодек тратит дополнительные биты на повышенную точность
  впустую, а взамен получает или вообще ничего, или небольшое увеличение качества.
  К сожалению, нет способа предсказать возможные улучшения от <tt class="option">qpel</tt>,
  так что Вам придется сделать кодирование с ней и без нее, чтобы знать
  наверняка.
  </p><p>
  <tt class="option">qpel</tt> может почти удвоить время кодирования и
  требует, как минимум, на 25% большей мощности при декодировании.
  Она поддерживается не всеми аппаратными проигрывателями.
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>gmc</strong></span>
  Пытается сэкономить биты в панорамных сценах, используя один вектор
  движения для всего кадра. Это почти всегда увеличивает PSNR, но заметно
  замедляет кодирование (так же как и декодирование).
  Поэтому Вас следует использовать ее, только когда Вы включили
  <tt class="option">vhq</tt> на максимум.
  GMC <code class="systemitem">Xvid</code>'а является более сложным,
  чем у DivX'а, но поддерживается только некоторыми аппаратными проигрывателями.
</p></li></ul></div></div><div class="sect2" title="10.4.3. Профили кодирования"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-xvid-encoding-profiles"></a>10.4.3. Профили кодирования</h3></div></div></div><p>
Xvid поддерживает профили кодирования через опцию <tt class="option">profile</tt>,
которая используется для накладывания ограничений на значения видео потока Xvid таким
образом, что он будет воспроизводиться на всем, что поддерживает выбранный
профиль.
Ограничения относятся к разрешению, битпотоку и некоторым возможностям MPEG-4.
Следующая таблица показывает, что поддерживает тот или иной профиль.
</p><div class="informaltable"><table border="1"><colgroup><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"></colgroup><tbody><tr><td align="center"> </td><td colspan="4" align="center">Простой</td><td colspan="6" align="center">Расширенный простой</td><td colspan="6" align="center">DivX</td></tr><tr><td align="center">Название профиля</td><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td align="center">5</td><td align="center">Карманный</td><td align="center">Портативный NTSC</td><td align="center">Портативный PAL</td><td align="center">Домашний кинотеатр NTSC</td><td align="center">Домашний кинотеатр PAL</td><td align="center">HDTV</td></tr><tr><td align="center">Ширина [пикселов]</td><td align="center">176</td><td align="center">176</td><td align="center">352</td><td align="center">352</td><td align="center">176</td><td align="center">176</td><td align="center">352</td><td align="center">352</td><td align="center">352</td><td align="center">720</td><td align="center">176</td><td align="center">352</td><td align="center">352</td><td align="center">720</td><td align="center">720</td><td align="center">1280</td></tr><tr><td align="center">Высота [пикселов]</td><td align="center">144</td><td align="center">144</td><td align="center">288</td><td align="center">288</td><td align="center">144</td><td align="center">144</td><td align="center">288</td><td align="center">288</td><td align="center">576</td><td align="center">576</td><td align="center">144</td><td align="center">240</td><td align="center">288</td><td align="center">480</td><td align="center">576</td><td align="center">720</td></tr><tr><td align="center">Частота кадров [fps]</td><td align="center">15</td><td align="center">15</td><td align="center">15</td><td align="center">15</td><td align="center">30</td><td align="center">30</td><td align="center">15</td><td align="center">30</td><td align="center">30</td><td align="center">30</td><td align="center">15</td><td align="center">30</td><td align="center">25</td><td align="center">30</td><td align="center">25</td><td align="center">30</td></tr><tr><td align="center">Максимальный средний битпоток [кбит/сек]</td><td align="center">64</td><td align="center">64</td><td align="center">128</td><td align="center">384</td><td align="center">128</td><td align="center">128</td><td align="center">384</td><td align="center">768</td><td align="center">3000</td><td align="center">8000</td><td align="center">537.6</td><td align="center">4854</td><td align="center">4854</td><td align="center">4854</td><td align="center">4854</td><td align="center">9708.4</td></tr><tr><td align="center">Пиковое значение средней величины битпотока за 3 секунды [кбит/сек]</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">800</td><td align="center">8000</td><td align="center">8000</td><td align="center">8000</td><td align="center">8000</td><td align="center">16000</td></tr><tr><td align="center">Макс. B-кадров</td><td align="center">0</td><td align="center">0</td><td align="center">0</td><td align="center">0</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">0</td><td align="center">1</td><td align="center">1</td><td align="center">1</td><td align="center">1</td><td align="center">2</td></tr><tr><td align="center">MPEG квантование</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="center">Адаптивное квантование</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td></tr><tr><td align="center">Чересстрочное кодирование</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">X</td><td align="center">X</td><td align="center">X</td></tr><tr><td align="center">Четвертьпиксельная точность</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="center">Глобальная компенсация движения</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr></tbody></table></div></div><div class="sect2" title="10.4.4. Примеры настроек кодирования"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-xvid-example-settings"></a>10.4.4. Примеры настроек кодирования</h3></div></div></div><p>
Последующие настройки — это примеры различных комбинаций опций кодирования,
которые влияют на соотношения скорость-качество при той же величине целевого
битпотока.
</p><p>
Все настройки кодирования проверялись на тестовом видео 720x448 @30000/1001 fps
с целевым битпотоком 900кбит/сек, на машине AMD-64 3400+ с 2400 МГц и 64 битном режиме.
Для каждой настройки кодирования указаны измеренная скорость кодирования (в
кадрах в секунду) и потеря PSNR (в дБ) по сравнению с настройкой "очень высокое
качество". Поймите, пожалуйста, что в зависимости от Вашего материала, типа
машины, прогресса разработки, Вы можете получить сильно отличающиеся результаты.
</p><div class="informaltable"><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>Описание</th><th>Опции кодирования</th><th>скорость
(в fps)</th><th>Относительная потеря PSNR (в дБ)</th></tr></thead><tbody><tr><td>Очень высокое качество</td><td><tt class="option">chroma_opt:vhq=4:bvhq=1:quant_type=mpeg</tt></td><td>16fps</td><td>0дБ</td></tr><tr><td>Высокое качество</td><td><tt class="option">vhq=2:bvhq=1:chroma_opt:quant_type=mpeg</tt></td><td>18fps</td><td>-0.1дБ</td></tr><tr><td>Быстрое</td><td><tt class="option">turbo:vhq=0</tt></td><td>28fps</td><td>-0.69дБ</td></tr><tr><td>Реального времени</td><td><tt class="option">turbo:nochroma_me:notrellis:max_bframes=0:vhq=0</tt></td><td>38fps</td><td>-1.48дБ</td></tr></tbody></table></div></div></div><div class="sect1" title="10.5. Кодирование кодеком x264"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-x264"></a>10.5. Кодирование кодеком <code class="systemitem">x264</code></h2></div></div></div><p>
<code class="systemitem">x264</code> — это свободная библиотека для
кодирования H.264/AVC видео потоков.
Перед началом кодирования Вы должны <a class="link" href="#x264" title="2.5.2. x264">
настроить <span class="application">MEncoder</span> для его поддержки</a>.
</p><div class="sect2" title="10.5.1. Опции кодирования x264"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-x264-encoding-options"></a>10.5.1. Опции кодирования x264</h3></div></div></div><p>
Начните, пожалуйста с просмотра раздела
<code class="systemitem">x264</code>
man страницы <span class="application">MPlayer</span>'а.
Этот раздел предполагается быть дополнением к странице man.
Здесь Вы найдете быстрые подсказки о том, какие опции чаще всего интересуют
большинство людей. Страница man более лаконична, но также более полна и порой
намного лучше преподносит технические детали.
</p><div class="sect3" title="10.5.1.1. Введение"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-x264-encoding-options-intro"></a>10.5.1.1. Введение</h4></div></div></div><p>
Это руководство рассматривает две главные категории опций кодирования:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  Опции, в основном влияющие на соотношение скорость-качество.
</p></li><li class="listitem"><p>
  Опции, которые могут быть полезны для удовлетворения различных
  пользовательский предпочтений и специальных требований.
</p></li></ol></div><p>
В конце концов, только Вы можете решать какие опции являются лучшими для Ваших
целей. Решение для первого класса опций очень простое:
надо только определить, считаете ли Вы, что разница в качестве оправдывает разницу в
скорости.  Для второго класса опций предпочтения могут быть значительно более
субъективными и зависеть от большего числа факторов.
Имейте в виду, что некоторые из опций категории "пользовательских предпочтений и специальных
требований" могут все же иметь большое влияние на скорость или качество,
но это не основное их предназначение.
Часть опций из "пользовательских предпочтений" могут даже привести к изменениям,
которые выглядят лучше для одних людей и хуже — для других.
</p><p>
Перед тем как продолжить, Вам придется понять, что это руководство использует
только одну метрику качества: глобальный PSNR.
Краткое описание того, что такое PSNR, смотрите в
<a class="ulink" href="http://en.wikipedia.org/wiki/PSNR" target="_top">статье Википедии о PSNR</a>.
Глобальный PSNR — это последнее значение PSNR, выводимое на консоль, когда в
<tt class="option">x264encopts</tt> включена опция <tt class="option">psnr</tt>.
Каждый раз, когда Вы читаете утверждения о PSNR, за ними скрывается
предположение, что используются одинаковые значения битпотока.
</p><p>
Почти все комментарии этого руководства предполагают, что Вы используете два
прохода.
Есть две основные причины использовать двухпроходное кодирование при сравнении
опций.
Во-первых, использование двух проходов увеличивает PSNR примерно на 1дБ,
что является очень хорошим значением.
Во-вторых, тестирование опций прямым сравнением качества при однопроходном
кодировании вводит основной сбивающий фактор: зачастую битпоток значительно
меняется при каждом кодировании.
Не всегда можно с легкостью сказать, изменилось ли качество в основном за счет
изменения опций, или оно по большей части отражает случайные изменения
в полученном битпотоке.
</p></div><div class="sect3" title="10.5.1.2. Опции, затрагивающие, в основном, скорость и качество"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-x264-encoding-options-speedvquality"></a>10.5.1.2. Опции, затрагивающие, в основном, скорость и качество</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>subq</strong></span>:
  Из всех опций, позволяющих выбирать между скоростью и качеством,
  <tt class="option">subq</tt> и <tt class="option">frameref</tt> (смотрите ниже), пожалуй,
  самые важные.
  Если Вы заинтересованы в тонкой настройке либо скорости, либо качества,
  эти две — первое, с чего Вам стоит начать.
  С точки зрения скорости, опции <tt class="option">frameref</tt> и
  <tt class="option">subq</tt> очень жестко взаимодействуют друг с другом.
  Опыт показывает, что с одним ссылочным кадром
  <tt class="option">subq=5</tt> (настройка по умолчанию) расходует на 35% больше
  времени, чем <tt class="option">subq=1</tt>.
  С 6 ссылочными кадрами эта величина достигает 60%.
  Эффект <tt class="option">subq</tt> на PSNR выглядит довольно постоянным, в отличие
  от количества ссылочных кадров.
  Как правило, <tt class="option">subq=5</tt> достигает значения глобального PSNR
  на 0.2-0.5 дБ большего, чем  при <tt class="option">subq=1</tt>.
  Обычно этого достаточно, чтобы заметить.
  </p><p>
  <tt class="option">subq=6</tt> — медленнее и дает лучшее качество при разумной
  цене.
  Если сравнивать с <tt class="option">subq=5</tt>, он обычно дает на 0.1-0.4 дБ
  больший глобальный PSNR ценой потери 25%-100% скорости.
  В отличие от остальных уровней <tt class="option">subq</tt>, поведение
  <tt class="option">subq=6</tt> не так сильно зависит от <tt class="option">frameref</tt>
  и <tt class="option">me</tt>. Вместо этого, эффективность <tt class="option">subq=6</tt>
  по большей части зависит от количества используемых B-кадров. При
  обычном использовании это означает, что <tt class="option">subq=6</tt> в сложных,
  высокодинамичных сценах имеет большое влияние как на скорость, так и на
  качество, но в сценах с малым количествах движения она не имеет такого
  эффекта. Имейте в виду, что по-прежнему рекомендуется всегда устанавливать
  <tt class="option">bframes</tt> в значение, отличное от нуля (смотрите далее).
  </p><p>
  <tt class="option">subq=7</tt> — самый медленный режим с наилучшим качеством.
  По сравнению с <tt class="option">subq=6</tt> он, обычно, улучшает общий PSNR на
  0.01-0.05 дБ ценой потери 15%-30% скорости.
  Поскольку соотношение качества и времени кодирования очень невелико, Вам
  следует использовать этот режим, только если боретесь за каждый бит, и время
  кодирования Вас не волнует.
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>frameref</strong></span>:
  <tt class="option">frameref</tt> по умолчанию установлена в 1, но это не значит, что
  ее стоит устанавливать в 1.
  Только увеличение <tt class="option">frameref</tt> до 2 дает прирост PSNR примерно
  на 0.15дБ за счет уменьшения скорости на 5-10%; похоже, что это неплохая цена.
  <tt class="option">frameref=3</tt> дает примерно 0.25дБ PSNR сверх
  <tt class="option">frameref=1</tt>, что должно быть видимой разницей.
  <tt class="option">frameref=3</tt> медленнее примерно на 15%, чем
  <tt class="option">frameref=1</tt>.
  К сожалению, улучшение очень быстро сходит на нет.
  От <tt class="option">frameref=6</tt> можно ожидать прироста PSNR лишь на
  0.05-0.1 дБ по сравнению с <tt class="option">frameref=3</tt> с дополнительной
  потерей 15% скорости.
  Выше <tt class="option">frameref=6</tt> качество обычно увеличивается очень незначительно
  (хотя на всем протяжении этой дискуссии Вам следует иметь в виду, оно может
  значительно изменяться в зависимости от исходного материала).
  В довольно типичном случае <tt class="option">frameref=12</tt> улучшит глобальный
  PSNR всего на 0.02дБ по сравнению с <tt class="option">frameref=6</tt>,
  ценой 15%-20% скорости.
  При таких высоких значениях <tt class="option">frameref</tt>, единственная
  действительно хорошая вешь, о которой может быть сказано, состоит в том, что
  дальнейшее ее увеличение почти никогда не будет <span class="bold"><strong>вредить</strong></span> PSNR, но увеличение качества будет трудно даже
  измерить, не говоря уже о его заметности.
  </p><div class="note" title="Замечание:" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание:</h3><p>
  Увеличение <tt class="option">frameref</tt> до чрезмерно высоких значений
  <span class="bold"><strong>может</strong></span> и
  <span class="bold"><strong>обычно наносит</strong></span>
  вред эффективности кодирования, если CABAC отключен.
  С задействованным CABAC (настройка по умолчанию), возможность установки
  <tt class="option">frameref</tt> "слишком высоким" на данный момент выглядит слишком
  далекой, чтобы об этом беспокоиться, а в будущем оптимизации могут вообще
  убрать такую возможность.
  </p></div><p>
  Если Вас заботит скорость, разумным компромиссом будет использовать низкие
  значения <tt class="option">subq</tt> и <tt class="option">frameref</tt> в первом проходе, а
  затем увеличить их во втором. Обычно, это обладает ничтожным отрицательным
  эффектом на конечное качество: Вы, возможно, потеряете вплоть до 0.1дБ PSNR,
  что должно быть слишком малой разницей, чтобы её заметить.
  Однако, различные значения <tt class="option">frameref</tt> могут
  иногда повлиять на решение о выборе типа кадра.
  Скорее всего, это довольно редкие крайние случаи, но если Вы хотите быть точно
  уверенными, посмотрите, содержит ли Ваше видео полноэкранные
  
  периодически вспыхивающие изображения или очень большие паузы, которые могут стать
  причиной принудительной вставки I-кадра.
  Настройте <tt class="option">frameref</tt> в первом проходе так, чтобы
  она была достаточно большой для содержания длительности цикла вспыхивания
  (или паузы).
  Например, если сцены вспыхивают и гаснут между двумя изображениями в течении
  трёх кадров, установите <tt class="option">frameref</tt> равным 3 или выше.
  Эта проблема, возможно, очень редко появляется для живой съемки, но она иногда
  возникает при записи видео игр.
 </p></li><li class="listitem"><p>
  <span class="bold"><strong>me</strong></span>:
  Эта опция используется для выбора метода оценки движения.
  Изменение этой опции оказывает прямое влияние на соотношение
  скорость-качество. <tt class="option">me=dia</tt> лишь на несколько процентов
  быстрее, чем поиск по умолчанию, ценой не больше 0.1дБ глобального PSNR.
  Значение по умолчанию (<tt class="option">me=hex</tt>) — разумный выбор между скоростью
  и качеством. <tt class="option">me=umh</tt> немного, вплоть до 0.1дБ, улучшает
  глобальный PSNR, соответствующее падение скорости меняется в
  зависимости от <tt class="option">frameref</tt>. С высокими значениями
  <tt class="option">frameref</tt> (например, 12 или около того), <tt class="option">me=umh</tt>
  примерно на 40% медленнее, чем настройка по умолчанию <tt class="option">me=hex</tt>.
  С <tt class="option">frameref=3</tt>, падение скорости уменьшается до 25%-30%.
  </p><p>
  <tt class="option">me=esa</tt> использует исчерпывающий поиск, который работает
  слишком медленно для практического применения.
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>partitions=all</strong></span>:
  Эта опция задействует использование сегментов 8x4, 4x8 и 4x4 в предсказанных
  макроблоках (в дополнение к стандартным).
  Ее включение приведет к довольно постоянной 10%-15% потере в скорости.
  Эта опция практически бесполезна для исходного материала, содержащего только
  небольшое движение, тем не менее, для некоторого высокодинамичного материала,
  особенно с большим количеством мелких движущихся объектов, следует ожидать
  прироста около 0.1дБ.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>bframes</strong></span>:
  Если Вы занимались кодированием с другими кодеками, то могли заметить, что
  B-кадры не всегда полезны.
  В H.264 это изменилось: есть новые техники и типы блоков, возможные в B-кадрах.
  Обычно, даже примитивный алгоритм выбора B-кадров может дать значимую
  выгоду для PSNR.
  Интересно заметить, что использование B-кадров обычно отчасти ускоряет второй
  проход, а также может ускорить однопроходное кодирование, если отключено
  адаптивное принятие решения о B-кадрах.
  </p><p>
  С отключенным адаптивным принятием решения о B-кадрах
  (<tt class="option">nob_adapt</tt> в <tt class="option">x264encopts</tt>),
  оптимальное значение этой опции обычно не превышает
  <tt class="option">bframes=1</tt>, иначе могут пострадать высокодинамичные сцены.
  С включенным адаптивным принятием решения о B-кадрах (поведение по умолчанию),
  можно безопасно использовать более высокие значения; кодировщик уменьшит
  количество B-кадров в сценах, где они повредят сжатию.
  Кодировщик редко решает использовать больше, чем 3 или 4 B-кадра;
  установка этой опции в любое более высокое значение не будет иметь большого
  эффекта.
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>b_adapt</strong></span>:
  Заметьте: она включена по умолчанию.
  </p><p>
  Когда эта опция включена, кодировщик будет использовать разумно
  быстрый процесс принятия решения для уменьшения количества B-кадров,
  используемых в сценах, которые от этого не сильно выиграют.
  Вы можете использовать <tt class="option">b_bias</tt> для тонкой настройки того,
  насколько "счастлив" будет кодировщик использованию B-кадров.
  Потеря в скорости при использовании адаптивных B-кадров на данный момент
  весьма невелика, но таково же и потенциальное улучшение качества.
  Тем не менее, хуже от этого обычно не становится.
  Заметьте, что эта опция влияет на скорость и решение о типе кадра только в первом
  проходе.
  <tt class="option">b_adapt</tt> и <tt class="option">b_bias</tt> не имеют эффекта в
  последующих проходах.
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>b_pyramid</strong></span>:
  С тем же успехом Вы можете включить эту опцию, если используете &gt;=2 B-кадров;
  Вы получите небольшое улучшение качества без потери в скорости, как и говорит
  man руководство.
  Имейте в виду, что такое видео не может быть прочитано основанными на
  libavcodec декодерами, созданными ранее, чем примерно 5 Марта 2005.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>weight_b</strong></span>:
  В обычных случаях эта опция не дает большого улучшения.
  Однако, в проявляющихся или затухающих сценах взвешенное предсказание дает
  довольно большую экономию битпотока.
  В MPEG-4 ASP затухание обычно лучше кодируется последовательностью дорогих
  I-кадров; использование взвешенного предсказания в B-кадрах делает возможным
  преобразовать хотя бы часть из них в значительно более меньшие B-кадры.
  Потери в скорости кодирования минимальны, поскольку не требуется делать
  дополнительные принятия решений.
  Вдобавок, вопреки расхожему мнению, взвешенное предсказание не
  сильно влияет на требования декодера к CPU при прочих равных условиях.
  </p><p>
  К сожалению, текущий алгоритм адаптивного принятия решений о B-кадрах имеет
  твердую склонность к избеганию использования B-кадров при затуханиях.
  До тех пор, пока это не изменится, хорошей идеей, возможно, будет добавить
  <tt class="option">nob_adapt</tt> к x264encopts, если предполагаете, что затухания
  будут давать существенный вклад в Вашем конкретном видеоклипе.
  </p></li><li class="listitem"><p><a name="menc-feat-x264-encoding-options-speedquality-threads"></a>
  <span class="bold"><strong>threads</strong></span>
  Эта опция позволяет породить потоки для параллельного кодирования на
  нескольких CPU. Вы можете вручную выбрать количество создаваемых потоков или,
  что лучше, установить <tt class="option">threads=auto</tt> и позволить
  <code class="systemitem">x264</code> определить количество доступных
  CPU и выбрать соответствующее количество потоков.
  Если у Вас многопроцессорная машина, Вам следует всерьез задуматься об
  использовании этой опции, так как она может увеличить скорость кодирования линейно
  в зависимости от числа CPU ядер (около 94% на ядро), незначительно уменьшая PSNR
  (примерно 0.005 дБ для двухпроцессорной, 0.01 дБ — для
  четырехпроцессорной машины).
  </p></li></ul></div></div><div class="sect3" title="10.5.1.3. Опции, относящиеся к различным предпочтениям"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-x264-encoding-options-misc-preferences"></a>10.5.1.3. Опции, относящиеся к различным предпочтениям</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>Двухпроходное кодирование</strong></span>:
  Выше советовалось всегда использовать кодирование в два прохода, но все же
  существуют причины этого не делать. Например, если Вы захватываете TV
  трансляцию и кодируете в реальном времени, придется использовать однопроходный
  режим. К тому же один проход очевидно быстрее, чем два; если Вы используете
  точно такой же набор опций в обоих случаях, двухпроходной режим медленнее
  почти вдвое.
  </p><p>
  Все же существует очень хорошие причины использовать кодирование в два
  прохода. Во-первых, управление битпотоком однопроходного режима не
  является телепатом и часто делает необоснованный выбор, потому что не может
  видеть общую картину. Например, предположим, что Вы имеете двухминутное видео,
  состоящее из двух независимых частей. Первая половина — очень динамичная
  сцена, продолжающаяся 60 секунд и требующая сама по себе битпоток примерно
  2500 кбит/сек, чтобы прилично выглядеть. Сразу за ней следует гораздо менее
  требовательная 60-секундная сцена, которая хорошо выглядит при 300 кбит/сек.
  Предположим, Вы запросили битпоток 1400 кбит/сек; в теории этого достаточно
  для удовлетворения потребностей обеих сцен.
  В этом случае управление битпотоком в однопроходном режиме сделает пару "ошибок".
  Во-первых, оно установит битпоток в 1400 кбит/сек для обеих частей. Первая
  часть может оказаться чрезмерно квантованной, что приведет к
  недопустимо выглядящему и неоправданно блочному изображению. Вторая часть будет
  существенно недостаточно квантованной; она может выглядеть отлично, но цена
  битпотока для этого качества будет полностью неоправданной.
  Чего намного труднее избежать, так это проблемы перехода между двумя
  сценами. В первых секундах малодинамичной части квантователь будет чрезвычайно
  превышен, потому что управление битпотоком все еще ожидает встретить такие же
  требования к битпотоку как и в первой части. Этот "ошибочный период" с
  чрезвычайно превышенным квантованием будет выглядеть раздражающе неприятно и
  использовать на самом деле меньше, чем 300 кбит/сек, требуемых ему для того,
  чтобы прилично выглядеть. Существуют способы смягчить эффект от подобных
  подводных камней однопроходного режима, но они могут иметь склонность к
  усилению неверного предсказания битпотока.
  </p><p>
  Многопроходное кодирование может предложить огромные преимущества по сравнению
  с однопроходным. Используя статистику, собранную при первом проходе,
  кодировщик может оценить, с разумной точностью, "стоимость" (в битах)
  кодирования любого заданного кадра при любом заданном квантователе.
  Это делает возможным намного более рациональное, лучше спланированное
  распределение битов между дорогими (высокодинамичными) и дешевыми
  (малодинамичными) сценами. Смотрите <tt class="option">qcomp</tt> ниже, чтобы узнать
  некоторые идеи о том, как можно это распределение настроить по Вашему вкусу.
  </p><p>
  Более того, два прохода занимают не двойное время по сравнению с одним.
  Вы можете настроить опции первого прохода на более быструю скорость и низкое
  качество. Если хорошо выберете опции, Вы получите очень быстрый первый проход.
  Полученное качество во втором проходе будет несколько ниже, потому что
  предсказание размера менее точно, но разница в качестве обычно слишком мала,
  чтобы быть заметной. Попробуйте, например, добавить
  <tt class="option">subq=1:frameref=1</tt> в <tt class="option">x264encopts</tt> первого
  прохода. Затем, при втором проходе, используйте более медленные, с лучшим
  качеством опции:
  <tt class="option">subq=6:frameref=15:partitions=all:me=umh</tt>
  </p></li><li class="listitem"><p>
  <span class="bold"><strong>Кодирование в три прохода</strong></span>?
  x264 предоставляет возможность делать желаемое количество последовательных
  проходов. Если Вы указали <tt class="option">pass=1</tt> при первом проходе,
  используйте затем <tt class="option">pass=3</tt> в последующем проходе, этот проход
  будет одновременно читать статистику предыдущего прохода и записывать свою
  собственную. Дополнительный проход, следующий за этим, будет иметь очень
  хорошую основу для осуществления очень точных предсказаний размеров кадров при
  выбранном квантователе. На практике, общее улучшение качества от использования
  этого режима близко к нулю и, вполне возможно, третий проход приведет к
  немного худшему глобальному PSNR, чем у предыдущего прохода.
  При обычном использовании три прохода помогают, если Вы при двух проходах
  получаете либо плохое предсказание битпотока, либо плохо выглядящие переходы
  между сценами. Это отчасти то, что наверняка будет происходить на очень
  коротких клипах. Существуют также особые случаи, когда три (или более)
  проходом удобны для продвинутых пользователей, но, для краткости, это
  руководство не включает в себя описание этих особых случаев.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>qcomp</strong></span>:
  <tt class="option">qcomp</tt> управляет соотношением количества бит, отданных
  "дорогим" высокодинамичным и "дешевым" малодинамичным кадрам. Один крайний
  случай: <tt class="option">qcomp=0</tt>, предназначен для истинно постоянного
  битпотока. Обычно это сделает высокодинамичные сцены выглядящими просто
  ужасно, в то время как малодинамичные сцены будут, возможно, выглядеть
  абсолютно великолепно, но при этом будут использовать во много раз больший
  битпоток, чем им необходимо, чтобы выглядеть лишь превосходно.
  Другая крайность: <tt class="option">qcomp=1</tt>, добивается примерно одинакового
  параметра квантования (QP). Постоянный QP не выглядит плохо, но большинство
  людей думают, что более разумно частично снизить битпоток в сильно
  дорогих сценах (где потеря качества не очень заметна) и перераспределить их в
  сцены, которые легче закодировать с отличным качеством.
  <tt class="option">qcomp</tt> по умолчанию установлена в 0.6, что по мнению многих
  людей может быть несколько мало (также часто используется 0.7-0.8).
</p></li><li class="listitem"><p>
  <span class="bold"><strong>keyint</strong></span>:
  <tt class="option">keyint</tt> — единственная возможность выбора между удобством
  перемещения по файлу и эффективностью кодирования. По-умолчанию
  <tt class="option">keyint</tt> установлена в 250. В материале с 25fps это гарантирует
  возможность перемещения с точностью до 10 секунд. Если Вы считаете, что более
  важным и полезным будет перемещение с точностью до 5 секунд, установите
  <tt class="option">keyint=125</tt>; это немного ухудшит качество/битпоток. Если Вы
  заботитесь только о качестве, но не о перемещаемости, Вы можете установить
  значение этой опции в более высокое значение (понимая, что улучшение будет
  убывающим, вплоть до исчезающе малого или даже нулевого). Видео поток
  по-прежнему будет иметь точки перемещения, пока в нем есть какие-то изменения
  сцен.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>deblock</strong></span>:
  Этот раздел может быть несколько спорным.
  </p><p>
  H.264 определяет простую процедуру удаления блочности в I-блоках, которая
  использует предустановленные степени обработки и пороговые значения в
  зависимости от QP рассматриваемого блока.
  По-умолчанию, блоки с высоким QP обрабатываются сильнее, а в блоках с низким
  QP удаление блочности вообще не производится.
  Предустановленые степени обработки, определенные стандартом, тщательно подобраны
  и имеют хорошие шансы быть PSNR-оптимальными для любого видео, которое Вы
  пытаетесь кодировать.
  Опция <tt class="option">deblock</tt> позволяет указать смещения предустановленных
  пороговых значений деблокинга.
  </p><p>
  Похоже, многие думают, что хорошей идеей является значительное уменьшение силы
  воздействия фильтра деблокинга (читай, -3).
  Это, однако, почти никогда не является хорошей идеей, и, люди, это делающие, в большинстве
  случаев не совсем хорошо понимают, как работает удаление
  блочности по умолчанию.
  </p><p>
  
  Первая и самая важная вещь, которую нужно знать о in-loop фильтре удаления
  блочности состоит в том, что пороговые значения по умолчанию практически
  всегда PSNR-оптимальны.
  В редких случаях, где они неоптимальны, идеальное смещение будет плюс минус 1.
  Изменение параметров деблокинга на большие значения фактически гарантирует
  ухудшение PSNR.
  Усиление фильтра размажет больше деталей; ослабление — оставит больше квадратиков.
  </p><p>
  По определению плохая идея уменьшать пороги деблокинга, если Ваш исходный
  материал в основном имеет небольшую пространственную сложность (т.е. не имеет
  множества деталей или шума).
  In-loop фильтр делает весьма неплохую работу по сокрытию появляющихся
  артефактов. Однако, если исходный материал имеет высокую пространственную
  сложность, артефакты будут практически незаметны.
  Это происходит потому, что ореолы имеют склонность выглядеть как детали или
  шум. Зрительное восприятие легко замечает отсутствие деталей, но ему не так
  легко обратить внимание на неверно изображенный шум.
  Когда речь идет о субъективном качестве, шум и детали в некоторой степени
  взаимозаменяемы.
  Уменьшая силу фильтра удаления блочности, Вы, скорее всего, увеличиваете ошибку,
  добавляя ореолы, но глаз этого не замечает, поскольку он путает артефакты с
  деталями.
  </p><p>
  Однако, это <span class="bold"><strong>по-прежнему</strong></span> не оправдывает
  уменьшение силы фильтра. Вы в большинстве случаев можете получить более
  качественный шум при помощи постобработки.
  Если результат кодирования при помощи H.264 выглядит слишком смазанным или
  размытым, попробуйте поиграть с <tt class="option">-vf noise</tt>, при
  воспроизведении закодированного фильма.
  <tt class="option">-vf noise=8a:4a</tt> должна скрыть большинство мелких артефактов.
  Ее результат почти наверняка будет выглядеть лучше, чем полученный при помощи
  махинаций с фильтром удаления блочности.
  </p></li></ul></div></div></div><div class="sect2" title="10.5.2. Примеры настроек кодирования"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-x264-example-settings"></a>10.5.2. Примеры настроек кодирования</h3></div></div></div><p>
Последующие настройки — это примеры различных комбинаций опций кодирования,
которые влияют на соотношения скорость-качество при той же величине целевого
битпотока.
</p><p>
Все настройки кодирования проверялись на тестовом видео 720x448 @30000/1001 fps
с целевым битпотоком 900кбит/сек, на машине AMD-64 3400+ с 2400 МГц и 64-х битном режиме.
Для каждой настройки кодирования указаны измеренная скорость кодирования (в
кадрах в секунду) и потеря PSNR (в дБ) по сравнению с настройкой "очень высокое
качество". Поймите, пожалуйста, что в зависимости от Вашего материала, типа
машины, прогресса разработки Вы можете получить сильно отличающиеся результаты.
</p><div class="informaltable"><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>Описание</th><th>Опции кодирования</th><th>скорость (в fps)</th><th>Относительная потеря PSNR (в дБ)</th></tr></thead><tbody><tr><td>Очень высокое качество</td><td><tt class="option">subq=6:partitions=all:8x8dct:me=umh:frameref=5:bframes=3:b_pyramid:weight_b</tt></td><td>6fps</td><td>0дБ</td></tr><tr><td>Высокое качество</td><td><tt class="option">subq=5:8x8dct:frameref=2:bframes=3:b_pyramid:weight_b</tt></td><td>13fps</td><td>-0.89дБ</td></tr><tr><td>Быстро</td><td><tt class="option">subq=4:bframes=2:b_pyramid:weight_b</tt></td><td>17fps</td><td>-1.48дБ</td></tr></tbody></table></div></div></div><div class="sect1" title="10.6. Кодирование семейством кодеков Video For Windows"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-video-for-windows"></a>10.6. 
  Кодирование семейством кодеков <code class="systemitem">Video For Windows</code>
</h2></div></div></div><p>
Video for Windows предоставляет простое кодирование при помощи бинарных видео
кодеков. Вы можете кодировать следующими кодеками (если у Вас есть другие,
сообщите нам!)
</p><p>
Имейте в виду, что поддержка этой возможности очень экспериментальная и
некоторые кодеки могут не работать корректно. Некоторые кодеки могут работать
только в определенных пространствах цветов, попробуйте
<tt class="option">-vf format=bgr24</tt> и <tt class="option">-vf format=yuy2</tt>,
если кодек выдает ошибку или кодирует неверно.
</p><div class="sect2" title="10.6.1. Поддерживаемые кодеки Video for Windows"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-enc-vfw-video-codecs"></a>10.6.1. Поддерживаемые кодеки Video for Windows</h3></div></div></div><p>
</p><div class="informaltable"><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>Имя файла с видео кодеком</th><th>Описание (FourCC)</th><th>md5sum</th><th>Комментарий</th></tr></thead><tbody><tr><td>aslcodec_vfw.dll</td><td>Alparysoft vfw кодек без потерь (ASLC)</td><td>608af234a6ea4d90cdc7246af5f3f29a</td><td> </td></tr><tr><td>avimszh.dll</td><td>AVImszh (MSZH)</td><td>253118fe1eedea04a95ed6e5f4c28878</td><td>необходим <tt class="option">-vf format</tt></td></tr><tr><td>avizlib.dll</td><td>AVIzlib (ZLIB)</td><td>2f1cc76bbcf6d77d40d0e23392fa8eda</td><td> </td></tr><tr><td>divx.dll</td><td>DivX4Windows-VFW</td><td>acf35b2fc004a89c829531555d73f1e6</td><td> </td></tr><tr><td>huffyuv.dll</td><td>HuffYUV (без потерь) (HFYU)</td><td>b74695b50230be4a6ef2c4293a58ac3b</td><td> </td></tr><tr><td>iccvid.dll</td><td>Cinepak Video (cvid)</td><td>cb3b7ee47ba7dbb3d23d34e274895133</td><td> </td></tr><tr><td>icmw_32.dll</td><td>Motion Wavelets (MWV1)</td><td>c9618a8fc73ce219ba918e3e09e227f2</td><td> </td></tr><tr><td>jp2avi.dll</td><td>ImagePower MJPEG2000 (IPJ2)</td><td>d860a11766da0d0ea064672c6833768b</td><td><tt class="option">-vf flip</tt></td></tr><tr><td>m3jp2k32.dll</td><td>Morgan MJPEG2000 (MJ2C)</td><td>f3c174edcbaef7cb947d6357cdfde7ff</td><td> </td></tr><tr><td>m3jpeg32.dll</td><td>Morgan Motion JPEG Codec (MJPG)</td><td>1cd13fff5960aa2aae43790242c323b1</td><td> </td></tr><tr><td>mpg4c32.dll</td><td>Microsoft MPEG-4 v1/v2</td><td>b5791ea23f33010d37ab8314681f1256</td><td> </td></tr><tr><td>tsccvid.dll</td><td>TechSmith Camtasia Screen Codec (TSCC)</td><td>8230d8560c41d444f249802a2700d1d5</td><td>ошибка shareware в windows</td></tr><tr><td>vp31vfw.dll</td><td>On2 Open Source VP3 Codec (VP31)</td><td>845f3590ea489e2e45e876ab107ee7d2</td><td> </td></tr><tr><td>vp4vfw.dll</td><td>On2 VP4 Personal Codec (VP40)</td><td>fc5480a482ccc594c2898dcc4188b58f</td><td> </td></tr><tr><td>vp6vfw.dll</td><td>On2 VP6 Personal Codec (VP60)</td><td>04d635a364243013898fd09484f913fb</td><td> </td></tr><tr><td>vp7vfw.dll</td><td>On2 VP7 Personal Codec (VP70)</td><td>cb4cc3d4ea7c94a35f1d81c3d750bc8d</td><td><tt class="option">-ffourcc VP70</tt></td></tr><tr><td>ViVD2.dll</td><td>SoftMedia ViVD V2 VfW кодек (GXVE)</td><td>a7b4bf5cac630bb9262c3f80d8a773a1</td><td> </td></tr><tr><td>msulvc06.DLL</td><td>MSU кодек без потерь (MSUD)</td><td>294bf9288f2f127bb86f00bfcc9ccdda</td><td>
  Может декодироваться <span class="application">Window Media Player</span>,
  но не <span class="application">MPlayer</span> (пока).
  </td></tr><tr><td>camcodec.dll</td><td>CamStudio lossless video codec (CSCD)</td><td>0efe97ce08bb0e40162ab15ef3b45615</td><td>sf.net/projects/camstudio</td></tr></tbody></table></div><p>

Первый столбец содержит имена кодеков, которые должны указываться после
параметра <code class="literal">codec</code>,
например: <tt class="option">-xvfwopts codec=divx.dll</tt>
FourCC код, используемый каждым кодеком, указан в скобках.
</p><div class="informalexample"><p>
Пример конвертации ISO DVD ролика в VP6 flash видео файл с использованием
compdata настроек битпотока:
</p><pre class="screen">
mencoder -dvd-device <em class="replaceable"><code>zeiram.iso</code></em> dvd://7 -o <em class="replaceable"><code>trailer.flv</code></em> \
-ovc vfw -xvfwopts codec=vp6vfw.dll:compdata=onepass.mcf -oac mp3lame \
-lameopts cbr:br=64 -af lavcresample=22050 -vf yadif,scale=320:240,flip \
-of lavf
</pre><p>
</p></div></div><div class="sect2" title="10.6.2. Использование vfw2menc для создания файла настроек кодека."><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-video-for-windows-bitrate-settings"></a>10.6.2. Использование vfw2menc для создания файла настроек кодека.</h3></div></div></div><p>
Для кодирования кодеками Video for Windows, Вам потребуется установить
величину битпотока и другие опции. Известно, что это работает на x86 и для
*NIX, и для Windows.
</p><p>
Во-первых, Вы должны собрать программу <span class="application">vfw2menc</span>.
Она находится в подкаталоге <tt class="filename">TOOLS</tt>
дерева исходников MPlayer.
Для сборки под Linux, это можно сделать, воспользовавшись <span class="application">Wine</span>:
</p><pre class="screen">winegcc vfw2menc.c -o vfw2menc -lwinmm -lole32</pre><p>

Для сборки под Windows в <span class="application">MinGW</span> или
<span class="application">Cygwin</span> используйте:
</p><pre class="screen">gcc vfw2menc.c -o vfw2menc.exe -lwinmm -lole32</pre><p>

Для сборки в <span class="application">MSVC</span> Вам потребуется getopt.
Getopt можно найти в исходном архиве <span class="application">vfw2menc</span>,
доступном в:
Проект <a class="ulink" href="http://oss.netfarm.it/mplayer-win32.php" target="_top">MPlayer на win32</a>.
</p><div class="informalexample"><p>
Далее следует пример использования с VP6 кодеком.
</p><pre class="screen">
vfw2menc -f VP62 -d vp6vfw.dll -s firstpass.mcf
</pre><p>
Это откроет диалоговое окно кодека VP6. Повторите этот шаг для второго прохода,
указав <tt class="option">-s <em class="replaceable"><code>secondpass.mcf</code></em></tt>.
</p></div><p>
Пользователи Windows могут использовать
<tt class="option">-xvfwopts codec=vp6vfw.dll:compdata=dialog</tt>,
для показа окна настроек кодека перед началом кодирования.
</p></div></div><div class="sect1" title="10.7. Использование MEncoder для создания совместимых с QuickTime файлов"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-quicktime-7"></a>10.7. Использование <span class="application">MEncoder</span>
для создания совместимых с <span class="application">QuickTime</span>
файлов</h2></div></div></div><div class="sect2" title="10.7.1. Зачем необходимо создавать совместимые с QuickTime файлы?"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-quicktime-7-why-use-it"></a>10.7.1. Зачем необходимо создавать совместимые с <span class="application">QuickTime</span>
файлы?</h3></div></div></div><p>
  Есть несколько причин, по которым создание
  <span class="application">QuickTime</span>-совместимых файлов может быть
  желательно.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Вы хотите, чтобы любой компьютерно неграмотный человек мог смотреть
  результат Вашего кодирования на большинстве платформ (Windows, Mac OS X, Unices …).
</p></li><li class="listitem"><p>
  <span class="application">QuickTime</span>
  позволяет воспользоваться преимуществами большего числа возможностей
  аппаратного и программного ускорения на Mac OS X, чем платформо-независимые
  плееры наподобие <span class="application">MPlayer</span> или
  <span class="application">VLC</span>.
  Это означает, что Ваше кодирование имеет шансы плавно воспроизводиться
  на старых машинах, оснащённых G4.
</p></li><li class="listitem"><p>
  <span class="application">QuickTime</span> 7 поддерживает кодек нового поколения
  H.264, который даёт существенно лучшее качество изображения, чем
  предыдущие поколения кодеков (MPEG-2, MPEG-4 …).
</p></li></ul></div></div><div class="sect2" title="10.7.2. Ограничения QuickTime 7"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-quicktime-7-constraints"></a>10.7.2. Ограничения <span class="application">QuickTime</span> 7</h3></div></div></div><p>
  <span class="application">QuickTime</span> 7 поддерживает H.264 видео и
  AAC аудио, но не поддерживает их мультиплексирование в формат
  контейнера AVI.
  Однако, Вы можете использовать <span class="application">MEncoder</span>
  для кодирования видео и аудио, а потом использовать внешнюю
  программу, такую как <span class="application">mp4creator</span> (часть
  <a class="ulink" href="http://mpeg4ip.sourceforge.net/" target="_top">пакета MPEG4I</a>)
  для ремультиплексирования видео и аудио дорожек в контейнер MP4.
</p><p>
  Поддержка H.264 в <span class="application">QuickTime</span> ограничена,
  так что Вам придётся отказаться от нескольких продвинутых возможностей.
  Если Вы кодируете видео с возможностями, не поддерживаемыми
  <span class="application">QuickTime</span> 7,
  плееры, основанные на <span class="application">QuickTime</span>,
  покажут Вам милый белый экран вместо ожидаемого Вами видео.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>B-кадры</strong></span>:
  <span class="application">QuickTime</span> 7 поддерживает максимум 1 B-кадр,
  т.е. <tt class="option">-x264encopts bframes=1</tt>. Это означает, что
  <tt class="option">b_pyramid</tt> и <tt class="option">weight_b</tt> не дадут
  эффекта, поскольку им необходимо, чтобы <tt class="option">bframes</tt>
  было больше 1.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Макроблоки</strong></span>:
  <span class="application">QuickTime</span> 7 не поддерживает 8x8 DCT макроблоки.
  Эта опция (<tt class="option">8x8dct</tt>) выключена по умолчанию, так что
  просто удостоверьтесь, что явно её не задали.
  Это также означает, что опция <tt class="option">i8x8</tt> будет бесполезна,
  т.к. ей необходима <tt class="option">8x8dct</tt>.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Коэффициент соотношения сторон</strong></span>:
  <span class="application">QuickTime</span> 7 не поддерживает информацию
  SAR (коэффициент пропорций пиксела, sample aspect ratio)
  в MPEG-4 файлах; он предполагает SAR=1. Прочтите
  <a class="link" href="#menc-feat-quicktime-7-scale" title="10.7.4. Масштабирование">раздел о масштабировании</a>
  для обхода проблемы.
</p></li></ul></div></div><div class="sect2" title="10.7.3. Обрезание"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-quicktime-7-crop"></a>10.7.3. Обрезание</h3></div></div></div><p>
  Предположим, что Вы хотите сделать рип свежекупленной копии "Хроник
  Нарнии" и Ваш регион DVD 1, что означает, что это NTSC.
  Пример ниже будет также применим к PAL, за исключением того, что Вам
  нужно будет опустить <tt class="option">-ofps 24000/1001</tt> и использовать
  слегка отличающиеся размеры для <tt class="option">crop</tt> и <tt class="option">scale</tt>.
</p><p>
  После запуска <tt class="option">mplayer dvd://1</tt>, Вы следуете процессу,
  описанному в разделе <a class="link" href="#menc-feat-telecine" title="10.2. Как работать с телесином и чересстрочной развёрткой на NTSC DVD">Как работать
  с телесином и чересстрочной развёрткой на NTSC DVD</a> и обнаруживаете,
  что это 24000/1001 fps видео с построчной развёрткой. Это несколько
  упрощает обработку, поскольку Вам не нужно использовать фильтр
  обратного телесина, такой как <tt class="option">pullup</tt>, или фильтр
  деинтерлейса, такой как <tt class="option">yadif</tt>.
</p><p>
  Затем Вам необходимо усечь чёрные полосы сверху и снизу видео, как
  описано в <a class="link" href="#menc-feat-dvd-mpeg4-example-crop">этом</a>
  разделе.
</p></div><div class="sect2" title="10.7.4. Масштабирование"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-quicktime-7-scale"></a>10.7.4. Масштабирование</h3></div></div></div><p>
  Следующий шаг действительно душераздирающий.
  <span class="application">QuickTime</span> 7 не поддерживает MPEG-4 видео
  с коэффициентом соотношения сторон пиксела, отличным от 1. Так что Вам
  придётся масштабировать видео либо в сторону увеличения (что впустую
  потратит много места на диске), либо в строну уменьшения (что приведёт
  к потере некоторых деталей источника) для квадратизации пикселов.
  Какой бы способ Вы не выбрали, это будет крайне неэффективным, но
  не может быть опущено, если Вы хотите, чтоб Ваше видео воспроизводилось
  с помощью <span class="application">QuickTime</span> 7.
  <span class="application">MEncoder</span> может применить необходимое
  увеличивающее или уменьшающее масштабирование, если ему указать
  <tt class="option">-vf scale=-10:-1</tt> или <tt class="option">-vf scale=-1:-10</tt>
  соответственно.
  Это отмасштабирует Ваше видео до корректной ширины для усечённой
  высоты, округлённой до ближайшего множителя 16 для оптимального
  сжатия.
  Помните, что если производите обрезание, то нужно сперва обрезать, а лишь затем
  масштабировать:

  </p><pre class="screen">-vf crop=720:352:0:62,scale=-10:-1</pre><p>
</p></div><div class="sect2" title="10.7.5. A/V синхронизация"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-quicktime-7-avsync"></a>10.7.5. A/V синхронизация</h3></div></div></div><p>
  Поскольку Вы будете мультиплексировать в другой контейнер, Вы должны
  всегда использовать опцию <tt class="option">harddup</tt>, чтобы убедиться,
  что дублирующиеся кадры будут действительно дублироваться в полученном
  видео. Без этой опции <span class="application">MEncoder</span> будет просто
  располагать маркер в видеопотоке о том, что кадр был повторен, и будет
  полагаться на то, что клиентское программное обеспечение покажет кадр
  дважды. К сожалению, это "мягкое дублирование" не переживает
  ремультиплексирование, в результате чего аудио будет постепенно терять
  синхронизацию с видео.
</p><p>
  В итоге, цепочка фильтров выглядит следующим образом:
  </p><pre class="screen">-vf crop=720:352:0:62,scale=-10:-1,harddup</pre><p>
</p></div><div class="sect2" title="10.7.6. Битпоток"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-quicktime-7-bitrate"></a>10.7.6. Битпоток</h3></div></div></div><p>
  Как обычно, выбор битпотока зависит от технических свойств исходного
  материала, как объясняется
  <a class="link" href="#menc-feat-dvd-mpeg4-resolution-bitrate" title="10.1.5. Выбор разрешения и битпотока">здесь</a>,
  как, впрочем, и от личного вкуса.
  Этот фильм обладает небольшим количеством движения и большим
  количеством деталей, но H.264 видео хорошо выглядит на существенно
  меньших битпотоках, чем XviD или другие MPEG-4 кодеки.
  После длительного экспериментирования, автор данного руководства
  решил кодировать фильм на 900 кбит/сек, и считает, что он выглядит
  очень хорошо. Вы можете уменьшить битпоток, если Вам нужно сохранить
  больше места, или увеличить, если Вам нужно улучшить качество.
</p></div><div class="sect2" title="10.7.7. Пример кодирования"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-quicktime-7-example"></a>10.7.7. Пример кодирования</h3></div></div></div><p>
  Теперь Вы готовы к кодированию видео. Поскольку Вы заботитесь
  о качестве, Вы , разумеется, будете делать двупроходное кодирование.
  Для некоторого сокращения времени кодирования, Вы можете указать
  опцию <tt class="option">turbo</tt> при первом проходе; это уменьшит
  <tt class="option">subq</tt> и <tt class="option">frameref</tt> до 1.
  Чтобы сохранить немного места на диске, Вы можете использовать
  параметр <tt class="option">ss</tt> для отрезания первых нескольких
  секунд видео. (Я обнаружил, что, в частности, у данного фильма
  есть 32 секунды титров и логотипов.)
  <tt class="option">bframes</tt> может быть 0 или 1.
  остальные опции описаны в разделе <a class="link" href="#menc-feat-x264-encoding-options-speedvquality" title="10.5.1.2. Опции, затрагивающие, в основном, скорость и качество">Кодирование
  кодеком <code class="systemitem">x264</code></a> и на
  man странице.

  </p><pre class="screen">mencoder dvd://1 -o /dev/null -ss 32 -ovc x264 \
-x264encopts pass=1:turbo:bitrate=900:bframes=1:\
me=umh:partitions=all:trellis=1:qp_step=4:qcomp=0.7:direct_pred=auto:keyint=300 \
-vf crop=720:352:0:62,scale=-10:-1,harddup \
-oac faac -faacopts br=192:mpeg=4:object=2 -channels 2 -srate 48000 \
-ofps 24000/1001</pre><p>

  Если у Вас многопроцессорная машина, не упустите шанс значительно
  ускорить кодирование задействованием
  <a class="link" href="#menc-feat-x264-encoding-options-speedquality-threads">
  многопоточного режима <code class="systemitem">x264</code></a>,
  добавив <tt class="option">threads=auto</tt> в <tt class="option">x264encopts</tt> в
  командной строке.
</p><p>
  Второй проход выполняется аналогично, за исключением того, что Вам
  нужно указать выходной файл и установить <tt class="option">pass=2</tt>.

  </p><pre class="screen">mencoder dvd://1 <span class="bold"><strong>-o нарния.avi</strong></span> -ss 32 -ovc x264 \
-x264encopts <span class="bold"><strong>pass=2</strong></span>:turbo:bitrate=900:frameref=5:bframes=1:\
me=umh:partitions=all:trellis=1:qp_step=4:qcomp=0.7:direct_pred=auto:keyint=300 \
-vf crop=720:352:0:62,scale=-10:-1,harddup \
-oac faac -faacopts br=192:mpeg=4:object=2 -channels 2 -srate 48000 \
-ofps 24000/1001</pre><p>
</p><p>
  Получившееся AVI должно хорошо воспроизводиться в
  <span class="application">MPlayer</span>, но, конечно же,
  <span class="application">QuickTime</span> не сможет его воспроизвести,
  т.к. не поддерживает H.264, мультиплексированный в AVI.
  Так что следующий шаг — ремультиплексирование видео в контейнер MP4.
</p></div><div class="sect2" title="10.7.8. Ремультиплексирование в MP4"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-quicktime-7-remux"></a>10.7.8. Ремультиплексирование в MP4</h3></div></div></div><p>
  Существует несколько способов ремультиплексирования AVI файлов
  в MP4. Вы можете использовать <span class="application">mp4creator</span>,
  являющийся частью
  <a class="ulink" href="http://mpeg4ip.sourceforge.net/" target="_top">пакета MPEG4IP</a>.
</p><p>
  Сперва демультиплексируйте AVI в отдельные аудио и видео потоки
  с помощью <span class="application">MPlayer</span>.

  </p><pre class="screen">mplayer нарния.avi -dumpaudio -dumpfile нарния.aac
mplayer нарния.avi -dumpvideo -dumpfile нарния.h264</pre><p>

  Имена файлов важны; для <span class="application">mp4creator</span>
  необходимо, чтобы AAC аудио потоки назывались <code class="systemitem">.aac</code>
  и H.264 видео потоки назывались <code class="systemitem">.h264</code>.
</p><p>
  Теперь используйте <span class="application">mp4creator</span> для создания
  нового MP4 файла из аудио и видео потоков.

  </p><pre class="screen">mp4creator -create=нарния.aac нарния.mp4
mp4creator -create=нарния.h264 -rate=23.976 нарния.mp4</pre><p>

  В отличии от этапа кодирования, Вам нужно указать частоту кадров
  как десятичную (например, 23.976), а не целую (например, 24000/1001)
  дробь.
</p><p>
  Теперь файл <code class="systemitem">нарния.mp4</code> должен проигрываться
  с помощью любого <span class="application">QuickTime</span> 7 приложения,
  например, <span class="application">QuickTime Player</span> или
  <span class="application">iTunes</span>.
  Если Вы планируете просмотр видео в вэб-браузере с помощью плагина
  <span class="application">QuickTime</span>, Вам также необходимо
  модифицировать фильм таким образом, чтобы плагин
  <span class="application">QuickTime</span> мог начать его воспроизведение
  ещё во время загрузки. <span class="application">mp4creator</span>
  может создать эти вспомогательные дорожки (т.н. hint tracks):

  </p><pre class="screen">mp4creator -hint=1 нарния.mp4
mp4creator -hint=2 нарния.mp4
mp4creator -optimize нарния.mp4</pre><p>

  Вы можете проверить полученный результат, чтобы убедиться, что
  вспомогательные дорожки были успешно созданы.

  </p><pre class="screen">mp4creator -list нарния.mp4</pre><p>

  Вы должны увидеть список дорожек: 1 аудио, 1 видео и 2 вспомогательных.

</p><pre class="screen">Track   Type    Info
1       audio   MPEG-4 AAC LC, 8548.714 secs, 190 kbps, 48000 Hz
2       video   H264 Main@5.1, 8549.132 secs, 899 kbps, 848x352 @ 23.976001 fps
3       hint    Payload mpeg4-generic for track 1
4       hint    Payload H264 for track 2
</pre><p>
</p></div><div class="sect2" title="10.7.9. Добавление тегов метаданных"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-quicktime-7-metadata"></a>10.7.9. Добавление тегов метаданных</h3></div></div></div><p>
  Если Вы хотите добавить в видео теги, которые отображаются в iTunes, Вы
  можете использовать
  <a class="ulink" href="http://atomicparsley.sourceforge.net/" target="_top">AtomicParsley</a>.

  </p><pre class="screen">AtomicParsley нарния.mp4 --metaEnema --title "The Chronicles of Narnia" --year 2005 --stik Movie --freefree --overWrite</pre><p>

  Опция <tt class="option">--metaEnema</tt> удаляет любые существующие метаданные
  (<span class="application">mp4creator</span> вставляет своё название в тег
  "утилита кодирования") и <tt class="option">--freefree</tt> высвобождает место,
  оставшееся от удалённых метаданных.
  Опция <tt class="option">--stik</tt> устанавливает тип видео (например,
  Movie или TV Show), который используется iTunes для группировки
  родственных видеофайлов.
  Опция <tt class="option">--overWrite</tt> перезаписывает исходный файл; без неё
  <span class="application">AtomicParsley</span> создаст новый файл с автоматическим
  именем в том же каталоге и оставит исходный файл нетронутым.
</p></div></div><div class="sect1" title="10.8. Использование MEncoder для создания VCD/SVCD/DVD-совместимых файлов."><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="menc-feat-vcd-dvd"></a>10.8. Использование <span class="application">MEncoder</span>
  для создания VCD/SVCD/DVD-совместимых файлов.</h2></div></div></div><div class="sect2" title="10.8.1. Ограничения формата"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-vcd-dvd-constraints"></a>10.8.1. Ограничения формата</h3></div></div></div><p>
<span class="application">MEncoder</span> способен создавать MPEG файлы VCD, SCVD
и DVD формата, используя библиотеку <code class="systemitem">libavcodec</code>.
Эти файлы затем могут быть использованы совместно с
<a class="ulink" href="http://www.gnu.org/software/vcdimager/vcdimager.html" target="_top">vcdimager</a>
или
<a class="ulink" href="http://dvdauthor.sourceforge.net/" target="_top">dvdauthor</a>
для создания дисков, которые будут воспроизводиться на стандартном видео
проигрывателе.
</p><p>
DVD, SVCD, и VCD форматы обладают жесткими ограничениями. Доступен только небольшой выбор
размеров и пропорций кодируемого изображения.
Если Ваш фильм пока не удовлетворяет этим ограничениям, придется изображение
масштабировать, обрезать или добавлять к нему черные полосы, чтобы добиться
совместимости.
</p><div class="sect3" title="10.8.1.1. Ограничения форматов"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-constraints-resolution"></a>10.8.1.1. Ограничения форматов</h4></div></div></div><div class="informaltable"><table border="1"><colgroup><col><col><col><col><col><col><col><col><col></colgroup><thead><tr><th>Формат</th><th>Разрешение</th><th>Вид. Кодек</th><th>Вид. Битпоток</th><th>Дискретизация</th><th>Ауд. Кодек</th><th>Ауд. Битпоток</th><th>FPS</th><th>Пропорции</th></tr></thead><tbody><tr><td>NTSC DVD</td><td>720x480, 704x480, 352x480, 352x240</td><td>MPEG-2</td><td>9800 кбит/с</td><td>48000 Гц</td><td>AC-3,PCM</td><td>1536 кбит/с (макс.)</td><td>30000/1001, 24000/1001</td><td>4:3, 16:9 (только для 720x480)</td></tr><tr><td>NTSC DVD</td><td>352x240<sup>[<a name="fn-rare-resolutions" href="#ftn.fn-rare-resolutions" class="footnote">a</a>]</sup></td><td>MPEG-1</td><td>1856 кбит/с</td><td>48000 Гц</td><td>AC-3,PCM</td><td>1536 кбит/с (макс.)</td><td>30000/1001, 24000/1001</td><td>4:3, 16:9</td></tr><tr><td>NTSC SVCD</td><td>480x480</td><td>MPEG-2</td><td>2600 кбит/с</td><td>44100 Гц</td><td>MP2</td><td>384 кбит/с (макс.)</td><td>30000/1001</td><td>4:3</td></tr><tr><td>NTSC VCD</td><td>352x240</td><td>MPEG-1</td><td>1150 кбит/с</td><td>44100 Гц</td><td>MP2</td><td>224 кбит/с</td><td>24000/1001, 30000/1001</td><td>4:3</td></tr><tr><td>PAL DVD</td><td>720x576, 704x576, 352x576, 352x288</td><td>MPEG-2</td><td>9800 кбит/с</td><td>48000 Гц</td><td>MP2,AC-3,PCM</td><td>1536 кбит/с (макс.)</td><td>25</td><td>4:3, 16:9 (только для 720x576)</td></tr><tr><td>PAL DVD</td><td>352x288<sup>[<a href="#ftn.fn-rare-resolutions" class="footnoteref">a</a>]</sup></td><td>MPEG-1</td><td>1856 кбит/с</td><td>48000 Гц</td><td>MP2,AC-3,PCM</td><td>1536 кбит/с (макс.)</td><td>25</td><td>4:3, 16:9</td></tr><tr><td>PAL SVCD</td><td>480x576</td><td>MPEG-2</td><td>2600 кбит/с</td><td>44100 Гц</td><td>MP2</td><td>384 кбит/с (макс.)</td><td>25</td><td>4:3</td></tr><tr><td>PAL VCD</td><td>352x288</td><td>MPEG-1</td><td>1152 кбит/с</td><td>44100 Гц</td><td>MP2</td><td>224 кбит/с</td><td>25</td><td>4:3</td></tr></tbody><tbody class="footnotes"><tr><td colspan="9"><div class="footnote"><p><sup>[<a name="ftn.fn-rare-resolutions" href="#fn-rare-resolutions" class="para">a</a>] </sup>
  Эти разрешения редко используются для DVD, поскольку имеют довольно низкое
  качество.</p></div></td></tr></tbody></table></div><p>
Если Ваш фильм имеет пропорции 2.35:1 (большинство современных фильмов с обилием движения),
для создания DVD или VCD придется добавить черные полосы или обрезать фильм до
16:9. Добавляя черные полосы, пытайтесь выровнять их размеры на границу в 16 пикселов,
чтобы минимизировать влияние на производительность кодирования.
К счастью, DVD имеет достаточно избыточный битпоток, чтобы не сильно
беспокоиться об эффективности кодирования, но SVCD и VCD весьма ограничены в
битпотоке и требуют определенных усилий для достижения приемлемого качества.
</p></div><div class="sect3" title="10.8.1.2. Ограничения на размер GOP"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-constraints-gop"></a>10.8.1.2. Ограничения на размер GOP</h4></div></div></div><p>
DVD, VCD, и SVCD также ограничивают Вас относительно низкими размерами
GOP (Group of Pictures, Группа Изображений).
Для материала с 30 fps максимальный допустимый размер GOP равен 18.
Для 25 или 24 fps, максимум равен 15.
Размер GOP устанавливается опцией <tt class="option">keyint</tt>.
</p></div><div class="sect3" title="10.8.1.3. Ограничения на битпоток"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-constraints-bitrate"></a>10.8.1.3. Ограничения на битпоток</h4></div></div></div><p>
VCD видео должно быть CBR с 1152 кбит/с.
Это сильное ограничение усугубляется, к тому же, чрезвычайно низким размером vbv
буфера, равным 327 килобит.
SVCD допускает различные значения видео битпотока вплоть до 2500 кбит/с и не
так сильно стесняющий размер vbv буфера, равный 917 килобит.
У DVD видео битпоток может свободно меняться вплоть до 9800 kbps (хотя обычный
поток равен примерно половине этого значения), а размер vbv буфера равен 1835
килобит.
</p></div></div><div class="sect2" title="10.8.2. Опции вывода"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-vcd-dvd-output"></a>10.8.2. Опции вывода</h3></div></div></div><p>
У <span class="application">MEncoder</span> есть опции, управляющие выходным форматом.
Используя их, можно дать указание создать файл корректного типа.
</p><p>
Для VCD и SVCD опции называются xvcd и xsvcd, потому что они являются
расширенными форматами. Они не полностью совместимы, в основном, потому что не
содержат смещений развёртки. Если нужно создать образ SVCD, следует передать
выходной файл программе
<a class="ulink" href="http://www.gnu.org/software/vcdimager/vcdimager.html" target="_top">vcdimager</a>.
</p><p>
VCD:
</p><pre class="screen">-of mpeg -mpegopts format=xvcd</pre><p>
</p><p>
SVCD:
</p><pre class="screen">-of mpeg -mpegopts format=xsvcd</pre><p>
</p><p>
DVD (с временными метками на каждом кадре, если возможно):
</p><pre class="screen">-of mpeg -mpegopts format=dvd:tsaf</pre><p>
</p><p>
DVD с NTSC Pullup:
</p><pre class="screen">-of mpeg -mpegopts format=dvd:tsaf:telecine -ofps 24000/1001</pre><p>
Это делает возможным кодирование 24000/1001 fps построчного содержимого с
частотой 30000/1001 fps, с одновременным сохранением совместимости с DVD.
</p><div class="sect3" title="10.8.2.1. Пропорции"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-output-aspect"></a>10.8.2.1. Пропорции</h4></div></div></div><p>
Аргумент aspect в <tt class="option">-lavcopts</tt> используется для кодирования
коэффициента пропорций файла.
Коэффициент пропорций используется в процессе воспроизведения для восстановления
правильного размера видео.
</p><p>
16:9 or "Широкоэкранный"
</p><pre class="screen">-lavcopts aspect=16/9</pre><p>
</p><p>
4:3 or "Полноэкранный"
</p><pre class="screen">-lavcopts aspect=4/3</pre><p>
</p><p>
2.35:1 or "Кинематографический" NTSC
</p><pre class="screen">-vf scale=720:368,expand=720:480 -lavcopts aspect=16/9</pre><p>
Для вычисления правильного размера масштабирования используйте расширенную
ширину NTSC 854/2.35 = 368
</p><p>
2.35:1 or "Кинематографический" PAL
</p><pre class="screen">-vf scale=720:432,expand=720:576 -lavcopts aspect=16/9</pre><p>
Для вычисления правильного размера масштабирования используйте расширинную
ширину PAL 1024/2.35 = 432
</p></div><div class="sect3" title="10.8.2.2. Сохранение A/V синхронизации"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-a-v-sync"></a>10.8.2.2. Сохранение A/V синхронизации</h4></div></div></div><p>
Для того, чтобы сохранять аудио/видео синхронизацию на протяжении всего
кодирования, <span class="application">MEncoder</span> должен выбрасывать или
дублировать кадры. Это довольно неплохо работает при мультиплексировании в AVI
файл, но с другими мультиплексорами, такими как MPEG, почти гарантировано
приведет к нарушению A/V синхронизации. Для избежания подобных проблем,
необходимо добавить видео фильтр <tt class="option">harddup</tt> в конец цепочки
фильтров. Дополнительную техническую информацию о <tt class="option">harddup</tt> можно
найти в разделе
<a class="link" href="#menc-feat-dvd-mpeg4-muxing-filter-issues" title="10.1.12.1. Улучшение мультиплексирования и надёжности A/V синхронизации">Улучшение
мультиплексирования и надежности A/V синхронизации</a> или в man руководстве.
</p></div><div class="sect3" title="10.8.2.3. Преобразование частоты дискретизации"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-output-srate"></a>10.8.2.3. Преобразование частоты дискретизации</h4></div></div></div><p>
Если частота дискретизации в оригинальном файле не совпадает с требуемой в
целевом формате, необходимо преобразование. Его можно осуществить, совместно
используя опцию <tt class="option">-srate</tt> и аудио фильтр<tt class="option">-af lavcresample</tt>.
</p><p>
DVD:
</p><pre class="screen">-srate 48000 -af lavcresample=48000</pre><p>
</p><p>
VCD и SVCD:
</p><pre class="screen">-srate 44100 -af lavcresample=44100</pre><p>
</p></div></div><div class="sect2" title="10.8.3. Использование libavcodec для VCD/SVCD/DVD кодирования"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-vcd-dvd-lavc"></a>10.8.3. Использование libavcodec для VCD/SVCD/DVD кодирования</h3></div></div></div><div class="sect3" title="10.8.3.1. Введение"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-lavc-intro"></a>10.8.3.1. Введение</h4></div></div></div><p>
  Используя соответствующие опции, можно применять
  <code class="systemitem">libavcodec</code> для создания VCD/SVCD/DVD
  совместимого видео.
</p></div><div class="sect3" title="10.8.3.2. lavcopts"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-lavc-options"></a>10.8.3.2. lavcopts</h4></div></div></div><p>
Это список полей в <tt class="option">-lavcopts</tt>, которые может потребоваться
изменить, чтобы создать совместимый фильм для VCD, SVCD или DVD:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>acodec</strong></span>:
  <tt class="option">mp2</tt> для VCD, SVCD, или PAL DVD;
  <tt class="option">ac3</tt> наиболее часто используется для DVD.
  Для DVD также может использоваться PCM, но это, по большей части, бесполезная
  трата свободного места. Имейте в виду, что MP3 аудио не совместимо ни с одним
  из этих форматов, но, как бы то ни было, часто проигрыватели не испытывают
  никаких проблем с его воспроизведением.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>abitrate</strong></span>:
  224 для VCD; вплоть до 384 для SVCD; вплоть до 1536 для DVD, но
  распространенным является диапазон значений от 192 кбит/с для стерео до 384
  кбит/с для 5.1 звука.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>vcodec</strong></span>:
  <tt class="option">mpeg1video</tt> для VCD;
  <tt class="option">mpeg2video</tt> для SVCD;
  <tt class="option">mpeg2video</tt> обычно используется для DVD, но Вы также можете
  использовать
  <tt class="option">mpeg1video</tt> для CIF разрешений.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>keyint</strong></span>:
  Используется для установки размера GOP.
  18 для 30fps материала или 15 для 25/24 fps материала.
  Коммерческие изготовители, похоже, предпочитают значение интервала ключевых
  кадров, равное 12. Можно значительно увеличить это значение и все еще
  сохранять совместимость с большинством проигрывателей.
  <tt class="option">keyint</tt> равное 25 не должно вызывать никаких проблем.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>vrc_buf_size</strong></span>:
  327 для VCD, 917 для SVCD и 1835 ддя  DVD.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>vrc_minrate</strong></span>:
  1152 для VCD. Может не указываться для SVCD и DVD.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>vrc_maxrate</strong></span>:
  1152 для VCD; 2500 для SVCD; 9800 для DVD.
  Для SVCD и DVD Вы, возможно, пожелаете использовать меньшие значения в
  зависимости от Ваших личных требований и предпочтений.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>vbitrate</strong></span>:
  1152 для VCD;
  вплоть до 2500 для SVCD;
  вплоть до 9800 для DVD.
  Для двух последний форматов, vbitrate следует установить на основании личных
  предпочтений.
  Например, если Вы настаиваете на размещении 20 или около того часов видео на
  DVD, можете использовать vbitrate=400.
  Качество получившегося видео, возможно, будет довольно плохим.
  Если Вы пытаетесь выжать максимально возможное качество на DVD, используйте
  vbitrate=9800, но имейте в виду, что это ограничит Вас менее чем одним часом
  видео на однослойном DVD.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>vstrict</strong></span>:
  <tt class="option">vstrict</tt>=0 следует использовать для создания DVD.
  Без этой опции <span class="application">MEncoder</span> создает поток, который не
  может быть корректно декодирован некоторыми аппаратными DVD проигрывателями.
</p></li></ul></div></div><div class="sect3" title="10.8.3.3. Примеры"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-lavc-examples"></a>10.8.3.3. Примеры</h4></div></div></div><p>
  Это обычный минимальный набор <tt class="option">-lavcopts</tt> для кодирования видео:
</p><p>
VCD:
</p><pre class="screen">
-lavcopts vcodec=mpeg1video:vrc_buf_size=327:vrc_minrate=1152:\
vrc_maxrate=1152:vbitrate=1152:keyint=15:acodec=mp2
</pre><p>
</p><p>
SVCD:
</p><pre class="screen">
-lavcopts vcodec=mpeg2video:vrc_buf_size=917:vrc_maxrate=2500:vbitrate=1800:\
keyint=15:acodec=mp2
</pre><p>
</p><p>
DVD:
</p><pre class="screen">
-lavcopts vcodec=mpeg2video:vrc_buf_size=1835:vrc_maxrate=9800:vbitrate=5000:\
keyint=15:vstrict=0:acodec=ac3
</pre><p>
</p></div><div class="sect3" title="10.8.3.4. Расширенные опции"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-lavc-advanced"></a>10.8.3.4. Расширенные опции</h4></div></div></div><p>
Для достижения более высокого качества кодирования, Вы также можете
добавить опции lavcopts, улучшающие качество, такие как
<tt class="option">trell</tt>, <tt class="option">mbd=2</tt> и другие.
Обратите внимание, что <tt class="option">qpel</tt> и <tt class="option">v4mv</tt>,
часто полезные с MPEG-4, не применимы к MPEG-1 или MPEG-2.
Также, если Вы хотите выполнить очень высококачественное кодирование
DVD, может быть полезным добавление <tt class="option">dc=10</tt> в lavcopts.
Это может помочь подавить появление блоков в однородно окрашенных
областях. Подводя итог, вот пример настроек lavcopts для
высококачественного DVD:
</p><p>
</p><pre class="screen">
-lavcopts vcodec=mpeg2video:vrc_buf_size=1835:vrc_maxrate=9800:vbitrate=8000:\
keyint=15:trell:mbd=2:precmp=2:subcmp=2:cmp=2:dia=-10:predia=-10:cbp:mv0:\
vqmin=1:lmin=1:dc=10:vstrict=0
</pre><p>
</p></div></div><div class="sect2" title="10.8.4. Кодирование звука"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-vcd-dvd-audio"></a>10.8.4. Кодирование звука</h3></div></div></div><p>
VCD и SVCD поддерживают звук MPEG-1 layer II, используя одну из
<code class="systemitem">toolame</code>,
<code class="systemitem">twolame</code>,
или MP2 <code class="systemitem">libavcodec</code> кодировщик.
libavcodec MP2 не так хорош, как остальные две библиотеки, однако, он должен
быть всегда доступен для использования.
VCD поддерживает только звук с постоянным битпотоком (CBR), в то время как SVCD
также поддерживает и переменный (VBR). Будьте осторожны, используя VBR,
поскольку некоторые плохие аппаратные проигрыватели могут не очень хорошо его
поддерживать.
</p><p>
Для DVD звука используется AC-3 кодек из <code class="systemitem">libavcodec</code>.
</p><div class="sect3" title="10.8.4.1. toolame"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-audio-toolame"></a>10.8.4.1. toolame</h4></div></div></div><p>
Для VCD и SVCD:
</p><pre class="screen">-oac toolame -toolameopts br=224</pre><p>
</p></div><div class="sect3" title="10.8.4.2. twolame"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-audio-twolame"></a>10.8.4.2. twolame</h4></div></div></div><p>
Для VCD и SVCD:
</p><pre class="screen">-oac twolame -twolameopts br=224</pre><p>
</p></div><div class="sect3" title="10.8.4.3. libavcodec"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-audio-lavc"></a>10.8.4.3. libavcodec</h4></div></div></div><p>
Для 2 канального DVD звука:
</p><pre class="screen">-oac lavc -lavcopts acodec=ac3:abitrate=192</pre><p>
</p><p>
Для DVD с 5.1 звуком:
</p><pre class="screen">-channels 6 -oac lavc -lavcopts acodec=ac3:abitrate=384</pre><p>
</p><p>
Для VCD и SVCD:
</p><pre class="screen">-oac lavc -lavcopts acodec=mp2:abitrate=224</pre><p>
</p></div></div><div class="sect2" title="10.8.5. Собирая все вместе"><div class="titlepage"><div><div><h3 class="title"><a name="menc-feat-vcd-dvd-all"></a>10.8.5. Собирая все вместе</h3></div></div></div><p>
Этот раздел демонстрирует некоторые полные команды для создания VCD/SVCD/DVD
совместимого видео.
</p><div class="sect3" title="10.8.5.1. PAL DVD"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-all-pal-dvd"></a>10.8.5.1. PAL DVD</h4></div></div></div><p>
</p><pre class="screen">
mencoder -oac lavc -ovc lavc -of mpeg -mpegopts format=dvd:tsaf \
  -vf scale=720:576,harddup -srate 48000 -af lavcresample=48000 \
  -lavcopts vcodec=mpeg2video:vrc_buf_size=1835:vrc_maxrate=9800:vbitrate=5000:\
keyint=15:vstrict=0:acodec=ac3:abitrate=192:aspect=16/9 -ofps 25 \
  -o <em class="replaceable"><code>фильм.mpg</code></em> <em class="replaceable"><code>фильм.avi</code></em>
</pre><p>
</p></div><div class="sect3" title="10.8.5.2. NTSC DVD"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-all-ntsc-dvd"></a>10.8.5.2. NTSC DVD</h4></div></div></div><p>
</p><pre class="screen">
mencoder -oac lavc -ovc lavc -of mpeg -mpegopts format=dvd:tsaf \
  -vf scale=720:480,harddup -srate 48000 -af lavcresample=48000 \
  -lavcopts vcodec=mpeg2video:vrc_buf_size=1835:vrc_maxrate=9800:vbitrate=5000:\
keyint=18:vstrict=0:acodec=ac3:abitrate=192:aspect=16/9 -ofps 30000/1001 \
  -o <em class="replaceable"><code>фильм.mpg</code></em> <em class="replaceable"><code>фильм.avi</code></em>
</pre><p>
</p></div><div class="sect3" title="10.8.5.3. PAL AVI, содержащий AC-3 звук, в DVD"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-all-pal-ac3-copy"></a>10.8.5.3. PAL AVI, содержащий AC-3 звук, в DVD</h4></div></div></div><p>
Если исходный материал уже содержит AC-3 звук, используйте -oac copy вместо
перекодирования.
</p><pre class="screen">
mencoder -oac copy -ovc lavc -of mpeg -mpegopts format=dvd:tsaf \
  -vf scale=720:576,harddup -ofps 25 \
  -lavcopts vcodec=mpeg2video:vrc_buf_size=1835:vrc_maxrate=9800:vbitrate=5000:\
keyint=15:vstrict=0:aspect=16/9 -o <em class="replaceable"><code>фильм.mpg</code></em> <em class="replaceable"><code>фильм.avi</code></em>
</pre><p>
</p></div><div class="sect3" title="10.8.5.4. NTSC AVI, содержащий AC-3 звук, в DVD"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-all-ntsc-ac3-copy"></a>10.8.5.4. NTSC AVI, содержащий AC-3 звук, в DVD</h4></div></div></div><p>
Если исходный материал уже содержит AC-3 звук и является NTSC @ 24000/1001 fps:
</p><pre class="screen">
mencoder -oac copy -ovc lavc -of mpeg -mpegopts format=dvd:tsaf:telecine \
  -vf scale=720:480,harddup -lavcopts vcodec=mpeg2video:vrc_buf_size=1835:\
  vrc_maxrate=9800:vbitrate=5000:keyint=15:vstrict=0:aspect=16/9 -ofps 24000/1001 \
  -o <em class="replaceable"><code>фильм.mpg</code></em> <em class="replaceable"><code>фильм.avi</code></em>
</pre><p>
</p></div><div class="sect3" title="10.8.5.5. PAL SVCD"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-all-pal-svcd"></a>10.8.5.5. PAL SVCD</h4></div></div></div><p>
</p><pre class="screen">
mencoder -oac lavc -ovc lavc -of mpeg -mpegopts format=xsvcd -vf \
    scale=480:576,harddup -srate 44100 -af lavcresample=44100 -lavcopts \
    vcodec=mpeg2video:mbd=2:keyint=15:vrc_buf_size=917:vrc_minrate=600:\
vbitrate=2500:vrc_maxrate=2500:acodec=mp2:abitrate=224:aspect=16/9 -ofps 25 \
    -o <em class="replaceable"><code>фильм.mpg</code></em> <em class="replaceable"><code>фильм.avi</code></em>
</pre><p>
</p></div><div class="sect3" title="10.8.5.6. NTSC SVCD"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-all-ntsc-svcd"></a>10.8.5.6. NTSC SVCD</h4></div></div></div><p>
</p><pre class="screen">
mencoder -oac lavc -ovc lavc -of mpeg -mpegopts format=xsvcd  -vf \
    scale=480:480,harddup -srate 44100 -af lavcresample=44100 -lavcopts \
    vcodec=mpeg2video:mbd=2:keyint=18:vrc_buf_size=917:vrc_minrate=600:\
vbitrate=2500:vrc_maxrate=2500:acodec=mp2:abitrate=224:aspect=16/9 -ofps 30000/1001 \
    -o <em class="replaceable"><code>фильм.mpg</code></em> <em class="replaceable"><code>фильм.avi</code></em>
</pre><p>
</p></div><div class="sect3" title="10.8.5.7. PAL VCD"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-all-pal-vcd"></a>10.8.5.7. PAL VCD</h4></div></div></div><p>
</p><pre class="screen">
mencoder -oac lavc -ovc lavc -of mpeg -mpegopts format=xvcd -vf \
    scale=352:288,harddup -srate 44100 -af lavcresample=44100 -lavcopts \
    vcodec=mpeg1video:keyint=15:vrc_buf_size=327:vrc_minrate=1152:\
vbitrate=1152:vrc_maxrate=1152:acodec=mp2:abitrate=224:aspect=16/9 -ofps 25 \
    -o <em class="replaceable"><code>фильм.mpg</code></em> <em class="replaceable"><code>фильм.avi</code></em>
</pre><p>
</p></div><div class="sect3" title="10.8.5.8. NTSC VCD"><div class="titlepage"><div><div><h4 class="title"><a name="menc-feat-vcd-dvd-all-ntsc-vcd"></a>10.8.5.8. NTSC VCD</h4></div></div></div><p>
</p><pre class="screen">
mencoder -oac lavc -ovc lavc -of mpeg -mpegopts format=xvcd -vf \
    scale=352:240,harddup -srate 44100 -af lavcresample=44100 -lavcopts \
    vcodec=mpeg1video:keyint=18:vrc_buf_size=327:vrc_minrate=1152:\
vbitrate=1152:vrc_maxrate=1152:acodec=mp2:abitrate=224:aspect=16/9 -ofps 30000/1001 \
    -o <em class="replaceable"><code>фильм.mpg</code></em> <em class="replaceable"><code>фильм.avi</code></em>
</pre><p>
</p></div></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.fn-menc-feat-dvd-mpeg4-codec-cpu" href="#fn-menc-feat-dvd-mpeg4-codec-cpu" class="para">1</a>] </sup>
   Несмотря на это, будьте осторожны: для декодирования MPEG-4 AVC
   видео с DVD разрешением необходима быстрая машина (например,
   Pentium 4 свыше 1.5 ГГц или Pentium M свыше 1 ГГц).
  </p></div><div class="footnote"><p><sup>[<a name="ftn.fn-menc-feat-dvd-mpeg4-codec-playback" href="#fn-menc-feat-dvd-mpeg4-codec-playback" class="para">2</a>] </sup>
  Один и тот же результат кодирования может не выглядеть таким же
  на чьём-либо другом мониторе или при воспроизведении с помощью
  другого декодера, так что проверяйте Ваши результаты кодирования
  на жизнеспособность, воспроизводя их в разных начальных условиях.
  </p></div></div></div><div class="chapter" title="Глава 11. Часто Задаваемые вопросы"><div class="titlepage"><div><div><h2 class="title"><a name="faq"></a>Глава 11. Часто Задаваемые вопросы</h2></div></div></div><div class="qandaset" title="Frequently Asked Questions"><a name="id2610837"></a><dl><dt>11.1.  <a href="#faq-development">Разработка</a></dt><dd><dl><dt>В: <a href="#id2610852">
Как создать правильный патч для MPlayer?
</a></dt><dt>В: <a href="#id2611450">
Как перевести MPlayer на новый язык?
</a></dt><dt>В: <a href="#id2611489">
Как можно помочь развитию MPlayer?
</a></dt><dt>В: <a href="#id2611528">
Как стать разработчиком MPlayer?
</a></dt><dt>В: <a href="#id2611582">
Почему Вы не используете autoconf/automake?
</a></dt></dl></dd><dt>11.2.  <a href="#faq-compilation-installation">Компиляция и установка</a></dt><dd><dl><dt>В: <a href="#id2611628">
Компиляция завершается с ошибкой и gcc вываливается
с загадочным сообщением, содержащим фразу
internal compiler error или
unable to find a register to spill или
can't find a register in class 'GENERAL_REGS'
while reloading 'asm'.
</a></dt><dt>В: <a href="#id2611704">
Существуют ли бинарные (RPM/Debian) пакеты MPlayer?
</a></dt><dt>В: <a href="#id2611739">
Как собрать 32-х битную версию MPlayer на 64-х битном Athlon?
</a></dt><dt>В: <a href="#id2611769">
Configure завершается с указанным сообщением, и MPlayer
не компилируется!
Your gcc does not support even i386 for '-march' and '-mcpu'
</a></dt><dt>В: <a href="#id2611808">
Я имею Matrox G200/G400/G450/G550, как мне скомпилировать/использовать
mga_vid драйвер?
</a></dt><dt>В: <a href="#id2611838">
На этапе 'make', MPlayer жалуется на отсутствующие
библиотеки X11. Я не понимаю, ведь X11 у меня установлен!?
</a></dt><dt>В: <a href="#id2611910">
Сборка в Mac OS 10.3 приводит к нескольким ошибкам линковки.
</a></dt></dl></dd><dt>11.3.  <a href="#faq-general">Общие вопросы</a></dt><dd><dl><dt>В: <a href="#id2612065">
Есть ли списки рассылки, посвященные MPlayer?
</a></dt><dt>В: <a href="#id2612093">
Я обнаружил неприятную ошибку, появляющуюся при просмотре моего любимого фильма!
Кому мне следует сообщить об этом?
</a></dt><dt>В: <a href="#id2612124">
У меня происходит дамп ядра при попытке создать дамп потоков, что
не так?
</a></dt><dt>В: <a href="#id2612157">
В начале воспроизведения появляется следующее сообщение, хотя все
вроде бы работает прекрасно:
Ошибка инициализации Linux RTC в ioctl (rtc_pie_on): Permission denied
</a></dt><dt>В: <a href="#id2612195">
Как сделать скриншот??
</a></dt><dt>В: <a href="#id2612255">
Каков смысл чисел в статусной строке?
</a></dt><dt>В: <a href="#id2611291">
Появляется сообщение, что не найден файл
/usr/local/lib/codecs/ ...
</a></dt><dt>В: <a href="#id2611320">
Как сделать, чтобы MPlayer запомнил мои особые опции
для определенного файла, например movie.avi?
</a></dt><dt>В: <a href="#id2611369">
Субтитры великолепные, лучшие из виденных когда-либо, но они замедляют
воспроизведение! Я знаю, это необычно...
</a></dt><dt>В: <a href="#id2611416">
Как запустить MPlayer в фоновом режиме?
</a></dt></dl></dd><dt>11.4.  <a href="#faq-playback">Проблемы воспроизведения</a></dt><dd><dl><dt>В: <a href="#id2612824">
Не могу локализовать причину некоторой странной проблемы произведения.
</a></dt><dt>В: <a href="#id2612899">
Как настроить субтитры для вывода на черных полях вокруг изображения?
</a></dt><dt>В: <a href="#id2612935">
Как выбрать дорожки звука/субтитров в DVD, OGM, Matroska или NUT файле?
</a></dt><dt>В: <a href="#id2613002">
Пытаюсь воспроизвести поток через интернет, но ничего не получается.
</a></dt><dt>В: <a href="#id2613024">
Я загрузил фильм из P2P сети, но он не работает!
</a></dt><dt>В: <a href="#id2613053">
У меня проблемы с отображением субтитров, помогите!
</a></dt><dt>В: <a href="#id2613104">
Почему MPlayer не работает в Fedora Core?
</a></dt><dt>В: <a href="#id2613294">
MPlayer умирает с сообщением:
MPlayer прерван сигналом 4 в модуле: decode_video
</a></dt><dt>В: <a href="#id2613340">
При попытке захвата с тюнера, все работает, но цвета — неправильные. С другими приложениями
все в порядке.
</a></dt><dt>В: <a href="#id2613375">
Получаю странные процентные значения (слишком большие) при проигрывании файлов на ноутбуке.
</a></dt><dt>В: <a href="#id2613418">
Аудио/видео теряют синхронизацию, при запуске MPlayer
с правами root на ноутбуке. При запуске с правами обычного пользователя все работает
нормально.
</a></dt><dt>В: <a href="#id2613464">
При воспроизведении фильма изображение вдруг начинает дергаться и появляется
следующее сообщение:
Обнаружен плохо 'слоёный' AVI файл - переключаюсь в -ni режим...
</a></dt></dl></dd><dt>11.5.  <a href="#faq-driver">Проблемы драйверов вывода видео/аудио (vo/ao)</a></dt><dd><dl><dt>В: <a href="#id2613517">
При запуске в полноэкранном режиме, наблюдаются черные полосы вокруг изображения
вместо полноэкранного масштабирования.
</a></dt><dt>В: <a href="#id2613592">
Я только что установил MPlayer. Попытка открыть файл
приводит к фатальной ошибке:
Ошибка при открытии/инициализации выбранного устройства видеовывода (-vo).
Как решить проблему?
</a></dt><dt>В: <a href="#id2613674">
У меня проблемы с [Ваш оконный менеджер] и
полноэкранным режимом xv/xmga/sdl/x11 ...
</a></dt><dt>В: <a href="#id2613712">
Теряется синхронизация звука при воспроизведении AVI файла.
</a></dt><dt>В: <a href="#id2613748">
Как использовать dmix с
MPlayer?
</a></dt><dt>В: <a href="#id2613785">
Нет звука при воспроизведении видео и появляется ошибка подобная этой:

AO: [oss] 44100Hz 2ch Signed 16-bit (Little-Endian)
[AO OSS] инициализация аудио: Не могу открыть аудиоустройство /dev/dsp: Device or resource busy
Не могу открыть/инициализировать аудиоустройство -&gt; без звука.
Аудио: без звука
Начало воспроизведения...

</a></dt><dt>В: <a href="#id2613855">
При запуске MPlayer в KDE наблюдается черный экран
и ничего более. Примерно через минуту начинается воспроизведение.
</a></dt><dt>В: <a href="#id2613918">
Проблема с синхронизацией A/V. Некоторые из моих AVI файлов проигрываются нормально, но
некоторые — с двойной скоростью!
</a></dt><dt>В: <a href="#id2613953">
При проигрывании фильма происходит рассинхронизация звука и видео или
MPlayer рушится с ошибкой:
Слишком много (945 в 8390980 байтах) видеопакетов в буфере!
</a></dt><dt>В: <a href="#id2614078">
Как избавиться от рассинхронизации при перемотке потоков RealMedia?
</a></dt></dl></dd><dt>11.6.  <a href="#faq-dvd">Воспроизведение DVD</a></dt><dd><dl><dt>В: <a href="#id2614112">
Как насчет DVD навигации/Меню?
</a></dt><dt>В: <a href="#id2614173">
Как насчет субтитров? MPlayer умеет их отображать?
</a></dt><dt>В: <a href="#id2614201">
Как установить регион для DVD-привода? У меня нет Windows!
</a></dt><dt>В: <a href="#id2614224">
DVD не проигрываются, MPlayer зависает или выводит ошибку "Encrypted VOB file!".
</a></dt><dt>В: <a href="#id2614248">
Нужны ли права root (setuid) для воспроизведения DVD?
</a></dt><dt>В: <a href="#id2614274">
Возможно ли проигрывать/кодировать только выбранные разделы?
</a></dt><dt>В: <a href="#id2614295">
Воспроизведение DVD медленное!
</a></dt><dt>В: <a href="#id2614333">
Я скопировал DVD используя vobcopy. Как его проигрывать/кодировать с жесткого
диска?
</a></dt></dl></dd><dt>11.7.  <a href="#faq-features">Просьбы о новых возможностях</a></dt><dd><dl><dt>В: <a href="#id2614382">
Если MPlayer приостановлен, и я пытаюсь перемотать фильм или нажимаю
любую клавишу, воспроизведение продолжается. Хотелось бы иметь возможность перемотки во
время паузы.
</a></dt><dt>В: <a href="#id2614418">
Хочется перематывать на +/- 1 кадр  вместо 10 секунд.
</a></dt></dl></dd><dt>11.8.  <a href="#faq-encoding">Кодирование</a></dt><dd><dl><dt>В: <a href="#id2614465">
Как производить кодирование?

</a></dt><dt>В: <a href="#id2614490">
Как сохранить весь ролик DVD в файл?
</a></dt><dt>В: <a href="#id2614536">
Как автоматически создавать (S)VCD?
</a></dt><dt>В: <a href="#id2614572">
Как создать (S)VCD?
</a></dt><dt>В: <a href="#id2614611">
Как склеить два файла?
</a></dt><dt>В: <a href="#id2614684">
Как исправить AVI файлы с испорченным индексом или неверным чередованием?
</a></dt><dt>В: <a href="#id2614741">
Как исправить пропорции в AVI файле?
</a></dt><dt>В: <a href="#id2614788">
Как сделать копию и закодировать VOB файл с испорченным началом?
</a></dt><dt>В: <a href="#id2614869">
Не могу закодировать DVD субтитры в AVI!
</a></dt><dt>В: <a href="#id2614889">
Как кодировать только выбранные эпизоды из DVD?
</a></dt><dt>В: <a href="#id2614913">
Я хочу работать с файлами более 2Гб в файловой системе VFAT. Это возможно?
</a></dt><dt>В: <a href="#id2614931">
Что означают числа в статусной строке в процессе кодировании?
</a></dt><dt>В: <a href="#id2615086">
Почему рекомендуемый MEncoder'ом битрейт отрицателен?
</a></dt><dt>В: <a href="#id2615115">
Не могу перекодировать ASF файл в AVI/MPEG-4, потому что используется 1000fps.
</a></dt><dt>В: <a href="#id2615142">
Как поместить субтитры в выходной файл?
</a></dt><dt>В: <a href="#id2615173">
Как закодировать только звук из видеоклипа?
</a></dt><dt>В: <a href="#id2615248">
Почему сторонние проигрыватели не могут воспроизвести MPEG-4 файлы,
сжатые MEncoder'ом версий старше 1.0pre7?
</a></dt><dt>В: <a href="#id2615410">
Как перекодировать звуковой файл (без видео)?
</a></dt><dt>В: <a href="#id2615442">
Как воспроизвести субтитры внедренные в AVI?
</a></dt><dt>В: <a href="#id2615482">
MPlayer не хочет...
</a></dt></dl></dd></dl><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"><col><tbody><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h3 class="title"><a name="faq-development"></a>11.1. Разработка</h3></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>В: <a href="#id2610852">
Как создать правильный патч для MPlayer?
</a></dt><dt>В: <a href="#id2611450">
Как перевести MPlayer на новый язык?
</a></dt><dt>В: <a href="#id2611489">
Как можно помочь развитию MPlayer?
</a></dt><dt>В: <a href="#id2611528">
Как стать разработчиком MPlayer?
</a></dt><dt>В: <a href="#id2611582">
Почему Вы не используете autoconf/automake?
</a></dt></dl></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2610852"></a><a name="id2610854"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как создать правильный патч для <span class="application">MPlayer</span>?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Мы создали <a class="ulink" href="../../tech/patches.txt" target="_top">краткий документ</a> (англ.),
описывающий все необходимые детали. Пожалуйста, следуйте инструкциям.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611450"></a><a name="id2611452"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как перевести <span class="application">MPlayer</span> на новый язык?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Прочитайте <a class="ulink" href="../../tech/translations.txt" target="_top">HOWTO по переводу</a> (англ.),
там все описано. За дополнительной помощью Вы можете обратиться в рассылку
<a class="ulink" href="http://lists.mplayerhq.hu/mailman/listinfo/mplayer-translations" target="_top">MPlayer-translations</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611489"></a><a name="id2611491"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как можно помочь развитию <span class="application">MPlayer</span>?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Мы будем более чем счастливы принять
<a class="ulink" href="http://www.mplayerhq.hu/donations.html" target="_top">пожертвования</a> оборудованием
и программным обеспечением. Они позволяют нам постоянно улучшать
<span class="application">MPlayer</span>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611528"></a><a name="id2611530"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как стать разработчиком <span class="application">MPlayer</span>?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Мы всегда рады приветствовать людей, занимающихся написанием кода и документации.
Для начала прочтите <a class="ulink" href="../../tech/" target="_top">техническую документацию</a> (англ.).
Затем Вам следует подписаться на список рассылки
<a class="ulink" href="http://lists.mplayerhq.hu/mailman/listinfo/mplayer-dev-eng" target="_top">MPlayer-dev-eng</a>
и начать написание кода. Если Вы хотите помочь с документацией, то подпишитесь на
<a class="ulink" href="http://lists.mplayerhq.hu/mailman/listinfo/mplayer-docs" target="_top">MPlayer-docs</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611582"></a><a name="id2611584"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Почему Вы не используете autoconf/automake?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
У нас есть модульная, написанная вручную система сборки. Она хорошо справляется
со своей работой, зачем же ее менять? Кроме того, нам, как и
<a class="ulink" href="http://freshmeat.net/articles/view/889/" target="_top">некоторым другим</a>, не нравятся
auto* утилиты.
</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h3 class="title"><a name="faq-compilation-installation"></a>11.2. Компиляция и установка</h3></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>В: <a href="#id2611628">
Компиляция завершается с ошибкой и gcc вываливается
с загадочным сообщением, содержащим фразу
internal compiler error или
unable to find a register to spill или
can't find a register in class 'GENERAL_REGS'
while reloading 'asm'.
</a></dt><dt>В: <a href="#id2611704">
Существуют ли бинарные (RPM/Debian) пакеты MPlayer?
</a></dt><dt>В: <a href="#id2611739">
Как собрать 32-х битную версию MPlayer на 64-х битном Athlon?
</a></dt><dt>В: <a href="#id2611769">
Configure завершается с указанным сообщением, и MPlayer
не компилируется!
Your gcc does not support even i386 for '-march' and '-mcpu'
</a></dt><dt>В: <a href="#id2611808">
Я имею Matrox G200/G400/G450/G550, как мне скомпилировать/использовать
mga_vid драйвер?
</a></dt><dt>В: <a href="#id2611838">
На этапе 'make', MPlayer жалуется на отсутствующие
библиотеки X11. Я не понимаю, ведь X11 у меня установлен!?
</a></dt><dt>В: <a href="#id2611910">
Сборка в Mac OS 10.3 приводит к нескольким ошибкам линковки.
</a></dt></dl></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611628"></a><a name="id2611630"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Компиляция завершается с ошибкой и <span class="application">gcc</span> вываливается
с загадочным сообщением, содержащим фразу
<code class="systemitem">internal compiler error</code> или
<code class="systemitem">unable to find a register to spill</code> или
<code class="systemitem">can't find a register in class 'GENERAL_REGS'
while reloading 'asm'</code>.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Вы столкнулись с ошибкой в <span class="application">gcc</span>. Пожалуйста,
<a class="ulink" href="http://gcc.gnu.org/bugs.html" target="_top">сообщите об этом разработчикам gcc</a>
но не нам. В силу некоторых причин <span class="application">MPlayer</span>, похоже,
часто вызывает ошибки компилятора. Тем не менее, мы не можем их исправить, но и
добавлять специальный код для обхода ошибок компилятора не будем.
Чтобы избежать этой проблемы, либо используйте надежную и стабильную версию компилятора, либо
часто обновляйтесь.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611704"></a><a name="id2611706"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Существуют ли бинарные (RPM/Debian) пакеты <span class="application">MPlayer</span>?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Смотрите разделы <a class="link" href="#debian" title="8.1.1. Debian пакеты">Debian</a> и <a class="link" href="#rpm" title="8.1.2. RPM пакеты">RPM</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611739"></a><a name="id2611741"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как собрать 32-х битную версию <span class="application">MPlayer</span> на 64-х битном Athlon?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Попробуйте следующие опции configure:
</p><pre class="screen">
./configure --target=i386-linux --cc="gcc -m32" --as="as --32" --with-extralibdir=/usr/lib
</pre><p>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611769"></a><a name="id2611771"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Configure завершается с указанным сообщением, и <span class="application">MPlayer</span>
не компилируется!
</p><pre class="screen">Your gcc does not support even i386 for '-march' and '-mcpu'</pre><p>
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Ваш gcc некорректно установлен, проверьте <tt class="filename">configure.log</tt>
для более подробной информации.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611808"></a><a name="id2611810"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Я имею Matrox G200/G400/G450/G550, как мне скомпилировать/использовать
<code class="systemitem">mga_vid</code> драйвер?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Прочитайте раздел <a class="link" href="#mga_vid" title="7.7. Matrox фреймбуфер (mga_vid)">mga_vid</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611838"></a><a name="id2611840"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
На этапе 'make', <span class="application">MPlayer</span> жалуется на отсутствующие
библиотеки X11. Я не понимаю, ведь X11 у меня <span class="emphasis"><em>установлен</em></span>!?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
... но Вы не имеете установленных пакетов разработки X11. Либо они установлены
некорректно. Они называются <tt class="filename">XFree86-devel*</tt> в Red Hat,
<tt class="filename">xlibs-dev</tt> в Debian Woody и
<tt class="filename">libx11-dev</tt> в Debian Sarge. Также проверьте существуют ли
символические ссылки <tt class="filename">/usr/X11</tt> и
<tt class="filename">/usr/include/X11</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611910"></a><a name="id2611912"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Сборка в Mac OS 10.3 приводит к нескольким ошибкам линковки.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Как правило, ошибка линковки выглядит так:
</p><pre class="screen">
ld: Undefined symbols:
_LLCStyleInfoCheckForOpenTypeTables referenced from QuartzCore expected to be defined in ApplicationServices
_LLCStyleInfoGetUserRunFeatures referenced from QuartzCore expected to be defined in ApplicationServices
</pre><p>
Эта проблема — результат разработчиков Apple, использующих 10.4 для компиляции их программ и
распространяющих бинарники пользователям 10.3 через Software Update.
Неопределённые символы присутствуют в 10.4, но их нет в 10.3.
Одно из решений — откат QuickTime до версии 7.0.1, но есть и лучшее.
</p><p>
Загрузите
<a class="ulink" href="http://rapidshare.de/files/20281171/CompatFrameworks.tgz.html" target="_top">более старую версию фреймворка</a>.
Вы получите архив, содержащий фреймворк QuickTime 7.0.1 и QuartzCore 10.3.9.
</p><p>
Распакуйте файл куда-нибудь, кроме папки System (т.е. не устанавливайте эти программы
в. <tt class="filename">/System/Library/Frameworks</tt>!
Эта старая копия нужна только для решения проблем с линковкой!)
</p><pre class="screen">gunzip &lt; CompatFrameworks.tgz | tar xvf -</pre><p>
В config.mak следует добавить
<code class="systemitem">-F/path/to/where/you/extracted</code>
к переменной <code class="systemitem">OPTFLAGS</code>.
При использовании <span class="application">X-Code</span> Вы можете просто выбрать эти фреймворки
вместо системных.
</p><p>
Получившийся бинарный <span class="application">MPlayer</span> будет использовать фреймворк,
установленный в Вашей системе, используя динамические ссылки времени исполнения.
(Это можно проверить, запустив <code class="systemitem">otool -l</code>).
</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h3 class="title"><a name="faq-general"></a>11.3. Общие вопросы</h3></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>В: <a href="#id2612065">
Есть ли списки рассылки, посвященные MPlayer?
</a></dt><dt>В: <a href="#id2612093">
Я обнаружил неприятную ошибку, появляющуюся при просмотре моего любимого фильма!
Кому мне следует сообщить об этом?
</a></dt><dt>В: <a href="#id2612124">
У меня происходит дамп ядра при попытке создать дамп потоков, что
не так?
</a></dt><dt>В: <a href="#id2612157">
В начале воспроизведения появляется следующее сообщение, хотя все
вроде бы работает прекрасно:
Ошибка инициализации Linux RTC в ioctl (rtc_pie_on): Permission denied
</a></dt><dt>В: <a href="#id2612195">
Как сделать скриншот??
</a></dt><dt>В: <a href="#id2612255">
Каков смысл чисел в статусной строке?
</a></dt><dt>В: <a href="#id2611291">
Появляется сообщение, что не найден файл
/usr/local/lib/codecs/ ...
</a></dt><dt>В: <a href="#id2611320">
Как сделать, чтобы MPlayer запомнил мои особые опции
для определенного файла, например movie.avi?
</a></dt><dt>В: <a href="#id2611369">
Субтитры великолепные, лучшие из виденных когда-либо, но они замедляют
воспроизведение! Я знаю, это необычно...
</a></dt><dt>В: <a href="#id2611416">
Как запустить MPlayer в фоновом режиме?
</a></dt></dl></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2612065"></a><a name="id2612067"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Есть ли списки рассылки, посвященные <span class="application">MPlayer</span>?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Да. Смотрите раздел <a class="ulink" href="http://www.mplayerhq.hu/design7/mailing_lists.html" target="_top">списки рассылки</a>
нашего сайта.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2612093"></a><a name="id2612096"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Я обнаружил неприятную ошибку, появляющуюся при просмотре моего любимого фильма!
Кому мне следует сообщить об этом?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Прочтите
<a class="link" href="#bugreports" title="Приложение A. Как сообщать об ошибках">руководство по составлению отчетов об ошибках</a>
и следуйте инструкциям.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2612124"></a><a name="id2612126"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
У меня происходит дамп ядра при попытке создать дамп потоков, что
не так?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Не паникуйте. Убедитесь, что знаете где Ваше полотенце.</p><p>
Серьёзно, обратите внимание на смайлик и ищите файлы,
оканчивающиеся на
<tt class="filename">.dump</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2612157"></a><a name="id2612159"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
В начале воспроизведения появляется следующее сообщение, хотя все
вроде бы работает прекрасно:
</p><pre class="screen">Ошибка инициализации Linux RTC в ioctl (rtc_pie_on): Permission denied</pre><p>
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Чтобы использовать RTC тайминг, Вам необходимо специально настроенное ядро.
Подробности ищите в разделе <a class="link" href="#rtc" title="2.6. RTC">RTC</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2612195"></a><a name="id2612197"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как сделать скриншот??
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Чтобы иметь возможность сделать скриншот, Вы должны использовать драйвер
вывода видео, который не использует оверлей.
В X11 это <tt class="option">-vo x11</tt>, в Windows используйте
<tt class="option">-vo directx:noaccel</tt>.
</p><p>
Есть и другой способ. Запустите <span class="application">MPlayer</span> с видео фильтром
<code class="systemitem">screenshot</code>
(<tt class="option">-vf screenshot</tt>), и нажмите клавишу <span class="keycap"><b>s</b></span> для
создания скриншота.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2612255"></a><a name="id2612257"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Каков смысл чисел в статусной строке?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Пример:
</p><pre class="screen">
A: 2.1 V: 2.2 A-V: -0.167 ct: 0.042 57/57 41% 0% 2.6% 0 4 49% 1.00x
</pre><p>
</p><div class="variablelist"><dl><dt><span class="term"><code class="systemitem">A: 2.1</code></span></dt><dd><p>позиция аудио в секундах</p></dd><dt><span class="term"><code class="systemitem">V: 2.2</code></span></dt><dd><p>позиция видео в секундах</p></dd><dt><span class="term"><code class="systemitem">A-V: -0.167</code></span></dt><dd><p>сдвиг аудио-видео в секундах (задержка)</p></dd><dt><span class="term"><code class="systemitem">ct: 0.042</code></span></dt><dd><p>итоговая выполненная коррекция A-V синхронизации</p></dd><dt><span class="term"><code class="systemitem">57/57</code></span></dt><dd><p>
  кадров проиграно/декодировано (считая от места последней перемотки)
  </p></dd><dt><span class="term"><code class="systemitem">41%</code></span></dt><dd><p>
  время CPU в процентах, используемое видео кодеком
  (для поблочного и прямого рендеринга сюда включается и video_out)
  </p></dd><dt><span class="term"><code class="systemitem">0%</code></span></dt><dd><p>время CPU, используемое video_out</p></dd><dt><span class="term"><code class="systemitem">2.6%</code></span></dt><dd><p>время CPU в процентах, используемое аудио кодеком</p></dd><dt><span class="term"><code class="systemitem">0</code></span></dt><dd><p>выброшено кадров для сохранения синхронизации A-V</p></dd><dt><span class="term"><code class="systemitem">4</code></span></dt><dd><p>
  текущий уровень постобработки (при использовании
  <tt class="option">-autoq</tt>)
  </p></dd><dt><span class="term"><code class="systemitem">49%</code></span></dt><dd><p>
  текущий уровень использования кеша. (нормальное значение — около 50%)
  </p></dd><dt><span class="term"><code class="systemitem">1.00x</code></span></dt><dd><p>
  скорость воспроизведения (множитель от нормальной скорости)
  </p></dd></dl></div><p>
Большинство из них используются для отладки, используйте опцию <tt class="option">-quiet</tt>
чтобы их скрыть. Имейте ввиду, что для некоторых файлов использование CPU модулем video_out
равно нулю (0%). Дело в том, что иногда он вызывается непосредственно из кодека и не может
быть измерен отдельно. Если Вы хотите узнать скорость video_out в этом случае, сравните
разницу при  воспроизведении с  <tt class="option">-vo null</tt> и Вашим драйвером вывода видео.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611291"></a><a name="id2611293"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Появляется сообщение, что не найден файл
<tt class="filename">/usr/local/lib/codecs/</tt> ...
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Загрузите и установите бинарные кодеки с нашей
<a class="ulink" href="http://www.mplayerhq.hu/design7/dload.html" target="_top">страницы загрузки</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611320"></a><a name="id2611322"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как сделать, чтобы <span class="application">MPlayer</span> запомнил мои особые опции
для определенного файла, например <tt class="filename">movie.avi</tt>?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Создайте файл с именем <tt class="filename">movie.avi.conf</tt> и Вашими опциями в нем,
сохраните его в каталог  <tt class="filename">~/.mplayer</tt>
или в один каталог с медиа-файлом.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611369"></a><a name="id2611371"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Субтитры великолепные, лучшие из виденных когда-либо, но они замедляют
воспроизведение! Я знаю, это необычно...
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
После запуска <tt class="filename">./configure</tt>,
отредактируйте <tt class="filename">config.h</tt>
и замените <code class="systemitem">#undef FAST_OSD</code> на
<code class="systemitem">#define FAST_OSD</code>. Перекомпилируйте.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2611416"></a><a name="id2611418"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как запустить <span class="application">MPlayer</span> в фоновом режиме?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Используйте:
</p><pre class="screen">
mplayer <em class="replaceable"><code>опции</code></em> <em class="replaceable"><code>имя_файла</code></em> &lt; /dev/null &amp;
</pre><p>
</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h3 class="title"><a name="faq-playback"></a>11.4. Проблемы воспроизведения</h3></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>В: <a href="#id2612824">
Не могу локализовать причину некоторой странной проблемы произведения.
</a></dt><dt>В: <a href="#id2612899">
Как настроить субтитры для вывода на черных полях вокруг изображения?
</a></dt><dt>В: <a href="#id2612935">
Как выбрать дорожки звука/субтитров в DVD, OGM, Matroska или NUT файле?
</a></dt><dt>В: <a href="#id2613002">
Пытаюсь воспроизвести поток через интернет, но ничего не получается.
</a></dt><dt>В: <a href="#id2613024">
Я загрузил фильм из P2P сети, но он не работает!
</a></dt><dt>В: <a href="#id2613053">
У меня проблемы с отображением субтитров, помогите!
</a></dt><dt>В: <a href="#id2613104">
Почему MPlayer не работает в Fedora Core?
</a></dt><dt>В: <a href="#id2613294">
MPlayer умирает с сообщением:
MPlayer прерван сигналом 4 в модуле: decode_video
</a></dt><dt>В: <a href="#id2613340">
При попытке захвата с тюнера, все работает, но цвета — неправильные. С другими приложениями
все в порядке.
</a></dt><dt>В: <a href="#id2613375">
Получаю странные процентные значения (слишком большие) при проигрывании файлов на ноутбуке.
</a></dt><dt>В: <a href="#id2613418">
Аудио/видео теряют синхронизацию, при запуске MPlayer
с правами root на ноутбуке. При запуске с правами обычного пользователя все работает
нормально.
</a></dt><dt>В: <a href="#id2613464">
При воспроизведении фильма изображение вдруг начинает дергаться и появляется
следующее сообщение:
Обнаружен плохо 'слоёный' AVI файл - переключаюсь в -ni режим...
</a></dt></dl></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2612824"></a><a name="id2612826"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Не могу локализовать причину некоторой странной проблемы произведения.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Завалялся файл <tt class="filename">codecs.conf</tt> в
<tt class="filename">~/.mplayer/</tt>, <tt class="filename">/etc/</tt>,
<tt class="filename">/usr/local/etc/</tt> или в аналогичном месте? Удалите его,
Устаревший <tt class="filename">codecs.conf</tt> может стать причиной непонятных
проблем и предназначается только для использования разработчиками,
занимающимися поддержкой кодеков. Он переопределяет внутренние настройки кодеков
<span class="application">MPlayer</span>'а, что не сулит ничего хорошего, если
в новых версиях программы внесены несовместимые изменения.
При использовании неэкспертами, это верный путь к, на первый взгляд, случайным и
неподдающимся локализации крахам и проблемам воспроизведения.
Если этот файл присутствует где-либо в Вашей системе, удалите его.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2612899"></a><a name="id2612901"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как настроить субтитры для вывода на черных полях вокруг изображения?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Воспользуйтесь видео фильтром <code class="systemitem">expand</code> для увеличения области
рендеринга по вертикали и разместите изображение у верхней кромки:
</p><pre class="screen">mplayer -vf expand=0:-100:0:0 -slang de dvd://1</pre><p>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2612935"></a><a name="id2612937"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как выбрать дорожки звука/субтитров в DVD, OGM, Matroska или NUT файле?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Нужно использовать опцию <tt class="option">-aid</tt> (аудио ID) или <tt class="option">-alang</tt>
(язык аудио), <tt class="option">-sid</tt> (ID субтитров) или <tt class="option">-slang</tt>
(язык субтитров), например:
</p><pre class="screen">
mplayer -alang eng -slang eng <em class="replaceable"><code>example.mkv</code></em>
mplayer -aid 1 -sid 1 <em class="replaceable"><code>example.mkv</code></em>
</pre><p>
Посмотреть список доступных:
</p><pre class="screen">
mplayer -vo null -ao null -frames 0 -v <em class="replaceable"><code>имя_файла</code></em> | grep sid
mplayer -vo null -ao null -frames 0 -v <em class="replaceable"><code>имя_файла</code></em> | grep aid
</pre><p>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613002"></a><a name="id2613004"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Пытаюсь воспроизвести поток через интернет, но ничего не получается.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Попробуйте воспроизвести поток с опцией <tt class="option">-playlist</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613024"></a><a name="id2613026"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Я загрузил фильм из P2P сети, но он не работает!
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
У Вас испорченный или поддельный файл. Если Вы получили его от друзей, которые
утверждают, что он работает, проверьте контрольную сумму <span class="application">md5sum</span>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613053"></a><a name="id2613055"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
У меня проблемы с отображением субтитров, помогите!
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Убедитесь, что шрифты установлены правильно. Снова пройдите все шаги части
<a class="link" href="#fonts-osd" title="2.4. Шрифты и OSD">Шрифты и OSD</a> раздела, посвященного установке.
Если используете TrueType шрифты, проверьте, что установлена
библиотека <code class="systemitem">FreeType</code>.
Стоит также проверить Ваши субтитры при помощи текстового редактора или
стороннего проигрывателя. Попробуйте преобразовать их в другой формат.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613104"></a><a name="id2613106"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Почему <span class="application">MPlayer</span> не работает в Fedora Core?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Из-за плохого взаимодействия между exec-shield, prelink и любым приложением, использующим
Windows DLLs (таким как <span class="application">MPlayer</span>).
</p><p>
Проблема в том, что exec-shield делает случайными адреса загрузки всех системных
библиотек. Смена адресов производится на стадии prelink (один раз каждые две недели).
</p><p>
Когда <span class="application">MPlayer</span> пытается загрузить Windows DLL, он хочет
поместить ее по определенному адресу (0x400000). Если там уже находится важная
системная библиотека, <span class="application">MPlayer</span> рухнет.
(Типичные симптомы — segmentation fault при попытке воспроизвести файлы
Windows Media 9.)
</p><p>
Если столкнулись с этой проблемой, то у Вас есть два варианта:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Подождать пару недель. Все может снова заработать.
</p></li><li class="listitem"><p>
  Слинковать все бинарники в системе с различными prelink опциями.
  Вот пошаговая инструкция:
  </p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Шаг 1"><p>
    Отредактируйте <tt class="filename">/etc/syconfig/prelink</tt> и измените
    </p><pre class="programlisting">PRELINK_OPTS=-mR</pre><p> на
    </p><pre class="programlisting">PRELINK_OPTS="-mR --no-exec-shield"</pre><p>
  </p></li><li class="step" title="Шаг 2"><p>
    <span class="command"><strong>touch /var/lib/misc/prelink.force</strong></span>
  </p></li><li class="step" title="Шаг 3"><p>
    <span class="command"><strong>/etc/cron.daily/prelink</strong></span>
    (Это перелинкует все приложения, что может занять длительное время.)
  </p></li><li class="step" title="Шаг 4"><p>
    <span class="command"><strong>execstack -s <em class="replaceable"><code>/path/to/</code></em>mplayer</strong></span>
    (Это отключит exec-shield для исполняемого файла <span class="application">MPlayer</span>.)
  </p></li></ol></div></li></ul></div><p>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613294"></a><a name="id2613296"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
<span class="application">MPlayer</span> умирает с сообщением:
</p><pre class="screen">MPlayer прерван сигналом 4 в модуле: decode_video</pre><p>
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Не используйте <span class="application">MPlayer</span> на процессоре, отличном от того,
на котором он компилировался, либо перекомпилируйте с определением CPU "на лету"
(<span class="command"><strong>./configure --enable-runtime-cpudetection</strong></span>).
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613340"></a><a name="id2613342"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
При попытке захвата с тюнера, все работает, но цвета — неправильные. С другими приложениями
все в порядке.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Ваша карта, вероятно, сообщает о некотором пространстве цветов как поддерживаемом, хотя на самом
деле его не поддерживает. Попробуйте с YUY2 вместо  YV12 по умолчанию (смотрите
секцию <a class="link" href="#tv-input" title="5.1. TV вход">TV</a>).
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613375"></a><a name="id2613377"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Получаю странные процентные значения (слишком большие) при проигрывании файлов на ноутбуке.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Это эффект системы управления энергопотреблением ноутбука (BIOS, не ядра).
Подсоедините разъем внешнего питания <span class="bold"><strong>до</strong></span>
включения ноутбука. Также можно попробовать
<a class="ulink" href="http://www.kernel.org/pub/linux/utils/kernel/cpufreq/cpufreq.html" target="_top">cpufreq</a> (SpeedStep интерфейс для Linux),
возможно это поможет.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613418"></a><a name="id2613420"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Аудио/видео теряют синхронизацию, при запуске <span class="application">MPlayer</span>
с правами root на ноутбуке. При запуске с правами обычного пользователя все работает
нормально.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Это тоже эффект системы управления энергопотреблением (смотрите выше).
Подсоедините разъем внешнего питания <span class="bold"><strong>до</strong></span>
включения ноутбука либо убедитесь, что не используется опция <tt class="option">-rtc</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613464"></a><a name="id2613467"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
При воспроизведении фильма изображение вдруг начинает дергаться и появляется
следующее сообщение:
</p><pre class="screen">Обнаружен плохо 'слоёный' AVI файл - переключаюсь в -ni режим...</pre><p>
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Файлы с некорректным чередованием и опция
<tt class="option">-cache</tt> вместе работают не очень хорошо.
Попробуйте <tt class="option">-nocache</tt>.
</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h3 class="title"><a name="faq-driver"></a>11.5. Проблемы драйверов вывода видео/аудио (vo/ao)</h3></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>В: <a href="#id2613517">
При запуске в полноэкранном режиме, наблюдаются черные полосы вокруг изображения
вместо полноэкранного масштабирования.
</a></dt><dt>В: <a href="#id2613592">
Я только что установил MPlayer. Попытка открыть файл
приводит к фатальной ошибке:
Ошибка при открытии/инициализации выбранного устройства видеовывода (-vo).
Как решить проблему?
</a></dt><dt>В: <a href="#id2613674">
У меня проблемы с [Ваш оконный менеджер] и
полноэкранным режимом xv/xmga/sdl/x11 ...
</a></dt><dt>В: <a href="#id2613712">
Теряется синхронизация звука при воспроизведении AVI файла.
</a></dt><dt>В: <a href="#id2613748">
Как использовать dmix с
MPlayer?
</a></dt><dt>В: <a href="#id2613785">
Нет звука при воспроизведении видео и появляется ошибка подобная этой:

AO: [oss] 44100Hz 2ch Signed 16-bit (Little-Endian)
[AO OSS] инициализация аудио: Не могу открыть аудиоустройство /dev/dsp: Device or resource busy
Не могу открыть/инициализировать аудиоустройство -&gt; без звука.
Аудио: без звука
Начало воспроизведения...

</a></dt><dt>В: <a href="#id2613855">
При запуске MPlayer в KDE наблюдается черный экран
и ничего более. Примерно через минуту начинается воспроизведение.
</a></dt><dt>В: <a href="#id2613918">
Проблема с синхронизацией A/V. Некоторые из моих AVI файлов проигрываются нормально, но
некоторые — с двойной скоростью!
</a></dt><dt>В: <a href="#id2613953">
При проигрывании фильма происходит рассинхронизация звука и видео или
MPlayer рушится с ошибкой:
Слишком много (945 в 8390980 байтах) видеопакетов в буфере!
</a></dt><dt>В: <a href="#id2614078">
Как избавиться от рассинхронизации при перемотке потоков RealMedia?
</a></dt></dl></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613517"></a><a name="id2613519"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
При запуске в полноэкранном режиме, наблюдаются черные полосы вокруг изображения
вместо полноэкранного масштабирования.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Ваш драйвер вывода видео аппаратно не поддерживает масштабирование, и, поскольку
программное масштабирование может быть ужасно медленным,
<span class="application">MPlayer</span> не задействует его автоматически.
Скорее всего Вы используете драйвер вывода <code class="systemitem">x11</code> вместо
<code class="systemitem">xv</code>.
Попробуйте указать <tt class="option">-vo xv</tt> в командной строке или
прочтите <a class="link" href="#video" title="Глава 7. Устройства вывода видео">раздел видео</a>, чтобы узнать о других
драйверах вывода видео. Опция <tt class="option">-zoom</tt> явно задействует
программное масштабирование.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613592"></a><a name="id2613594"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Я только что установил <span class="application">MPlayer</span>. Попытка открыть файл
приводит к фатальной ошибке:
</p><pre class="screen">Ошибка при открытии/инициализации выбранного устройства видеовывода (-vo).</pre><p>
Как решить проблему?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Просто смените драйвер вывода видео. Введите следующую команду для получения списка
доступных драйверов:
</p><pre class="screen">mplayer -vo help</pre><p>
Как только выберите правильный драйвер, добавьте его в файл конфигурации. Добавьте
</p><pre class="programlisting">
vo = <em class="replaceable"><code>выбранный_драйвер</code></em>
</pre><p>
в <tt class="filename">~/.mplayer/config</tt> и/или
</p><pre class="programlisting">
vo_driver = <em class="replaceable"><code>выбранный_драйвер</code></em>
</pre><p>
в <tt class="filename">~/.mplayer/gui.conf</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613674"></a><a name="id2613676"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
У меня проблемы с <em class="replaceable"><code>[Ваш оконный менеджер]</code></em> и
полноэкранным режимом xv/xmga/sdl/x11 ...
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Прочтите <a class="link" href="#bugreports" title="Приложение A. Как сообщать об ошибках">руководство по составлению отчетов об ошибках</a>
и отошлите соответствующий отчет нам.
Попробуйте также поэкспериментировать в опцией <tt class="option">-fstype</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613712"></a><a name="id2613714"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Теряется синхронизация звука при воспроизведении AVI файла.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Попробуйте опцию <tt class="option">-bps</tt> или <tt class="option">-nobps</tt>. Если это не помогает
прочтите <a class="link" href="#bugreports" title="Приложение A. Как сообщать об ошибках">руководство по составлению отчетов об ошибках</a>
и загрузите этот файл на наш FTP.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613748"></a><a name="id2613750"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как использовать <span class="application">dmix</span> с
<span class="application">MPlayer</span>?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
После настройки
<a class="ulink" href="http://alsa.opensrc.org/index.php?page=DmixPlugin" target="_top">asoundrc</a>
используйте <tt class="option">-ao alsa:device=dmix</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613785"></a><a name="id2613787"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Нет звука при воспроизведении видео и появляется ошибка подобная этой:
</p><pre class="screen">
AO: [oss] 44100Hz 2ch Signed 16-bit (Little-Endian)
[AO OSS] инициализация аудио: Не могу открыть аудиоустройство /dev/dsp: Device or resource busy
Не могу открыть/инициализировать аудиоустройство -&gt; без звука.
Аудио: без звука
Начало воспроизведения...
</pre><p>
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Используете KDE или GNOME со звуковыми службами aRts или ESD?
Попробуйте отключить службу звука или используйте <tt class="option">-ao arts</tt> или
<tt class="option">-ao esd</tt> опции, для указания <span class="application">MPlayer</span>
использовать aRts или ESD.
Также возможно, что Вы используете ALSA без эмуляции OSS,
попробуйте загрузить ALSA OSS модули ядра или добавьте опцию
<tt class="option">-ao alsa</tt> в командную строку, для использования
ALSA напрямую.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613855"></a><a name="id2613857"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
При запуске <span class="application">MPlayer</span> в KDE наблюдается черный экран
и ничего более. Примерно через минуту начинается воспроизведение.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
aRts блокирует звуковое устройство. Либо подождите старта видео, либо
отключите службу aRts в центре управления. Если Вы хотите использовать звук
через aRts, укажите вывод звука через встроенный звуковой драйвер aRts
(<tt class="option">-ao arts</tt>). Если он не работает, либо
<span class="application">MPlayer</span> собран без него, попробуйте SDL
(<tt class="option">-ao sdl</tt>) и убедитесь, что SDL может работать со
звуком aRts. Ещё один вариант — запуск <span class="application">MPlayer</span>
с artsdsp.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613918"></a><a name="id2613920"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Проблема с синхронизацией A/V. Некоторые из моих AVI файлов проигрываются нормально, но
некоторые — с двойной скоростью!
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
У Вас неверно работающая звуковая карта/драйвер. Скорее всего, поддерживается работа
только с 44100Гц, а Вы пытаетесь проиграть файл с 22050Гц звуком. Попробуйте
звуковой фильтр <code class="systemitem">resample</code>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2613953"></a><a name="id2613955"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
При проигрывании фильма происходит рассинхронизация звука и видео или
<span class="application">MPlayer</span> рушится с ошибкой:
</p><pre class="screen">Слишком много (945 в 8390980 байтах) видеопакетов в буфере!</pre><p>
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Причин может быть несколько.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Ваш CPU <span class="emphasis"><em>и/или</em></span> видеокарта <span class="emphasis"><em>и/или</em></span>
  шина слишком медленные. В этом случае <span class="application">MPlayer</span>
  выводит соответствующее сообщение (и количество выброшенных кадров быстро
  увеличивается).
</p></li><li class="listitem"><p>
  Если это AVI, возможно, у него проблемы с чередованием звука/видео,
  попробуйте опцию <tt class="option">-ni</tt> для обхода проблемы. Или файл имеет
  неверный заголовок. В этом случае могут помочь опции <tt class="option">-nobps</tt>
  и/или <tt class="option">-mc 0</tt>.
</p></li><li class="listitem"><p>
  Многие FLV файлы будут правильно воспроизводиться только с <tt class="option">-correct-pts</tt>.
  К сожалению, <span class="application">MEncoder</span> такой опции не имеет,
  но Вы можете попробовать вручную указать правильное значение <tt class="option">-fps</tt>,
  если оно Вам известно.
</p></li><li class="listitem"><p>
  У Вас неверно работает звуковой драйвер.
</p></li></ul></div><p>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614078"></a><a name="id2614080"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как избавиться от рассинхронизации при перемотке потоков RealMedia?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Может помочь опция <tt class="option">-mc 0.1</tt>.
</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h3 class="title"><a name="faq-dvd"></a>11.6. Воспроизведение DVD</h3></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>В: <a href="#id2614112">
Как насчет DVD навигации/Меню?
</a></dt><dt>В: <a href="#id2614173">
Как насчет субтитров? MPlayer умеет их отображать?
</a></dt><dt>В: <a href="#id2614201">
Как установить регион для DVD-привода? У меня нет Windows!
</a></dt><dt>В: <a href="#id2614224">
DVD не проигрываются, MPlayer зависает или выводит ошибку "Encrypted VOB file!".
</a></dt><dt>В: <a href="#id2614248">
Нужны ли права root (setuid) для воспроизведения DVD?
</a></dt><dt>В: <a href="#id2614274">
Возможно ли проигрывать/кодировать только выбранные разделы?
</a></dt><dt>В: <a href="#id2614295">
Воспроизведение DVD медленное!
</a></dt><dt>В: <a href="#id2614333">
Я скопировал DVD используя vobcopy. Как его проигрывать/кодировать с жесткого
диска?
</a></dt></dl></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614112"></a><a name="id2614114"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как насчет DVD навигации/Меню?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
<span class="application">MPlayer</span> не поддерживает DVD меню в силу серьезных
архитектурных ограничений, которые мешают правильной обработке неподвижных
изображений и интерактивного содержимого. Если хотите модные меню, Вам
придется использовать другой проигрыватель, например <span class="application">xine</span>,
<span class="application">vlc</span> или <span class="application">Ogle</span>.
Если Вы хотите получить DVD навигацию в <span class="application">MPlayer</span>,
реализуйте ее самостоятельно, но имейте ввиду, что это нелегкое и ответственное дело.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614173"></a><a name="id2614175"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как насчет субтитров? <span class="application">MPlayer</span> умеет их отображать?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Да. Смотрите <a class="link" href="#dvd" title="4.2. Воспроизведение DVD">DVD раздел</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614201"></a><a name="id2614203"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как установить регион для DVD-привода? У меня нет Windows!
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Воспользуйтесь
<a class="ulink" href="http://linvdr.org/projects/regionset/" target="_top">утилитой regionset</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614224"></a><a name="id2614226"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
DVD не проигрываются, MPlayer зависает или выводит ошибку "Encrypted VOB file!".
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Код расшифровки CSS не работает с некоторыми приводами, если регион неверно установлен.
Смотрите ответ на предыдущий вопрос.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614248"></a><a name="id2614250"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Нужны ли права root (setuid) для воспроизведения DVD?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Нет. Конечно, Вы должны иметь необходимые права на файл DVD устройства
(в <tt class="filename">/dev/</tt>).
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614274"></a><a name="id2614277"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Возможно ли проигрывать/кодировать только выбранные разделы?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Да, попробуйте опцию <tt class="option">-chapter</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614295"></a><a name="id2614297"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Воспроизведение DVD медленное!
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Используйте опцию <tt class="option">-cache</tt> (описанную на странице man) и попробуйте
включить DMA для DVD привода утилитой <span class="command"><strong>hdparm</strong></span>
(описанной в <a class="link" href="#drives" title="4.1. Приводы CD/DVD">разделе CD</a>).
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614333"></a><a name="id2614335"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Я скопировал DVD используя vobcopy. Как его проигрывать/кодировать с жесткого
диска?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Используйте опцию <tt class="option">-dvd-device</tt>, чтобы указать каталог, содержащий файлы:
</p><pre class="screen">
mplayer dvd://1 -dvd-device <em class="replaceable"><code>/путь/к/каталогу</code></em>
</pre><p>
</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h3 class="title"><a name="faq-features"></a>11.7. Просьбы о новых возможностях</h3></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>В: <a href="#id2614382">
Если MPlayer приостановлен, и я пытаюсь перемотать фильм или нажимаю
любую клавишу, воспроизведение продолжается. Хотелось бы иметь возможность перемотки во
время паузы.
</a></dt><dt>В: <a href="#id2614418">
Хочется перематывать на +/- 1 кадр  вместо 10 секунд.
</a></dt></dl></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614382"></a><a name="id2614384"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Если <span class="application">MPlayer</span> приостановлен, и я пытаюсь перемотать фильм или нажимаю
любую клавишу, воспроизведение продолжается. Хотелось бы иметь возможность перемотки во
время паузы.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Это нелегко реализовать без потери синхронизации A/V. Пока ни одна попытка не
увенчалась успехом, но патчи приветствуются.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614418"></a><a name="id2614420"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Хочется перематывать на +/- 1 кадр  вместо 10 секунд.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Вы можете перемещаться на 1 кадр вперед, нажимая клавишу
<span class="keycap"><b>.</b></span>. После этого воспроизведение будет приостановлено
(смотрите страницу руководства man для подробностей).
Перемещение назад вряд ли будет реализовано в ближайшем будущем.
</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h3 class="title"><a name="faq-encoding"></a>11.8. Кодирование</h3></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>В: <a href="#id2614465">
Как производить кодирование?

</a></dt><dt>В: <a href="#id2614490">
Как сохранить весь ролик DVD в файл?
</a></dt><dt>В: <a href="#id2614536">
Как автоматически создавать (S)VCD?
</a></dt><dt>В: <a href="#id2614572">
Как создать (S)VCD?
</a></dt><dt>В: <a href="#id2614611">
Как склеить два файла?
</a></dt><dt>В: <a href="#id2614684">
Как исправить AVI файлы с испорченным индексом или неверным чередованием?
</a></dt><dt>В: <a href="#id2614741">
Как исправить пропорции в AVI файле?
</a></dt><dt>В: <a href="#id2614788">
Как сделать копию и закодировать VOB файл с испорченным началом?
</a></dt><dt>В: <a href="#id2614869">
Не могу закодировать DVD субтитры в AVI!
</a></dt><dt>В: <a href="#id2614889">
Как кодировать только выбранные эпизоды из DVD?
</a></dt><dt>В: <a href="#id2614913">
Я хочу работать с файлами более 2Гб в файловой системе VFAT. Это возможно?
</a></dt><dt>В: <a href="#id2614931">
Что означают числа в статусной строке в процессе кодировании?
</a></dt><dt>В: <a href="#id2615086">
Почему рекомендуемый MEncoder'ом битрейт отрицателен?
</a></dt><dt>В: <a href="#id2615115">
Не могу перекодировать ASF файл в AVI/MPEG-4, потому что используется 1000fps.
</a></dt><dt>В: <a href="#id2615142">
Как поместить субтитры в выходной файл?
</a></dt><dt>В: <a href="#id2615173">
Как закодировать только звук из видеоклипа?
</a></dt><dt>В: <a href="#id2615248">
Почему сторонние проигрыватели не могут воспроизвести MPEG-4 файлы,
сжатые MEncoder'ом версий старше 1.0pre7?
</a></dt><dt>В: <a href="#id2615410">
Как перекодировать звуковой файл (без видео)?
</a></dt><dt>В: <a href="#id2615442">
Как воспроизвести субтитры внедренные в AVI?
</a></dt><dt>В: <a href="#id2615482">
MPlayer не хочет...
</a></dt></dl></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614465"></a><a name="id2614467"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как производить кодирование?

</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Прочтите раздел <a class="link" href="#mencoder" title="Глава 9. Основы использования MEncoder"><span class="application">MEncoder</span></a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614490"></a><a name="id2614492"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как сохранить весь ролик DVD в файл?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Как только определитесь с выбором ролика и проверите, что он проигрывается в
<span class="application">MPlayer</span>, воспользуйтесь опцией
<tt class="option">-dumpstream</tt>.
Например:
</p><pre class="screen">
mplayer dvd://5 -dumpstream -dumpfile <em class="replaceable"><code>dvd_dump.vob</code></em>
</pre><p>
сохранит 5-й ролик в файл
<em class="replaceable"><code>dvd_dump.vob</code></em>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614536"></a><a name="id2614538"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как автоматически создавать (S)VCD?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Попробуйте скрипт <tt class="filename">mencvcd.sh</tt> из каталога
<tt class="filename">TOOLS</tt>. С его помощью Вы можете перекодировать
DVD или другие фильмы в VCD или SVCD формат и даже записывать их на CD.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614572"></a><a name="id2614574"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как создать (S)VCD?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Новые версии  <span class="application">MEncoder</span> могут самостоятельно создавать
MPEG-2 файлы, которые можно использовать в качестве основы для VCD или SVCD,
воспроизводящиеся "из коробки" на всех платформах (например, чтобы поделиться
фильмом, снятым на видеокамеру, с компьютерно-неграмотными друзьями).
Прочтите
<a class="link" href="#menc-feat-vcd-dvd" title="10.8. Использование MEncoder для создания VCD/SVCD/DVD-совместимых файлов.">Использование MEncoder для создания VCD/SVCD/DVD-совместимых файлов</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614611"></a><a name="id2614613"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как склеить два файла?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
MPEG файлы могут быть объединены в один, если сильно повезет.
Для файлов AVI, можете воспользоваться встроенной возможностью
<span class="application">MEncoder</span>'а
работать с несколькими файлами сразу:
</p><pre class="screen">
mencoder -ovc copy -oac copy -o <em class="replaceable"><code>out.avi</code></em> <em class="replaceable"><code>файл1.avi</code></em> <em class="replaceable"><code>файл2.avi</code></em>
</pre><p>
Это будет работать только если файлы имеют одинаковое разрешение и сжаты одинаковым
кодеком. Также попробуйте
<a class="ulink" href="http://fixounet.free.fr/avidemux/" target="_top">avidemux</a> и
<span class="application">avimerge</span> (часть набора утилит
<a class="ulink" href="http://www.transcoding.org/" target="_top">transcode</a>
).
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614684"></a><a name="id2614686"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как исправить AVI файлы с испорченным индексом или неверным чередованием?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Избежать использования <tt class="option">-idx</tt> и иметь возможность перемотки в
AVI файлах с испорченным индексом, либо избежать <tt class="option">-ni</tt> для воспроизведения файлов
с неверным чередованием поможет команда
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.avi</code></em> -idx -ovc copy -oac copy -o <em class="replaceable"><code>output.avi</code></em>
</pre><p>
Она скопирует видео и аудио в новый файл, генерируя новый индекс и исправляя чередование.
Конечно, это не поможет исправить ошибки в видео и/или аудио потоке.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614741"></a><a name="id2614743"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как исправить пропорции в AVI файле?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Вы можете это сделать при помощи опции <span class="application">MEncoder</span>'а
<tt class="option">-force-avi-aspect</tt>, которая переопределяет информацию о пропорциях, хранящуюся
в опции vprp AVI OpenDML заголовка. Например:
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.avi</code></em> -ovc copy -oac copy -o <em class="replaceable"><code>output.avi</code></em> -force-avi-aspect 4/3
</pre><p>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614788"></a><a name="id2614790"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как сделать копию и закодировать VOB файл с испорченным началом?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Основная проблема при попытке кодировать испорченный VOB файл
<sup>[<a name="fn-corrupted-files-or-copy-protection" href="#ftn.fn-corrupted-files-or-copy-protection" class="footnote">3</a>]</sup>
состоит в том, что будет трудно закодировать файл с хорошей
A/V синхронизацией.
Один из способов заключается в отбрасывании испорченных данных
и кодирования только корретной части. Сначала ищите начало корректных данных (меняя
параметр "колво_байтов_для_пропуска"):
</p><pre class="screen">
mplayer <em class="replaceable"><code>input.vob</code></em> -sb <em class="replaceable"><code>колво_байтов_для_пропуска</code></em>
</pre><p>
Затем создаете новый файл, содержащий корректную часть:
</p><pre class="screen">
dd if=<em class="replaceable"><code>input.vob</code></em> of=<em class="replaceable"><code>output_cut.vob</code></em> skip=1 ibs=<em class="replaceable"><code>колво_байтов_для_пропуска</code></em>
</pre><p>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614869"></a><a name="id2614871"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Не могу закодировать DVD субтитры в AVI!
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Необходимо правильно указать опцию <tt class="option">-sid</tt>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614889"></a><a name="id2614891"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как кодировать только выбранные эпизоды из DVD?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Используйте опцию <tt class="option">-chapter</tt>, например <tt class="option">-chapter 5-7</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614913"></a><a name="id2614915"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Я хочу работать с файлами более 2Гб в файловой системе VFAT. Это возможно?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Нет. VFAT не поддерживает файлы более 2Гб.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2614931"></a><a name="id2614934"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Что означают числа в статусной строке в процессе кодировании?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Пример:
</p><pre class="screen">
Pos: 264.5s   6612f ( 2%)  7.12fps Trem: 576min 2856mb A-V:0.065 [2156:192]
</pre><p>
</p><div class="variablelist"><dl><dt><span class="term"><code class="systemitem">Pos: 264.5s</code></span></dt><dd><p>временная позиция в кодируемом потоке</p></dd><dt><span class="term"><code class="systemitem">6612f</code></span></dt><dd><p>количество закодированных кадров</p></dd><dt><span class="term"><code class="systemitem">2%</code></span></dt><dd><p>размер закодированной части входного потока</p></dd><dt><span class="term"><code class="systemitem">7.12fps</code></span></dt><dd><p>скорость кодирования</p></dd><dt><span class="term"><code class="systemitem">Trem: 576min</code></span></dt><dd><p>оценка времени, оставшегося до конца кодирования</p></dd><dt><span class="term"><code class="systemitem">2856mb</code></span></dt><dd><p>оценка окончательного размера перекодированного файла</p></dd><dt><span class="term"><code class="systemitem">A-V:0.065</code></span></dt><dd><p>текушая задержка между аудио и видео потоками</p></dd><dt><span class="term"><code class="systemitem">[2156:192]</code></span></dt><dd><p>
  средний видео битпоток (в кбит/с) и средний аудио битпоток (в кбит/с)
  </p></dd></dl></div><p>
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2615086"></a><a name="id2615088"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Почему рекомендуемый <span class="application">MEncoder</span>'ом битрейт отрицателен?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Потому что аудио битрейт в процессе кодирования становится слишком велик, чтобы
уместить фильм на CD. Проверьте, правильно ли установлена libmp3lame.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2615115"></a><a name="id2615117"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Не могу перекодировать ASF файл в AVI/MPEG-4, потому что используется 1000fps.
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Поскольку ASF использует переменную частоту кадров, а AVI — фиксированную,
необходимо её установить вручную опцией <tt class="option">-ofps</tt>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2615142"></a><a name="id2615144"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как поместить субтитры в выходной файл?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Просто укажите <span class="application">MEncoder</span> опцию <tt class="option">-sub &lt;имя_файла&gt;</tt>
(или <tt class="option">-sid</tt>, соответственно).
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2615173"></a><a name="id2615175"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как закодировать только звук из видеоклипа?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Напрямую это невозможно, но можете попробовать такой способ
(обратите внимание на
<span class="bold"><strong>&amp;</strong></span> в конце команды
<span class="command"><strong>mplayer</strong></span>):
</p><pre class="screen">
mkfifo encode
mplayer -ao pcm -aofile <em class="replaceable"><code>encode</code></em> dvd://1 &amp;
lame <em class="replaceable"><code>Ваши_опции</code></em> <em class="replaceable"><code>encode</code></em> <em class="replaceable"><code>music.mp3</code></em>
rm <em class="replaceable"><code>encode</code></em>
</pre><p>
Это позволяет использовать любой кодер, не только
<span class="application">LAME</span>,
просто замените <span class="command"><strong>lame</strong></span> на Ваш предпочитаемый кодер.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2615248"></a><a name="id2615250"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Почему сторонние проигрыватели не могут воспроизвести MPEG-4 файлы,
сжатые <span class="application">MEncoder</span>'ом версий старше 1.0pre7?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
<code class="systemitem">libavcodec</code>, родная библиотека
кодирования MPEG-4, обычно поставляемая с <span class="application">MEncoder</span>,
устанавливала FourCC в 'DIVX' при сжатии MPEG-4 видео (FourCC —
это тэг AVI, указывающий нужную программу сжатия и декодирования видео,
т.е. кодек). Поэтому многие люди считают, что
<code class="systemitem">libavcodec</code> была библиотекой
кодирования DivX, когда на самом деле это совершенно другая библиотека
кодирования MPEG-4, реализующая стандарт MPEG-4 значительно лучше, чем DivX.
Поэтому новый FourCC, по умолчанию используемый
<code class="systemitem">libavcodec</code> — это 'FMP4', но Вы
можете переопределить это поведение, используя опцию
<span class="application">MEncoder</span>'а
<tt class="option">-ffourcc</tt>.
Вы также можете сменить FourCC у существующего файла тем же способом:
</p><pre class="screen">
mencoder <em class="replaceable"><code>input.avi</code></em> -o <em class="replaceable"><code>output.avi</code></em> -ffourcc XVID
</pre><p>
Имейте ввиду, что этот пример устанавливает FourCC в XVID, а не DIVX.
Это рекомендуется, т.к. DIVX FourCC означает DivX4, очень простой MPEG-4
кодек, в то время как DX50 и XVID оба — полные MPEG-4 (ASP).
Таким образом, если Вы установите FourCC в DIVX, некоторые плохие
программные или аппаратные проигрыватели могут быть в шоке от дополнительных
возможностей, которые
<code class="systemitem">libavcodec</code> поддерживает,
а DivX — нет;
с другой стороны <code class="systemitem">Xvid</code>
по функциональности ближе к <code class="systemitem">libavcodec</code>
и поддерживается любыми приличными проигрывателями.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2615410"></a><a name="id2615412"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как перекодировать звуковой файл (без видео)?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Используйте <tt class="filename">aconvert.sh</tt> из подкаталога
<tt class="filename">TOOLS</tt>
дерева исходников MPlayer.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2615442"></a><a name="id2615444"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
Как воспроизвести субтитры внедренные в AVI?
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Используйте <tt class="filename">avisubdump.c</tt> из подкаталога
<tt class="filename">TOOLS</tt> или прочтите
<a class="ulink" href="http://xlife.zuavra.net/curse/0012/" target="_top">этот документ о извлечении/мультиплексировании субтитров внедренных в OpenDML AVI файлы</a>.
</p></td></tr><tr class="question" title="В:"><td align="left" valign="top"><a name="id2615482"></a><a name="id2615484"></a><p><b>В:</b></p></td><td align="left" valign="top"><p>
MPlayer не хочет...
</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>О:</b></p></td><td align="left" valign="top"><p>
Посмотрите коллекцию всевозможных скриптов и хаков в подкаталоге
<tt class="filename">TOOLS</tt>.
<tt class="filename">TOOLS/README</tt> содержит документацию.
</p></td></tr></tbody></table></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.fn-corrupted-files-or-copy-protection" href="#fn-corrupted-files-or-copy-protection" class="para">3</a>] </sup>
В какой-то мере некоторые формы защиты от копирования могут быть восприняты как
испорченное содержимое.
</p></div></div></div><div class="appendix" title="Приложение A. Как сообщать об ошибках"><div class="titlepage"><div><div><h2 class="title"><a name="bugreports"></a>Приложение A. Как сообщать об ошибках</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#bugreports_security">A.1. Отчеты об ошибках безопасности</a></span></dt><dt><span class="sect1"><a href="#bugreports_fix">A.2. Как исправить ошибку</a></span></dt><dt><span class="sect1"><a href="#bugreports_regression_test">A.3. Как провести проверку на деградацию, используя Subversion</a></span></dt><dt><span class="sect1"><a href="#bugreports_report">A.4. Как сообщить об ошибке</a></span></dt><dt><span class="sect1"><a href="#bugreports_where">A.5. Куда сообщать об ошибках</a></span></dt><dt><span class="sect1"><a href="#bugreports_what">A.6. Что сообщать</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bugreports_system">A.6.1. Системная информация</a></span></dt><dt><span class="sect2"><a href="#bugreports_hardware">A.6.2. Аппаратура и драйверы</a></span></dt><dt><span class="sect2"><a href="#bugreports_configure">A.6.3. Проблемы конфигурации</a></span></dt><dt><span class="sect2"><a href="#bugreports_compilation">A.6.4. Проблемы компиляции</a></span></dt><dt><span class="sect2"><a href="#bugreports_playback">A.6.5. Проблемы при воспроизведении</a></span></dt><dt><span class="sect2"><a href="#bugreports_crash">A.6.6. Падения</a></span></dt><dd><dl><dt><span class="sect3"><a href="#bugreports_debug">A.6.6.1. Как сохранить информацию о воспроизводимом падении</a></span></dt><dt><span class="sect3"><a href="#bugreports_core">A.6.6.2. Как извлечь полезную информацию из дампа core</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#bugreports_advusers">A.7. Я знаю, что я делаю...</a></span></dt></dl></div><p>
Хорошие сообщения об ошибках вносят значительный вклад в разработку любого
программного продукта. Но, как и написание хорошей программы, хорошее сообщение
об ошибке включает в себя некую долю работы. Пожалуйста, осознайте, что
большинство разработчиков — занятые люди, получающие огромное количество
писем. Поэтому, хотя Ваши отзывы необходимы для улучшения <span class="application">MPlayer</span>'а, хотя
они очень приветствуются, пожалуйста поймите, что Вы должны предоставить
<span class="bold"><strong>всю</strong></span> требуемую нами информацию, поэтому точно
следуйте инструкциям в этом документе.
</p><div class="sect1" title="A.1. Отчеты об ошибках безопасности"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bugreports_security"></a>A.1. Отчеты об ошибках безопасности</h2></div></div></div><p>
В случае, если Вы нашли уязвимость и хотите позволить нам исправить ее до того, как она будет
обнародована, мы будем рады получить Ваше уведомление по адресу
<a class="ulink" href="mailto:security@mplayerhq.hu" target="_top">security@mplayerhq.hu</a>.
Пожалуйста добавьте [SECURITY] или [ADVISORY] к теме письма.
Убедитесь, что Ваш отчет содержит полный и подробный анализ ошибки.
Желательно также прислать и исправление уязвимости.
Пожалуйста, не откладывайте отчет для написания подтверждающего ошибку эксплойта.
Вы можете отослать его позже другим письмом.
</p></div><div class="sect1" title="A.2. Как исправить ошибку"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bugreports_fix"></a>A.2. Как исправить ошибку</h2></div></div></div><p>
Если Вы ощущаете в себе достаточно сил и умения для самостоятельного решения
проблемы, пожалуйста, сделайте это. Или может быть Вы уже это сделали?
Пожалуйста, прочитайте <a class="ulink" href="../../tech/patches.txt" target="_top">этот короткий
документ</a>, чтобы узнать, как сделать так, чтобы Ваш код включили
в <span class="application">MPlayer</span>.  Люди из рассылки
<a class="ulink" href="http://lists.mplayerhq.hu/mailman/listinfo/mplayer-dev-eng" target="_top">mplayer-dev-eng</a>
помогут Вам, если у Вас есть вопросы.
</p></div><div class="sect1" title="A.3. Как провести проверку на деградацию, используя Subversion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bugreports_regression_test"></a>A.3. Как провести проверку на деградацию, используя Subversion</h2></div></div></div><p>
Иногда возникает проблема 'раньше это работало, а теперь - нет'. Здесь представлена
пошаговая процедура определения момента возникновения ошибки.
Но она <span class="bold"><strong>не для</strong></span> рядовых пользователей.
</p><p>
Во-первых, Вам нужно получить исходный код MPlayer из Subversion.
Инструкции могут быть найдены в
<a class="ulink" href="http://www.mplayerhq.hu/design7/dload.html#svn" target="_top">разделе Subversion
страницы закачки</a>.
</p><p>
После этого в каталоге mplayer/ Вы будете иметь образ дерева Subversion.
Теперь обновите этот образ на желаемую дату:
</p><pre class="screen">
cd mplayer/
svn update -r {"2004-08-23"}
</pre><p>
Формат даты: YYYY-MM-DD HH:MM:SS.
Использование этого формата, гарантирует, что Вы сможете извлечь патчи по дате их
внесения, которые указаны в
<a class="ulink" href="http://lists.mplayerhq.hu/pipermail/mplayer-cvslog/" target="_top">архиве MPlayer-cvslog</a>.
</p><p>
Далее выполняйте как при обычном обновлении:
</p><pre class="screen">
./configure
make
</pre><p>
</p><p>
Для непрограммистов, читающих эту страницу, сообщим, то самый быстрый способ найти место
возникновения ошибки — использование бинарного поиска, т.е. поиск даты,
деля интервал поиска пополам раз за разом.
Например, если проблема возникла в 2003 году, начните с середины года и
выясните присутствует ли проблема. Если да, то переходите к проверке
начала Апреля, иначе — к началу Октября. Повторяйте этот процесс, уменьшая интервал
поиска вдвое, пока не выясните искомую дату.
</p><p>
Если у Вас имеется достаточно свободного места на жестком диске (полная
компиляция требует около 100Мб, или 300-350 если включена отладочная
информация), скопируйте последнюю работающую версию перед обновлением,
это сэкономит время при необходимости вернуться назад.
(Как правило необходимо выполнять 'make distclean' до перекомпиляции
более ранней версии, поэтому при отсутствии сохраненной копии
Вам придется перекомпилировать весь проект.)
Также Вы можете использовать <a class="ulink" href="http://ccache.samba.org/" target="_top">ccache</a>
для ускорения компиляции.
</p><p>
Как только Вы нашли дату, продолжайте поиск, используя архив mplayer-cvslog
(отсортированный по дате) до получения более точного времени, включая
час, минуту, секунду:
</p><pre class="screen">
svn update -r {"2004-08-23 15:17:25"}
</pre><p>
Это позволит легко выделить патч, явившийся источником проблемы.
</p><p>
Если Вы нашли нужный патч, то Вы практически победили; сообщите о нем в
<a class="ulink" href="http://bugzilla.mplayerhq.hu/" target="_top">MPlayer Bugzilla</a> или
подпишитесь на
<a class="ulink" href="http://lists.mplayerhq.hu/mailman/listinfo/mplayer-users" target="_top">MPlayer-users</a>
и отправте сообщение туда.
Есть шанс, что автор исправит ошибку.
Вы также можете долго и пристально вглядываться в патч, пока сами не увидите ошибку :).
</p></div><div class="sect1" title="A.4. Как сообщить об ошибке"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bugreports_report"></a>A.4. Как сообщить об ошибке</h2></div></div></div><p>
Прежде всего, пожалуйста, попробуйте использовать новейшую Subversion версию
<span class="application">MPlayer</span>'а, поскольку Ваша ошибка уже может быть исправлена.
Разработка продвигается очень быстро, большинство проблем в официальных релизах
сообщается в течение дней, и даже часов, после релиза, поэтому, пожалуйста, для
сообщений об ошибках используйте <span class="bold"><strong>только Subversion</strong></span>.
Это включает и бинарные пакеты <span class="application">MPlayer</span>'а. Вы найдёте
инструкции по Subversion внизу
<a class="ulink" href="http://www.mplayerhq.hu/dload.html" target="_top">этой страницы</a>
или в README. Если это не помогло, пожалуйста, обратитесь к остальной документации. Если
Ваша проблема не известна или не решается с помощью наших инструкций,
пожалуйста, сообщите об ошибке.
</p><p>
Пожалуйста, не присылайте сообщения об ошибках лично какому-нибудь разработчику.
Это командная работа, и, поэтому, Вашим сообщением могут заинтересоваться
несколько человек. Довольно часто бывает, что пользователи уже сталкивались
с Вашей проблемой и знают, как обойти проблему, даже если это ошибка в коде
<span class="application">MPlayer</span>'а.
</p><p>
Пожалуйста, опишите Вашу проблему настолько подробно, насколько возможно.
Проведите маленькое расследование, чтобы выяснить условия, при которых возникает
проблема. Проявляется ли ошибка только в каких-то конкретных ситуациях?
Она специфична только для каких-то файлов или типов файлов? Происходит ли это
с каким-то одним кодеком, или это не зависит от кодека? Можете ли Вы
воспроизвести это со всеми драйверами вывода? Чем больше Вы предоставите
информации, тем выше вероятность того, что мы сможем исправить ошибку.
Пожалуйста, не забудьте включить важную информацию, которую мы просим ниже,
иначе мы не сможем должным образом диагностировать Вашу проблему.
</p><p>
Великолепное, отлично написанное руководство по задаванию вопросов
на общедоступных форумах — это
<a class="ulink" href="http://www.catb.org/~esr/faqs/smart-questions.html" target="_top">How To Ask
Questions The Smart Way[Как Задавать Вопросы. Правильный Путь.]</a>,
написанное <a class="ulink" href="http://www.catb.org/~esr/" target="_top">Eric S. Raymond</a>.
Есть и другое —
<a class="ulink" href="http://www.chiark.greenend.org.uk/~sgtatham/bugs.html" target="_top">How to Report
Bugs Effectively[Как Эффективно Сообщить об Ошибке]</a>, написанное <a class="ulink" href="http://www.chiark.greenend.org.uk/~sgtatham/" target="_top">Simon Tatham</a>.
Если Вы будете следовать этим указаниям, Вы сможете получить помощь. Но,
пожалуйста, учтите, что мы добровольно отслеживаем рассылки в свободное время.
Мы очень заняты и не можем гарантировать, что Вы получите решение для Вашей
проблемы (или хотя бы ответ).
</p></div><div class="sect1" title="A.5. Куда сообщать об ошибках"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bugreports_where"></a>A.5. Куда сообщать об ошибках</h2></div></div></div><p>
Подпишитесь на рассылку mplayer-users:
<a class="ulink" href="http://lists.mplayerhq.hu/mailman/listinfo/mplayer-users" target="_top">http://lists.mplayerhq.hu/mailman/listinfo/mplayer-users</a>
и отошлите Ваше сообщение на:
<a class="ulink" href="mailto:mplayer-users@mplayerhq.hu" target="_top">mailto:mplayer-users@mplayerhq.hu</a>,
где Вы сможете его обсудить.
</p><p>
Или, если хотите, Вы можете использовать нашу новую
<a class="ulink" href="http://bugzilla.mplayerhq.hu/" target="_top">Bugzilla</a>.
</p><p>
Язык этой рассылки — <span class="bold"><strong>английский</strong></span>.
Пожалуйста, следуйте стандарту <a class="ulink" href="http://www.ietf.org/rfc/rfc1855.txt" target="_top">
Netiquette Guidelines[Руководство по Сетевому Этикету]</a> и
<span class="bold"><strong>не присылайте HTML почту</strong></span> ни на какую из наших
рассылок. Вас просто проигнорируют или забанят. Если Вы хотите узнать, что такое
HTML почта и почему это — зло, прочтите
<a class="ulink" href="http://efn.no/html-bad.html" target="_top">этот документ</a>. Он объяснит
Вам все детали и содержит инструкции по отключению HTML. Также обратите
внимание, что мы не будем индивидуально CC (отсылать копии) людям, а поэтому
подписаться — хорошая идея, если Вы хотите получить ответ.
</p></div><div class="sect1" title="A.6. Что сообщать"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bugreports_what"></a>A.6. Что сообщать</h2></div></div></div><p>
Вам необходимо включить лог, конфигурацию или примеры файлов в сообщение
об ошибке. Если что-то из этого большое, то лучше загрузить это на наш
<a class="ulink" href="ftp://upload.mplayerhq.hu/MPlayer/incoming/" target="_top">FTP сервер</a>
в сжатом виде (предпочтительно gzip или bzip2) и включить в сообщение
об ошибке только путь и имя файла. На наших рассылках стоит ограничение размера
сообщения в 80КБ. Если у Вас что-то большее, то сожмите или загрузите это.
</p><div class="sect2" title="A.6.1. Системная информация"><div class="titlepage"><div><div><h3 class="title"><a name="bugreports_system"></a>A.6.1. Системная информация</h3></div></div></div><p>
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Ваш дистрибутив Linux или операционная система и версия, например:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Red Hat 7.1</p></li><li class="listitem"><p>Slackware 7.0 + пакеты разработки из 7.1 ...</p></li></ul></div><p>
</p></li><li class="listitem"><p>
  версию ядра:
  </p><pre class="screen">uname -a</pre><p>
</p></li><li class="listitem"><p>
  версию libc:
  </p><pre class="screen">ls -l /lib/libc[.-]*</pre><p>
</p></li><li class="listitem"><p>
  версии gcc и ld:
  </p><pre class="screen">
gcc -v
ld -v</pre><p>
</p></li><li class="listitem"><p>
  версия binutils:
  </p><pre class="screen">as --version</pre><p>
</p></li><li class="listitem"><p>
  Если у Вас проблемы с полноэкранным режимом:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Тип оконного менеджера и версия</p></li></ul></div><p>
</p></li><li class="listitem"><p>
  Если у Вас проблема с XVIDIX:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>глубина цвета X'ов:
    </p><pre class="screen">xdpyinfo | grep "depth of root"</pre><p>
  </p></li></ul></div><p>
</p></li><li class="listitem"><p>
  Если глючит только GUI:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>версия GTK</p></li><li class="listitem"><p>версия GLIB</p></li><li class="listitem"><p>ситуация с GUI, в которых проявляется проблема</p></li></ul></div><p>
</p></li></ul></div><p>
</p></div><div class="sect2" title="A.6.2. Аппаратура и драйверы"><div class="titlepage"><div><div><h3 class="title"><a name="bugreports_hardware"></a>A.6.2. Аппаратура и драйверы</h3></div></div></div><p>
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Информация о CPU (это сработает только под Linux):
  </p><pre class="screen">cat /proc/cpuinfo</pre><p>
</p></li><li class="listitem"><p>
  Производитель и модель видео карты, например:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>ASUS V3800U чип: nVidia TNT2 Ultra pro 32MB SDRAM</p></li><li class="listitem"><p>Matrox G400 DH 32MB SGRAM</p></li></ul></div><p>
</p></li><li class="listitem"><p>
Тип драйвера и версия, например:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Встроенный в X'ы</p></li><li class="listitem"><p>nVidia 0.9.623</p></li><li class="listitem"><p>Utah-GLX CVS 2001-02-17</p></li><li class="listitem"><p>DRI из X 4.0.3</p></li></ul></div><p>
</p></li><li class="listitem"><p>
  Тип и драйвер звуковой карты, например:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Creative SBLive! Gold с OSS драйверами от oss.creative.com</p></li><li class="listitem"><p>Creative SB16 с OSS драйверами из ядра</p></li><li class="listitem"><p>GUS PnP с ALSA OSS эмуляцией</p></li></ul></div><p>
</p></li><li class="listitem"><p>
  Если Вы сомневаетесь, на Linux системах включите вывод
<span class="command"><strong>lspci -vv</strong></span>.
</p></li></ul></div><p>
</p></div><div class="sect2" title="A.6.3. Проблемы конфигурации"><div class="titlepage"><div><div><h3 class="title"><a name="bugreports_configure"></a>A.6.3. Проблемы конфигурации</h3></div></div></div><p>
Если Вы получаете ошибку при выполнении <span class="command"><strong>./configure</strong></span>, или если
автоопределение чего-то не срабатывает, прочитайте <tt class="filename">configure.log
</tt>. Там Вы можете обнаружить ответ, например если у Вас стоят несколько
версий одной библиотеки, или если Вы забыли установить пакет разработки (тот
самый, с суффиксом -dev). Если Вы думаете, что это ошибка, включите в сообщение
файл <tt class="filename">configure.log</tt>.
</p></div><div class="sect2" title="A.6.4. Проблемы компиляции"><div class="titlepage"><div><div><h3 class="title"><a name="bugreports_compilation"></a>A.6.4. Проблемы компиляции</h3></div></div></div><p>
Пожалуйста, включите эти файлы:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>config.h</p></li><li class="listitem"><p>config.mak</p></li></ul></div><p>
</p></div><div class="sect2" title="A.6.5. Проблемы при воспроизведении"><div class="titlepage"><div><div><h3 class="title"><a name="bugreports_playback"></a>A.6.5. Проблемы при воспроизведении</h3></div></div></div><p>
Пожалуйста, включите вывод <span class="application">MPlayer</span>'а с уровнем
"избыточности" [verbose] 1, но запомните: <span class="bold"><strong>не
сокращайте вывод</strong></span>, когда Вы его вставляете в почту. Разработчикам
понадобятся все сообщения, чтобы правильно диагностировать проблему. Вы можете
направить вывод в файл, например так:
</p><pre class="screen">
mplayer -v <em class="replaceable"><code>опции</code></em> <em class="replaceable"><code>имя-файла</code></em> &gt; mplayer.log 2&gt;&amp;1
</pre><p>
</p><p>
Если проблема специфична для одного или нескольких файлов,
пожалуйста, загрузите проблемные файлы на:
<a class="ulink" href="ftp://mplayerhq.hu/MPlayer/incoming/" target="_top">ftp://mplayerhq.hu/MPlayer/incoming/</a>
</p><p>
Также загрузите маленький текстовый файл с базовым именем как у Вашего файла и
расширением <tt class="filename">.txt</tt>. Опишите проблему, возникающую у Вас
с соответствующим файлом и включите Ваш электронный адрес и вывод
<span class="application">MPlayer</span>'а
с уровнем "избыточности" 1. Обычно первых 1-5 МБ файла
бывает достаточно, чтобы воспроизвести проблему, но чтобы быть уверенными,
мы просим Вас сделать:
</p><pre class="screen">
dd if=<em class="replaceable"><code>Ваш-файл</code></em> of=<em class="replaceable"><code>малый-файл</code></em> bs=1024k count=5
</pre><p>
Это запишет первые 5 МБ '<span class="bold"><strong>Вашего-файла</strong></span>'
в файл '<span class="bold"><strong>малый-файл</strong></span>'. Теперь снова
попытайтесь с эти маленьким файлом, и если проблема все ещё проявляется,
тогда этого примера будет достаточно для нас.  Пожалуйста,
<span class="bold"><strong>никогда</strong></span> не отсылайте эти файлы по почте!
Загрузите его и отошлите только путь/имя файла на FTP-сервере. Если файл
доступен по сети, тогда просто пришлите <span class="bold"><strong>точный</strong></span>
URL, и этого будет достаточно.
</p></div><div class="sect2" title="A.6.6. Падения"><div class="titlepage"><div><div><h3 class="title"><a name="bugreports_crash"></a>A.6.6. Падения</h3></div></div></div><p>
Вы должны запустить <span class="application">MPlayer</span> внутри <span class="command"><strong>gdb</strong></span>
и прислать нам полный вывод, или , если у Вас есть дамп поломки
<tt class="filename">core</tt>, Вы можете извлечь необходимую полезную информацию из файла
core. Вот как:
</p><div class="sect3" title="A.6.6.1. Как сохранить информацию о воспроизводимом падении"><div class="titlepage"><div><div><h4 class="title"><a name="bugreports_debug"></a>A.6.6.1. Как сохранить информацию о воспроизводимом падении</h4></div></div></div><p>
Перекомпилируйте <span class="application">MPlayer</span> с включённым кодом отладки:
</p><pre class="screen">
./configure --enable-debug=3
make
</pre><p>
и запустите <span class="application">MPlayer</span> внутри gdb:
</p><pre class="screen">gdb ./mplayer</pre><p>
Теперь Вы в gdb. Наберите:
</p><pre class="screen">
run -v <em class="replaceable"><code>опции-для-mplayer</code></em> <em class="replaceable"><code>имя-файла</code></em>
</pre><p>
и воспроизведите крах программы. Как только Вы это сделаете, gdb вернёт Вас к приглашению
командной строки, где Вы должны набрать
</p><pre class="screen">
bt
disass $pc-32 $pc+32
info all-registers
</pre><p>
</p></div><div class="sect3" title="A.6.6.2. Как извлечь полезную информацию из дампа core"><div class="titlepage"><div><div><h4 class="title"><a name="bugreports_core"></a>A.6.6.2. Как извлечь полезную информацию из дампа core</h4></div></div></div><p>
Создайте следующий командный файл:
</p><pre class="screen">
bt
disass $pc-32 $pc+32
info all-registers
</pre><p>
Теперь просто выполните такую команду:
</p><pre class="screen">
gdb mplayer --core=core -batch --command=командный-файл &gt; mplayer.bug
</pre><p>
</p></div></div></div><div class="sect1" title="A.7. Я знаю, что я делаю..."><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bugreports_advusers"></a>A.7. Я знаю, что я делаю...</h2></div></div></div><p>
Если Вы создали правильное сообщение об ошибке так, как рассказано выше, и Вы
уверены, что это ошибка в <span class="application">MPlayer</span>'е, а не ошибка компилятора или плохой файл,
Вы уже прочли всю документацию и не можете найти решение, Ваши звуковые драйвера
в порядке, тогда Вы можете подписаться на рассылку mplayer-advusers и прислать
сообщение об ошибке туда, чтобы получить более точный и быстрый ответ.
</p><p>
Обратите внимание, что если Вы будете отсылать туда вопросы новичков или
вопросы, на которые ответы присутствуют в документации, то Вас проигнорируют
или обругают вместо того, чтобы ответить. Поэтому не заваливайте нас мелочами
и подписывайтесь на -advusers только, если Вы действительно знаете, что Вы
делаете, и ощущаете себя продвинутым пользователем или разработчиком <span class="application">MPlayer</span>'а.
Если подходите под этот критерий, Вам не составит труда понять, как надо
подписаться...
</p></div></div><div class="appendix" title="Приложение B. Формат скинов MPlayer"><div class="titlepage"><div><div><h2 class="title"><a name="skin"></a>Приложение B. Формат скинов <span class="application">MPlayer</span></h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#skin-overview">B.1. Обзор</a></span></dt><dd><dl><dt><span class="sect2"><a href="#skin-overview-directories">B.1.1. Каталоги</a></span></dt><dt><span class="sect2"><a href="#skin-overview-formats">B.1.2. Форматы изображений</a></span></dt><dt><span class="sect2"><a href="#skin-overview-components">B.1.3. Компоненты скина</a></span></dt><dt><span class="sect2"><a href="#skin-files">B.1.4. Файлы</a></span></dt></dl></dd><dt><span class="sect1"><a href="#skin-file">B.2. Файл skin</a></span></dt><dd><dl><dt><span class="sect2"><a href="#skin-file-main">B.2.1. Главное окно и полоса воспроизведения</a></span></dt><dt><span class="sect2"><a href="#skin-file-subwindow">B.2.2. Вспомогательное окно</a></span></dt><dt><span class="sect2"><a href="#skin-file-menu">B.2.3. Меню со скинами</a></span></dt></dl></dd><dt><span class="sect1"><a href="#skin-fonts">B.3. Шрифты</a></span></dt><dd><dl><dt><span class="sect2"><a href="#skin-fonts-symbols">B.3.1. Значки</a></span></dt></dl></dd><dt><span class="sect1"><a href="#skin-gui">B.4. GUI сообщения</a></span></dt><dt><span class="sect1"><a href="#skin-quality">B.5. Создание качественного скина</a></span></dt></dl></div><div class="sect1" title="B.1. Обзор"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="skin-overview"></a>B.1. Обзор</h2></div></div></div><p>
На самом деле с форматом скинов уже нет необходимости что-либо делать, но вам
следует знать, что <span class="application">MPlayer</span>
<span class="bold"><strong>не имеет</strong></span> встроенного скина, так что
<span class="bold"><strong>как минимум один скин должен быть установлен, для
возможности использовать GUI.</strong></span>
</p><div class="sect2" title="B.1.1. Каталоги"><div class="titlepage"><div><div><h3 class="title"><a name="skin-overview-directories"></a>B.1.1. Каталоги</h3></div></div></div><p>
Скины ищутся в следующих каталогах (по порядку):
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
  <tt class="filename">$(DATADIR)/skins/</tt>
</p></li><li class="listitem"><p>
  <tt class="filename">$(PREFIX)/share/mplayer/skins/</tt>
</p></li><li class="listitem"><p>
  <tt class="filename">~/.mplayer/skins/</tt>
</p></li></ol></div><p>
</p><p>
Имейте в виду, что первый путь может меняться в соответствии с конфигурацией
<span class="application">MPlayer</span> (смотрите аргументы скрипта
<span class="command"><strong>configure</strong></span> <tt class="option">--prefix</tt> и <tt class="option">--datadir</tt>).
</p><p>
Каждый скин устанавливается в его собственный подкаталог, в одном из указанных выше
каталогов, например:
</p><pre class="screen">$(PREFIX)/share/mplayer/skins/default/</pre><p>
</p></div><div class="sect2" title="B.1.2. Форматы изображений"><div class="titlepage"><div><div><h3 class="title"><a name="skin-overview-formats"></a>B.1.2. Форматы изображений</h3></div></div></div><p>Изображениями должны быть truecolor (24 или 32 бит/пиксел) PNG.</p><p>
В главном окне и полосе воспроизведения (смотрите ниже) можно использовать
изображения с 'прозрачностью': Области, заполненные цветом #FF00FF (magenta) полностью
прозрачны при просмотре программой <span class="application">MPlayer</span>. Это значит, что
если ваш X сервер поддерживает расширение XShape, вы сможете получить даже
окна произвольной формы.
</p></div><div class="sect2" title="B.1.3. Компоненты скина"><div class="titlepage"><div><div><h3 class="title"><a name="skin-overview-components"></a>B.1.3. Компоненты скина</h3></div></div></div><p>
Скины имеют достаточно свободный формат (в отличие,например, от скинов
<span class="application">Winamp</span>/<span class="application">XMMS</span>,
имеющих формат фиксированный), так что зависит исключительно от вас, выйдет ли
у вас что-то грандиозное.
</p><p>
В данный момент могут быть оформлены четыре окна:
<a class="link" href="#skin-file-main" title="B.2.1. Главное окно и полоса воспроизведения">главное окно</a>,
<a class="link" href="#skin-file-subwindow" title="B.2.2. Вспомогательное окно">вспомогательное окно</a>,
<a class="link" href="#skin-file-main" title="B.2.1. Главное окно и полоса воспроизведения">полоса воспроизведения</a>, and the
<a class="link" href="#skin-file-menu" title="B.2.3. Меню со скинами">меню со скинами</a> (активирующееся правым щелчком
мыши).

</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>Главное окно</strong></span> и/или
  <span class="bold"><strong>полоса воспроизведения</strong></span> - те, через которые вы
  управляете <span class="application">MPlayer</span>. Фон окна - это изображение.
  Различные элементы могут (и должны) размещаться в окне:
  <span class="emphasis"><em>кнопки</em></span>,   <span class="emphasis"><em>ползунки</em></span> и
  <span class="emphasis"><em>надписи</em></span>.
  Для каждого элемента должен быть задан размер и положение.
  </p><p>
  <span class="bold"><strong>Кнопка</strong></span> имеет три состояния (нажата, отпущена,
  отключена), таким образом, ее изображение должно быть разделено вертикально на три части.
  Смотрите элемент <a class="link" href="#skin-button">кнопка</a> для подробностей.
  </p><p>
  <span class="bold"><strong>Ползунок</strong></span> (в основном используется для полосы перемещения
  и управления громкостью/балансом) может иметь любое количество положений, задаваемых делением
  его изображения на различные части одна под другой. Смотрите
  <a class="link" href="#skin-hpotmeter">hpotmeter</a> и
  <a class="link" href="#skin-potmeter">potmeter</a> для подробностей.
  </p><p>
  <span class="bold"><strong>Надписи</strong></span> чуть особеннее: Символы, необходимые для их
  отрисовки, берутся из графического файла, и задаются
  <a class="link" href="#skin-fonts" title="B.3. Шрифты">файлом описания шрифта</a>.
  Последний - это текстовый файл, указывающий x,y положения и размер каждого символа
  в файле с изображением (файл изображения и файл описания шрифта
  <span class="emphasis"><em>вместе</em></span> формируют шрифт). Смотрите
  <a class="link" href="#skin-dlabel">dlabel</a>
  и <a class="link" href="#skin-slabel">slabel</a> для подробностей.
  </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Все изображения могут быть полностью прозрачными, как описано в разделе,
  посвященном <a class="link" href="#skin-overview-formats" title="B.1.2. Форматы изображений">форматам изображений</a>. Если X
  сервер не поддерживает расширение XShape, части, помеченные как прозрачные, будут черными.
  Если вам нравится использовать эту возможность, ширина фона главного окна должна
  делиться на 8.
  </p></div></li><li class="listitem"><p>
  <span class="bold"><strong>Вспомогательное окно</strong></span>  - это то, где появляется фильм.
  Оно может отображать указанную картинку, если  никакого фильма не загружено (пустое окно
  немного надоедает :-)) <span class="bold"><strong>Замечание:</strong></span> прозрачность здесь
  <span class="bold"><strong>не допускается</strong></span>.
</p></li><li class="listitem"><p>
  <span class="bold"><strong>Меню со скинами</strong></span> - всего лишь способ управлять
  <span class="application">MPlayer</span> в понятиях элементов меню. Для меню требуются
  два изображения: одно из них - основное, показывает меню в обычном режиме,
  другое используется для отображения выбранных элементов. Когда появляется меню,
  отображается первое. Если вы перемещаете мышь над элементами меню,
  выбранный элемент копируется из второго изображения поверх элемента меню под указателем мыши
  (второе изображение никогда не отображается целиком).
  </p><p>
  Элемент меню определяется его позицией и размером изображения (смотрите раздел,
  посвященный <a class="link" href="#skin-file-menu" title="B.2.3. Меню со скинами">меню со скинами</a> для подробностей).
  </p></li></ul></div><p>
</p><p>
Важная вещь, не упомянутая выше: Чтобы работали кнопки, ползунки и элементы меню,
<span class="application">MPlayer</span> должен знать, что делать, если на них
щелкнули мышью. Это делается при помощи <a class="link" href="#skin-gui" title="B.4. GUI сообщения">сообщений</a>
(событий). Для этих элементов вы должны определить сообщения, генерируемые, когда
на них щелкают мышью.
</p></div><div class="sect2" title="B.1.4. Файлы"><div class="titlepage"><div><div><h3 class="title"><a name="skin-files"></a>B.1.4. Файлы</h3></div></div></div><p>
Вам нужны следующие файлы для создания скина:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Файл конфигурации, называющийся <a class="link" href="#skin-file" title="B.2. Файл skin">skin</a> говорит
  <span class="application">MPlayer</span> как совместить разные части скина воедино,
  и что делать, если производится щелчок где-нибудь в окне.
</p></li><li class="listitem"><p>
  Фоновое изображение главного окна.
</p></li><li class="listitem"><p>
  Изображения элементов главного окна (включая один или более файлов описания шрифтов,
  необходимых для отрисовки надписей.
</p></li><li class="listitem"><p>
  Изображение, показываемое во вспомогательном окне (необязательно).
</p></li><li class="listitem"><p>
  Два изображения для меню со скинами (нужны, только если вы хотите создавать меню).
</p></li></ul></div><p>
  Все файлы, за исключением skin, могут быть названы так, как вам захочется
  (но заметьте, что файлы описания шрифтов должны иметь расширение
  a <tt class="filename">.fnt</tt>).
</p></div></div><div class="sect1" title="B.2. Файл skin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="skin-file"></a>B.2. Файл skin</h2></div></div></div><p>
Как описано выше, это файл конфигурации скина. он строчно-орентирован:
строки комментариев начинаются с символа '<code class="literal">;</code>' в начале
строки (только пробелы и табуляция допускается перед символом '<code class="literal">;</code>').
</p><p>
Файл создается из разделов. Каждый описывает скин для приложения и
имеет следующую форму:
</p><pre class="programlisting">
section = <em class="replaceable"><code>название раздела</code></em>
.
.
.
end
</pre><p>
</p><p>
В данный момент приложение одно, так что вам потребуется только один раздел: его название
<span class="bold"><strong>movieplayer</strong></span>.
</p><p>
В пределах раздела каждое окно описывается блоком следующей структуры:
</p><pre class="programlisting">
window = <em class="replaceable"><code>название окна</code></em>
.
.
.
end
</pre><p>
</p><p>
где  <em class="replaceable"><code>название окна</code></em> может быть одной из этих строк:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  <span class="bold"><strong>main</strong></span> - главное окно
</p></li><li class="listitem"><p>
  <span class="bold"><strong>sub</strong></span> - вспомогательное окно
</p></li><li class="listitem"><p>
  <span class="bold"><strong>menu</strong></span> - меню со скинами
</p></li><li class="listitem"><p>
  <span class="bold"><strong>playbar</strong></span> - полоса воспроизведения
</p></li></ul></div><p>
</p><p>
(Блоки sub и menu опциональные - необязательно создавать меню или оформлять вспомогательное
окно.)
</p><p>
В пределах блока window вы можете описать каждый элемент окна строкой в следующем формате:
</p><pre class="programlisting">item = parameter</pre><p>
Где <code class="literal">item</code> - это строка, определяющая тип элемента GUI,
<code class="literal">parameter</code> - числовое или текстовое значение (или список значений, разделенных
запятой).
</p><p>
Если собрать все вместе, файл целиком будет выглядеть примерно так:
</p><pre class="programlisting">
section = movieplayer
  window = main
  ; ... items for main window ...
  end

  window = sub
  ; ... items for subwindow ...
  end

  window = menu
  ; ... items for menu ...
  end

  window = playbar
  ; ... items for playbar ...
  end
end
</pre><p>
</p><p>
Название файла с изображением  должно указываться без лидирующих каталогов -
изображения ищутся в каталоге <tt class="filename">skins</tt>.
Вы можете (но не обязаны) указать расширение файла. Если файл не существует,
<span class="application">MPlayer</span> пытается загрузить файл
<tt class="filename">&lt;filename&gt;.&lt;ext&gt;</tt>, где <code class="literal">png</code>
и <code class="literal">PNG</code> пробуются вместо <tt class="filename">&lt;ext&gt;</tt>
(в этом порядке). Будет использоваться первый найденный файл.
</p><p>
Вот пример, чтобы было понятнее. Предположим вы имеете изображение, называющееся
<tt class="filename">main.png</tt>, которое используете для главного окна:
</p><pre class="programlisting">base = main, -1, -1</pre><p>
<span class="application">MPlayer</span> пытается загрузить файлы <tt class="filename">main</tt>,
<tt class="filename">main.png</tt>, <tt class="filename">main.PNG</tt>.
</p><p>
И наконец несколько слов о позиционировании. Главное и вспомогательное окна могут
быть размещены в разных углах экрана указанием <code class="literal">X</code> и
<code class="literal">Y</code> координат. <code class="literal">0</code> -  это верхний и левый край,
<code class="literal">-1</code> - центр и <code class="literal">-2</code> - правый или нижний, как
указано на иллюстрации:
</p><div class="informalfigure"><pre class="screen">
(0, 0)----(-1, 0)----(-2, 0)
  |          |          |
  |          |          |
(0,-1)----(-1,-1)----(-2,-1)
  |          |          |
  |          |          |
(0,-2)----(-1,-2)----(-2,-2)
</pre></div><p>
</p><div class="sect2" title="B.2.1. Главное окно и полоса воспроизведения"><div class="titlepage"><div><div><h3 class="title"><a name="skin-file-main"></a>B.2.1. Главное окно и полоса воспроизведения</h3></div></div></div><p>
Ниже  - список элементов, которые можно указывать в
'<code class="literal">window = main</code>' ... '<code class="literal">end</code>',
и '<code class="literal">window = playbar</code>' ... '<code class="literal">end</code>'
блоках.
</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">
  <a name="skin-main-base"></a>base = image, X, Y
  </code></span></dt><dd><p>
  Позволяет вам указать фоновое изображение, используемое в главном окне.
  Окно будет появляться в указанной <code class="literal">X,Y</code> позиции на экране и
  иметь размер изображения.
  </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
  Эти координаты пока не работают для окна отображения.
  </p></div><div class="warning" title="Внимание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Внимание</h3><p>Прозрачные регионы в изображении (цвет #FF00FF) станут черными
  на X сервере без расширения XShape. Ширина картинки должна делиться
  на 8.</p></div></dd><dt><span class="term"><code class="literal">
  <a name="skin-button"></a>button = image, X, Y, width, height, message
  </code></span></dt><dd><p>
  Размещает кнопку размера <code class="literal">width</code> * <code class="literal">height</code> на
  позиции <code class="literal">X,Y</code>. Указанное сообщение <code class="literal">message</code>
  генерируется при щелчке на кнопку. Изображение <code class="literal">image</code>,
  должно иметь три части одна ниже другой (в соответствии с возможными состояниями
  кнопки), как здесь:
  </p><div class="informalfigure"><pre class="screen">
+------------+
|  нажата    |
+------------+
|  отпущена  |
+------------+
|  отключена |
+------------+</pre></div></dd><dt><span class="term"><code class="literal">
  <a name="skin-decoration"></a>decoration = enable|disable
  </code></span></dt><dd><p>
  Включает или выключает декорации главного окна, осуществляемые window manager . По-умолчанию
  <span class="bold"><strong>disable</strong></span>.
  </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
  Это не работает для окна отображения, в этом нет надобности.
  </p></div></dd><dt><span class="term"><code class="literal">
  <a name="skin-hpotmeter"></a>hpotmeter = button, bwidth, bheight, phases, numphases, default, X, Y, width, height, message
  </code></span></dt><dd><p>
  </p></dd><dt><span class="term"><code class="literal">
  <a name="skin-vpotmeter"></a>vpotmeter = button, bwidth, bheight, phases, numphases, default, X, Y, width, height, message
  </code></span></dt><dd><p>
  Размещает горизонтальный (hpotmeter) или вертикальный (vpotmeter) ползунок размера
  <code class="literal">width</code> * <code class="literal">height</code> на позиции
  <code class="literal">X,Y</code>. Изображение может быть разделено на разные части для
  указания различных положений ползунка (например, вы можете иметь регулятор для
  управления громкостью звука, изменяющийся с красного на зеленый при изменении его
  уровня с минимального на максимальный.). <code class="literal">hpotmeter</code> может иметь
  кнопку, которую можно таскать горизонтально. Параметры:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
    <code class="literal">button</code> - изображение, используемое для
    кнопки (должно иметь три части одна под другой, как в случае
    <a class="link" href="#skin-button">кнопки</a>)
  </p></li><li class="listitem"><p>
    <code class="literal">bwidth</code>, <code class="literal">bheight</code> - размер кнопки
  </p></li><li class="listitem"><p>
    <code class="literal">phases</code> - изображение, используемое для
    различных положений hpotmeter. Специальное значение <code class="literal">NULL</code>
    может использоваться, если подобное изображение вам не нужно. Изображение
    должно быть разделено вертикально на
    <code class="literal">numphases</code> частей, как указано ниже:
    </p><div class="informalfigure"><pre class="screen">
+--------------+
| положение #1 |
+--------------+
| положение #2 |
+--------------+
     ...
+--------------+
| положение #n |
+--------------+</pre></div><p>
  </p></li><li class="listitem"><p>
    <code class="literal">numphases</code> - количество положений в изображении
    <code class="literal">phases</code>
  </p></li><li class="listitem"><p>
    <code class="literal">default</code> - положение hpotmeter по-умолчанию
    (в диапазоне от <code class="literal">0</code> до <code class="literal">100</code>)
  </p></li><li class="listitem"><p>
    <code class="literal">X</code>, <code class="literal">Y</code> - позиция hpotmeter
    </p></li><li class="listitem"><p>
    <code class="literal">width</code>, <code class="literal">height</code> - ширина и высота
    <code class="literal">hpotmeter</code>
  </p></li><li class="listitem"><p>
    <code class="literal">message</code> - сообщение, генерируемое  при изменении значения
    <code class="literal">hpotmeter</code>
  </p></li></ul></div><p>
  </p></dd><dt><span class="term"><code class="literal">
  <a name="skin-potmeter"></a>potmeter = phases, numphases, default, X, Y, width, height, message
  </code></span></dt><dd><p>
  <code class="literal">hpotmeter</code> без кнопки.
  (Я предполагаю, что это означает повернутый вокруг,
  но он реагирует только на перетаскивание по горизонтали.) Для описания параметров смотрите
  <a class="link" href="#skin-hpotmeter">hpotmeter</a>.
  <code class="literal">phases</code> может быть равен <code class="literal">NULL</code>, но это совершенно
  бесполезно, поскольку вы не сможете определить в каком положении
  находится <code class="literal">potmeter</code>.
  </p></dd><dt><span class="term"><code class="literal">
  <a name="skin-font"></a>font = fontfile, fontid
  </code></span></dt><dd><p>
  Определяет шрифт. <code class="literal">fontfile</code> - это название файла описания шрифта
  с расширением <tt class="filename">.fnt</tt> (не указывайте расширение здесь).
  <code class="literal">fontid</code> используется для ссылки на шрифт
  (смотрите <a class="link" href="#skin-dlabel">dlabel</a> и
  <a class="link" href="#skin-slabel">slabel</a>). Может быть определено до 25 шрифтов.
  </p></dd><dt><span class="term"><code class="literal">
  <a name="skin-slabel"></a>slabel = X, Y, fontid, "text"
  </code></span></dt><dd><p>
  Размещает  статическую метку на позиции <code class="literal">X,Y</code>. <code class="literal">text</code>
  отображается, используя шрифт, определенный по <code class="literal">fontid</code>.
  Текст - просто обычная строка (<code class="literal">$x</code> переменные не работают), которая должна
  быть заключена в двойные кавычки (но символ " не может быть частью текста).
  Метка отображается, используя шрифт определенный по <code class="literal">fontid</code>.
  </p></dd><dt><span class="term"><code class="literal">
  <a name="skin-dlabel"></a>dlabel = X, Y, length, align, fontid, "text"
  </code></span></dt><dd><p>
  Размещает динамическую метку на позиции <code class="literal">X,Y</code>. Метка зовется
  динамической, потому что ее текст периодически обновляется. Максимальная длина
  метки задается параметром <code class="literal">length</code> (ее высота равна высоте символа).
  Если отображаемый текст шире этого значения, он будет скроллироваться,
  иначе он выравнивается в пределах указанного пространства в соответствии со
  значением параметра
  <code class="literal">align</code>: <code class="literal">0</code> - вправо,
  <code class="literal">1</code> - по центру, <code class="literal">2</code> - влево.
  </p><p>
  Отображаемый текст задается параметром <code class="literal">text</code>: Он должен быть
  заключен в двойные кавычки (но символ " не может быть частью текста).
  Метка отображается, используя шрифт, определяемый по <code class="literal">fontid</code>.
  Вы можете использовать следующие переменные в тексте:
  </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Переменная</th><th>Значение</th></tr></thead><tbody><tr><td>$1</td><td>время воспроизведения в формате <span class="emphasis"><em>чч:мм:сс</em></span></td></tr><tr><td>$2</td><td>время воспроизведения в формате <span class="emphasis"><em>мммм:сс</em></span></td></tr><tr><td>$3</td><td>время воспроизведения формате <span class="emphasis"><em>чч</em></span>(часы)</td></tr><tr><td>$4</td><td>время воспроизведения в формате <span class="emphasis"><em>мм</em></span>(минуты)</td></tr><tr><td>$5</td><td>время воспроизведения в формате <span class="emphasis"><em>сс</em></span>(секунды)</td></tr><tr><td>$6</td><td>длительность фильма в формате <span class="emphasis"><em>чч:мм:сс</em></span></td></tr><tr><td>$7</td><td>длительность фильма в формате <span class="emphasis"><em>мммм:сс</em></span></td></tr><tr><td>$8</td><td>время воспроизведения формате <span class="emphasis"><em>ч:мм:сс</em></span></td></tr><tr><td>$v</td><td>кромкость в формате <span class="emphasis"><em>xxx.xx</em></span>%</td></tr><tr><td>$V</td><td>кромкость в формате <span class="emphasis"><em>xxx.xx</em></span></td></tr><tr><td>$b</td><td>баланс в формате <span class="emphasis"><em>xxx.xx</em></span>%</td></tr><tr><td>$B</td><td>баланс в формате <span class="emphasis"><em>xxx.xx</em></span></td></tr><tr><td>$$</td><td>символ $</td></tr><tr><td>$a</td><td>символ ,соответствующий типу звука (нет: <code class="literal">n</code>,
    моно: <code class="literal">m</code>, стерео: <code class="literal">t</code>)</td></tr><tr><td>$t</td><td>номер дорожки (в плейлисте)</td></tr><tr><td>$o</td><td>имя файла</td></tr><tr><td>$f</td><td>имя файла в нижнем регистре</td></tr><tr><td>$F</td><td>имя файла в верхнем регистре</td></tr><tr><td>$T</td><td>
    символ, соответствующий типу потока (файл: <code class="literal">f</code>,
    Video CD: <code class="literal">v</code>, DVD: <code class="literal">d</code>,
    URL: <code class="literal">u</code>)
    </td></tr><tr><td>$p</td><td>
    символ <span class="keycap"><b>p</b></span> (если фильм воспроизводится и шрифт имеет
    символ <span class="keycap"><b>p</b></span>)
    </td></tr><tr><td>$s</td><td>
    символ <span class="keycap"><b>s</b></span> (если фильм остановлен и шрифт имеет
    символ <span class="keycap"><b>s</b></span>)
    </td></tr><tr><td>$e</td><td>
    символ <span class="keycap"><b>e</b></span> (если фильм на паузе и шрифт имеет
    символ <span class="keycap"><b>e</b></span>)
    </td></tr><tr><td>$x</td><td>ширина фильма</td></tr><tr><td>$y</td><td>высота фильма</td></tr><tr><td>$C</td><td>название используемого кодека</td></tr></tbody></table></div><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
  Переменные <code class="literal">$a, $T, $p, $s</code> и <code class="literal">$e</code> все
  возвращают символы, которые должны быть отображены в качестве специальных значков
  (например, <span class="keycap"><b>e</b></span> - для значка паузы, который обычно выглядит как ||).
  Вы должны иметь шрифт для обычных символов и отличающийся шрифт для значков.
  Смотрите раздел о <a class="link" href="#skin-fonts-symbols" title="B.3.1. Значки">значках</a>
  для дополнительной информации.
  </p></div></dd></dl></div></div><div class="sect2" title="B.2.2. Вспомогательное окно"><div class="titlepage"><div><div><h3 class="title"><a name="skin-file-subwindow"></a>B.2.2. Вспомогательное окно</h3></div></div></div><p>
Следующие элементы могут быть использованы в блоке
'<code class="literal">window = sub</code>' . . . '<code class="literal">end</code>' .
</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">
  <a name="skin-sub-base"></a>base = image, X, Y, width, height
  </code></span></dt><dd><p>
  Изображение, отображаемое в окне. Окно будет появляться в указанной позиции
  <code class="literal">X,Y</code> экрана (<code class="literal">0,0</code> - верхний левый угол).
  Вы можете указать <code class="literal">-1</code> для центра и <code class="literal">-2</code>
  для правого (<code class="literal">X</code>) и нижнего (<code class="literal">Y</code>) края.
  Окно будет того же размера, что и изображение. <code class="literal">width</code> и
  <code class="literal">height</code> означают размер окна; они необязательны
  (если отсутствуют, окно будет иметь те же размеры, что и изображение).
  </p></dd><dt><span class="term"><code class="literal">
  <a name="skin-background"></a>background = R, G, B
  </code></span></dt><dd><p>
  Позволяет указать цвет фона. Это полезно, если изображение меньше окна.
  <code class="literal">R</code>, <code class="literal">G</code> и <code class="literal">B</code>
  указывают красную, зеленую и синюю составляющие цвета (каждое из них -
  десятичное число от 0 до 255).
  </p></dd></dl></div></div><div class="sect2" title="B.2.3. Меню со скинами"><div class="titlepage"><div><div><h3 class="title"><a name="skin-file-menu"></a>B.2.3. Меню со скинами</h3></div></div></div><p>
Как было описано выше, меню отображается при помощи двух картинок. Нормальные
элементы меню берутся из изображения, указанного элементом <code class="literal">base</code>,
в то время как выделенный в данный момент элемент берется  из изображения,
указанного элементом <code class="literal">selected</code>. Вы должны определить позицию и
размер каждого элемента меню.
</p><p>
Следующие элементы можно использовать в блоке
'<code class="literal">window = menu</code>'. . .'<code class="literal">end</code>'.
</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">
  <a name="skin-menu-base"></a>base = image
  </code></span></dt><dd><p>
  Изображение для нормальных элементов меню.
  </p></dd><dt><span class="term"><code class="literal">
  <a name="skin-selected"></a>selected = image
  </code></span></dt><dd><p>
  Изображение, показывающее меню со всеми выделенными элементами.
  </p></dd><dt><span class="term"><code class="literal">
  <a name="skin-menu"></a>menu = X, Y, width, height, message
  </code></span></dt><dd><p>
  Определяет позицию <code class="literal">X,Y</code> и размер элемента меню в изображении.
  <code class="literal">message</code> - это сообщение, генерируемое, когда кнопка мыши будет отпущена
  над элементом меню.
  </p></dd></dl></div></div></div><div class="sect1" title="B.3. Шрифты"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="skin-fonts"></a>B.3. Шрифты</h2></div></div></div><p>
Как описано в разделе, посвященному частям скина, шрифт определяется
изображением и файлом описания. Вы можете поместить символы в любое место изображения,
но будьте уверены, что их позиция и размер точно указаны в файле описания.
</p><p>
Файл описания шрифта (с расширением <tt class="filename">.fnt</tt>) может иметь комментарии,
начинающиеся с '<code class="literal">;</code>'. Файл должен иметь строку вида
<a name="skin-font-image"></a>
</p><pre class="programlisting">image = <em class="replaceable"><code>image</code></em></pre><p>,
где <code class="literal"><em class="replaceable"><code>image</code></em></code> - это название
файла с изображением, используемым для шрифта (расширение указывать необязательно).
<a name="skin-font-char"></a>
</p><pre class="programlisting">"char" = X, Y, width, height</pre><p>
Здесь <code class="literal">X</code> и <code class="literal">Y</code> указывают позицию символа
<code class="literal">char</code> в изображении (<code class="literal">0,0</code> - верхний левый угол),
<code class="literal">width</code> и <code class="literal">height</code> - размеры символа в пикселах.
</p><p>
Этот пример определяет символы  A, B, C, используя <tt class="filename">font.png</tt>.
</p><pre class="programlisting">
; Can be "font" instead of "font.png".
image = font.png

; Three characters are enough for demonstration purposes :-)
"A" =  0,0, 7,13
"B" =  7,0, 7,13
"C" = 14,0, 7,13
</pre><p>
</p><div class="sect2" title="B.3.1. Значки"><div class="titlepage"><div><div><h3 class="title"><a name="skin-fonts-symbols"></a>B.3.1. Значки</h3></div></div></div><p>
Некоторые символы имеют специальное значение, когда возвращаются некоторыми переменными,
используемыми в <a class="link" href="#skin-dlabel">dlabel</a>. Подразумевается, что эти символы
должны отображаться в виде значков, так для DVD потока можно отображать значок
красивого логотипа DVD вместо символа '<code class="literal">d</code>'.
</p><p>
Следующая таблица содержит список всех символов, которые могут использоваться для
отображения значков (и поэтому требуют другой шрифт).
</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Символ</th><th>Значок</th></tr></thead><tbody><tr><td><span class="keycap"><b>p</b></span></td><td>воспроизведение</td></tr><tr><td><span class="keycap"><b>s</b></span></td><td>стоп</td></tr><tr><td><span class="keycap"><b>e</b></span></td><td>пауза</td></tr><tr><td><span class="keycap"><b>n</b></span></td><td>без звука</td></tr><tr><td><span class="keycap"><b>m</b></span></td><td>звук моно</td></tr><tr><td><span class="keycap"><b>t</b></span></td><td>звук стерео</td></tr><tr><td><span class="keycap"><b>f</b></span></td><td>файл</td></tr><tr><td><span class="keycap"><b>v</b></span></td><td>Video CD</td></tr><tr><td><span class="keycap"><b>d</b></span></td><td>DVD</td></tr><tr><td><span class="keycap"><b>u</b></span></td><td>URL</td></tr></tbody></table></div></div></div><div class="sect1" title="B.4. GUI сообщения"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="skin-gui"></a>B.4. GUI сообщения</h2></div></div></div><p>
Это сообщения, которые могут генерироваться кнопками, ползунками и элементами меню.
</p><div class="variablelist" title="Управление воспроизведением:"><p class="title"><b>Управление воспроизведением:</b></p><dl><dt><span class="term"><span class="bold"><strong>evNext</strong></span></span></dt><dd><p>
  Переход к следующему элементу списка воспроизведения.
  </p></dd><dt><span class="term"><span class="bold"><strong>evPause</strong></span></span></dt><dd><p>
  Вместе с <code class="literal">evPlaySwitchToPause</code> формирует переключатель паузы.
  Может быть использовано для общей кнопки воспроизведение/пауза. Оба сообщения
  должны быть назначены кнопкам, находящимся практически в одной точке окна.
  Это сообщение ставит воспроизведение на паузу и показывает изображение кнопки с
  назначенным сообщением <code class="literal">evPlaySwitchToPause</code>
  (чтобы показать, что кнопка может быть нажата для продолжения воспроизведения).
  </p></dd><dt><span class="term"><span class="bold"><strong>evPlay</strong></span></span></dt><dd><p>
  Старт воспроизведения.
  </p></dd><dt><span class="term"><span class="bold"><strong>evPlaySwitchToPause</strong></span></span></dt><dd><p>
  Противоположность <code class="literal">evPauseSwitchToPlay</code>. Это сообщение
  запускает воспроизведение и показывает изображение кнопки с
  назначенным сообщением <code class="literal">evPauseSwitchToPlay</code>
  (чтобы показать, что кнопка может быть нажата для включения паузы).
  </p></dd><dt><span class="term"><span class="bold"><strong>evPrev</strong></span></span></dt><dd><p>
  Переход к предыдущему элементу списка воспроизведения.
  </p></dd><dt><span class="term"><span class="bold"><strong>evStop</strong></span></span></dt><dd><p>
  Останавливает воспроизведение.
  </p></dd></dl></div><div class="variablelist" title="Перемещение:"><p class="title"><b>Перемещение:</b></p><dl><dt><span class="term"><span class="bold"><strong>evBackward10sec</strong></span></span></dt><dd><p>
  Перемещение назад на 10 секунд.
  </p></dd><dt><span class="term"><span class="bold"><strong>evBackward1min</strong></span></span></dt><dd><p>
  Перемещение назад на 1 минуту.
  </p></dd><dt><span class="term"><span class="bold"><strong>evBackward10min</strong></span></span></dt><dd><p>
  Перемещение назад на 10 минут.
  </p></dd><dt><span class="term"><span class="bold"><strong>evForward10sec</strong></span></span></dt><dd><p>
  Перемещение вперед на 10 секунд.
  </p></dd><dt><span class="term"><span class="bold"><strong>evForward1min</strong></span></span></dt><dd><p>
  Перемещение вперед на 1 минуту.
  </p></dd><dt><span class="term"><span class="bold"><strong>evForward10min</strong></span></span></dt><dd><p>
  Перемещение вперед на 10 минут.
  </p></dd><dt><span class="term"><span class="bold"><strong>evSetMoviePosition</strong></span></span></dt><dd><p>
  Перемещается к позиции (может использоваться ползунком;
  используется относительное (0-100%) положение ползунка).
  </p></dd></dl></div><div class="variablelist" title="Управление видео:"><p class="title"><b>Управление видео:</b></p><dl><dt><span class="term"><span class="bold"><strong>evHalfSize</strong></span></span></dt><dd><p>
  Установить половинный размер окна.
  </p></dd><dt><span class="term"><span class="bold"><strong>evDoubleSize</strong></span></span></dt><dd><p>
  Установить двойной размер окна.
  </p></dd><dt><span class="term"><span class="bold"><strong>evFullScreen</strong></span></span></dt><dd><p>
  Включить/выключить полноэкранный режим.
  </p></dd><dt><span class="term"><span class="bold"><strong>evNormalSize</strong></span></span></dt><dd><p>
  Установить нормальный размер окна.
  </p></dd></dl></div><div class="variablelist" title="Управление звуком:"><p class="title"><b>Управление звуком:</b></p><dl><dt><span class="term"><span class="bold"><strong>evDecAudioBufDelay</strong></span></span></dt><dd><p>
  Уменьшить задержку буфера звука.
  </p></dd><dt><span class="term"><span class="bold"><strong>evDecBalance</strong></span></span></dt><dd><p>
  Уменьшить баланс.
  </p></dd><dt><span class="term"><span class="bold"><strong>evDecVolume</strong></span></span></dt><dd><p>
  Уменьшить громкость.
  </p></dd><dt><span class="term"><span class="bold"><strong>evIncAudioBufDelay</strong></span></span></dt><dd><p>
  Увеличить задержку буфера звука.
  </p></dd><dt><span class="term"><span class="bold"><strong>evIncBalance</strong></span></span></dt><dd><p>
  Увеличить баланс.
  </p></dd><dt><span class="term"><span class="bold"><strong>evIncVolume</strong></span></span></dt><dd><p>
  Увеличить громкость.
  </p></dd><dt><span class="term"><span class="bold"><strong>evMute</strong></span></span></dt><dd><p>
  Выключить/включить звук.
  </p></dd><dt><span class="term"><span class="bold"><strong>evSetBalance</strong></span></span></dt><dd><p>
  Установить баланс (может использоваться ползунком;
  используется относительное (0-100%) значение ползунка),
  </p></dd><dt><span class="term"><span class="bold"><strong>evSetVolume</strong></span></span></dt><dd><p>
  Установить громкость (может использоваться ползунком;
  используется относительное (0-100%) значение ползунка),
  </p></dd></dl></div><div class="variablelist" title="Разное:"><p class="title"><b>Разное:</b></p><dl><dt><span class="term"><span class="bold"><strong>evAbout</strong></span></span></dt><dd><p>
  Открыть окно 'О программе'.
  </p></dd><dt><span class="term"><span class="bold"><strong>evDropSubtitle</strong></span></span></dt><dd><p>
  Отключает субтитры, использующиеся в данный момент.
  </p></dd><dt><span class="term"><span class="bold"><strong>evEqualizer</strong></span></span></dt><dd><p>
  Включает/выключает эквалайзер.
  </p></dd><dt><span class="term"><span class="bold"><strong>evExit</strong></span></span></dt><dd><p>
  Выход из программы.
  </p></dd><dt><span class="term"><span class="bold"><strong>evIconify</strong></span></span></dt><dd><p>
  Сворачивает окно в иконку.
  </p></dd><dt><span class="term"><span class="bold"><strong>evLoad</strong></span></span></dt><dd><p>
  Открывает файл (открывая окно навигации, в котором вы можете выбрать файл).
  </p></dd><dt><span class="term"><span class="bold"><strong>evLoadPlay</strong></span></span></dt><dd><p>
  Делает то же, что и <code class="literal">evLoad</code>, но запускает вопроизведение файла
  автоматически после его загрузки.
  </p></dd><dt><span class="term"><span class="bold"><strong>evLoadSubtitle</strong></span></span></dt><dd><p>
  Загружает файл с субтитрами (с диалогом выбора файла).
  </p></dd><dt><span class="term"><span class="bold"><strong>evLoadAudioFile</strong></span></span></dt><dd><p>
  Загружает звуковой файл (с диалогом выбора файла).
  </p></dd><dt><span class="term"><span class="bold"><strong>evNone</strong></span></span></dt><dd><p>
  Пустое сообщение, не имеет действий (за исключением, возможно, Subversion версий :-)).
  </p></dd><dt><span class="term"><span class="bold"><strong>evPlaylist</strong></span></span></dt><dd><p>
  Открывае/закрывает окно со списком воспроизведения.
  </p></dd><dt><span class="term"><span class="bold"><strong>evPlayDVD</strong></span></span></dt><dd><p>
  Пытается открыть диск в указанном устройстве DVD-ROM.
  </p></dd><dt><span class="term"><span class="bold"><strong>evPlayVCD</strong></span></span></dt><dd><p>
  Пытается открыть диск в указанном устройстве CD-ROM.
  </p></dd><dt><span class="term"><span class="bold"><strong>evPreferences</strong></span></span></dt><dd><p>
  Открывает окно с настройками.
  </p></dd><dt><span class="term"><span class="bold"><strong>evSetAspect</strong></span></span></dt><dd><p>
  Включает показ пропорций изображения.
  </p></dd><dt><span class="term"><span class="bold"><strong>evSetURL</strong></span></span></dt><dd><p>
  Отображает диалог ввода URL.
  </p></dd><dt><span class="term"><span class="bold"><strong>evSkinBrowser</strong></span></span></dt><dd><p>
  Открывает окно навигации по скинам.
  </p></dd></dl></div></div><div class="sect1" title="B.5. Создание качественного скина"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="skin-quality"></a>B.5. Создание качественного скина</h2></div></div></div><p>
Итак, вы прочитали о создании скина для
<span class="application">MPlayer</span> GUI, прекрасно нарисовали все в
<span class="application">Gimp</span> и желаете отправить скин нам?
Прочтите некоторые руководства для избежания основных ошибок и
создания высококачественного скина.
</p><p>
Мы хотим, чтобы скины, добавляемые нами в репозиторий, удовлетворяли
некоторым стандартам качества. Есть также несколько вещей,
сделающих вашу жизнь проще.
</p><p>
В качестве примера можете посмотреть на скин <code class="systemitem">Blue</code>,
начиная с версии 1.5, он удовлетворяет всем критериям, указанным ниже.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
  Каждый скин должна идти с файлом
  <tt class="filename">README</tt>, содержащим информацию о вас, авторе,
  правах на копирование, лицензионным уведомлением и всем другим,
  что вам захочется добавить. Если хотите иметь историю изменений, то
  этот файл - хорошее место для нее.
  </p></li><li class="listitem"><p>
  Должен быть файл <tt class="filename">VERSION</tt>,
  содержащий только номер версии скина в одной строке
  (например 1.0).
  </p></li><li class="listitem"><p>
  Горизонтальные и вертикальные элементы управления
  (такие как ползунки громкости или положения) должны иметь
  кнопку-ползунок точно отцентрированную по центру самого ползунка.
  Должно быть возможно двигать кнопку к обоим концам ползунка,
  но не выходить за них.
  </p></li><li class="listitem"><p>
  Элементы скина должны иметь правильные размеры,
  указанные в файле skin. Если это не так, вы сможете щелкнуть, например,
  мимо кнопки и все равно она сработает, или наоборот кликнуть на нее,
  не вызвав никакого действия.
  </p></li><li class="listitem"><p>
  Файл <tt class="filename">skin</tt> должен быть набран аккуратно
  и не должен содержать символов табуляции. Аккуратно набран означает,
  что числа должны выравниваться стройно в столбцы.
  </p></li></ul></div></div></div></div></body></html>
